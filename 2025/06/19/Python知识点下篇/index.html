<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Python教程：应用之巅 | 格物致知</title><meta name="keywords" content="Python爬虫, 数据分析, Django, Flask, Web开发"><meta name="author" content="Prorise"><meta name="copyright" content="Prorise"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#cee8ff"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Python教程：应用之巅"><meta name="application-name" content="Python教程：应用之巅"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#cee8ff"><meta property="og:type" content="article"><meta property="og:title" content="Python教程：应用之巅"><meta property="og:url" content="https://prorise-cool.github.io/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/index.html"><meta property="og:site_name" content="格物致知"><meta property="og:description" content="Python系列教程终章：应用之巅。本篇将带您进入实战领域，通过案例讲解如何使用Python进行单元测试、所有的标准类库的使用详解"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2025/06/17/685113b7c7d81.webp"><meta property="article:author" content="Prorise"><meta property="article:tag" content="全栈, Full Stack, 前端, 后端, Node.js, Vue, React, 数据库, Linux, Docker, 个人博客, 技术分享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2025/06/17/685113b7c7d81.webp"><meta name="description" content="Python系列教程终章：应用之巅。本篇将带您进入实战领域，通过案例讲解如何使用Python进行单元测试、所有的标准类库的使用详解"><link rel="shortcut icon" href="/img/icons/favicon.ico"><link rel="canonical" href="https://prorise-cool.github.io/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media=&quot;all&quot;"><script async="" src="https://www.googletagmanager.com/gtag/js?id=[object Object]"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","[object Object]")</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"Prorise","mode":"tianli","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"S-DNA1JM95BX2F9L0N","Referer":"https://xx.xx/"},
  diytitle: undefined,
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.prorise666.site/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"b39753735ed0ed5ffeb771bc108e3158","mailMd5":"ec3291d59a8d7d3675df8a0537fcbc979f0fa611c8df55841fb7f4fd162bd07a"},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤣 全栈开发工程师","🙂 前端架构设计师","🙃 后端服务构建者","🤩 移动端应用开发","🤯 数据库设计专家","🥳 DevOps运维实践者","🤭 技术栈多面手","😎 性能优化达人"]},
  algolia: {"appId":"K8Y7M0RMXQ","apiKey":"11fa7380e2694483a44b143044e69e6e","indexName":"prorise_blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":3,"position":"top","messagePrev":"距离上次更新已经过了","messageNext":"天，文章内容可能已经过时。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Prorise","link":"链接: ","source":"来源: 格物致知","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"格物致知",title:"Python教程：应用之巅",postAI:"true",pageFillDescription:"第十八章 单元测试, 18.1 单元测试简介：, 18.2 Pytest 简介与核心优势, 18.3 Pytest 核心特性概览, 18.4 Pytest 基础实践, 18.4.1 编写第一个 Pytest 测试：测试加法函数, 18.4.2 测试异常：pytest.raises, 18.5 Pytest Fixtures：强大的依赖注入与测试准备, 18.5.1 Fixture 基本概念与应用：@pytest.fixture, 18.5.2 Fixture 的作用域 (Scope), 18.5.3 使用 yield 实现 Fixture 的 Teardown (清理操作), 第十九章 标准内置库详解, 1、时间处理模块详解, time 模块, time 模块常用函数, struct_time 对象详解, strftime 和 strptime 常用格式化符号, time 模块代码示例, time 模块开箱即用函数x2F场景, a. 获取特定格式的当前时间字符串, b. 测量函数执行时间, c. 时间戳与格式化字符串之间的转换, datetime 模块, datetime 模块核心类x2F方法, datetime 模块代码示例, datetime 模块开箱即用函数x2F场景, a. 获取不同精度的当前时间, b. 计算未来或过去的日期, c. 安全地解析日期字符串, d. 计算两个日期之间的天数x2F小时数x2F分钟数, time 与 datetime 模块的选择与注意事项, 2、随机数模块详解, random 模块介绍, random 模块常用函数, random 模块代码示例, random 模块开箱即用函数x2F场景, a. 生成指定长度的随机字符串（用于非加密场景）, b. 模拟多次掷骰子并统计结果, c. 从加权列表中随机抽取奖励, d. 生成一个范围内的随机日期, 3、操作系统交互与文件处理模块, os 模块：与操作系统交互的基础（核心）, os 及 os.path 常用功能, os 模块代码示例, shutil 模块：高级文件操作, shutil 常用函数, shutil 模块代码示例, pathlib 模块：面向对象的文件系统路径, pathlib 常用类与方法, pathlib 模块代码示例, pathlib 模块开箱即用场景, a. 递归查找指定类型的文件并处理, b. 安全地创建多级目录结构, zipfile 模块：处理 ZIP 压缩文件, zipfile 常用功能 (基于 ZipFile 对象), zipfile 模块代码示例, tarfile 模块：处理 TAR 归档文件, tarfile 常用功能 (基于 TarFile 对象), tarfile 模块代码示例, 4.系统交互与进程管理模块, sys 模块：与 Python 解释器深度交互, sys 模块常用属性和函数, sys 模块代码示例, argparse 模块：强大的命令行参数解析（核心）, argparse 模块核心功能, argparse 模块代码示例, subprocess 模块：管理子进程, subprocess 常用功能, subprocess 模块代码示例, 5.日志与配置管理模块, configparser 模块：读写 INI 配置文件, configparser 常用功能, configparser 模块代码示例 (读取、修改、创建), , logging 模块：Python的日志记录系统（核心）, logging 模块基本使用与日志级别, logging 模块基础配置代码示例 (basicConfig), logging 模块核心组件 (Loggers Handlers Formatters), logging 模块高级配置代码示例 (使用字典配置 dictConfig), logging 模块使用文件配置 (.inix2F.cfg), logging 模块开箱即用场景, a. 为脚本快速设置日志记录到文件和控制台, Loguru 模块：更简单的日志记录, Loguru 核心特性与常用功能, Loguru 模块代码示例, Loguru 模块开箱即用场景, a. 快速为脚本设置控制台和文件日志, 6.较为不常用实用库, contextlib 模块：简化上下文管理器, contextlib 常用功能, contextlib 模块代码示例, tempfile 模块：处理临时文件和目录, tempfile 常用功能, tempfile 模块代码示例, glob 模块：文件路径名模式匹配, glob 常用功能, glob 模块代码示例, uuid 模块：生成通用唯一标识符, uuid 常用功能与版本, uuid 模块代码示例, 7.底层工具库, typing 模块：类型提示支持, typing 常用类型与构造器, typing 模块代码示例, itertools 模块：高效的迭代器构建工具, itertools 常用功能, itertools 模块代码示例, functools 模块：高阶函数与可调用对象工具, functools 常用功能, functools 模块代码示例, copy 模块：对象的浅拷贝与深拷贝, copy 常用功能, pprint 模块：数据结构的美化输出, pprint 常用功能, pprint 模块代码示例, 第二十章：Python 语法新特性总结 (3.8 ~ 3.13), Python 3.8 主要特性, 1. 赋值表达式 (海象操作符) =, 2. 仅位置参数 (/), 3. f-string 增强 (=) 用于调试, Python 3.9 主要特性, 1. 字典合并与更新操作符 (| 和 |=), 2. 类型注解的内置集合类型 (泛型), 3. 字符串方法：removeprefix() 和 removesuffix(), Python 3.10 主要特性, 1. 结构化模式匹配 (matchx2Fcase), 2. 联合类型操作符 (|), 3. 上下文管理器改进：括号内多个 with 表达式, Python 3.11 主要特性, 1. 异常组 (ExceptionGroup) 和异常注释 (add_note()), 2. Self 类型, 3. LiteralString 类型, Python 3.12 主要特性, 1. 泛型类和函数的简化语法 (PEP 695), 2. 类型别名与类型变量语法改进 (type 语句) (PEP 695), 3. f-string 语法进一步改进 (PEP 701), Python 3.13 主要特性, 1. @typing.override 装饰器 (PEP 698), 第二十一章：项目结构规范与最佳实践, 一、推荐的 Python 项目结构, 1. 目录树概览, 2. 各部分详解, a. my_project/ (项目根目录), b. my_package/ (主应用包), c. tests/ (测试目录), d. docs/ (文档目录), e. examples/ (示例代码目录), f. .gitignore, g. LICENSE, h. README.md, i. requirements.txt, j. setup.py (或 pyproject.toml + setup.cfg), 二、代码质量与风格指南 (PEP 8 核心实践), 三、总结与工具第十八章单元测试软件开发的核心目标之一是交付高质量运行稳定的代码单元测试是保障这一目标的重要手段它专注于验证软件中最小可测试单元通常是函数方法或类的行为是否符合预期在本章中我们将深入学习中广受欢迎的测试框架单元测试简介单元测试通过在开发早期发现并修复问题从而提升代码质量增强代码重构的信心并作为一种活文档辅助理解代码功能基本流程隔离单元确定要测试的函数方法或类定义预期明确该单元在特定输入下应有的输出或行为编写测试使用测试框架编写代码来验证这些预期执行测试运行测试并检查结果迭代优化根据测试结果修改代码或测试本身简介与核心优势是一个成熟且功能齐全的测试框架它使得编写小型易读的测试变得简单并且可以扩展以支持复杂的函数式接口或系统级测试为什么选择极简样板代码相比需要的模板代码更少测试函数就是普通的函数不需要继承任何类强大的语句直接使用标准的语句进行断言会提供详细的断言失败信息灵活的的系统非常强大用于管理测试依赖和测试上下文的准备与清理比传统的更灵活丰富的插件生态拥有大量高质量的第三方插件如覆盖率并行测试等良好的兼容性可以运行基于和编写的测试用例清晰的测试报告默认提供易读的测试报告安装您可以使用来安装核心特性概览的强大功能主要体现在以下几个核心特性上本笔记将逐一介绍特性概念简介涉及的主要元素用法测试发现自动查找符合特定命名约定的测试文件和函数文件名或函数方法名基本测试函数普通函数即可作为测试用例无需继承特定类断言使用内置的语句进行结果验证提供详细的错误报告异常测试优雅地测试代码是否按预期抛出异常上下文管理器测试固件管理测试函数的依赖状态和资源实现代码复用和模块化装饰器用于参数化测试使用不同的参数多次运行同一个测试函数避免代码重复装饰器标记为测试函数添加元数据用于分类跳过标记预期失败等如运行测试通过命令行工具运行测试并提供多种选项命令及其参数如基础实践编写第一个测试测试加法函数会自动发现当前目录及其子目录下所有命名为或的文件中的开头的函数被测代码计算两个数的和测试代码导入需要测试的函数测试基本的加法功能直接使用进行断言应该等于可选的错误信息这里一定会报错因为测试负数相加代码注释与讲解测试文件命名为遵循的发现约定测试函数和以开头直接使用语句如果后的表达式为会将该测试标记为失败并提供详细的上下文信息最后的部分是可选的如果断言失败这个消息不会像的参数那样直接显示会通过其内省机制提供更丰富的失败信息运行测试会自动找到并执行和测试异常当需要验证代码是否按预期抛出特定异常时可以使用被测代码包含函数计算一个数的平方输入必须是数字测试代码需要导入来使用等特性测试正数的平方测试负数的平方测试零的平方测试当输入无效时函数是否抛出是一个上下文管理器用于断言在块内执行的代码会抛出指定类型的异常如果代码块中没有抛出测试将失败如果代码块中抛出了其他类型的异常测试也将失败呵呵呵呵呵这行代码应该抛出这个测试能通过是因为函数在接收到字符串参数时会抛出当使用上下文管理器时如果代码块内抛出了会捕获这个异常并使测试通过这正是我们期望的行为测试异常的错误信息是否符合预期可选的参数允许提供一个正则表达式用于验证抛出的异常实例的错误消息这对于确保错误信息对用户友好且准确非常有用如果抛出的异常消息与提供的正则表达式不匹配测试将失败输入必须是数字参数使用正则表达式匹配错误信息强大的依赖注入与测试准备测试固件是中一个非常核心且强大的特性它们用于为测试函数类模块或整个会话设置必要的预置条件如数据对象实例服务连接等并在测试结束后进行清理基本概念与应用通过装饰器可以将一个函数标记为测试函数可以通过将其名称作为参数来请求使用这个示例一个提供简单列表数据的返回的值会注入到测试函数中一个提供简单字典数据的将名称作为参数测试的长度测试的内容一个测试可以使用多个测试的值并同时使用确认也被正确注入代码注释与讲解装饰器将和函数转换为当测试函数如在其参数列表中包含名称时会在执行该测试函数之前先执行对应的函数并将其返回值注入到测试函数的同名参数中复用性同一个可以被多个测试函数使用避免了重复的设置代码声明式依赖测试函数清晰地声明了它所依赖的上下文或数据的作用域可以定义不同的作用域以控制其执行的频率和生命周期作用域通过的参数指定作为单元测试来说没有必要区分的这么死板平常来说使用默认值即可若有严格需求再详细区分作用域默认每个测试函数执行一次是开销最小隔离性最好的作用域每个测试类执行一次用于类中所有测试方法共享的创建开销较大的资源每个模块执行一次每个包执行一次且整个测试会话即一次命令的完整执行过程执行一次适用于全局的创建非常昂贵的资源示例函数级别每个测试函数都会重新创建一次设置函数级别的每个测试函数都会重新创建函数值清理函数级别的类级别每个测试类只创建一次类中所有测试方法共享设置类级别的每个测试类只创建一次类值清理类级别的模块级别整个测试模块文件只创建一次所有测试共享设置模块级别的整个测试文件只创建一次模块值清理模块级别的会话级别整个测试会话只创建一次所有测试模块共享设置会话级别的整个测试会话只创建一次会话值清理会话级别的代码注释与讲解观察运行用于显示输出时的输出可以清晰地看到不同作用域的时机使用实现的清理操作如果需要在测试使用完毕后执行清理操作类似于中的可以使用语句之前的代码是部分之后的代码是部分示例使用用于创建更安全的临时文件目录每个测试函数都会得到一个新的临时文件创建一个包含内容的临时文件测试结束后该临时文件会被自动清理创建临时文件并写入内容创建一个有名字的临时文件确保在块结束后文件不会立即删除这样测试函数才能访问它我们需要手动删除或者使用见会更简单使用可以获得文件名和文件描述符更可控设置创建临时文件使用文件描述符打开将文件路径和预期的内容传递给测试函数删除临时文件清理删除临时文件测试从创建的临时文件中读取内容解包返回的值测试运行中访问测试临时文件在测试执行期间确实存在测试运行中检查代码注释与讲解语句是和的分界点它将和提供给测试函数之后的代码在使用该的测试函数执行完毕后无论成功或失败执行第十九章标准内置库详解时间处理模块详解在开发中处理日期和时间是常见的需求无论是记录日志数据打点任务调度还是处理用户输入都离不开时间模块标准库主要提供了和两个模块来处理时间模块模块提供了对语言库中时间相关函数的底层访问接口主要用于获取时间戳进行时间格式转换以及控制程序执行流程如暂停它处理的时间通常与操作系统的本地时间或协调世界时相关模块常用函数下表列出了模块中一些核心且常用的函数函数描述返回当前时间的时间戳自年月日到现在的浮点秒数将一个时间戳默认为的返回值转换为本地时间的对象如果未提供则使用当前时间将一个时间戳默认为的返回值转换为格林威治标准时间的对象如果未提供则使用当前时间的反函数接收一个对象本地时间作为参数并返回其对应的时间戳浮点秒数接收一个对象默认为的返回值并返回一个个字符的可读字符串例如不推荐在新代码中使用将对象默认为的返回值按照指定的字符串格式化为时间字符串这是最常用的时间格式化函数将时间字符串按照指定的解析为对象暂停当前程序的执行指定的秒数可以是浮点数表示更精确的时间返回一个具有最高可用精度的性能计数器的值以秒为单位用于测量短时间间隔它的参考点是未定义的因此只有连续调用的结果之间的差异才是有效的返回当前进程的执行时间用户时间系统时间的总和以秒为单位不包括睡眠时间批注核心记忆函数获取时间戳是很多时间操作的基础将时间戳转为本地时间元组便于访问时间的各个部分强烈推荐记忆用于将时间元组格式化为任意字符串非常灵活和常用用于将特定格式的字符串解析回时间元组控制程序执行节奏非常实用在需要将本地时间元组转换回时间戳时使用对象详解和函数返回的是对象它是一个包含九个整数的元组实际上是一个具有命名属性的元组因此可以通过索引和属性名访问索引属性名值范围含义例如年份到月份到日期到小时到分钟到闰秒秒到周一为星期几到一年中的第几天或是否为夏令时和常用格式化符号用于将时间元组格式化为字符串而则相反用于将字符串解析为时间元组它们使用相同的格式化代码格式符含义示例基于周一四位数的年份两位数的年份两位数的月份两位数的日期小时制的小时小时制的小时两位数的分钟两位数的秒数完整的星期几名称本地化英文环境简写的星期几名称本地化英文环境完整的月份名称本地化英文环境简写的月份名称本地化英文环境星期几周日为周一为周六为如果周日是一年中的第几天本地化本地化的日期和时间表示本地化的日期表示美式本地化的时间表示一个字面的字符注意的行为周日是还是周一是可能因平台而异中的始终是周一为模块代码示例获取当前时间戳自纪元以来的秒数当前时间戳例如将时间戳转换为本地时间的对象本地时间元组访问的属性年份月份日期小时分钟秒数星期几周一一年中的第几天夏令时将时间戳转换为时间的对象时间元组年份小时将本地时间的对象转换回时间戳从本地时间元组转换回的时间戳应与非常接近使用获取可读字符串不推荐在新代码中使用等同于格式的时间例如使用将格式化为自定义字符串强烈推荐自定义格式化时间例如使用将字符串解析为对象解析结果解析得到的年份程序暂停程序开始执行暂停秒程序暂停秒后继续执行性能计数器用于测量小段代码执行时间执行一些操作高性能计数器测量的操作耗时秒进程时间执行一些密集型操作密集型操作的进程耗时秒模块开箱即用函数场景获取特定格式的当前时间字符串获取当前本地时间并按指定格式返回字符串参数使用的时间格式化字符串返回格式化后的当前时间字符串示例使用当前日期时间输出示例当前日期输出示例当前时间输出示例测量函数执行时间测量并打印指定函数执行所需的时间参数需要测量执行时间的函数传递给的位置参数传递给的关键字参数返回的返回值使用更精确函数执行耗时秒示例函数模拟耗时操作操作完成参数为测量示例函数的执行时间时间戳与格式化字符串之间的转换将时间戳转换为指定格式的本地时间字符串将指定格式的时间字符串转换为本地时间戳示例当前时间戳时间戳字符串字符串时间戳模块模块是中处理日期和时间的更高级更面向对象的接口它定义了几种类用于处理日期时间日期时间时间差以及时区信息相比模块模块的功能更强大使用更直观尤其适合进行复杂的日期时间运算和时区处理模块核心类方法类方法描述表示一个理想化的日期对象具有属性类方法返回当前的本地日期类方法根据给定的时间戳返回本地日期表示一个理想化的时间对象具有属性表示日期和时间的组合包含和对象的所有信息类方法返回当前的本地日期和时间如果提供了可选参数一个对象则返回对应时区的日期时间类方法返回当前的日期和时间但返回的是一个对象无时区信息不推荐使用请用替代类方法根据时间戳返回本地日期和时间如果提供了则返回对应时区的日期时间类方法将符合格式的日期字符串解析为对象实例方法将或对象格式化为字符串表示两个日期或时间之间的时间差可以用于日期时间的加减运算的一个具体子类表示一个固定的偏移量例如代表时区批注核心记忆类与方法最核心的类用于表示精确的日期和时间当只需要日期部分时使用当只需要时间部分时使用非常重要用于进行日期时间的加减运算获取当前日期时间常用将字符串解析为对象常用将对象格式化为字符串用于创建时区感知的对象模块代码示例日期时间操作示例获取当前日期时间本地时区的当前日期时间当前日期时间年份月份日期小时分钟秒数微秒获取当前日期时间获取时区的当前日期时间当前日期时间创建特定的日期时间对象年月日特定日期时间对象创建对象和对象特定日期年份月份日期星期几周一周日是特定时间小时分钟秒数日期时间格式化年月日时分秒星期格式化后的日期时间日期时间解析解析后的日期时间时间差时间差日期时间运算当前时间加五天小时分钟未来日期时间当前时间减去周后计算两个日期时间的差年月日两个对象之间的差相差天数相差总秒数与时间戳转换将本地对象转换为时间戳当前对象对应的时间戳从时间戳创建本地对象从时间戳转换回的本地从时间戳创建对象从时间戳转换回的替换日期时间的某些部分替换年份和微秒后的时区处理创建一个表示东八区的对象北京时间当前北京时间北京时间的时区信息将一个对象转换为对象假设是北京时间赋予北京时区将一个对象转换到另一个时区北京时间转换为时间模块开箱即用函数场景获取不同精度的当前时间获取格式化的当前日期时间字符串参数使用的时间格式化字符串可以用于表示微秒如果为则返回时间否则返回本地时间返回格式化后的当前日期时间字符串示例本地当前精确时间输出示例当前日期输出示例假设当前日期计算未来或过去的日期根据偏移量计算未来或过去的日期时间参数天数偏移正数表示未来负数表示过去周数偏移小时数偏移基准日期时间默认为当前本地时间返回计算后的日期时间对象示例一周后的日期时间三天前的中午点安全地解析日期字符串尝试按指定格式解析日期字符串如果失败则返回参数要解析的日期字符串使用的日期格式返回解析成功则返回对象否则返回通常我们只关心日期部分错误字符串无法匹配格式示例成功解析格式不匹配解析失败成功解析计算两个日期之间的天数小时数分钟数计算两个日期时间字符串之间的差异参数第一个日期时间字符串第二个日期时间字符串日期时间字符串的格式返回包含天数总小时数总分钟数总秒数的字典如果解析失败返回日期时间字符串格式错误或无效确保总是大于如果不是则交换它们或返回负值表示在之后示例从到相差天数总小时数总分钟数总秒数对象从到注意这里是反向的相差天数将会是负数与模块的选择与注意事项精度返回的时间戳通常具有微秒级精度取决于操作系统对象也支持微秒易用性对于复杂的日期时间运算时区处理以及更清晰的模块通常是更好的选择底层访问如果你需要与库或其他需要时间戳秒数的系统交互很直接时区处理模块对时区的支持有限依赖于系统本地时区提供时间模块通过抽象基类及其子类如提供了更健壮的时区处理能力处理跨时区应用时强烈建议使用并明确指定时区通常将所有时间转换为存储和处理仅在显示时转换为本地时区字符串转换和是这两个模块共有的重要功能但它们作用的对象类型不同对象对象的方法通常更易用不可变性对象都是不可变的这使得它们在用作字典键或在多线程环境中更安全格式在进行数据交换时推荐使用标准格式例如或表示对象有方法可以直接生成此格式在现代开发中除非有特定需求要使用模块的底层功能或性能计数器否则模块通常是进行日期和时间操作的首选随机数模块详解在编程中随机数扮演着重要的角色可用于模拟游戏数据抽样生成测试数据等多种场景的标准库通过模块提供了生成伪随机数的工具模块介绍模块实现了用于各种分布的伪随机数生成器这些是伪随机数意味着它们是通过一个确定性的算法生成的但其序列在统计上看起来是随机的如果不显式设置种子序列的起点通常是不可预测的模块常用函数下表列出了模块中一些核心且常用的函数函数描述初始化随机数生成器让随机序列可以被复现获取随机数生成器当前的内部状态恢复随机数生成器到之前保存的状态返回一个到之间不包括的随机小数返回一个在和之间的随机小数返回一个在和之间包括和的随机整数从一个按步长生成的整数序列中随机选一个数不包括从一个列表元组或字符串等序列中随机选择一个元素从总体中进行次可重复的随机抽样可以设置权重从总体中随机选择个不重复的元素将一个列表中的元素顺序随机打乱直接修改原列表生成一个符合正态分布高斯分布的随机数是平均值是标准差生成一个符合指数分布的随机数批注核心记忆函数需要结果可复现时使用生成基础随机小数非常常用获取范围内随机整数非常常用从序列中随机挑一个选取多个不重复项打乱列表顺序带权重或可重复抽样时使用模块代码示例设置随机数种子以获得可复现的结果随机数种子设置使用特定的种子为了下面的测试这里需要注释掉使用种子生成的第一个随机数使用种子生成的第二个随机数重置种子同上这里需要注释掉重置种子后生成的第一个随机数输出会和上面第一个相同生成之间的随机浮点数生成随机浮点数生成的随机浮点数生成指定范围内的随机浮点数只有浮点数会变生成指定范围内的随机浮点数生成的随机浮点数生成指定范围内的随机整数生成随机范围的随机整数生成的随机整数到指定步长的随机整数生成指定步长的随机整数从到中选择一个的倍数生成的随机整数到步长从序列中随机选择一个元素从序列中随机选择一个元素红橙黄绿蓝紫颜色列表随机选择的颜色从序列中随机选择个元素可重复带权重从序列中随机选择个元素可重复石头剪刀布石头有的概率被选中剪刀和布各有的概率选择个默认带权重选择个元素选择个可重复的元素带权重选择个可重复元素随机打乱新序列元素的顺序随机打乱新序列元素的顺序玩家玩家玩家玩家原始玩家顺序直接修改打乱后的玩家顺序模块开箱即用函数场景生成指定长度的随机字符串用于非加密场景生成一个指定长度的简单随机字符串参数生成字符串的长度是否包含大小写字母是否包含数字是否包含标点符号返回生成的随机字符串如果用户什么都没选默认只用小写字母示例生成的位随机字母数字生成的位复杂随机码安全提示此函数生成的随机字符串不应用于密码会话令牌等安全敏感的场景对于这些场景请务必使用的模块它能提供密码学强度的随机性模拟多次掷骰子并统计结果模拟多次掷骰子并返回每次的结果及统计参数掷骰子的次数骰子的面数返回包含所有掷骰结果的列表结果计数的对象示例模拟掷次面骰子所有结果列表可能太长选择性打印结果统计最常出现的点数从加权列表中随机抽取奖励根据权重从奖励列表中随机抽取一个奖励参数一个字典键是奖励值是对应的权重整数或浮点数例如金币装备药水返回抽中的奖励或者抛出异常示例金币小体力药剂随机材料包稀有装备碎片模拟每日签到奖励抽取次第天签到获得生成一个范围内的随机日期在给定的开始日期和结束日期之间生成一个随机日期参数开始日期字符串结束日期字符串日期字符串的格式返回生成的随机日期对象如果日期解析失败则返回日期格式错误或日期无效开始日期不能晚于结束日期再次检查以防万一加使结束日期也可能被选中示例在和之间随机生成的生日年月日会打印错误信息操作系统交互与文件处理模块在编程中与操作系统进行交互如管理文件和目录执行系统命令以及处理文件如复制移动压缩是非常常见的任务标准库为此提供了多个强大的模块主要包括和模块与操作系统交互的基础核心模块提供了一种可移植的方式来使用操作系统的功能例如读取或写入文件操作目录路径获取环境变量等它的一个重要子模块是专门用于处理路径字符串及常用功能方法属性描述获取当前脚本的工作目录路径更改当前脚本的工作目录到列出指定目录下的所有文件和文件夹名称创建一个名为的新目录如果路径中的父目录不存在会失败递归创建多级目录如果则目录已存在时不会报错删除指定路径的文件删除指定路径的空目录如果目录非空则会失败重命名文件或目录从名称改为名称一个表示环境变量的字典可以用来获取或设置环境变量在系统的中执行命令谨慎使用有安全风险强烈推荐智能地拼接一个或多个路径部分自动处理不同操作系统的分隔符检查指定的路径是否存在文件或目录检查指定的路径是否是一个文件检查指定的路径是否是一个目录获取指定文件的大小以字节为单位获取路径中的文件名部分获取路径中的目录部分获取路径的绝对路径将路径分割为文件名主体扩展名的元组批注核心记忆功能和管理当前工作目录查看目录内容创建目录删除文件和空目录极其重要用于跨平台安全地构造路径判断路径类型解析路径字符串模块代码示例目录操作目录操作当前工作目录创建单级目录目录已创建推荐使用递归创建存在亦可多级目录已创建或已存在当前目录内容列出当前目录内容最多显示个路径操作路径操作示例路径处理路径目录名输出文件名输出扩展名输出分割主体扩展名输出使用拼接的路径文件操作文件操作文件存在是否是文件文件大小字节重命名文件已重命名为删除文件文件已删除文件不存在环境变量环境变量获取环境变量环境变量未设置设置环境变量仅对当前进程及其子进程有效执行系统命令执行系统命令执行系统命令或可以判断操作系统命令执行完毕返回码更好的方式是使用模块它提供了更强的控制能力和安全性清理创建的目录使用更加优雅的方式去递归删除目录已成功删除目录不存在坑点与建议模块路径拼接务必使用来构造路径它会自动处理不同操作系统的路径分隔符增强代码的可移植性尽量避免使用尤其当命令包含用户输入时可能存在安全风险命令注入对于需要执行外部命令的场景模块是更安全更灵活的选择用于删除文件用于删除空目录如果要删除非空目录及其所有内容请使用权限问题文件和目录操作可能会因为权限不足而失败应使用来捕获和处理这类异常模块对于更现代面向对象的文件系统路径操作引入的模块是一个很好的选择它提供了更直观的但从使用层面受众程度来说使用模块的程序员会占更多数模块高级文件操作模块提供了许多高级的文件和文件集合操作功能例如复制移动删除整个目录树等是对模块中基本文件操作的补充常用函数函数描述复制文件到如果是目录则复制到该目录下类似但同时会尝试复制文件的元数据如权限时间戳仅复制文件内容从到不复制元数据递归地复制整个目录树从到危险操作递归地删除整个目录树包括非空目录递归地移动文件或目录到类似的命令创建一个压缩归档文件如或批注核心记忆函数模块复制文件时通常比更好因为它保留元数据复制整个文件夹要特别小心使用用于删除整个文件夹及其内容移动文件或文件夹创建压缩包模块代码示例准备测试环境源文件测试准备的源文件复制文件或如果是一个目录文件会被复制到该目录下并保持原名如果是一个文件名则文件会被复制并重命名为保留更多元数据文件已使用复制到复制目录树必须是不存在的目录会创建它先清理防止上次运行残留目录树已复制到移动文件或目录移动文件文件已移动到返回目标路径移动并重命名目录目录已移动并重命名为删除目录树非常危险会无提示删除所有内容创建一些内容准备删除目录目录已使用删除创建压缩包是不带扩展名的归档文件名是归档格式如是要压缩的根目录生成目录已压缩为清理测试环境测试环境已清理模块面向对象的文件系统路径模块是版本引入的标准库它将文件系统路径表示为具有方法和属性的实际对象而不是简单的字符串这种面向对象的方法使得路径操作更加清晰易读并且减少了在处理不同操作系统路径分隔符时可能出现的错误常用类与方法核心类是它同时代表文件和目录路径类属性方法描述导入核心的类创建一个对象可以传入字符串路径或已有的对象类方法返回一个表示当前工作目录的对象类方法返回一个表示用户主目录的对象使用操作符轻松跨平台地拼接路径部分另一种拼接路径部分的方法可以接受多个参数属性获取路径的最后一部分文件名或目录名属性获取文件名中不包含最后一个后缀的部分属性获取路径的最后一个文件扩展名例如属性获取路径中所有文件扩展名的列表例如属性获取路径的直接父目录属性一个序列包含路径的所有父级目录直到根目录检查路径是否存在无论是文件还是目录检查路径是否指向一个已存在的文件检查路径是否指向一个已存在的目录检查路径是否指向一个符号链接检查路径是否为绝对路径将路径解析为绝对路径并处理任何符号链接如果且路径不存在则报错返回路径的绝对形式不解析符号链接创建此路径表示的目录会创建所有必需的父目录则目录已存在时不报错删除此路径表示的空目录删除此路径表示的文件或符号链接如果且文件不存在则不报错将此路径重命名或移动到路径类似但在目标已存在时会覆盖它如果操作系统支持原子操作创建此路径表示的文件类似命令如果文件已存在则更新其修改时间除非读取文件内容并将其作为字符串返回将字符串写入文件会覆盖已有内容读取文件内容并将其作为字节串返回将字节串写入文件会覆盖已有内容以指定模式打开文件返回一个文件对象与内置类似返回一个迭代器产生此目录路径下的所有直接子项文件和目录的对象在此路径下查找匹配的文件和目录返回一个生成器递归地在此路径及其所有子目录下查找匹配的文件和目录返回一个生成器返回一个包含此路径元数据信息的对象如大小修改时间等批注核心记忆功能模块创建对象是所有操作的开始操作符非常常用且直观用于安全地拼接路径判断路径状态方便地获取路径的各个组成部分创建目录的常用组合简单快速地读写文件内容遍历和搜索目录内容使用进行文件操作确保文件正确关闭模块代码示例用于获取当前目录等辅助操作用于演示后清理目录模块演示准备模块功能演示创建一个临时的演示工作目录演示目录名称使用拼接准备演示环境创建目录结构和文件创建演示环境于递归删除清理旧环境确保父目录也创建避免重复创建创建文件目录创建图片目录创建压缩包目录主脚本创建主脚本文件项目说明创建项目说明文件创建数据文件报告创建文档文件图片创建图片文件压缩包创建压缩包文件在下递归创建三层目录结构的数字文件创建三层目录结构的数字文件第一层第二层第三层每个第三层目录创建个文件第层第子层的数字文件演示环境准备完成于清理演示环境清理演示环境于递归删除演示目录演示环境清理完成清理路径为对象创建与基本属性对象创建与基本属性从字符串创建对象绝对路径示例相对路径示例对象对象基本属性是否为绝对路径是否为绝对路径下面都以来做为演示的文件名的后缀的父目录的祖先目录的绝对路径的规范化路径用于跨平台路径表示的网络路径用于网络路径表示的第个祖先目录当前工作目录和用户主目录当前工作目录用户主目录输出结果对象创建与基本属性对象对象是否为绝对路径是否为绝对路径的文件名的后缀的父目录的祖先目录的绝对路径的规范化路径的网络路径的第个祖先目录的第个祖先目录的第个祖先目录的第个祖先目录当前工作目录用户主目录输出结果路径拼接与解析演示路径的拼接和解析路径拼接与解析使用操作符拼接使用操作符拼接使用方法拼接使用方法拼接获取绝对路径前面我们创建了所以他应该是存在的的相对路径的绝对路径的解析后绝对路径不存在无法进行绝对路径解析输出结果使用操作符拼接使用方法拼接的相对路径的绝对路径的解析后绝对路径检查路径类型和状态演示检查路径的类型和状态检查路径类型和状态路径是否存在是否是文件是否是目录路径是否存在是否是文件是否是目录路径是否存在文件和目录操作演示文件的创建读写和目录的创建遍历文件和目录操作创建新目录如果父目录不存在则一并创建如果目录已存在不抛出错误目录已创建或已存在在新目录中创建并写入文件文件已创建并写入内容读取文件内容从读取的内容重命名文件文件已重命名为旧路径是否还存在新路径是否存在删除文件如果文件不存在不报错文件已删除删除空目录只能删除空目录空目录已删除如果要删除包含父目录的整个空结构需要逐级删除或使用建议直接使用空目录已删除文件目录操作时发生错误目录遍历与文件搜索演示遍历目录内容和使用搜索文件目录遍历与文件搜索遍历目录只遍历当前目录下的内容目录文件使用搜索当前目录下的文件在目录下搜索所有文件文件这里按照道理来说他只能访问到的目录他的里面是下一级的子目录所以是没有文件的使用递归搜索所有子目录中的文件在及其所有子目录下搜索文件而可以递归搜索所有子目录中的文件显示相对于的路径文件准备演示环境清理演示环境演示的所有操作属性演示路径拼接与解析演示检查路径的类型和状态演示文件和目录操作演示目录遍历与文件搜索模块开箱即用场景递归查找指定类型的文件并处理用于类型注解递归查找指定目录下具有特定扩展名的所有文件参数要搜索的根目录文件扩展名例如注意包含点返回一个生成器逐个产生找到的文件路径对象在目录中递归查找所有文件错误不是一个有效的目录返回一个生成器例如确保是文件因为也可能匹配到带后缀的目录名仅在此场景独立运行时执行创建一些临时文件用于演示注意这个后缀是函数演示找到以下文件共个未找到任何文件清理已清理演示目录安全地创建多级目录结构用于类型注解确保指定的目录路径存在如果不存在则创建它包括所有必需的父目录参数要确保存在的目录路径可以是字符串或对象返回对应的对象引发如果路径存在但不是一个目录或者创建失败且非权限问题检查并确保目录存在如果父目录不存在一并创建如果目录已存在不引发目录现在已存在更广泛地捕获可能的错误如权限问题创建目录时发生错误将异常重新抛出让调用者处理仅在此场景独立运行时执行函数演示演示使用字符串路径返回的对象该路径是否是目录演示使用已存在的路径应该不会报错清理如果需要要删除需要先删除其父目录如果它是唯一的或者直接删除如果它是顶层创建的已清理演示目录坑点与建议模块面向对象思维转变如果你习惯了中基于字符串的函数式调用例如切换到的面向对象方式例如可能需要一点时间适应但适应后通常会觉得更自然和强大性能考虑在绝大多数应用场景下的性能与相当甚至在某些情况下由于内部优化可能更快只有在对路径操作进行极端密集的循环例如每秒处理数百万个路径时才可能需要进行性能分析比较对于日常脚本和大多数应用程序带来的可读性和易用性提升远比微小的性能差异更重要与旧代码的互操作性对象实现了接口这意味着在很多接受字符串路径作为参数的内置函数和标准库函数中包括的很多函数等你可以直接传递对象会自动将其转换为字符串路径这使得逐步迁移到或在现有代码中引入它变得容易绝对路径相对路径要清楚你的对象代表的是绝对路径还是相对路径方法可以获取一个路径的绝对规范化形式并解析所有符号链接则简单地将相对路径转换为绝对路径但不解析符号链接文件系统操作的原子性像或这样的操作其原子性即操作要么完全成功要么完全不执行不会留下中间状态取决于底层操作系统和文件系统的支持异常处理所有执行实际文件系统操作如创建删除读写文件目录的方法都可能引发的各种子类异常如务必使用块来妥善处理这些潜在的错误提供了一种更现代更的方式来与文件系统路径交互一旦熟悉了它的面向对象特性很多路径相关的编程任务都会变得更加简单和愉快模块处理压缩文件模块用于创建读取写入追加和列出文件的内容通常与语句一起使用以确保文件正确关闭常用功能基于对象方法属性描述打开或创建一个文件读写追加返回文件中所有成员的名称列表返回文件中所有成员的对象列表包含详细信息获取指定成员的对象从文件中提取单个成员到指定路径从文件中提取所有成员到指定路径将文件写入文件可选的是在压缩包中的名称读取文件中成员的内容并返回字节串关闭文件推荐使用语句自动管理批注核心记忆功能模块使用打开文件向压缩包中添加文件解压整个压缩包查看压缩包内容模块代码示例准备测试文件模拟文件创建文件并添加文件创建文件指定在中的路径和名称直接写入字符串内容文件创建完成读取文件内容读取文件的内容文件列表文件详细信息文件名大小修改日期读取特定文件内容的内容未在压缩包中找到解压文件确保解压目录存在解压文件到或者只解压特定文件文件解压完成查看目录清理测试环境已清理模块处理归档文件模块用于读取和写入归档文件包括使用和压缩的文件与类似推荐使用语句常用功能基于对象方法属性描述打开或创建一个文件读写追加等返回归档中所有成员的名称列表返回归档中所有成员的对象列表包含详细信息获取指定成员的对象从归档中提取单个成员到指定路径从归档中提取所有或指定到路径将文件或目录添加到归档可选是在归档中的名称返回一个类似文件的对象用于读取成员的内容不实际解压到磁盘关闭文件推荐使用语句自动管理批注核心记忆功能模块使用打开文件注意如创建压缩包向归档中添加文件或目录解压整个归档查看归档内容模块代码示例用于清理准备测试文件创建子目录创建格式的压缩包创建归档文件例如创建文件表示以压缩方式写入添加整个目录指定其在压缩包内的根名称或者分别添加文件文件创建完成读取归档文件内容读取文件的内容表示以方式读取文件列表文件详细信息名称类型大小修改时间读取特定文件内容不解压到磁盘假设这是压缩包内的路径的内容文件在归档中未找到读取归档成员时出错解压归档文件解压文件到文件解压完成查看目录清理测试环境已清理系统交互与进程管理模块在开发中与程序运行的底层环境如操作系统解释器本身进行交互以及启动和管理外部的子进程是非常常见的需求和这三个标准库模块为此提供了强大的支持模块与解释器深度交互模块提供了访问和操作解释器本身以及其运行时环境的变量和函数通过它我们可以获取命令行参数管理模块搜索路径控制程序退出了解当前平台信息等模块常用属性和函数属性方法描述获取脚本启动时传入的命令行参数列表第一个是脚本名用来终止当前程序的执行可以指定一个退出状态码一个列表指明了导入模块时会去哪些目录下查找返回一个字符串告诉你当前运行的操作系统平台是什么获取当前解释器的详细版本信息字符串以元组形式提供版本号的各部分主版本次版本等获取当前正在运行的解释器程序文件的绝对路径代表标准输入流的对象程序可以从中读取数据通常来自键盘代表标准输出流的对象函数默认向这里输出通常是屏幕代表标准错误流的对象用于输出错误和警告信息通常是屏幕查询解释器允许的最大递归调用层数修改解释器允许的最大递归调用层数一个字典记录了当前已加载的所有模块及其对象批注核心记忆功能模块开发命令行工具时获取用户输入参数的起点控制脚本的退出行为和状态理解如何找到模块偶尔需要动态修改它编写跨平台或版本兼容代码时的判断依据对于需要精细控制输入输出的脚本很有用模块代码示例用于路径操作示例模块说明与准备模块功能演示以下示例展示模块的常用功能命令行参数命令行参数假设脚本运行时命令为脚本本身的名称所有命令行参数第一个传递的参数真实场景中参数解析通常会交给模块未提供额外的命令行参数给脚本版本和平台信息版本和平台信息完整版本字符串版本信息元组主版本号次版本号修订版本号当前操作系统平台解释器可执行文件路径模块搜索路径模块搜索路径解释器查找模块时会依次检查以下路径仅显示前条路径示例动态添加一个自定义模块目录到假设在脚本同级目录下有一个名为的文件夹插入到最前面优先搜索已将添加到现在可以尝试导入该目录下的模块之后若要移除或者路径已存在于中标准输入输出错误流标准输入输出错误流这是一条通过输出的成功消息这是一条通过输出的错误消息尝试从读取一行程序会在此等待输入从读取到用户中断了输入递归深度限制递归深度限制当前的递归深度限制是谨慎修改递归限制过高可能导致栈溢出使程序崩溃修改后的递归深度限制是恢复原状程序退出程序退出以下调用将被注释掉以允许脚本继续执行准备通过正常退出程序通常表示成功这行代码不应被执行因为会引发默认不会被普通捕获程序已通过退出退出码如果在这里不重新引发或再次调用程序实际上可能不会完全终止取决于上下文模块演示结束坑点与建议模块的手动解析对于需要多个参数不同类型参数可选参数帮助信息等的命令行工具手动解析会变得非常复杂和易错强烈推荐使用模块来处理命令行参数的修改时机与影响动态修改主要用于临时解决模块导入问题或在特定环境下加载模块过度依赖动态修改可能导致项目结构混乱和难以维护优先考虑使用的包管理机制虚拟环境如和设置环境变量与异常处理通过引发异常来终止程序这意味着块中的子句在程序退出前仍会执行这对于释放资源如关闭文件网络连接非常重要捕获异常通常是不必要的除非你有非常特殊的理由需要在程序退出前执行一些额外的清理逻辑并且标准的块无法满足需求递归深度的修改设置递归深度限制是为了防止因无限递归或过深递归耗尽调用栈空间从而导致程序崩溃只有在你完全理解递归算法的特性和潜在风险并且确认需要更大深度时才应谨慎地使用大多数情况下如果遇到递归深度限制应首先检查算法是否存在逻辑错误或考虑将其转换为迭代实现标准流的编码的默认编码取决于操作系统和环境设置在处理非字符时尤其是在跨平台应用中要注意编码问题可能需要显式设置流的编码或使用环境变量模块强大的命令行参数解析核心当你的脚本需要从命令行接收参数时提供了原始的参数列表但手动解析会非常繁琐且容易出错特别是当参数变多类型各异或需要可选参数和帮助信息时这时模块就派上了大用场它使得创建用户友好的命令行界面变得简单模块核心功能功能方法描述创建一个新的参数解析器对象它是定义和解析参数的起点向解析器添加一个参数定义指定其名称类型行为等解析命令行传入的参数默认来自并返回一个包含参数值的对象添加子命令功能使你的工具可以像一样拥有多个操作模式常用参数定义参数的名称如或标志如指定参数应该被自动转换成的目标类型如如果用户在命令行中没有提供该参数则赋予该参数一个默认值为该参数提供一段简短的描述会显示在自动生成的帮助信息中定义当参数出现时应执行的动作如用于布尔开关用于计数指明一个可选参数是否必须被用户提供限制参数的值只能从一个给定的选项列表中选择指定该参数可以接受的值的数量如表示一个或多个批注核心记忆功能模块创建解析器的第一步可以设置程序描述等最核心的方法用它来定义你的工具接受哪些位置参数和可选参数以及它们的行为调用此方法来实际解析中的参数并得到一个包含所有参数值的命名空间对象熟悉的各种选项是用好的关键当你的命令行工具功能较多需要划分为不同的子命令时例如和此功能非常有用模块代码示例用于的默认行为和模拟输入用于文件操作用于高级文件操作模块演示准备文件操作工具列出目录显示所有文件和目录当前目录文件目录显示目录内容文件文件已删除目录已删除创建对象创建一个解析器对象用于定义和处理命令行参数程序名称会显示在帮助信息中一个用于文件操作的命令行工具程序描述帮助信息的结尾文本添加子命令不同的文件操作指的是命令行参数的名称选择要执行的操作添加子命令列出目录内容列出目录内容要列出的目录路径显示所有文件和目录添加子命令删除文件删除文件要删除的文件路径坑点与建议模块用户友好性是目标精心设计你的命令行参数和帮助信息能够自动生成规范的帮助文档或这是工具易用性的重要组成部分利用和参数美化整体帮助信息为每个参数提供清晰的文本参数类型和充分利用参数进行自动类型转换例如会将用户输入的字符串转换为整数如果类型转换失败会自动向用户报告错误使用参数可以限制参数的有效取值范围布尔开关对于表示是否状态的选项例如使用如果参数出现则对应属性值为否则为或如果参数出现则对应属性值为否则为非常方便的灵活运用参数可选如果提供了值则使用该值否则使用值如果未提供值但参数标志存在则使用值需与配合零个或多个参数值收集到一个列表中一个或多个参数值收集到一个列表中至少需要一个整数固定需要个参数值子命令的强大之处当你的工具功能复杂包含多个独立的操作模式时例如像版本控制系统那样有等不同命令子命令是组织这些功能的理想方式每个子命令可以拥有自己的一套参数使得整体界面更加清晰务必为子命令设置参数以便后续判断用户选择了哪个子命令默认值的合理设置为可选参数提供明智的默认值可以减少用户需要输入的参数数量提升使用体验帮助信息中可以使用来自动显示默认值互斥参数组当你有一组参数其中用户在任何时候只能指定一个时例如和不能同时出现可以使用互斥参数组来强制这种约束参数顺序通常不关心可选参数在命令行中出现的顺序但位置参数必须按照它们被添加的顺序提供错误处理会自动处理很多常见的用户输入错误如缺少必需参数参数类型错误无效选项值等并向用户显示友好的错误信息和用法提示你通常不需要自己编写大量的参数验证代码是构建专业健壮且用户友好的命令行应用程序的标准工具投入时间学习和熟练运用它的各种特性将极大提升你开发工具的效率和质量模块管理子进程模块允许你创建新的子进程连接到它们的输入输出错误管道并获取它们的返回码它是中执行外部命令和管理子进程的推荐方式取代了像等一些旧的模块和函数常用功能函数类参数描述推荐运行指定的命令并等待其完成返回一个对象更底层的接口创建一个子进程对象可以进行非阻塞操作或更复杂的交互用于和要执行的命令及其参数通常是一个列表如或字符串当时用于如果设为则会捕获子进程的标准输出和标准错误流的内容用于和如果设为标准输入输出和错误流会以文本模式处理自动进行编解码用于如果设为且命令返回非零退出码表示错误则会抛出异常用于和谨慎使用如果为命令将通过系统的执行可能带来安全风险用于和指定子进程的标准输入输出错误流的来源或去向如用于捕获对象函数成功完成后的返回值包含等信息与子进程交互向其发送数据并从其和读取所有输出直到结束等待子进程执行完成并返回其退出状态码检查子进程是否已经结束如果结束则返回退出码否则立即返回非阻塞用于向子进程发送信号以终止它较温和较强制批注核心记忆功能模块首选函数适用于大多数执行外部命令并等待其完成的场景它是对的高级封装参数的正确形式当默认且推荐时应为列表当时为字符串和获取命令输出时非常方便可以得到解码后的文本使得在命令执行失败时能自动抛出异常简化错误处理当你需要捕获子进程的输出或向其输入数据时将其用于参数类当需要更精细的控制例如非阻塞与进程进行持续的双向交互或者需要并行运行多个子进程时使用模块代码示例用于演示平台差异和获取解释器路径用于示例中的模块演示准备模块功能演示基本命令执行与等待基本命令执行与等待根据操作系统选择一个简单命令尝试执行命令会等待命令完成来捕获标准输出和标准错误使输出以文本形式解码通常是或系统默认编码表示即使命令返回非退出码也不会抛出异常我们手动检查使为字符串手动检查命令实际执行命令退出码命令成功执行标准输出前行命令执行可能存在问题退出码非标准错误输出命令未找到请确保它在系统中执行命令时发生意外错误自动错误检查自动错误检查尝试执行一个不存在的命令并使用如果命令返回非退出码会引发捕获输出以便在异常中查看理论上这行不会执行因为上面命令会失败命令未找到命令执行失败失败命令的返回码失败命令的输出无失败命令的错误无向子进程传递输入参数向子进程传递输入参数使用查找包含的行使用查找包含的行将向命令输入以下文本将此字符串作为子进程的标准输入找不到时退出码可能非通常表示找到匹配找到匹配的行未找到匹配的典型退出码未找到任何匹配的行其他错误命令执行出错或未找到退出码标准错误命令未找到使用需要格外小心使用需要格外小心允许你执行包含特性如管道通配符环境变量展开的命令字符串但如果命令字符串包含任何来自不可信来源的内容则极易受到命令注入攻击示例安全地获取当前目录下的文件列表不推荐仅为演示特性更安全的方式是使用的和模块演示执行命令通常应避免命令输出前行命令执行失败或命令未找到使用进行更精细的异步或交互式控制使用进行更精细控制启动一个子进程并通过管道与其交互子进程执行的代码从标准输入读取一行转换为大写然后打印到标准输出不会阻塞子进程会立即开始执行解释器代码字符串创建到子进程的管道创建从子进程的管道创建从子进程的管道使用文本模式进行可以指定子进程的工作目录子进程已启动通过与子进程交互向子进程的发送数据参数从子进程的和读取所有输出直到它们关闭等待子进程结束是一次性交互适合简单场景向子进程发送防止无限等待子进程退出码子进程标准输出子进程标准错误与子进程交互超时正在尝试终止强制终止清理管道子进程已被终止交互过程中发生错误模块演示结束日志与配置管理模块在开发应用程序时通过配置文件管理程序行为以及记录程序运行状态和错误信息即日志是至关重要的实践标准库为此提供了和两个核心模块模块读写配置文件模块用于处理结构化的配置文件其格式类似于文件这种文件通常以或为扩展名由一个或多个节组成每个节内包含若干键值对它非常适合存储应用程序的设置和参数示例配置文件内容可能如下这是一个注释行这也是一个注释行节比较特殊它的值会作为其他节的默认值在实际应用中密码不应明文存储在配置文件中常用功能方法类描述创建一个配置文件解析器对象用于后续的读写操作从指定的一个或多个文件中读取配置信息返回配置文件中所有节的名称列表不包括节检查配置文件中是否存在名为的节返回指定节下所有选项键的名称列表检查指定的中是否存在名为的选项返回指定节下所有选项的键值对列表获取指定节中选项的值始终作为字符串返回获取选项值并将其转换为整数获取选项值并将其转换为浮点数获取选项值并将其转换为布尔值如会转为在配置中添加一个新的节设置指定节中选项的值为注意必须是字符串从指定节中移除选项移除整个节及其所有选项将当前的配置数据写入到一个已打开的文件对象中批注核心记忆功能模块创建实例是第一步加载配置文件内容遍历配置结构获取配置值字符串常用获取特定类型的值修改或添加配置项保存更改到文件模块代码示例读取修改创建模块演示准备模块功能演示创建一个临时的示例配置文件注意较为特殊他会给所有的配置名都加上它所定义的键值已创建临时配置文件实例化读取配置文件读取配置文件方法可以读取一个或多个文件如果文件不存在则会忽略返回成功读取的文件列表错误无法读取配置文件成功读取配置文件查看所有不包括所有节不包括查看节中的默认值可以直接通过访问或通过方法也可以用访问节中的默认值查看特定节例如中的所有键值对节的选项获取特定节中特定选项的值返回字符串返回整数返回布尔值节中的值节中的值节中的值访问节中的值如果子节中没有定义会从继承节中的值节中的值修改配置文件内容在内存中修改配置文件内容在内存中修改特定节中的值修改端口号修改连接状态已修改节中的值添加新的选项添加新的数据库名称已添加新的选项添加新的节已添加新的节移除一个选项已移除选项将修改后的配置写回文件将修改后的配置写回文件写回文件注意写回文件时会覆盖原文件内容已将修改后的配置写回文件以编程方式创建全新的配置文件以编程方式创建全新的配置文件添加新的节和选项添加其他节和选项必须先创建节值必须是字符串如果是数字需要转为字符串布尔值也应是字符串为新配置添加了和节及选项将新创建的配置写入文件新创建的配置已写入到写入新创建的配置文件失败读取配置文件检查配置文件中的节和选项修改配置文件内容将修改后的配置写回文件模块的日志记录系统核心模块是内置的功能强大且灵活的日志记录框架良好的日志记录对于应用程序的调试监控问题排查和审计至关重要它允许开发者根据日志的重要性级别将其发送到不同的目的地如控制台文件网络等并可以自定义日志的格式模块基本使用与日志级别日志级别从低到高表示日志信息的重要性日志级别数值描述最详细的诊断信息通常只在调试问题时关心确认程序按预期运行的常规信息表明发生了意外情况或在不久的将来可能出现问题但程序仍能按预期工作由于更严重的问题程序未能执行某些功能严重错误表明程序本身可能无法继续运行的模块默认的日志级别是这意味着如果你不进行任何配置只有级别的日志消息会被处理和显示是一个快速配置日志系统的便捷函数通常在脚本的早期调用如果已经配置过它将不起作用常用参数描述设置日志记录器处理消息的最低级别如定义日志消息的输出格式字符串如果中包含时间此参数定义时间的显示格式指定日志输出到的文件名如果省略则输出到控制台如果指定了此参数定义文件的打开模式如追加覆盖批注核心记忆功能模块基础日志级别理解五个基本级别及其含义进行简单快速的日志配置的首选方法尤其适用于小型脚本或应用的初期发出不同级别日志消息的函数默认级别是如果不配置和消息不会显示模块基础配置代码示例模块基础配置演示模块基础配置演示最简单的日志记录默认配置最简单的日志记录默认配置此时没有调用日志级别默认为输出到这是一条消息默认情况下不显示这是一条消息默认情况下不显示这是一条消息默认显示会以消息的格式输出这是一条消息默认显示这是一条消息默认显示注意上面和级别的日志在默认情况下不会打印让所有日志级别都能打印出来让所有日志级别都能打印出来配置日志级别为输出到这是一条消息现在显示这是一条消息现在显示模块核心组件对于更复杂的日志需求可能不够用这时需要了解模块的三个核心组件日志记录器它是与应用程序代码直接打交道的对象你可以通过获取实例通常使用模块名作为名称例如这样可以方便地根据日志来源模块来配置和过滤日志有层级关系类似的包名例如名为的是名为的的子级可以设置自己的日志级别如果一个的级别未设置它会继承其父级的级别最终到日志消息会沿着层级向上传播到父级的除非将的属性设为处理器决定日志消息的最终去向一个可以关联多个常见的类型包括将日志发送到流如或控制台将日志写入磁盘文件支持日志文件按大小轮转达到一定大小时创建新文件支持日志文件按时间间隔轮转如每天每小时什么也不做常用于库模块中让应用开发者决定如何处理库的日志还有用于网络发送如系统日志等的也可以设置自己的日志级别只处理高于或等于该级别的日志消息格式化器定义最终输出的日志消息的布局和格式创建一个对象时可以指定一个格式字符串其中包含各种预定义的属性如时间级别名日志内容名模块名行号等创建好的对象需要附加到一个或多个上批注核心记忆功能模块组件获取实例是进行高级日志配置的入口决定日志去哪儿控制台文件网络等并可设置级别决定日志长什么样时间格式包含哪些信息等是日志消息处理的基本流程模块高级配置代码示例使用字典配置使用字典来配置日志是推荐的方式因为它清晰灵活并且可以从或等配置文件加载假设可用设置并配置高级日志系统模块高级配置演示创建日志目录定义日志配置定义日志配置字典配置版本目前只能是是否禁用现有的日志记录器日志格式化器过滤器这里不详细演示可以用于更细致的日志过滤处理器输出到控制台标准输出此处理及以上级别明确指定流输出到应用日志文件带轮转此处理及以上级别保留个备份文件单独记录及以上级别到错误日志文件简单文件追加模式日志记录器假设我们有一个名为的此捕获及以上级别不再向父级传播避免重复记录可以配置所有未明确指定的日志最终会到这里如果为默认情况下也有一个日志配置字典已定义应用配置应用字典配置已使用应用日志配置演示如何使用配置好的日志系统获取并使用实例演示应用模块日志记录获取这是来自的日志应出现在控制台这是来自的日志应出现在控制台和这是来自的日志处理同这是来自的日志应出现在控制台和这是来自的日志处理同演示其他模块日志记录获取这是来自的日志不应出现因为级别是这是来自的日志应出现在控制台这是来自的日志应出现在控制台演示未配置的日志记录器获取将使用配置如果未配置可能无输出或输出到默认级别如果在中配置了则按其配置这是来自的行为取决于执行日志系统设置和演示模块使用文件配置除了字典配置模块也支持从类似格式的配置文件加载配置这通过函数实现示例文件内容简化版用于不向传递文件名模式编码使用加载模块演示模块演示创建一个临时的文件已创建临时日志配置文件使用加载配置使用加载配置默认情况下可能对或某些编码处理不佳确保不会禁用通过等方式已配置的支持参数已从加载日志配置使用配置好的使用配置好的是定义的这是一条来自配置的日志这是一条来自配置的日志这是一条来自的日志通过配置这是一条来自的日志级别是所以不显示使用加载配置时发生错误注意对编码的处理可能不如灵活如果遇到编码问题可能需要确保配置文件不含或在旧版中修改源码不推荐清理已删除临时文件演示结束的编码问题在下处理文件尤其是有的时可能存在问题需要修改源码的方法来指定编码这是一个历史问题好消息是从开始函数增加了参数可以直接指定文件编码例如对于旧版如果遇到此问题更推荐的做法是确保配置文件本身保存为不带的或者考虑将配置迁移到使用因为从字典加载配置字典可以从任何来源如文件以正确的编码读取从而避免的编码限制模块开箱即用场景为脚本快速设置日志记录到文件和控制台为脚本设置一个简单的日志记录器同时输出到控制台和文件尝试设置日志输出到控制台级别和文件级别获取根日志记录器或创建一个特定的记录器获取或者使用一个特定的名称设置的最低捕获级别为具体输出由控制防止重复添加如果此函数可能被多次调用已有不再重复添加或者根据需要移除旧的如果已有直接返回创建控制台处理器输出到标准输出创建文件处理器确保日志目录存在如果包含路径创建日志目录日志将记录到文件设置文件日志处理器失败即使文件处理器失败控制台处理器仍然可能工作仅在此脚本直接运行时执行函数演示第一次设置这是一条详细的调试信息用于诊断应用程序已开始正常运行一个非关键性问题发生但不影响核心功能处理请求时发生错误操作失败模拟另一个模块使用同一个来自应用另一部分的信息尝试再次调用理想情况下配置只做一次尝试再次调用应提示已有应该会提示已有而不重复添加如果上面逻辑生效第二次调用后的日志日志记录演示结束请检查控制台输出和文件模块更简单的日志记录是一个语言非常受欢迎的第三方日志库在中也有类似的日志库其设计目标是让日志记录变得尽可能简单和愉悦同时又不失强大和灵活它提供了许多开箱即用的功能大大减少了配置日志所需的样板代码尽管我们是介绍标准内置库但原生的配置流程实在是太过繁琐核心特性与常用功能方法特性描述导入的核心对象大多数操作都通过它进行核心方法添加一个新的接收器来处理日志消息如文件函数或流至与标准库类似的日志记录方法用于发出不同级别的日志消息记录一条级别的消息并自动附加当前的异常信息和堆栈跟踪一个装饰器可以优雅地捕获函数中发生的异常并自动记录它们将自定义的键值对数据绑定到后续的日志记录中方便实现结构化日志移除之前通过添加的日志处理器常用参数日志的输出目标文件名字符串文件对象可调用对象等此处理的最低日志级别定义此输出日志的格式字符串有自己丰富的格式化标记设置日志文件轮转条件如每天午夜设置旧日志文件的保留策略如保留最新的个文件设置日志文件压缩格式如将日志消息序列化为格式输出用于结构化日志异步记录日志将日志消息放入队列中处理可提高性能批注核心记忆功能模块最重要的方法几乎所有的日志输出配置都通过它完成极其灵活日常使用的日志记录方法记录错误和异常信息时非常方便参数在中灵活定义日志输出格式参数在中强大的日志文件管理功能模块代码示例重要提示是一个第三方库您需要先安装它标准库用于配置输出到用于文件路径操作用于演示三方库导入个人库模块演示准备模块功能演示默认会将日志输出到并带有颜色和良好格式这是默认的日志信息他的格式为日期时间日志级别模块名函数名行号日志内容先演示一下默认的日志这是默认的日志信息这是警告信息这是错误信息这是调试信息这是成功信息这是严重错误信息这是异常信息这是自定义日志级别添加基本控制台输出添加基本控制台输出移除的默认处理器通常是一个输出到的处理器这样我们可以完全控制日志的输出目的地和格式标准输出流处理及以上级别的日志启用颜色已添加一个输出到的处理器这是添加了处理器后的日志信息这条消息不会被输出到因为级别低于这是一个警告信息这是一个错误信息这是一个成功信息这是一个严重错误信息添加文件输出并配置轮转和保留添加文件输出并配置轮转和保留移除所有处理器文件名中可以包含时间格式错误日志确保目录存在当文件达到时轮转创建新文件也可以是每天中午点轮转每周轮转最多保留个轮转后的日志文件也可以是保留个月的日志将轮转后的旧日志文件压缩为格式以时间级别模块函数消息格式输出已添加一个输出到的文件处理器级别轮转保留个压缩此文件只记录及以上级别已添加一个输出到的错误日志处理器级别测试轮转这是第条日志信息使用装饰器捕获函数异常使用装饰器捕获函数异常这将触发异常并被捕获这不会触发异常使用实现结构化日志或添加上下文使用实现结构化日志或添加上下文先移除之前的重新配置一个支持额外参数的移除所有已配置的会显示的内容已重新配置以显示用户登录成功这条日志会包含和用户尝试访问未授权资源也可以在记录时临时绑定来自特定的请求序列化为结构化日志序列化为结构化日志移除所有处理器关键将日志记录序列化为会显示的内容已添加一个输出到的格式文件处理器订单已处理打开文件会看到格式的日志模块开箱即用场景快速为脚本设置控制台和文件日志新增日志目录参数快速配置将日志同时输出到控制台和带轮转的文件正在配置日志系统确保日志目录存在清除所有旧的确保配置纯净配置控制台输出通常日志输出到到控制台日志已配置级别配置文件输出每轮转保留最近天的日志压缩旧日志异步写入提高性能文件日志已配置级别路径日志系统初始化完成快速设置日志场景演示指定日志目录这是一条级别的调试信息只有文件日志会记录用户登录了系统配置项未找到使用默认值故意引发处理项目列表时发生错误脚本演示部分执行完毕请检查控制台输出和目录下的日志文件自此最常用的标准库就介绍完了是全世界三方库生态最好的语言所以掌握一定的标准库即可剩下的库作为了解或是做底层开发会合适较为不常用实用库标准库中包含了许多小而精的模块它们为日常开发中的特定任务提供了便捷的解决方案本节将介绍几个常用的工具模块用于简化上下文管理用于处理临时文件和目录用于文件路径的模式匹配以及用于生成通用唯一标识符模块简化上下文管理器上下文管理器是中一种重要的编程构造主要通过语句来使用它能够帮助我们自动获取和释放资源或者在代码块执行前后执行特定操作如加锁解锁打开关闭文件模块提供了一些工具来更方便地创建和使用上下文管理器常用功能这个模块最常用的只有这个装饰器其他的方法并不常用简单了解即可函数装饰器描述一个装饰器能让你用简单的生成器函数快速创建支持语句的上下文管理器为那些有方法但本身不是上下文管理器的对象创建一个上下文管理器确保其被调用创建一个上下文管理器在其管理的代码块中可以忽略指定的几种异常类型一个上下文管理器可以动态地注册和管理多个其他的上下文管理器确保它们都能被正确清理一个什么也不做的上下文管理器有时用于在条件分支中提供一个空操作的目标批注核心记忆功能模块非常常用是将自定义资源管理逻辑封装为上下文管理器的最便捷方式当遇到只有方法的老旧对象时很有用优雅地处理某些预期内且不需要特别处理的异常管理多个或动态数量的资源时非常强大模块代码示例用于类型提示模块演示准备模块功能演示使用创建自定义上下文管理器使用创建计时器之前的部分方法当语句开始执行时装饰的生成器函数中关键字之前的所有代码会被执行这部分代码通常用来做一些准备工作比如打开文件连接数据库获取资源等如果语句产生了一个值例如这个值会赋给中的执行的时刻程序执行到时会将控制权交还给语句块内部的代码让块中的代码开始执行之后的部分通常在块中方法当语句块中的代码执行完毕无论是正常结束还是发生异常程序会回到生成器函数中从语句之后的地方继续执行这部分代码通常放在块中以确保其总能执行用来做清理工作比如关闭文件释放资源回滚事务等块保证了即使块中发生错误清理操作也能进行简单来说巧妙地利用了生成器的特性将一个普通的生成器函数变成了符合上下文管理器协议的对象使得前的代码在进入块时运行后的代码在退出块时运行这种方式比手动定义一个包含和方法的类要简洁得多默认计时器获取当前精确的时间戳之前是部分之后是部分耗时秒计时器结束耗时秒使用自定义的计时器文件读取模拟读取文件内容模拟读取文件的耗时数据处理模拟数据处理模拟数据处理的耗时模块处理临时文件和目录在程序运行过程中有时需要创建一些临时的文件或目录来存储中间数据这些数据在程序结束或不再需要时应该被自动清理模块为此提供了安全且便捷的解决方案常用功能函数类描述创建一个匿名的临时文件对象没有可见的文件名文件关闭时自动删除创建一个带名字的临时文件文件关闭时通常也会自动删除除非创建一个在内存中操作的临时文件当内容超过字节时会自动溢出到磁盘创建一个临时目录当上下文管理器退出或目录对象被垃圾回收时目录及其内容会被自动删除获取系统用于存放临时文件的默认目录路径获取生成临时文件或目录名称时使用的默认前缀批注核心记忆功能模块当你需要一个临时文件并且需要知道它的文件名时使用通常配合语句当你需要一个临时的目录来存放多个文件并且希望它能自动清理时使用通常配合语句用于完全匿名的临时文件不需要文件名模块代码示例用于演示的清理模块演示准备模块功能演示获取系统临时目录信息获取系统临时目录信息系统默认的临时目录路径生成临时文件目录的默认前缀生成临时文件目录的默认前缀创建匿名的临时文件创建匿名的临时文件创建的文件在文件系统上通常没有可见的目录项文件名他是一个真正的临时文件关闭后即删除临时文件创建成功这是一个临时文件的内容这是第二行内容回到文件开头才能读取临时文件内容匿名临时文件已在块结束时自动关闭并删除创建临时文件时发生错误创建带名字的临时文件创建的文件在文件系统中有可见的文件名默认情况下文件关闭时也会被自动删除带名字的临时文件创建成功这是一个带名字的临时文件的内容这是第二行内容回到文件开头才能读取临时文件内容带名字的临时文件已在块结束时自动关闭创建带名字的临时文件时发生错误创建临时目录创建临时目录临时目录创建成功在临时目录中创建文件可以在这个临时目录中创建文件和子目录这是文件在临时目录中的内容临时文件创建成功临时目录会在块结束时自动删除临时目录已在块结束时自动删除创建临时目录时发生错误临时文件创建成功带名字的临时文件创建成功临时目录创建成功用于演示的清理模块演示准备模块功能演示获取系统临时目录信息获取系统临时目录信息系统默认的临时目录路径生成临时文件目录的默认前缀生成临时文件目录的默认前缀创建匿名的临时文件创建匿名的临时文件创建的文件在文件系统上通常没有可见的目录项文件名他是一个真正的临时文件关闭后即删除临时文件创建成功这是一个临时文件的内容这是第二行内容回到文件开头才能读取临时文件内容匿名临时文件已在块结束时自动关闭并删除创建临时文件时发生错误创建带名字的临时文件创建的文件在文件系统中有可见的文件名默认情况下文件关闭时也会被自动删除带名字的临时文件创建成功这是一个带名字的临时文件的内容这是第二行内容回到文件开头才能读取临时文件内容带名字的临时文件已在块结束时自动关闭创建带名字的临时文件时发生错误创建临时目录创建临时目录临时目录创建成功在临时目录中创建文件可以在这个临时目录中创建文件和子目录这是文件在临时目录中的内容临时文件创建成功临时目录会在块结束时自动删除临时目录已在块结束时自动删除创建临时目录时发生错误临时文件创建成功带名字的临时文件创建成功临时目录创建成功坑点与建议模块自动清理当默认行为和在与语句一起使用时会在退出块时自动关闭并删除对应的文件或目录这是它们主要的便利之处的在上的行为在上当以默认打开时文件在创建后不能被其他进程甚至同一进程中的其他代码通过其文件名再次打开直到该对象被关闭如果你需要在文件保持打开状态时让其他部分通过名字访问它或者希望在关闭后文件仍然保留以便后续处理应设置但这种情况下你需要自己负责在不再需要时手动删除文件例如使用文件名安全性模块在生成临时文件名时会采取措施避免可预测的文件名有助于防止一些安全问题通常不建议使用像这样只返回一个文件名但不实际创建文件的旧函数因为它在文件名生成和文件创建之间存在竞争条件风险优先使用这些会实际创建并管理临时实体的工具权限创建临时文件或目录仍然受限于当前用户的操作系统权限如果程序没有在临时目录中写入的权限操作将会失败资源泄露如果不使用语句而是手动创建或对象你需要确保调用它们的方法对于文件或方法对于目录尽管目录对象被垃圾回收时也会尝试清理来释放资源和删除实体语句是推荐的最佳实践模块文件路径名模式匹配模块用于查找所有匹配特定模式的文件路径名它使用的模式规则类似中的通配符这对于需要批量处理符合某种命名规则的文件非常有用常用功能函数描述返回一个包含所有匹配模式的文件和目录路径的列表返回一个迭代器逐个产生匹配模式的文件和目录路径更节省内存对中的特殊字符如进行转义使其能被字面匹配模式中的特殊字符匹配任意多个包括零个任意字符匹配单个任意字符匹配方括号中出现的任意一个字符例如匹配或可以使用连字符表示范围例如匹配任意数字匹配任意不在方括号中出现的字符当时匹配任意文件和任意层级的目录递归匹配批注核心记忆功能模块最常用的功能直接获取所有匹配路径的列表理解通配符的含义配合进行递归搜索模块代码示例用于创建和清理测试目录文件模块演示准备模块功能演示创建测试环境清理旧的测试目录创建一些测试文件测试文件和目录已创建已清理测试环境基本通配符匹配基本通配符匹配匹配所有文件查找模式找到的文件匹配所有以开头的文件查找模式找到的以开头的文件匹配单个字符或匹配一个字符匹配多个查找模式找到的文件匹配字符集或查找模式找到的文件递归匹配和通配符递归匹配和递归查找所有子目录中的文件注意必须单独作为路径的一部分才能正确递归递归查找模式递归找到的所有文件使用迭代器进行匹配使用迭代器进行匹配使用迭代查找适合大量匹配结果返回一个迭代器当你处理大量文件时可以节省内存找到共找到个匹配项转义特殊字符转义特殊字符假设我们有一个文件名包含特殊字符例如如果想字面匹配它而不是让和作为通配符就需要转义如果实际创建此文件原始文件名含特殊字符转义后的部分完整的查找模式会是假设我们真的创建了这个文件查找转义后的模式结果模块演示结束坑点与建议模块与要想让通配符实现递归匹配即匹配任意层级的子目录必须同时在或函数中将参数设置为路径分隔符模块会自动处理当前操作系统的路径分隔符上的和上的你在模式中可以使用它在上也能正常工作结果顺序函数返回的路径列表的顺序是不确定的它依赖于操作系统底层函数返回的顺序如果需要排序的结果你需要自己对返回的列表进行排序例如性能对于非常大的目录结构或非常多的文件会一次性将所有匹配项加载到内存中可能消耗较多内存在这种情况下使用返回一个迭代器会更节省内存因为它逐个产生匹配项隐藏文件以开头的文件在系统上像这样的通配符默认不会匹配以点开头的隐藏文件或目录名如果需要匹配它们模式需要显式地包含点例如或模块的替代方案引入的模块提供了面向对象的路径操作对象有自己的和方法使用起来可能更直观和例如非递归递归无匹配项如果没有文件或目录匹配给定的模式会返回一个空列表会返回一个空的迭代器程序不会因此报错模块生成通用唯一标识符是一种位长的数字设计用来在空间和时间上保证唯一性而不需要一个中央协调机构模块提供了生成各种版本的功能这些在分布式系统数据库主键临时文件名会话等场景中非常有用常用功能与版本函数属性描述基于当前时间和计算机的地址生成版本可能涉及隐私基于一个命名空间和一个名称的哈希值生成版本结果是确定的推荐常用生成一个完全随机的版本基于一个命名空间和一个名称的哈希值生成版本结果是确定的类构造器从不同表示形式十六进制字符串字节串整数创建一个对象对象属性获取的个字符的十六进制字符串表示无连字符对象转字符串获取的标准个字符的十六进制字符串表示带连字符对象属性获取的字节表示对象属性获取的位整数表示对象属性获取的版本号或预定义的命名空间用于和当是一个完全限定域名时使用当是一个时使用当是一个时使用当是一个时使用批注核心记忆功能模块最常用用于生成随机的无法预测的唯一将对象转换为标准的带连字符的字符串形式便于存储和显示获取不带连字符的紧凑十六进制字符串模块代码示例模块演示准备模块功能演示生成版本基于时间和地址生成版本基于时间和地址字符串表示十六进制版本号节点可能含地址以十六进制显示节点生成时可能出现问题例如无法获取地址生成版本随机生成推荐常用生成版本随机生成示例字符串表示十六进制版本号示例每次调用都不同生成版本基于命名空间和名称的哈希生成版本哈希和是确定性的相同的命名空间和名称总是产生相同的使用预定义的命名空间版本号再次用相同参数生成结果应该一样再次生成应相同生成版本基于命名空间和名称的哈希生成版本哈希使用预定义的命名空间版本号从字符串或其他形式创建对象从字符串或其他形式创建对象必须是标准格式从字符串创建的对象其整数表示其字节表示从字符串创建失败模块演示结束坑点与建议模块版本选择版本通常是最佳选择它生成基于高质量随机数的碰撞概率极低且不包含任何可识别的硬件或时间信息因此对隐私更友好版本基于当前时间和计算机的地址生成虽然能保证在同一台机器上按时间顺序生成大致上但它可能暴露生成的机器的地址和生成时间存在一定的隐私和安全风险在需要基于时间排序且能容忍这些风险的特定场景下使用和这两个版本是确定性的即对于相同的命名空间和相同的名称字符串它们总是生成相同的使用哈希使用哈希它们适用于需要基于某个已知名称如名等生成一个唯一的可重现的标识符的场景由于和在密码学上已不被认为是强哈希算法这些主要用于标识而非安全目的碰撞概率的设计目标是全球唯一对于版本的随机其可能性的数量非常巨大种因为有几位用于版本和变体信息因此两个独立生成的相同的概率微乎其微在实际应用中基本可以忽略存储与表示返回标准的字符十六进制表示包含连字符例如这是最常见的交换和显示格式返回字符的紧凑十六进制表示不含连字符返回字节的字节串表示返回位的整数表示根据存储系统数据库文件名等的要求和效率选择合适的表示形式例如某些数据库可能对存储字节串或整数形式的更高效命名空间的使用当使用或时选择合适的预定义命名空间或者自己生成一个固定的作为自定义命名空间对于确保生成的的上下文和唯一性非常重要底层工具库本小节将探讨标准库中一系列强大的工具它们可以帮助我们更有效地处理迭代函数式编程数据复制美化输出定义枚举实现抽象基类以及运用类型提示来构建更健壮的应用程序模块类型提示支持模块是中用于支持类型提示的核心工具类型提示允许开发者为变量函数参数和函数返回值指定预期的类型虽然本质上是动态类型语言类型在运行时检查但类型提示有诸多好处提高代码可读性和可理解性明确了函数期望什么类型的输入以及会返回什么类型的结果辅助静态分析工具像这样的静态类型检查器可以使用类型提示来检测代码中潜在的类型错误而无需实际运行代码改善支持可以利用类型提示提供更准确的代码补全重构和错误高亮促进更好的设计思考类型有助于设计出更清晰更健壮的函数和类接口类型提示在运行时通常不会强制执行除非使用特定库如它们更多的是给开发者和工具看的元数据常用类型与构造器类型构造器描述或表示元素类型为的列表例如表示整数列表或表示键类型为值类型为的字典例如或表示一个元组其中每个元素都有特定的类型例如或表示一个所有元素类型均为的可变长度元组或表示元素类型为的集合例如表示一个值可以是类型或者等价于或表示一个未受约束的类型可以是任何类型应谨慎使用因为它会削弱类型检查表示一个可调用对象如函数指定其参数类型和返回类型用于定义泛型类型变量常用于编写泛型函数和类用于创建泛型类的基类创建一个概念上不同但运行时与相同的新类型主要用于静态类型检查表示类本身或其子类而不是的实例分别表示可迭代对象和迭代器其元素类型为表示更通用的映射类型如字典和序列类型如列表元组批注核心记忆功能模块基本集合类型的泛型版本处理可能为的值当一个值可能有几种不同类型时使用或的语法为回调函数或作为参数传递的函数指定签名在确实无法或不需要指定具体类型时使用但应尽量避免滥用的改进许多标准集合类型如可以直接用作泛型类型无需从模块导入对应的大写版本例如用代替的改进引入了操作符作为的更简洁语法例如代替模块代码示例对于许多大写的类型等可以用小写内置类型替代例如用代替为了兼容性这里仍然使用中的大写版本除非特别说明用于示例模块演示准备模块类型提示功能演示基本类型提示函数参数和返回值基本类型提示根据用户信息生成问候语返回这类静态检查器会警告不是处理一个整数列表返回一个浮点数列表返回根据用户查找用户如果找不到则返回找不到键时默认返回找到用户用户未找到查找用户可以写根据不同类型的值返回描述理论上不会到这里因为限制了类型处理任何类型的数据应谨慎使用可调用对象可调用对象应用一个二元整数操作并返回结果会报错签名不匹配和泛型和泛型定义一个类型变量可以是任何类型比更通用获取序列的第一个元素如果序列为空则返回定义一个泛型类它可以容纳类型的项目明确指定是类型检查器通常能推断出是和简介和简介创建一个概念上不同的类型但运行时它仍然是会将视为类型有助于防止意外传递普通创建实例可能会警告类型不匹配类型运行时仍是创建一个指定类必须是或其子类的实例可以是本身演示已在各节内进行模块演示结束坑点与建议模块运行时无强制性通常类型提示主要是给静态类型检查器如和看的解释器本身在运行时通常不会因为类型不匹配而报错除非你使用了像这样会进行运行时验证的库它们的目的是在开发阶段帮助发现潜在错误逐渐采用你不需要一次性为整个项目添加类型提示可以从新的代码开始或者从项目的关键部分开始逐步引入类型提示的使用类型表示可以是任何类型它会有效地关闭对该变量或表达式的类型检查应尽量避免使用只在确实无法确定类型或为了兼容旧代码时才用过度使用会降低类型提示带来的好处版本与类型提示语法许多标准内置集合类型如可以直接用作泛型类型注解例如而不是这使得代码更简洁引入了使用操作符来表示联合类型的语法例如代替还引入了和用于更精确地注解高阶函数和装饰器在的文件中可以在文件顶部添加这使得所有类型提示都被视为字符串字面量从而可以使用在当前版本中可能尚不支持的未来类型提示语法例如在中使用而不是如果配合这个导入泛型当你编写的函数或类可以处理多种不同类型的数据并且希望保持这些类型之间的一致性时例如一个函数接受一个列表并返回该列表中的一个元素元素的类型应该相同泛型是非常有用的循环导入与类型提示有时在进行类型提示时如果两个模块相互导入对方定义的类型可能会导致循环导入问题一种常见的解决方法是将其中一个导入放在块中需要或者使用字符串字面量作为类型提示例如类型别名对于复杂的类型签名可以使用类型别名来提高可读性例如提供了高效的迭代工具增强了函数式编程能力解决了对象复制的深浅问题让复杂数据显示更友好带来了更安全和可读的常量定义方式模块是实现面向对象中接口和抽象的基石而模块则为代码的健壮性和可维护性提供了强大的支持掌握这些模块能让你的编程技能更上一层楼模块高效的迭代器构建工具模块提供了一系列用于创建和使用迭代器的函数这些函数实现了很多常见的迭代算法运行速度快内存效率高并且能够以简洁的方式组合使用当你需要处理复杂的迭代逻辑时这个模块往往能提供优雅的解决方案常用功能函数描述创建一个从开始按无限递增或递减的数字迭代器创建一个无限循环遍历中元素的迭代器创建一个重复生成的迭代器可以指定重复次或无限重复将多个可迭代对象连接起来形成一个更长的迭代器或从可迭代对象中返回指定切片的元素类似列表切片但作用于迭代器计算多个可迭代对象的笛卡尔积相当于嵌套的循环从中生成长度为的所有可能排列元素不重复顺序有关从中生成长度为的所有可能组合元素不重复顺序无关允许元素重复的组合根据函数对连续的元素进行分组返回键组内元素迭代器对批注核心记忆功能模块创建特定模式的无限或有限迭代器轻松合并多个序列处理排列组合问题对已排序或按键分组的数据进行聚合处理安全地从无限迭代器或普通迭代器中取一部分模块代码示例用于类型注解模块演示准备模块功能演示无限迭代器与无限迭代器与演示及如何使用获取部分元素会生成用于从迭代器中获取指定数量的元素避免无限循环从中获取前个元素输出会生成从中获取前个元素输出会生成从中获取前个元素输出连接与组合迭代器连接与组合迭代器演示的用法可以将多个可迭代对象连接在一起连接后的元素输出生成多个可迭代对象的笛卡尔积结果输出生成可迭代对象的所有可能排列结果输出生成可迭代对象的所有可能组合不考虑顺序结果输出分组迭代器分组迭代器演示重要需要数据预先按分组键排序待分组数据已按首字母排序按首字母分组其中是分组键是一个迭代器包含该组的所有元素可以省略因为元组默认按第一个元素比较是一个迭代器需要转换为列表以开头的分组对未排序数据使用可能不符合预期未排序数据未排序键注意对未排序数据是按连续相同元素进行分组的坑点与建议模块无限迭代器像不带参数这样的函数会产生无限序列在直接使用它们进行迭代时务必配合或其他机制来限制迭代次数否则会导致无限循环迭代器消耗中的函数通常返回迭代器迭代器是一次性的遍历过后就会耗尽如果需要多次使用结果应先将其转换为列表或元组例如的前提函数在对数据进行分组前要求数据必须已经按照分组的键排好序如果数据未排序它只会将连续出现的相同键的元素分为一组可能与预期不符内存效率的函数通常设计为内存高效的因为它们是基于迭代器操作的一次只处理一个元素而不是一次性加载所有数据到内存这使得它们非常适合处理大型数据集组合性函数的强大之处在于它们的组合性你可以将多个函数串联起来用非常少的代码构建出复杂的迭代逻辑模块高阶函数与可调用对象工具模块包含了一些用于高阶函数操作或返回其他函数的函数的工具这些工具可以帮助你修改或扩展函数及其他可调用对象的行为而无需完全重写它们常用功能函数装饰器描述创建一个新的函数该函数在调用时会自动传入预设的和参数将一个二元函数累积地应用到的项上从而将序列规约为单个值一个装饰器用于更新一个包装函数的元信息如名称文档字符串以匹配被包装函数一个装饰器为函数调用结果提供最近最少使用缓存可以显著提高重复调用相同参数的耗时函数的性能一个类装饰器如果你定义了和至少一个其他比较方法它会自动为你补全所有其他的比较方法一个装饰器将函数转换为单分派泛函数可以根据第一个参数的类型注册不同的实现批注核心记忆功能模块当你需要固定函数的一些参数生成一个更特化的函数版本时非常有用用于执行累积计算如求和求积或更复杂的聚合编写自定义装饰器时务必使用以保持被装饰函数的元数据对于计算成本高且参数可能重复调用的函数这是一个简单有效的性能优化手段模块代码示例用于类型注解模块演示准备模块功能演示固定函数参数固定函数参数计算的次方创建一个总是计算平方的函数创建一个总是计算立方的函数创建一个总是计算以为底的幂的函数第一个未命名参数被固定为累积计算累积计算计算阶乘函数结果缓存函数结果缓存表示不限制缓存大小一个计算斐波那契数的耗时函数递归实现不加缓存效率极低计算打印这条可以看出函数是否实际执行模拟计算耗时第一次调用计算并缓存第一次调用耗时秒缓存信息第二次调用应从缓存中获取非常快第二次调用应从缓存读取耗时秒缓存清除缓存缓存已清除缓存信息编写行为正确的装饰器编写行为正确的装饰器一个简单的日志装饰器演示的作用如果没有的等元信息会变成的函数的文档字符串装饰器调用函数之前装饰器调用函数之后结果向一个人问好并返回问候语调用被装饰的检查被装饰函数的元信息函数名应为文档字符串应为的文档主函数用于调用各个演示函数用户选择要运行的演示请选择要运行的演示演示演示演示演示运行所有演示退出请输入选项编号退出程序无效选项请重新运行程序坑点与建议模块的参数顺序会按顺序填充位置参数然后是关键字参数如果本身有一些默认参数可以覆盖它们或者提供那些未被固定的参数的可读性虽然很强大但对于简单的求和求积等操作直接使用内置的或一个显式的循环通常更具可读性更适用于一些自定义的复杂累积逻辑确保中使用的二元函数易于理解的适用场景适用于那些输入参数组合相对有限且单次计算成本较高的纯函数即对于相同的输入总是返回相同输出且没有副作用的函数不适用于参数是可变对象如列表字典且函数行为依赖于对象内部状态变化的情况因为缓存是基于参数值的哈希如果可变对象被修改但其哈希不变或哈希变化但对象视为等价可能导致缓存命中错误可以让缓存区分不同类型的参数如和参数很重要设置太小可能导致缓存命中率低则不限制大小可能消耗过多内存的必要性在编写任何自定义装饰器时强烈建议使用来装饰内部的函数这能确保被装饰后的函数保留其原始函数的名称文档字符串参数列表模块名等重要元信息这对于调试文档生成和代码可维护性至关重要模块对象的浅拷贝与深拷贝在中赋值操作对于可变对象如列表字典通常只是创建了一个新的引用指向同一个对象这意味着修改一个引用会影响到所有指向该对象的引用模块提供了创建对象副本的方法分为浅拷贝和深拷贝用于在不同程度上复制对象及其内容常用功能函数描述创建对象的浅拷贝创建对象的深拷贝浅拷贝深拷贝浅拷贝创建一个新的复合对象例如一个新的列表实例然后对于原始对象中的元素如果是不可变类型如数字字符串元组则直接复制其值如果是可变类型如列表字典自定义对象则复制其引用也就是说新列表中的可变元素和旧列表中的对应可变元素将指向内存中同一个对象影响修改新拷贝中嵌套的可变对象的内容会影响到原始对象中对应的嵌套可变对象深拷贝创建一个新的复合对象然后递归地复制原始对象中的所有内容这意味着如果遇到嵌套的可变对象它会为这些嵌套的可变对象也创建新的副本而不是仅仅复制引用影响修改新拷贝中嵌套的可变对象的内容不会影响到原始对象因为它们是完全独立的副本能够正确处理循环引用对象内部直接或间接引用自身批注核心记忆功能模块理解浅拷贝和深拷贝的根本区别浅拷贝只复制顶层容器内部元素如果是可变对象则共享引用深拷贝会递归复制所有嵌套的可变对象创建完全独立的副本用于浅拷贝常用且重要当你需要一个与原始对象完全独立的副本尤其是当对象包含嵌套的可变结构时应使用深拷贝模块数据结构的美化输出当需要打印复杂的数据结构如深度嵌套的列表字典时内置的函数的输出可能挤在一行难以阅读和理解模块提供了美化打印的功能可以将这些数据结构以更易读的格式输出例如自动换行缩进和排序可选常用功能函数类描述将对象美化输出到指定的流默认为返回对象美化后的字符串表示而不是直接打印创建一个对象可以更细致地控制美化输出的参数并可复用或的常用参数每级缩进的空格数输出内容的目标宽度超过此宽度会尝试换行控制嵌套数据结构的打印深度超出此深度的部分会用表示输出流如果为则输出会更紧凑尽可能将多个短元素放在同一行如果为默认则字典会按键排序后输出保证输出顺序的一致性批注核心记忆功能模块最常用直接美化打印数据结构当你需要获取美化后的字符串而不是直接打印时使用如果不希望字典输出时按键排序可以创建实例并设置模块代码示例假设可用用于示例数据模块演示准备模块功能演示创建一个复杂的嵌套数据结构用于演示一个较长的列表使用直接美化打印使用直接美化打印使用普通打印复杂数据对比用输出会很拥挤使用打印复杂数据保持字典插入顺序或原始顺序使用获取美化后的字符串使用获取美化后的字符串只打印到第层嵌套更深的用尝试更紧凑的输出字典按键排序输出保证一致性使用获取的格式化字符串使用类进行更细致的控制和复用使用类创建一个实例可以预设参数表示不限制深度不排序字典使用自定义的实例打印使用另一个配置字典排序的实例演示函数已在各自节内调用或其逻辑已在此处模块演示结束第二十章语法新特性总结语言在不断发展每个新版本都会带来一些有用的新特性性能改进和语法糖使得编写代码更加高效和愉悦本章将简要回顾从到版本引入的一些值得关注的语法和核心库特性主要特性带来了赋值表达式海象操作符仅位置参数调试支持等重要更新赋值表达式海象操作符海象操作符允许你在表达式内部为变量赋值这可以在某些情况下简化代码尤其是在语句或循环中当你需要先计算一个值然后判断这个值并且后续还想使用这个值时海象操作符演示假设可用演示海象操作符的使用海象操作符示例在条件中赋值并使用列表长度为大于前三个元素列表长度为不大于特性演示仅位置参数函数定义中可以使用来指明其前面的参数只能通过位置传递不能作为关键字参数传递这有助于库作者设计更清晰更不易出错的仅位置参数演示演示仅位置参数的使用仅位置参数创建用户信息字典和只能通过位置传递和可以是位置参数或关键字参数正确位置参数正确位置参数和关键字参数正确作为位置参数也是可以的演示真正的错误情况错误之前的参数不能用关键字方式传递在尝试执行操作时发生错误此处不重复假设按特性运行增强用于调试现在支持说明符可以在输出中包含表达式文本及其计算结果非常便于调试调试增强演示演示中的调试功能增强用于调试使用直接打印变量名和值调试信息输出示例调试信息也可以用于更复杂的表达式计算结果注意在表达式之后输出示例计算结果主要特性引入了新的字典合并操作符类型注解可以使用内置集合类型并为字符串添加了移除前缀后缀的方法字典合并与更新操作符和新的操作符用于合并两个字典用于原地更新字典字典合并与更新操作符演示兼容旧版类型提示但在中即可演示字典的和操作符字典合并与更新操作符键与重复合并操作如果键重复则右边字典的值优先合并后输出原地更新操作原始被修改原地更新后输出特性演示类型注解的内置集合类型泛型现在可以直接使用内置的集合类型如作为泛型类型进行注解而无需从模块导入大写版本如内置集合类型注解演示在中不再必需但为了兼容性或清晰性仍可使用演示使用内置集合类型进行类型注解参数字符串列表键为字符串值为整数的字典返回包含整数和浮点数的元组类型注解的内置集合类型函数定义使用了注解处理的名字处理的分数返回结果没有分数字符串方法和这两个新的字符串方法用于移除字符串的前缀或后缀如果存在的话字符串移除前缀后缀演示演示和字符串方法和移除后缀后缀不匹配未改变移除前缀前缀不匹配未改变主要特性带来了备受期待的结构化模式匹配更简洁的联合类型表示法以及上下文管理器语法的改进结构化模式匹配这是一种新的控制流语句允许你根据数据的结构和值来匹配模式并执行相应的代码块类似于其他语言中的或模式匹配结构化模式匹配演示演示结构化模式匹配处理不同数据结构结构化模式匹配输入匹配字典结构并捕获值用户数据姓名嵌套匹配和事件其他匹配列表包含守卫条件两个相等的整数点捕获列表剩余部分到操作在上的结果匹配字符串并用绑定收到退出指令通配符匹配任何其他情况未知或不匹配的数据包格式特性演示处理包结果联合类型操作符现在可以使用操作符来表示联合类型使得类型注解更简洁联合类型操作符演示在中和不再必需显式导入来使用使用代替演示使用作为联合类型操作符联合类型操作符接收到的值类型数值处理字符串处理使用代替演示使用代替未提供数据处理可选数据为上下文管理器改进括号内多个表达式现在可以在语句后的括号内编写多个上下文表达式而无需嵌套语句使代码更扁平上下文管理器改进演示用于文件操作演示在语句中使用括号包含多个上下文表达式上下文管理器改进括号内多个表达式创建临时输入文件第一行数据第二行数据已创建临时输入文件的写法同时打开读和写示例操作转为大写后写入内容已从输入文件读取处理后写入输出文件验证输出文件输出文件内容处理文件时发生错误清理临时文件临时文件已清理主要特性带来了显著的性能提升计划以及异常组异常注释类型和等新特性异常组和异常注释允许同时处理多个不相关的异常方法可以向异常对象添加上下文注释异常组和异常注释演示在中是内置的演示和异常组和异常注释演示演示输入的值无法转换为整数添加注释请确保输入的是有效的数字如果要重新引发带注释的异常捕获到带注释要查看注释你需要捕获异常并访问其属性或让它传播到顶层由解释器打印异常的默认异常回溯会显示注释重新引发以观察其默认打印效果重新引发的异常其回溯应包含注释异常包含的注释演示概念性演示概念性假设我们有多个并发任务每个都可能失败模拟任务任务模拟成功任务除法运算失败任务捕获模拟任务任务模拟成功任务字典键查找失败任务捕获如果有多个异常可以用包装它们在中是内置的对于旧版本可能需要此库在执行多个任务时发生错误发生了异常组处理异常组的语法捕获到异常组中的捕获到异常组中的在实际代码中会使用来处理所有模拟任务均成功完成特性演示类型或仅如果提供了一种更简洁更准确的方式来注解那些返回类自身实例的方法例如构造函数工厂方法或返回修改后自身的链式调用方法类型演示或演示类型的使用类型已创建返回类型是设置一个配置选项并返回自身以便链式调用选项设置为返回当前类的实例类方法返回创建一个带有默认设置的实例调用类方法指向或其子类构建配置使用示例链式调用演示在子类中的行为返回的仍然是类型的类型是应为类型用于注解那些值必须是字面量字符串即直接在代码中写出的字符串而不是通过变量拼接或函数调用生成的字符串的参数这有助于静态分析工具检测潜在的安全风险例如注入类型演示演示类型类型一个模拟的安全数据库查询函数它只接受字面量字符串作为查询语句以防止注入尝试执行安全查询参数在实际应用中这里会与数据库交互并可能使用参数化查询模拟执行查询参数化正确的用法传递字符串字面量错误的用法传递通过变量或拼接生成的字符串静态类型检查器如会对以下调用发出警告会警告请输入要查询的列名例如模拟用户输入会警告注意主要用于静态类型检查如果上面的注释行被取消且使用了它会标记出潜在的类型错误在运行时本身不强制取消注释以在运行时测试部分可选主要特性继续改进类型系统带来了更简洁的泛型类和函数语法以及的进一步增强泛型类和函数的简化语法现在可以使用更简洁的方括号语法直接在类或函数定义中声明类型参数而无需从导入简化泛型语法演示在中可以通过新语法隐式定义演示中简化的泛型类和函数语法泛型类和函数的简化语法简化泛型函数定义旧方法直接在函数名后用声明类型参数获取列表的第一个元素如果列表为空则返回调用简化泛型类定义旧方法直接在类名后用声明类型参数可以显式指定类型也可以让类型检查器推断特性演示类型别名与类型变量语法改进语句引入了语句作为创建类型别名和类型变量的更清晰更正式的方式语句演示仍可用于兼容性或复杂场景的语句定义类型别名定义类型变量现在是一个可以绑定到或定义逆变类型变量上界为定义协变类型变量上界为演示中使用语句定义类型别名和类型变量类型别名与类型变量语法改进语句处理点类型是泛型变量字符串泛型变量整数会报错类型不匹配整数列表的和会报错因为只能是或语法进一步改进中的更加强大和灵活主要体现在引号重用现在可以在表达式内部重用与包围自身所用类型相同的引号无需转义多行表达式和注释表达式部分现在可以跨越多行并且可以包含注释反斜杠表达式部分可以使用反斜杠语法改进演示演示中的语法改进语法进一步改进引号重用在之前需要不同类型的引号或转义或者可以重用引号引号重用外层单引号内部仍可方便使用双引号引号重用单引号多行表达式和注释注意在多行表达式中注释必须在自己的行上这是一个表达式内部的注释多行表达式方法调用带多行表达式和注释反斜杠虽然不常见但现在允许原本就这样可以现在更灵活中使用反斜杠主要特性带来了包括新的装饰器编译器的初步实验可能不直接体现在日常语法中以及对现有特性的一些改进装饰器一个新的装饰器来自模块或的中已有用于明确指示一个方法意图覆盖其父类中的同名方法这有助于静态类型检查器和开发者捕捉由于意外拼写错误或签名不匹配导致的覆盖失败装饰器演示或演示装饰器装饰器明确表示此方法覆盖父类方法明确表示此方法覆盖父类方法如果写成拼写错误这类类型检查器会报错因为它没有覆盖任何父类方法尝试覆盖一个不存在的基类方法会警告帮助在静态检查时发现覆盖错误部分特性演示第二十一章项目结构规范与最佳实践一个清晰一致的项目结构和高质量的代码是任何成功软件项目的基石良好的项目组织不仅能让其他开发者以及未来的你更容易理解和维护代码还能简化构建测试部署和分发流程同样遵循统一的代码风格和最佳实践能够显著提高代码的可读性减少错误并促进团队协作本章将探讨项目的推荐结构并总结一些核心的代码质量与风格指南主要基于一推荐的项目结构一个组织良好的项目通常包含应用代码测试文档依赖管理和打包配置等部分下面是一个推荐的通用项目结构示例目录树概览项目根目录例如仓库的根主要的包你的应用或库的核心代码将标记为一个包可包含包级别初始化代码包内的模块文件另一个模块文件包内可以有子包使成为一个子包子包内的模块常用的工具或辅助函数可以组织在子包中辅助函数模块存放所有测试代码的目录使成为一个包有些测试运行器需要针对的测试针对子包模块的测试项目文档例如使用或生成配置文件如果使用主文档文件或文档等如何使用你的包或库的示例代码指定应忽略的文件和目录项目的许可证文件例如项目的详细说明安装指南使用方法等格式列出项目运行所需的基本依赖包及其版本传统方式项目的构建脚本用于打包分发现代方式项目元数据和构建系统配置推荐与结合或替代可选配置文件用于自动化测试不同环境各部分详解项目根目录这是你项目的最顶层目录通常对应你的版本控制系统如的仓库根目录主应用包这是存放你项目核心代码的地方它是一个包意味着它包含一个文件这个文件可以为空仅用于将目录标记为一个包使得其中的模块可以使用点分路径导入例如它也可以包含包级别的初始化代码定义变量来控制的行为或者直接从子模块中导出常用的类和函数以提供更简洁的包示例仅为演示打印实际通常不直接打印包正在被初始化定义包版本从子模块导出方便外部调用控制的行为一个包级别的辅助函数示例例如这些是包内的实际模块文件包含相关的函数类和变量大型包可以进一步组织为子包每个子包同样包含一个文件例如通常用于存放项目中可复用的辅助函数工具类等测试目录存放单元测试集成测试等所有测试代码测试文件名通常以开头或者测试类以开头以便测试运行器如能够自动发现和执行文档目录存放项目的用户文档文档等常用的工具有配合或或纯示例代码目录提供如何使用你的库或应用程序的简单可运行的示例代码告知哪些文件或目录不应被跟踪和提交例如虚拟环境目录配置文件等包含项目的开源许可证文本例如等明确许可证对于代码的分享和使用非常重要项目的入口点和门面通常包含项目名称和简短描述安装说明基本用法示例如何运行测试如何贡献许可证信息链接列出项目运行所必需的第三方依赖包及其版本通常由生成或者手动维护更现代的项目可能会使用中的示例或用于构建打包和分发项目的脚本传统示例传统方式仅为演示通常不应有副作用打印执行避免在导入时执行打印读取作为长描述未找到长描述将为空示例依赖具体根据项目需求包的唯一名称上当前版本您的名字这是一个关于我的超级包的简短描述如果是项目主页会自动查找所有包含的目录作为包参数可以排除特定目录如指定包内需要包含的非代码文件例如模板数据文件如果使用项目兼容的最低版本项目的核心运行时依赖可选用于开发和测试的额外依赖如果你的包提供了命令行工具分类器帮助用户发现你的包搜索关键词配置完成现代和推荐使用文件来声明构建依赖和项目元数据仍然可以作为构建后端示例可选如果在子目录这是一个关于我的超级包的简短描述您的名字您的名字其他分类器当使用时可以非常简单甚至在某些情况下不需要如果所有元数据都在且构建后端支持二代码质量与风格指南核心实践是官方的代码风格指南遵循它可以使代码更易读更易于维护并促进团队协作的一致性除了还有一些通用的最佳实践下面是一个演示这些规范的示例脚本代码质量与实践演示标准库导入标准库导入标准库导入类型注解第三方库导入示例本地应用库导入示例模块级别文档字符串与常量代码质量与核心实践演示本模块旨在演示风格指南中的常见规则和一些编码最佳实践官方文档常量名应全部大写单词间用下划线分隔类定义与文档字符串类定义与文档字符串一个示例类用于演示规范和良好实践这个类的主要目的是展示命名约定文档字符串格式方法定义以及属性的组织方式对象的名称一个可选的整数值一个受保护的成员变量一个私有的成员变量初始化对象对象的名称一个可选的整数值默认为受保护成员以下划线开头私有成员以双下划线开头会被名称修饰显示对象的信息如果参数列表过长可以像下面这样换行和缩进信息输出的前缀默认为格式化后的信息字符串行长度通常建议不超过个字符或团队约定的长度如长字符串或表达式可以分行通常在操作符之后换行并适当缩进访问被名称修饰的私有变量在二元运算符之前或之后换行都是允许的但团队内应保持一致一个只读属性返回大写的名称函数定义与文档字符串函数定义与文档字符串计算一个数字列表的总和与平均值需要计算的浮点数列表一个包含总和与平均值的元组如果输入列表为空如果列表中包含非数字类型的元素输入列表不能为空以计算平均值操作符两侧通常有空格捕获特定异常列表中的所有元素都必须是数字正确的空格使用示例运算符两侧逗号后括号内侧通常无空格除非是元组只有一个元素索引切片操作符内侧无空格冒号后有空格前面无花括号内侧通常无空格条件语句与表达条件语句与表达演示条件语句的推荐写法检查使用或项目为检查布尔真值直接使用或而不是或适用于空列表空字符串空字典等项目为空或具有布尔假值复杂条件表达式如果过长可以分行并用括号括起来此处的仅为示例位运算示例项目是一个长度大于的活动字符串且不紧急项目具有其他状态推导式与生成器表达式推导式与生成器表达式演示列表推导式和生成器表达式列表推导式生成器表达式更节省内存按需生成生成器表达式在中使用字典推导式避免过于复杂的嵌套推导式如果可读性受损应拆分为普通循环尚可接受异常处理异常处理一个演示安全操作的函数包含完整的异常处理假设这是一个可能抛出多种异常的操作输入值必须是数字类型除数不能为零自定义而非直接捕获特定的预期的异常操作失败实际项目中用日志操作失败捕获其他所有子类的异常作为最后防线发生未知错误如果块中没有发生任何异常则执行块操作成功完成结果无论块中是否发生异常块总会执行通常用于资源清理操作尝试已结束块执行上下文管理器语句上下文管理器语句使用上下文管理器安全地读取文件内容语句确保文件在操作完成后即使发生异常也会被正确关闭成功读取文件文件未找到读取文件时发生错误主程序块用于调用演示函数开始演示开始演示对于列表总和平均值捕获到预期错误开始演示开始演示开始演示开始演示创建一个临时文件用于读取演示文件内容前字符测试文件不存在的情况清理临时文件已删除临时读取文件代码质量与实践演示结束三总结与工具遵循良好的项目结构和编码规范是开发高质量可维护应用的关键项目结构清晰的目录划分有助于分离关注点使得代码测试文档和配置易于查找和管理代码风格一致的编码风格提高了代码的可读性是团队协作的基础文档与注释良好的文档字符串和必要的注释使代码更易于理解和使用代码利用语言的特性如推导式上下文管理器可以写出更简洁更高效更易读的代码辅助工具为了帮助开发者遵循最佳实践并保持代码质量社区提供了许多优秀的工具代码风格和错误检查结合了错误检查风格检查和复杂度检查功能更全面提供更广泛的代码分析错误检测风格检查和重构建议一个用编写的极快的和可以替代等多种工具代码自动格式化一个固执己见的代码格式化工具能自动将代码格式化为符合子集的一致风格自动将代码格式化为符合风格也包含了格式化功能静态类型检查官方的静态类型检查器由微软开发快速且功能强大的类型检查器也是中插件的核心开发的类型检查器可以推断类型将这些工具集成到你的开发流程和持续集成系统中可以有效地提升团队的整体代码质量和开发效率",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-06-19 17:45:00",postMainColor:"#CBA633"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0F1C2E')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#cee8ff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/index_media.css" media="(max-width:0),screen and (prefers-reduced-motion:reduce)" onload="this.media=`screen`"><link rel="stylesheet" href="/css/post-ui.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="后续项目..."><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="后续项目..."><span class="back-menu-item-text">后续项目...</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">格物致知</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)" rel="external nofollow noreferrer">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>个人</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fas fa-check-double faa-tada"></i><span> 代办清单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>预览</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?server=netease&amp;id=3117791189"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fas fa-comments faa-tada"></i><span> 评论总览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 即刻短文</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="background-change-button"><a class="site-page" onclick="toggleWinbox()" title="切换背景" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-palette"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);" rel="external nofollow noreferrer"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url">后端技术</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Python/" itemprop="url">Python</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Python/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>Python</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Python教程：应用之巅</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-19T06:00:00.000Z" title="发表于 2025-06-19 14:00:00">2025-06-19</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-06-19T09:45:00.000Z" title="更新于 2025-06-19 17:45:00">2025-06-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span data-flag-title="Python教程：应用之巅"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为广东"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广东</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://bu.dusays.com/2025/06/17/685113b7c7d81.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">Tianli GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax="" src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope="" itemtype="https://prorise-cool.github.io/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/"><header><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url">后端技术</a><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Python/" itemprop="url">Python</a><a href="/tags/Python/" tabindex="-1" itemprop="url">Python</a><h1 id="CrawlerTitle" itemprop="name headline">Python教程：应用之巅</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">Prorise</span><time itemprop="dateCreated datePublished" datetime="2025-06-19T06:00:00.000Z" title="发表于 2025-06-19 14:00:00">2025-06-19</time><time itemprop="dateCreated datePublished" datetime="2025-06-19T09:45:00.000Z" title="更新于 2025-06-19 17:45:00">2025-06-19</time></header><div id="postchat_postcontent"><h2 id="第十八章-单元测试"><a href="#第十八章-单元测试" class="headerlink" title="第十八章 单元测试"></a>第十八章 单元测试</h2><p>软件开发的核心目标之一是交付高质量、运行稳定的代码。<strong>单元测试 (Unit Testing)</strong> 是保障这一目标的重要手段，它专注于验证软件中最小可测试单元（通常是函数、方法或类）的行为是否符合预期。</p><p>在本章中，我们将深入学习 Python 中广受欢迎的测试框架 —— <code>pytest</code>。</p><h3 id="18-1-单元测试简介："><a href="#18-1-单元测试简介：" class="headerlink" title="18.1 单元测试简介："></a>18.1 单元测试简介：</h3><p>单元测试通过在开发早期发现并修复问题，从而提升代码质量，增强代码重构的信心，并作为一种“活文档”辅助理解代码功能。</p><p><strong>基本流程：</strong></p><ol><li><strong>隔离单元</strong>：确定要测试的函数、方法或类。</li><li><strong>定义预期</strong>：明确该单元在特定输入下应有的输出或行为。</li><li><strong>编写测试</strong>：使用测试框架编写代码来验证这些预期。</li><li><strong>执行测试</strong>：运行测试并检查结果。</li><li><strong>迭代优化</strong>：根据测试结果修改代码或测试本身。</li></ol><h3 id="18-2-Pytest-简介与核心优势"><a href="#18-2-Pytest-简介与核心优势" class="headerlink" title="18.2 Pytest 简介与核心优势"></a>18.2 Pytest 简介与核心优势</h3><p><code>pytest</code> 是一个成熟且功能齐全的 Python 测试框架，它使得编写小型、易读的测试变得简单，并且可以扩展以支持复杂的函数式、接口或系统级测试。</p><p><strong>为什么选择 <code>pytest</code>？</strong></p><ul><li><strong>极简样板代码</strong>：相比 <code>unittest</code>，<code>pytest</code> 需要的模板代码更少。测试函数就是普通的 Python 函数，不需要继承任何类。</li><li><strong>强大的 <code>assert</code> 语句</strong>：直接使用标准的 <code>assert</code> 语句进行断言，<code>pytest</code> 会提供详细的断言失败信息。</li><li><strong>灵活的 Fixtures</strong>：<code>pytest</code> 的 Fixture 系统非常强大，用于管理测试依赖和测试上下文的准备与清理，比传统的 <code>setUp/tearDown</code> 更灵活。</li><li><strong>丰富的插件生态</strong>：拥有大量高质量的第三方插件（如 <code>pytest-django</code>, <code>pytest-cov</code> (覆盖率), <code>pytest-xdist</code> (并行测试) 等）。</li><li><strong>良好的兼容性</strong>：可以运行基于 <code>unittest</code> 和 <code>nose</code> 编写的测试用例。</li><li><strong>清晰的测试报告</strong>：默认提供易读的测试报告。</li></ul><p><strong>安装 <code>pytest</code></strong></p><p>您可以使用 pip 来安装 <code>pytest</code>：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest</span><br></pre></td></tr></tbody></table></figure><h3 id="18-3-Pytest-核心特性概览"><a href="#18-3-Pytest-核心特性概览" class="headerlink" title="18.3 Pytest 核心特性概览"></a>18.3 Pytest 核心特性概览</h3><p><code>pytest</code> 的强大功能主要体现在以下几个核心特性上，本笔记将逐一介绍：</p><table><thead><tr><th align="left">特性/概念</th><th align="left">简介</th><th align="left">涉及的主要 pytest 元素/用法</th></tr></thead><tbody><tr><td align="left"><strong>测试发现 (Test Discovery)</strong></td><td align="left"><code>pytest</code> 自动查找符合特定命名约定的测试文件和函数。</td><td align="left">文件名 <code>test_*.py</code> 或 <code>*_test.py</code>；函数/方法名 <code>test_*</code>。</td></tr><tr><td align="left"><strong>基本测试函数 (Basic Test Functions)</strong></td><td align="left">普通 Python 函数即可作为测试用例，无需继承特定类。</td><td align="left"><code>def test_example(): ...</code></td></tr><tr><td align="left"><strong>断言 (Assertions)</strong></td><td align="left">使用 Python 内置的 <code>assert</code> 语句进行结果验证，<code>pytest</code> 提供详细的错误报告。</td><td align="left"><code>assert expression</code></td></tr><tr><td align="left"><strong>异常测试 (Exception Testing)</strong></td><td align="left">优雅地测试代码是否按预期抛出异常。</td><td align="left"><code>pytest.raises()</code> 上下文管理器。</td></tr><tr><td align="left"><strong>Fixtures (测试固件)</strong></td><td align="left">管理测试函数的依赖、状态和资源，实现代码复用和模块化。</td><td align="left"><code>@pytest.fixture</code> 装饰器, <code>yield</code> 用于 teardown。</td></tr><tr><td align="left"><strong>参数化测试 (Parametrization)</strong></td><td align="left">使用不同的参数多次运行同一个测试函数，避免代码重复。</td><td align="left"><code>@pytest.mark.parametrize</code> 装饰器。</td></tr><tr><td align="left"><strong>标记 (Markers)</strong></td><td align="left">为测试函数添加元数据，用于分类、跳过、标记预期失败等。</td><td align="left"><code>@pytest.mark.&lt;marker_name&gt;</code> (如 <code>skip</code>, <code>xfail</code>)。</td></tr><tr><td align="left"><strong>运行测试 (Running Tests)</strong></td><td align="left">通过命令行工具 <code>pytest</code> 运行测试，并提供多种选项。</td><td align="left"><code>pytest</code> 命令及其参数 (如 <code>-v</code>, <code>-k</code>, <code>-m</code>)。</td></tr></tbody></table><h3 id="18-4-Pytest-基础实践"><a href="#18-4-Pytest-基础实践" class="headerlink" title="18.4 Pytest 基础实践"></a>18.4 Pytest 基础实践</h3><h4 id="18-4-1-编写第一个-Pytest-测试：测试加法函数"><a href="#18-4-1-编写第一个-Pytest-测试：测试加法函数" class="headerlink" title="18.4.1 编写第一个 Pytest 测试：测试加法函数"></a>18.4.1 编写第一个 Pytest 测试：测试加法函数</h4><p><code>pytest</code> 会自动发现当前目录及其子目录下所有命名为 <code>test_*.py</code> 或 <code>*_test.py</code> 的文件中的 <code>test_*</code> 开头的函数。</p><p><em>被测代码 (<code>my_math.py</code>):</em></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my_math.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">"""计算两个数的和"""</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></tbody></table></figure><p><em>测试代码 (<code>test_my_math_pytest.py</code>):</em></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_my_math_pytest.py</span></span><br><span class="line"><span class="keyword">from</span> my_math <span class="keyword">import</span> add <span class="comment"># 导入需要测试的函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_simple_addition</span>():</span><br><span class="line">    <span class="string">"""测试基本的加法功能。"""</span></span><br><span class="line">    <span class="comment"># 直接使用 assert进行断言</span></span><br><span class="line">    <span class="keyword">assert</span> add(<span class="number">1</span>, <span class="number">2</span>) == <span class="number">3</span>, <span class="string">"1 + 2 应该等于 3"</span> <span class="comment"># 可选的错误信息</span></span><br><span class="line">    <span class="keyword">assert</span> add(-<span class="number">1</span>, <span class="number">1</span>) == <span class="number">0</span></span><br><span class="line">    <span class="comment"># assert add(0, 3) == 这里一定会报错 因为 0 # 3 != 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_negative_addition</span>():</span><br><span class="line">    <span class="string">"""测试负数相加。"""</span></span><br><span class="line">    <span class="keyword">assert</span> add(-<span class="number">5</span>, -<span class="number">10</span>) == -<span class="number">15</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p><strong>代码注释与讲解：</strong></p><ul><li>测试文件命名为 <code>test_my_math_pytest.py</code>，遵循 <code>pytest</code> 的发现约定。</li><li>测试函数 <code>test_simple_addition</code> 和 <code>test_negative_addition</code> 以 <code>test_</code> 开头。</li><li>直接使用 <code>assert</code> 语句。如果 <code>assert</code> 后的表达式为 <code>False</code>，<code>pytest</code> 会将该测试标记为失败，并提供详细的上下文信息。</li><li>最后的 <code>, "message"</code> 部分是可选的，如果断言失败，这个消息不会像 <code>unittest</code> 的 <code>msg</code> 参数那样直接显示，<code>pytest</code> 会通过其内省机制提供更丰富的失败信息。</li></ul><p><strong>运行测试：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/image-20250510175654130.png" alt="image-20250510175654130"></p><p><code>pytest</code> 会自动找到并执行 <code>test_simple_addition</code> 和 <code>test_negative_addition</code>。</p><h4 id="18-4-2-测试异常：pytest-raises"><a href="#18-4-2-测试异常：pytest-raises" class="headerlink" title="18.4.2 测试异常：pytest.raises"></a>18.4.2 测试异常：<code>pytest.raises</code></h4><p>当需要验证代码是否按预期抛出特定异常时，可以使用 <code>pytest.raises</code>。</p><p><em>被测代码 (<code>more_math.py</code>，包含 <code>square</code> 函数):</em></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># more_math.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">square</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="string">"""计算一个数的平方。"""</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(n, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">"输入必须是数字"</span>)</span><br><span class="line">    <span class="keyword">return</span> n * n</span><br></pre></td></tr></tbody></table></figure><p><em>测试代码 (<code>test_more_math_pytest.py</code>):</em></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_more_math_pytest.py</span></span><br><span class="line"><span class="keyword">import</span> pytest  <span class="comment"># 需要导入 pytest 来使用 pytest.raises 等特性</span></span><br><span class="line"><span class="keyword">from</span> more_math <span class="keyword">import</span> square</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_square_positive_numbers</span>():</span><br><span class="line">    <span class="string">"""测试正数的平方。"""</span></span><br><span class="line">    <span class="keyword">assert</span> square(<span class="number">2</span>) == <span class="number">4</span></span><br><span class="line">    <span class="keyword">assert</span> square(<span class="number">3.0</span>) == <span class="number">9.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_square_negative_numbers</span>():</span><br><span class="line">    <span class="string">"""测试负数的平方。"""</span></span><br><span class="line">    <span class="keyword">assert</span> square(-<span class="number">2</span>) == <span class="number">4</span></span><br><span class="line">    <span class="keyword">assert</span> square(-<span class="number">1.5</span>) == <span class="number">2.25</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_square_zero</span>():</span><br><span class="line">    <span class="string">"""测试零的平方。"""</span></span><br><span class="line">    <span class="keyword">assert</span> square(<span class="number">0</span>) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_square_invalid_input_raises_typeerror</span>():</span><br><span class="line">    <span class="string">"""测试当输入无效时，square 函数是否抛出 TypeError。"""</span></span><br><span class="line">    <span class="comment"># pytest.raises 是一个上下文管理器，用于断言在 with 块内执行的代码会抛出指定类型的异常</span></span><br><span class="line">    <span class="comment"># 如果代码块中没有抛出 TypeError，测试将失败</span></span><br><span class="line">    <span class="comment"># 如果代码块中抛出了其他类型的异常，测试也将失败</span></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(TypeError):</span><br><span class="line">        square(<span class="string">'呵呵呵呵呵'</span>)  <span class="comment"># 这行代码应该抛出 TypeError</span></span><br><span class="line">    <span class="comment"># 这个测试能通过是因为 square 函数在接收到字符串参数时会抛出 TypeError</span></span><br><span class="line">    <span class="comment"># 当使用 pytest.raises(TypeError) 上下文管理器时，如果代码块内抛出了 TypeError</span></span><br><span class="line">    <span class="comment"># pytest 会捕获这个异常并使测试通过，这正是我们期望的行为</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_square_invalid_input_message</span>():</span><br><span class="line">    <span class="string">"""测试 TypeError 异常的错误信息是否符合预期 (可选)。"""</span></span><br><span class="line">    <span class="comment"># pytest.raises 的 match 参数允许提供一个正则表达式，用于验证抛出的异常实例的错误消息</span></span><br><span class="line">    <span class="comment"># 这对于确保错误信息对用户友好且准确非常有用</span></span><br><span class="line">    <span class="comment"># 如果抛出的异常消息与提供的正则表达式不匹配，测试将失败</span></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(TypeError, <span class="keyword">match</span>=<span class="string">"输入必须是数字"</span>):  <span class="comment"># match 参数使用正则表达式匹配错误信息</span></span><br><span class="line">        square(<span class="string">'text'</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="18-5-Pytest-Fixtures：强大的依赖注入与测试准备"><a href="#18-5-Pytest-Fixtures：强大的依赖注入与测试准备" class="headerlink" title="18.5 Pytest Fixtures：强大的依赖注入与测试准备"></a>18.5 Pytest Fixtures：强大的依赖注入与测试准备</h3><p>Fixtures（测试固件）是 <code>pytest</code> 中一个非常核心且强大的特性。它们用于为测试函数、类、模块或整个会话设置必要的预置条件（如数据、对象实例、服务连接等），并在测试结束后进行清理。</p><h4 id="18-5-1-Fixture-基本概念与应用：-pytest-fixture"><a href="#18-5-1-Fixture-基本概念与应用：-pytest-fixture" class="headerlink" title="18.5.1 Fixture 基本概念与应用：@pytest.fixture"></a>18.5.1 Fixture 基本概念与应用：<code>@pytest.fixture</code></h4><p>通过 <code>@pytest.fixture</code> 装饰器可以将一个函数标记为 fixture。测试函数可以通过将其名称作为参数来请求使用这个 fixture。</p><p><em>示例 (<code>test_fixtures_basic.py</code>):</em></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_fixtures_basic.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_list</span>():</span><br><span class="line">    <span class="string">"""一个提供简单列表数据的 fixture。"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [Fixture setup] Creating sample_list..."</span>)</span><br><span class="line">    data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    <span class="keyword">return</span> data <span class="comment"># fixture 返回的值会注入到测试函数中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_dict</span>():</span><br><span class="line">    <span class="string">"""一个提供简单字典数据的 fixture。"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [Fixture setup] Creating sample_dict..."</span>)</span><br><span class="line">    <span class="keyword">return</span> {<span class="string">"name"</span>: <span class="string">"pytest"</span>, <span class="string">"type"</span>: <span class="string">"framework"</span>}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_list_length</span>(<span class="params">sample_list</span>): <span class="comment"># 将 fixture 名称作为参数</span></span><br><span class="line">    <span class="string">"""测试 sample_list 的长度。"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n      [Test running] test_list_length using sample_list"</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(sample_list) == <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_list_content</span>(<span class="params">sample_list</span>):</span><br><span class="line">    <span class="string">"""测试 sample_list 的内容。"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n      [Test running] test_list_content using sample_list"</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">3</span> <span class="keyword">in</span> sample_list</span><br><span class="line">    <span class="keyword">assert</span> sample_list[<span class="number">0</span>] == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_dict_values</span>(<span class="params">sample_dict, sample_list</span>): <span class="comment"># 一个测试可以使用多个 fixtures</span></span><br><span class="line">    <span class="string">"""测试 sample_dict 的值，并同时使用 sample_list。"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n      [Test running] test_dict_values using sample_dict and sample_list"</span>)</span><br><span class="line">    <span class="keyword">assert</span> sample_dict[<span class="string">"name"</span>] == <span class="string">"pytest"</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(sample_list) &gt; <span class="number">0</span> <span class="comment"># 确认 sample_list 也被正确注入</span></span><br></pre></td></tr></tbody></table></figure><p><strong>代码注释与讲解：</strong></p><ul><li><code>@pytest.fixture</code>: 装饰器，将 <code>sample_list</code> 和 <code>sample_dict</code> 函数转换为 fixture。</li><li>当测试函数（如 <code>test_list_length(sample_list)</code>）在其参数列表中包含 fixture 名称时，<code>pytest</code> 会在执行该测试函数之前先执行对应的 fixture 函数，并将其返回值注入到测试函数的同名参数中。</li><li><strong>复用性</strong>：同一个 fixture 可以被多个测试函数使用，避免了重复的设置代码。</li><li><strong>声明式依赖</strong>：测试函数清晰地声明了它所依赖的上下文或数据。</li></ul><h4 id="18-5-2-Fixture-的作用域-Scope"><a href="#18-5-2-Fixture-的作用域-Scope" class="headerlink" title="18.5.2 Fixture 的作用域 (Scope)"></a>18.5.2 Fixture 的作用域 (Scope)</h4><p>Fixture 可以定义不同的作用域，以控制其执行（setup/teardown）的频率和生命周期。作用域通过 <code>@pytest.fixture</code> 的 <code>scope</code> 参数指定</p><p>作为单元测试来说，没有必要区分的这么死板，<strong>平常来说使用默认值即可</strong>，若有严格需求再详细区分作用域</p><ul><li><strong><code>function</code> (默认)</strong>: 每个测试函数执行一次。是开销最小、隔离性最好的作用域。</li><li><strong><code>class</code></strong>: 每个测试类执行一次。用于类中所有测试方法共享的、创建开销较大的资源。</li><li><strong><code>module</code></strong>: 每个模块执行一次。</li><li><strong><code>package</code></strong>: 每个包执行一次 (Python 3.7+, 且 <code>pytest</code> 4.3+)。</li><li><strong><code>session</code></strong>: 整个测试会话（即一次 <code>pytest</code> 命令的完整执行过程）执行一次。适用于全局的、创建非常昂贵的资源。</li></ul><p><em>示例 (<code>test_fixture_scopes.py</code>):</em></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_fixture_scopes.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数级别 - 每个测试函数都会重新创建一次</span></span><br><span class="line"><span class="meta">@pytest.fixture </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">function_scoped_fixture</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [设置] 函数级别的fixture - 每个测试函数都会重新创建"</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"函数值"</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [清理] 函数级别的fixture"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类级别 - 每个测试类只创建一次，类中所有测试方法共享</span></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">"class"</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">class_scoped_fixture</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [设置] 类级别的fixture - 每个测试类只创建一次"</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"类值"</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [清理] 类级别的fixture"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模块级别 - 整个测试模块文件只创建一次，所有测试共享</span></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">"module"</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">module_scoped_fixture</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [设置] 模块级别的fixture - 整个测试文件只创建一次"</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"模块值"</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [清理] 模块级别的fixture"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会话级别 - 整个测试会话只创建一次，所有测试模块共享</span></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">"session"</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">session_scoped_fixture</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [设置] 会话级别的fixture - 整个测试会话只创建一次"</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"会话值"</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n   [清理] 会话级别的fixture"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p><strong>代码注释与讲解：</strong></p><ul><li>观察运行 <code>pytest -s -v test_fixture_scopes.py</code> (<code>-s</code> 用于显示 print 输出) 时的输出，可以清晰地看到不同作用域 fixture 的 setup 时机。</li></ul><h4 id="18-5-3-使用-yield-实现-Fixture-的-Teardown-清理操作"><a href="#18-5-3-使用-yield-实现-Fixture-的-Teardown-清理操作" class="headerlink" title="18.5.3 使用 yield 实现 Fixture 的 Teardown (清理操作)"></a>18.5.3 使用 <code>yield</code> 实现 Fixture 的 Teardown (清理操作)</h4><p>如果 fixture 需要在测试使用完毕后执行清理操作（类似于 <code>unittest</code> 中的 <code>tearDown</code>），可以使用 <code>yield</code> 语句。<code>yield</code> 之前的代码是 setup 部分，<code>yield</code> 之后的代码是 teardown 部分。</p><p><em>示例 (使用 <code>pytest</code> fixture):</em></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_file_fixture_pytest.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tempfile  <span class="comment"># 用于创建更安全的临时文件/目录</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">"function"</span></span>)  </span><span class="comment"># 每个测试函数都会得到一个新的临时文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">temp_file_with_content</span>():</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    创建一个包含内容的临时文件。</span></span><br><span class="line"><span class="string">    测试结束后，该临时文件会被自动清理。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># Setup: 创建临时文件并写入内容</span></span><br><span class="line">    <span class="comment"># tempfile.NamedTemporaryFile 创建一个有名字的临时文件，delete=False 确保在with块结束后文件不会立即删除，</span></span><br><span class="line">    <span class="comment"># 这样测试函数才能访问它。我们需要手动删除。</span></span><br><span class="line">    <span class="comment"># 或者使用 tmp_path fixture (见 18.5.4) 会更简单。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 tempfile.mkstemp() 可以获得文件名和文件描述符，更可控</span></span><br><span class="line">    fd, file_path = tempfile.mkstemp(text=<span class="literal">True</span>, prefix=<span class="string">"pytest_temp_"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n   [Fixture 设置] 创建临时文件: <span class="subst">{file_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    file_content = <span class="string">"Hello, pytest fixtures!"</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fd, <span class="string">"w"</span>) <span class="keyword">as</span> f:  <span class="comment"># 使用文件描述符打开</span></span><br><span class="line">        f.write(file_content)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># yield 将文件路径和预期的内容传递给测试函数</span></span><br><span class="line">    <span class="keyword">yield</span> file_path, file_content</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Teardown: 删除临时文件</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n   [Fixture 清理] 删除临时文件: <span class="subst">{file_path}</span>"</span>)</span><br><span class="line">    os.remove(file_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_read_from_temp_file</span>(<span class="params">temp_file_with_content</span>):</span><br><span class="line">    <span class="string">"""测试从 fixture 创建的临时文件中读取内容。"""</span></span><br><span class="line">    file_path, expected_content = temp_file_with_content  <span class="comment"># 解包 fixture 返回的值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n      [测试运行中] test_read_from_temp_file 访问 <span class="subst">{file_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="keyword">assert</span> content == expected_content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_temp_file_exists_during_test</span>(<span class="params">temp_file_with_content</span>):</span><br><span class="line">    <span class="string">"""测试临时文件在测试执行期间确实存在。"""</span></span><br><span class="line">    file_path, _ = temp_file_with_content</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n      [测试运行中] test_temp_file_exists_during_test 检查 <span class="subst">{file_path}</span>"</span>)</span><br><span class="line">    <span class="keyword">assert</span> os.path.exists(file_path)</span><br></pre></td></tr></tbody></table></figure><p><strong>代码注释与讲解：</strong></p><ul><li><code>yield file_path, file_content</code>: <code>yield</code> 语句是 setup 和 teardown 的分界点。它将 <code>file_path</code> 和 <code>file_content</code> 提供给测试函数。</li><li><code>yield</code> 之后的代码 (<code>os.remove(file_path)</code>) 在使用该 fixture 的测试函数执行完毕后（无论成功或失败）执行。</li></ul><h2 id="第十九章-标准内置库详解"><a href="#第十九章-标准内置库详解" class="headerlink" title="第十九章 标准内置库详解"></a>第十九章 标准内置库详解</h2><h3 id="1、时间处理模块详解"><a href="#1、时间处理模块详解" class="headerlink" title="1、时间处理模块详解"></a>1、时间处理模块详解</h3><p>在 Python 开发中，处理日期和时间是常见的需求，无论是记录日志、数据打点、任务调度还是处理用户输入，都离不开时间模块。Python 标准库主要提供了 <code>time</code> 和 <code>datetime</code> 两个模块来处理时间</p><h4 id="time-模块"><a href="#time-模块" class="headerlink" title="time 模块"></a><code>time</code> 模块</h4><p><code>time</code> 模块提供了对C语言库中时间相关函数的底层访问接口，主要用于获取时间戳、进行时间格式转换以及控制程序执行流程（如暂停）。它处理的时间通常与操作系统的本地时间或UTC（协调世界时）相关。</p><h5 id="time-模块常用函数"><a href="#time-模块常用函数" class="headerlink" title="time 模块常用函数"></a><code>time</code> 模块常用函数</h5><p>下表列出了 <code>time</code> 模块中一些核心且常用的函数：</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>time.time()</code></td><td>返回当前时间的时间戳（自1970年1月1日00:00:00 UTC到现在的浮点秒数）。</td></tr><tr><td><code>time.localtime([secs])</code></td><td>将一个时间戳（默认为 <code>time.time()</code> 的返回值）转换为本地时间的 <code>struct_time</code> 对象。如果未提供 <code>secs</code>，则使用当前时间。</td></tr><tr><td><code>time.gmtime([secs])</code></td><td>将一个时间戳（默认为 <code>time.time()</code> 的返回值）转换为 UTC（格林威治标准时间）的 <code>struct_time</code> 对象。如果未提供 <code>secs</code>，则使用当前时间。</td></tr><tr><td><code>time.mktime(t)</code></td><td><code>time.localtime()</code> 的反函数。接收一个 <code>struct_time</code> 对象（本地时间）作为参数，并返回其对应的时间戳（浮点秒数）。</td></tr><tr><td><code>time.asctime([t])</code></td><td>接收一个 <code>struct_time</code> 对象（默认为 <code>time.localtime()</code> 的返回值）并返回一个24个字符的可读字符串，例如：<code>'Mon May 12 11:18:35 2025'</code>。不推荐在新代码中使用。</td></tr><tr><td><code>time.strftime(format[, t])</code></td><td>将 <code>struct_time</code> 对象（默认为 <code>time.localtime()</code> 的返回值）按照指定的 <code>format</code> 字符串格式化为时间字符串。这是最常用的时间格式化函数。</td></tr><tr><td><code>time.strptime(string, format)</code></td><td>将时间字符串 <code>string</code> 按照指定的 <code>format</code> 解析为 <code>struct_time</code> 对象。</td></tr><tr><td><code>time.sleep(secs)</code></td><td>暂停当前程序的执行指定的秒数 <code>secs</code>（可以是浮点数，表示更精确的时间）。</td></tr><tr><td><code>time.perf_counter()</code></td><td>返回一个具有最高可用精度的性能计数器的值（以秒为单位），用于测量短时间间隔。它的参考点是未定义的，因此只有连续调用的结果之间的差异才是有效的。</td></tr><tr><td><code>time.process_time()</code></td><td>返回当前进程的CPU执行时间（用户时间 + 系统时间）的总和（以秒为单位）。不包括睡眠时间。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆函数</strong></p><ul><li><code>time.time()</code>: 获取时间戳，是很多时间操作的基础。</li><li><code>time.localtime()</code>: 将时间戳转为本地时间元组，便于访问时间的各个部分。</li><li><code>time.strftime()</code>: <strong>强烈推荐记忆</strong>，用于将时间元RSA组格式化为任意字符串，非常灵活和常用。</li><li><code>time.strptime()</code>: 用于将特定格式的字符串解析回时间元组。</li><li><code>time.sleep()</code>: 控制程序执行节奏，非常实用。</li><li><code>time.mktime()</code>: 在需要将本地时间元组转换回时间戳时使用。</li></ul></blockquote><h5 id="struct-time-对象详解"><a href="#struct-time-对象详解" class="headerlink" title="struct_time 对象详解"></a><code>struct_time</code> 对象详解</h5><p><code>time.localtime()</code> 和 <code>time.gmtime()</code> 函数返回的是 <code>struct_time</code> 对象，它是一个包含九个整数的元组（实际上是一个具有命名属性的元组，因此可以通过索引和属性名访问）。</p><table><thead><tr><th>索引</th><th>属性名</th><th>值范围</th><th>含义</th></tr></thead><tbody><tr><td>0</td><td><code>tm_year</code></td><td>例如, 2025</td><td>年份</td></tr><tr><td>1</td><td><code>tm_mon</code></td><td>1 到 12</td><td>月份</td></tr><tr><td>2</td><td><code>tm_mday</code></td><td>1 到 31</td><td>日期</td></tr><tr><td>3</td><td><code>tm_hour</code></td><td>0 到 23</td><td>小时</td></tr><tr><td>4</td><td><code>tm_min</code></td><td>0 到 59</td><td>分钟</td></tr><tr><td>5</td><td><code>tm_sec</code></td><td>0 到 61 (闰秒)</td><td>秒</td></tr><tr><td>6</td><td><code>tm_wday</code></td><td>0 到 6 (周一为0)</td><td>星期几</td></tr><tr><td>7</td><td><code>tm_yday</code></td><td>1 到 366</td><td>一年中的第几天</td></tr><tr><td>8</td><td><code>tm_isdst</code></td><td>0, 1, 或 -1</td><td>是否为夏令时</td></tr></tbody></table><h5 id="strftime-和-strptime-常用格式化符号"><a href="#strftime-和-strptime-常用格式化符号" class="headerlink" title="strftime 和 strptime 常用格式化符号"></a><code>strftime</code> 和 <code>strptime</code> 常用格式化符号</h5><p><code>strftime</code> 用于将时间元组格式化为字符串，而 <code>strptime</code> 则相反，用于将字符串解析为时间元组。它们使用相同的格式化代码。</p><table><thead><tr><th>格式符</th><th>含义</th><th>示例 (基于 2025-05-12 14:30:45 周一)</th></tr></thead><tbody><tr><td><code>%Y</code></td><td>四位数的年份</td><td><code>2025</code></td></tr><tr><td><code>%y</code></td><td>两位数的年份 (00-99)</td><td><code>25</code></td></tr><tr><td><code>%m</code></td><td>两位数的月份 (01-12)</td><td><code>05</code></td></tr><tr><td><code>%d</code></td><td>两位数的日期 (01-31)</td><td><code>12</code></td></tr><tr><td><code>%H</code></td><td>24小时制的小时 (00-23)</td><td><code>14</code></td></tr><tr><td><code>%I</code></td><td>12小时制的小时 (01-12)</td><td><code>02</code></td></tr><tr><td><code>%M</code></td><td>两位数的分钟 (00-59)</td><td><code>30</code></td></tr><tr><td><code>%S</code></td><td>两位数的秒数 (00-61)</td><td><code>45</code></td></tr><tr><td><code>%A</code></td><td>完整的星期几名称 (本地化)</td><td><code>Monday</code> (英文环境)</td></tr><tr><td><code>%a</code></td><td>简写的星期几名称 (本地化)</td><td><code>Mon</code> (英文环境)</td></tr><tr><td><code>%B</code></td><td>完整的月份名称 (本地化)</td><td><code>May</code> (英文环境)</td></tr><tr><td><code>%b</code></td><td>简写的月份名称 (本地化)</td><td><code>May</code> (英文环境)</td></tr><tr><td><code>%w</code></td><td>星期几 (0-6，周日为0，周一为1，…周六为6)</td><td><code>1</code> (如果周日是0)</td></tr><tr><td><code>%j</code></td><td>一年中的第几天 (001-366)</td><td><code>132</code></td></tr><tr><td><code>%p</code></td><td>AM/PM (本地化)</td><td><code>PM</code></td></tr><tr><td><code>%c</code></td><td>本地化的日期和时间表示</td><td><code>Mon May 12 14:30:45 2025</code></td></tr><tr><td><code>%x</code></td><td>本地化的日期表示</td><td><code>05/12/25</code> (美式)</td></tr><tr><td><code>%X</code></td><td>本地化的时间表示</td><td><code>14:30:45</code></td></tr><tr><td><code>%%</code></td><td>一个字面的 ‘%’ 字符</td><td><code>%</code></td></tr></tbody></table><blockquote><p><strong>注意</strong>： <code>%w</code> 的行为（周日是0还是周一是0）可能因平台而异。<code>struct_time</code> 中的 <code>tm_wday</code> 始终是周一为0。</p></blockquote><h5 id="time-模块代码示例"><a href="#time-模块代码示例" class="headerlink" title="time 模块代码示例"></a><code>time</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">## 1. 获取当前时间戳 (自纪元以来的秒数)</span></span><br><span class="line">current_timestamp = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"当前时间戳: <span class="subst">{current_timestamp}</span>"</span>) <span class="comment"># 例如: 1715480315.123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2. 将时间戳转换为本地时间的 struct_time 对象</span></span><br><span class="line">local_time_struct = time.localtime(current_timestamp)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"本地时间元组 (struct_time): <span class="subst">{local_time_struct}</span>"</span>)</span><br><span class="line"><span class="comment">## 访问 struct_time 的属性</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  年份 (tm_year): <span class="subst">{local_time_struct.tm_year}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  月份 (tm_mon): <span class="subst">{local_time_struct.tm_mon}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  日期 (tm_mday): <span class="subst">{local_time_struct.tm_mday}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  小时 (tm_hour): <span class="subst">{local_time_struct.tm_hour}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  分钟 (tm_min): <span class="subst">{local_time_struct.tm_min}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  秒数 (tm_sec): <span class="subst">{local_time_struct.tm_sec}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  星期几 (tm_wday, 周一=0): <span class="subst">{local_time_struct.tm_wday}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  一年中的第几天 (tm_yday): <span class="subst">{local_time_struct.tm_yday}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  夏令时 (tm_isdst): <span class="subst">{local_time_struct.tm_isdst}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3. 将时间戳转换为 UTC 时间的 struct_time 对象</span></span><br><span class="line">utc_time_struct = time.gmtime(current_timestamp)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"UTC时间元组 (struct_time): <span class="subst">{utc_time_struct}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  UTC 年份: <span class="subst">{utc_time_struct.tm_year}</span>, UTC 小时: <span class="subst">{utc_time_struct.tm_hour}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 4. 将本地时间的 struct_time 对象转换回时间戳</span></span><br><span class="line">timestamp_from_local_struct = time.mktime(local_time_struct)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"从本地时间元组转换回的时间戳: <span class="subst">{timestamp_from_local_struct}</span>"</span>) <span class="comment"># 应与 current_timestamp 非常接近</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 5. 使用 asctime() 获取可读字符串 (不推荐在新代码中使用)</span></span><br><span class="line">readable_time_asctime = time.asctime(local_time_struct) <span class="comment"># 等同于 time.asctime()</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"asctime() 格式的时间: <span class="subst">{readable_time_asctime}</span>"</span>) <span class="comment"># 例如: 'Mon May 12 11:18:35 2025'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 6. 使用 strftime() 将 struct_time 格式化为自定义字符串 (强烈推荐)</span></span><br><span class="line">formatted_time_custom = time.strftime(<span class="string">"%Y-%m-%d %H:%M:%S %A"</span>, local_time_struct)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"strftime() 自定义格式化时间: <span class="subst">{formatted_time_custom}</span>"</span>) <span class="comment"># 例如: '2025-05-12 11:18:35 Monday'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 7. 使用 strptime() 将字符串解析为 struct_time 对象</span></span><br><span class="line">time_string = <span class="string">"2024-07-20 10:30:00"</span></span><br><span class="line">format_string = <span class="string">"%Y-%m-%d %H:%M:%S"</span></span><br><span class="line">parsed_time_struct = time.strptime(time_string, format_string)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"strptime() 解析 '<span class="subst">{time_string}</span>' 结果: <span class="subst">{parsed_time_struct}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  解析得到的年份: <span class="subst">{parsed_time_struct.tm_year}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 8. 程序暂停</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"程序开始执行..."</span>)</span><br><span class="line">time.sleep(<span class="number">1.5</span>) <span class="comment"># 暂停1.5秒</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"程序暂停1.5秒后继续执行。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 9. 性能计数器 (用于测量小段代码执行时间)</span></span><br><span class="line">start_perf = time.perf_counter()</span><br><span class="line"><span class="comment">## 执行一些操作</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">end_perf = time.perf_counter()</span><br><span class="line">duration_perf = end_perf - start_perf</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"高性能计数器测量的操作耗时: <span class="subst">{duration_perf:<span class="number">.6</span>f}</span> 秒"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 10. 进程CPU时间</span></span><br><span class="line">start_process = time.process_time()</span><br><span class="line"><span class="comment">## 执行一些CPU密集型操作</span></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">    total += i</span><br><span class="line">end_process = time.process_time()</span><br><span class="line">duration_process = end_process - start_process</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"CPU密集型操作的进程耗时: <span class="subst">{duration_process:<span class="number">.6</span>f}</span> 秒"</span>)</span><br></pre></td></tr></tbody></table></figure><h5 id="time-模块开箱即用函数-场景"><a href="#time-模块开箱即用函数-场景" class="headerlink" title="time 模块开箱即用函数/场景"></a><code>time</code> 模块开箱即用函数/场景</h5><h6 id="a-获取特定格式的当前时间字符串"><a href="#a-获取特定格式的当前时间字符串" class="headerlink" title="a. 获取特定格式的当前时间字符串"></a>a. 获取特定格式的当前时间字符串</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_time_str</span>(<span class="params">format_str=<span class="string">"%Y-%m-%d %H:%M:%S"</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取当前本地时间，并按指定格式返回字符串。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    format_str (str): strftime 使用的时间格式化字符串。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    str: 格式化后的当前时间字符串。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> time.strftime(format_str, time.localtime())</span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例使用</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"当前日期时间: <span class="subst">{get_current_time_str()}</span>"</span>) <span class="comment"># 输出: 2025-05-12 11:18:35 (示例)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"当前日期 (YYYYMMDD): <span class="subst">{get_current_time_str(<span class="string">'%Y%m%d'</span>)}</span>"</span>) <span class="comment"># 输出: 20250512 (示例)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"当前时间 (HH-MM-SS): <span class="subst">{get_current_time_str(<span class="string">'%H-%M-%S'</span>)}</span>"</span>) <span class="comment"># 输出: 11-18-35 (示例)</span></span><br></pre></td></tr></tbody></table></figure><h6 id="b-测量函数执行时间"><a href="#b-测量函数执行时间" class="headerlink" title="b. 测量函数执行时间"></a>b. 测量函数执行时间</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">measure_execution_time</span>(<span class="params">func, *args, **kwargs</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    测量并打印指定函数执行所需的时间。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    func (callable): 需要测量执行时间的函数。</span></span><br><span class="line"><span class="string">    *args: 传递给 func 的位置参数。</span></span><br><span class="line"><span class="string">    **kwargs: 传递给 func 的关键字参数。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    any: func 的返回值。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    start_time = time.perf_counter() <span class="comment"># 使用 perf_counter 更精确</span></span><br><span class="line">    result = func(*args, **kwargs)</span><br><span class="line">    end_time = time.perf_counter()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"函数 '<span class="subst">{func.__name__}</span>' 执行耗时: <span class="subst">{end_time - start_time:<span class="number">.6</span>f}</span> 秒"</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example_function</span>(<span class="params">n</span>):</span><br><span class="line">    time.sleep(n) <span class="comment"># 模拟耗时操作</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"操作完成，参数为 <span class="subst">{n}</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 测量示例函数的执行时间</span></span><br><span class="line">measure_execution_time(example_function, <span class="number">0.5</span>)</span><br><span class="line">measure_execution_time(<span class="built_in">sum</span>, <span class="built_in">range</span>(<span class="number">1000000</span>))</span><br></pre></td></tr></tbody></table></figure><h6 id="c-时间戳与格式化字符串之间的转换"><a href="#c-时间戳与格式化字符串之间的转换" class="headerlink" title="c. 时间戳与格式化字符串之间的转换"></a>c. 时间戳与格式化字符串之间的转换</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timestamp_to_str</span>(<span class="params">ts, format_str=<span class="string">"%Y-%m-%d %H:%M:%S"</span></span>):</span><br><span class="line">    <span class="string">"""将时间戳转换为指定格式的本地时间字符串。"""</span></span><br><span class="line">    <span class="keyword">return</span> time.strftime(format_str, time.localtime(ts))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str_to_timestamp</span>(<span class="params">time_str, format_str=<span class="string">"%Y-%m-%d %H:%M:%S"</span></span>):</span><br><span class="line">    <span class="string">"""将指定格式的时间字符串转换为本地时间戳。"""</span></span><br><span class="line">    struct_t = time.strptime(time_str, format_str)</span><br><span class="line">    <span class="keyword">return</span> time.mktime(struct_t)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例</span></span><br><span class="line">ts_now = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"当前时间戳: <span class="subst">{ts_now}</span>"</span>)</span><br><span class="line"></span><br><span class="line">formatted_str = timestamp_to_str(ts_now)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"时间戳 -&gt; 字符串: <span class="subst">{formatted_str}</span>"</span>)</span><br><span class="line"></span><br><span class="line">back_to_ts = str_to_timestamp(formatted_str)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"字符串 -&gt; 时间戳: <span class="subst">{back_to_ts}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h4 id="datetime-模块"><a href="#datetime-模块" class="headerlink" title="datetime 模块"></a><code>datetime</code> 模块</h4><p><code>datetime</code> 模块是 Python 中处理日期和时间的更高级、更面向对象的接口。它定义了几种类，用于处理日期、时间、日期时间、时间差以及时区信息。相比 <code>time</code> 模块，<code>datetime</code> 模块的功能更强大，使用更直观，尤其适合进行复杂的日期时间运算和时区处理。</p><h5 id="datetime-模块核心类-方法"><a href="#datetime-模块核心类-方法" class="headerlink" title="datetime 模块核心类/方法"></a><code>datetime</code> 模块核心类/方法</h5><table><thead><tr><th>类/方法</th><th>描述</th></tr></thead><tbody><tr><td><code>datetime.date(year, month, day)</code></td><td>表示一个理想化的日期对象，具有 <code>year</code>, <code>month</code>, <code>day</code> 属性。</td></tr><tr><td><code>date.today()</code></td><td>(类方法) 返回当前的本地日期。</td></tr><tr><td><code>date.fromtimestamp(timestamp)</code></td><td>(类方法) 根据给定的时间戳返回本地日期。</td></tr><tr><td><code>datetime.time(hour, minute, second, ...)</code></td><td>表示一个理想化的时间对象，具有 <code>hour</code>, <code>minute</code>, <code>second</code>, <code>microsecond</code>, <code>tzinfo</code> 属性。</td></tr><tr><td><code>datetime.datetime(year, month, day, ...)</code></td><td>表示日期和时间的组合，包含 <code>date</code> 和 <code>time</code> 对象的所有信息。</td></tr><tr><td><code>datetime.now([tz])</code></td><td>(类方法) 返回当前的本地日期和时间。如果提供了可选参数 <code>tz</code> (一个 <code>tzinfo</code> 对象)，则返回对应时区的日期时间。</td></tr><tr><td><code>datetime.utcnow()</code></td><td>(类方法) 返回当前的UTC日期和时间，但返回的是一个 naive datetime 对象 (无时区信息)。<strong>不推荐使用，请用 <code>datetime.now(timezone.utc)</code> 替代。</strong></td></tr><tr><td><code>datetime.fromtimestamp(timestamp, [tz])</code></td><td>(类方法) 根据时间戳返回本地日期和时间。如果提供了 <code>tz</code>，则返回对应时区的日期时间。</td></tr><tr><td><code>datetime.strptime(date_string, format)</code></td><td>(类方法) 将符合 <code>format</code> 格式的日期字符串 <code>date_string</code> 解析为 <code>datetime</code> 对象。</td></tr><tr><td><code>obj.strftime(format)</code></td><td>(实例方法) 将 <code>date</code>, <code>time</code> 或 <code>datetime</code> 对象 <code>obj</code> 格式化为字符串。</td></tr><tr><td><code>datetime.timedelta(days, seconds, ...)</code></td><td>表示两个日期或时间之间的时间差，可以用于日期时间的加减运算。</td></tr><tr><td><code>datetime.timezone(offset, [name])</code></td><td><code>tzinfo</code> 的一个具体子类，表示一个固定的UTC偏移量。例如 <code>timezone.utc</code> 代表UTC时区。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆类与方法</strong></p><ul><li><code>datetime.datetime</code>: <strong>最核心的类</strong>，用于表示精确的日期和时间。</li><li><code>datetime.date</code>: 当只需要日期部分时使用。</li><li><code>datetime.time</code>: 当只需要时间部分时使用。</li><li><code>datetime.timedelta</code>: <strong>非常重要</strong>，用于进行日期时间的加减运算。</li><li><code>datetime.now()</code>: 获取当前日期时间。</li><li><code>datetime.strptime()</code>: <strong>常用</strong>，将字符串解析为 <code>datetime</code> 对象。</li><li><code>obj.strftime()</code>: <strong>常用</strong>，将 <code>datetime</code> 对象格式化为字符串。</li><li><code>datetime.timezone.utc</code>: 用于创建UTC时区感知的 <code>datetime</code> 对象。</li></ul></blockquote><h5 id="datetime-模块代码示例"><a href="#datetime-模块代码示例" class="headerlink" title="datetime 模块代码示例"></a><code>datetime</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======== 日期时间操作示例 ========</span></span><br><span class="line">print_header(<span class="string">"1. 获取当前日期时间"</span>)</span><br><span class="line">dt_now = datetime.now()  <span class="comment"># 本地时区的当前日期时间</span></span><br><span class="line">print_info(<span class="string">f"当前日期时间 (datetime.now()): <span class="subst">{dt_now}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  年份: <span class="subst">{dt_now.year}</span>, 月份: <span class="subst">{dt_now.month}</span>, 日期: <span class="subst">{dt_now.day}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  小时: <span class="subst">{dt_now.hour}</span>, 分钟: <span class="subst">{dt_now.minute}</span>, 秒数: <span class="subst">{dt_now.second}</span>, 微秒: <span class="subst">{dt_now.microsecond}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"2. 获取当前UTC日期时间"</span>)</span><br><span class="line">utc_now = datetime.now(timezone.utc)  <span class="comment"># 获取UTC时区的当前日期时间</span></span><br><span class="line">print_info(<span class="string">f"当前UTC日期时间 (datetime.now(timezone.utc)): <span class="subst">{utc_now}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"3. 创建特定的日期时间对象"</span>)</span><br><span class="line">special_dt = datetime(<span class="number">2025</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># 2025年1月1日12:00:00</span></span><br><span class="line">print_info(<span class="string">f"特定日期时间对象: <span class="subst">{special_dt}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"4. 创建 date 对象 和 time 对象"</span>)</span><br><span class="line">specific_date = date(<span class="number">2025</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">print_info(<span class="string">f"特定日期 (date): <span class="subst">{specific_date}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  年份: <span class="subst">{specific_date.year}</span>, 月份: <span class="subst">{specific_date.month}</span>, 日期: <span class="subst">{specific_date.day}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  星期几 (weekday(), 周一=0): <span class="subst">{specific_date.weekday()}</span>"</span>)  <span class="comment"># 周日是6</span></span><br><span class="line"></span><br><span class="line">specific_time = time(<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">print_info(<span class="string">f"特定时间 (time): <span class="subst">{specific_time}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  小时: <span class="subst">{specific_time.hour}</span>, 分钟: <span class="subst">{specific_time.minute}</span>, 秒数: <span class="subst">{specific_time.second}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"5. 日期时间格式化 (strftime)"</span>)</span><br><span class="line">formatted_dt = dt_now.strftime(<span class="string">"%Y年%m月%d日 %H时%M分%S秒 星期%A"</span>)</span><br><span class="line">print_info(<span class="string">f"格式化后的日期时间: <span class="subst">{formatted_dt}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"6. 日期时间解析 (strptime)"</span>)</span><br><span class="line">parsed_dt = datetime.strptime(<span class="string">"2025-10-20 12:00:00"</span>, <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">print_info(<span class="string">f"解析后的日期时间: <span class="subst">{parsed_dt}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"7. 时间差 (timedelta)"</span>)</span><br><span class="line">delta1 = timedelta(days=<span class="number">5</span>, hours=<span class="number">3</span>, minutes=<span class="number">30</span>)</span><br><span class="line">print_info(<span class="string">f"时间差: <span class="subst">{delta1}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"8. 日期时间运算"</span>)</span><br><span class="line">future_dt = dt_now + delta1  <span class="comment"># 当前时间加五天 3小时 30分钟</span></span><br><span class="line">print_info(<span class="string">f"未来日期时间: <span class="subst">{future_dt}</span>"</span>)</span><br><span class="line"></span><br><span class="line">past_dt = dt_now - timedelta(weeks=<span class="number">2</span>)</span><br><span class="line">print_info(<span class="string">f"当前时间减去2周后: <span class="subst">{past_dt}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算两个日期时间的差</span></span><br><span class="line">specific_dt = datetime(<span class="number">2025</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># 2025年10月20日12:00:00</span></span><br><span class="line">diff_dt = specific_dt - dt_now</span><br><span class="line">print_info(<span class="string">f"两个datetime对象之间的差: <span class="subst">{diff_dt}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  相差天数: <span class="subst">{diff_dt.days}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  相差总秒数: <span class="subst">{diff_dt.total_seconds()}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"9. datetime 与时间戳转换"</span>)</span><br><span class="line">current_timestamp = dt_now.timestamp()  <span class="comment"># 将本地datetime对象转换为时间戳</span></span><br><span class="line">print_info(<span class="string">f"当前datetime对象对应的时间戳: <span class="subst">{current_timestamp}</span>"</span>)</span><br><span class="line"></span><br><span class="line">dt_from_ts_local = datetime.fromtimestamp(current_timestamp)  <span class="comment"># 从时间戳创建本地datetime对象</span></span><br><span class="line">print_info(<span class="string">f"从时间戳转换回的本地datetime: <span class="subst">{dt_from_ts_local}</span>"</span>)</span><br><span class="line"></span><br><span class="line">dt_from_ts_utc = datetime.fromtimestamp(current_timestamp, tz=timezone.utc)  <span class="comment"># 从时间戳创建UTC datetime对象</span></span><br><span class="line">print_info(<span class="string">f"从时间戳转换回的UTC datetime: <span class="subst">{dt_from_ts_utc}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"10. 替换日期时间的某些部分"</span>)</span><br><span class="line">replaced_dt = dt_now.replace(year=<span class="number">2030</span>, microsecond=<span class="number">0</span>)</span><br><span class="line">print_info(<span class="string">f"替换年份和微秒后的datetime: <span class="subst">{replaced_dt}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"11. 时区处理"</span>)</span><br><span class="line"><span class="comment"># 创建一个表示东八区的 timezone 对象 (北京时间)</span></span><br><span class="line">beijing_tz = timezone(timedelta(hours=<span class="number">8</span>), name=<span class="string">'Asia/Shanghai'</span>)</span><br><span class="line">beijing_now = datetime.now(beijing_tz)</span><br><span class="line">print_info(<span class="string">f"当前北京时间: <span class="subst">{beijing_now}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"北京时间的时区信息: <span class="subst">{beijing_now.tzinfo}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个naive datetime对象转换为aware datetime对象</span></span><br><span class="line">naive_dt = datetime(<span class="number">2025</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">aware_dt_beijing = naive_dt.replace(tzinfo=beijing_tz)  <span class="comment"># 假设naive_dt是北京时间</span></span><br><span class="line">print_info(<span class="string">f"Naive datetime 赋予北京时区: <span class="subst">{aware_dt_beijing}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个aware datetime对象转换到另一个时区</span></span><br><span class="line">utc_dt_example = aware_dt_beijing.astimezone(timezone.utc)</span><br><span class="line">print_info(<span class="string">f"北京时间转换为UTC时间: <span class="subst">{utc_dt_example}</span>"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h5 id="datetime-模块开箱即用函数-场景"><a href="#datetime-模块开箱即用函数-场景" class="headerlink" title="datetime 模块开箱即用函数/场景"></a><code>datetime</code> 模块开箱即用函数/场景</h5><h6 id="a-获取不同精度的当前时间"><a href="#a-获取不同精度的当前时间" class="headerlink" title="a. 获取不同精度的当前时间"></a>a. 获取不同精度的当前时间</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timezone</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_formatted_current_datetime</span>(<span class="params">fmt=<span class="string">"%Y-%m-%d %H:%M:%S.%f"</span>, use_utc=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取格式化的当前日期时间字符串。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    fmt (str): strftime 使用的时间格式化字符串。</span></span><br><span class="line"><span class="string">               '%f' 可以用于表示微秒。</span></span><br><span class="line"><span class="string">    use_utc (bool): 如果为True，则返回UTC时间，否则返回本地时间。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    str: 格式化后的当前日期时间字符串。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> use_utc:</span><br><span class="line">        now_dt = datetime.now(timezone.utc)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        now_dt = datetime.now()</span><br><span class="line">    <span class="keyword">return</span> now_dt.strftime(fmt)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"本地当前精确时间: <span class="subst">{get_formatted_current_datetime()}</span>"</span>)</span><br><span class="line"><span class="comment">## 输出示例: 2025-05-12 11:18:35.123456</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"UTC当前日期 (YYYY-MM-DD): <span class="subst">{get_formatted_current_datetime(use_utc=<span class="literal">True</span>)}</span>"</span>)</span><br><span class="line"><span class="comment">## 输出示例: 2025-05-12 (假设当前UTC日期)</span></span><br></pre></td></tr></tbody></table></figure><h6 id="b-计算未来或过去的日期"><a href="#b-计算未来或过去的日期" class="headerlink" title="b. 计算未来或过去的日期"></a>b. 计算未来或过去的日期</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_future_past_date</span>(<span class="params">days_offset=<span class="number">0</span>, weeks_offset=<span class="number">0</span>, hours_offset=<span class="number">0</span>, base_date=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    根据偏移量计算未来或过去的日期时间。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    days_offset (int): 天数偏移，正数表示未来，负数表示过去。</span></span><br><span class="line"><span class="string">    weeks_offset (int): 周数偏移。</span></span><br><span class="line"><span class="string">    hours_offset (int): 小时数偏移。</span></span><br><span class="line"><span class="string">    base_date (datetime, optional): 基准日期时间，默认为当前本地时间。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    datetime: 计算后的日期时间对象。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> base_date <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        base_date = datetime.now()</span><br><span class="line">    </span><br><span class="line">    offset = timedelta(days=days_offset, weeks=weeks_offset, hours=hours_offset)</span><br><span class="line">    <span class="keyword">return</span> base_date + offset</span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例</span></span><br><span class="line">one_week_later = calculate_future_past_date(weeks_offset=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"一周后的日期时间: <span class="subst">{one_week_later.strftime(<span class="string">'%Y-%m-%d %H:%M'</span>)}</span>"</span>)</span><br><span class="line"></span><br><span class="line">three_days_ago_noon = calculate_future_past_date(days_offset=-<span class="number">3</span>, base_date=datetime(<span class="number">2025</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"三天前的中午12点: <span class="subst">{three_days_ago_noon.strftime(<span class="string">'%Y-%m-%d %H:%M'</span>)}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h6 id="c-安全地解析日期字符串"><a href="#c-安全地解析日期字符串" class="headerlink" title="c. 安全地解析日期字符串"></a>c. 安全地解析日期字符串</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_date_string_safely</span>(<span class="params">date_str, date_format=<span class="string">"%Y-%m-%d"</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    尝试按指定格式解析日期字符串，如果失败则返回None。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    date_str (str): 要解析的日期字符串。</span></span><br><span class="line"><span class="string">    date_format (str): datetime.strptime 使用的日期格式。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    datetime.date or None: 解析成功则返回date对象，否则返回None。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        dt_object = datetime.strptime(date_str, date_format)</span><br><span class="line">        <span class="keyword">return</span> dt_object.date() <span class="comment"># 通常我们只关心日期部分</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"错误: 字符串 '<span class="subst">{date_str}</span>' 无法匹配格式 '<span class="subst">{date_format}</span>'"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例</span></span><br><span class="line">valid_date_str = <span class="string">"2024-12-25"</span></span><br><span class="line">invalid_date_str = <span class="string">"25/12/2024"</span></span><br><span class="line"></span><br><span class="line">parsed_date1 = parse_date_string_safely(valid_date_str)</span><br><span class="line"><span class="keyword">if</span> parsed_date1:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"成功解析 '<span class="subst">{valid_date_str}</span>': <span class="subst">{parsed_date1}</span>"</span>)</span><br><span class="line"></span><br><span class="line">parsed_date2 = parse_date_string_safely(invalid_date_str) <span class="comment"># 格式不匹配</span></span><br><span class="line"><span class="keyword">if</span> parsed_date2 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"解析 '<span class="subst">{invalid_date_str}</span>' 失败。"</span>)</span><br><span class="line"></span><br><span class="line">parsed_date3 = parse_date_string_safely(<span class="string">"31.01.2023"</span>, date_format=<span class="string">"%d.%m.%Y"</span>)</span><br><span class="line"><span class="keyword">if</span> parsed_date3:</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">f"成功解析 '31.01.2023': <span class="subst">{parsed_date3}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h6 id="d-计算两个日期之间的天数-小时数-分钟数"><a href="#d-计算两个日期之间的天数-小时数-分钟数" class="headerlink" title="d. 计算两个日期之间的天数/小时数/分钟数"></a>d. 计算两个日期之间的天数/小时数/分钟数</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_difference_between_datetimes</span>(<span class="params">dt1_str, dt2_str, fmt=<span class="string">"%Y-%m-%d %H:%M:%S"</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    计算两个日期时间字符串之间的差异。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    dt1_str (str): 第一个日期时间字符串。</span></span><br><span class="line"><span class="string">    dt2_str (str): 第二个日期时间字符串。</span></span><br><span class="line"><span class="string">    fmt (str): 日期时间字符串的格式。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    dict or None: 包含天数、总小时数、总分钟数、总秒数的字典，如果解析失败返回None。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        dt1 = datetime.strptime(dt1_str, fmt)</span><br><span class="line">        dt2 = datetime.strptime(dt2_str, fmt)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"日期时间字符串格式错误或无效。"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 确保 dt2 总是大于 dt1，如果不是，则交换它们或返回负值</span></span><br><span class="line">    <span class="keyword">if</span> dt1 &gt; dt2:</span><br><span class="line">        delta = dt1 - dt2</span><br><span class="line">        sign = -<span class="number">1</span> <span class="comment"># 表示 dt1 在 dt2 之后</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        delta = dt2 - dt1</span><br><span class="line">        sign = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="string">"days"</span>: sign * delta.days,</span><br><span class="line">        <span class="string">"total_hours"</span>: sign * (delta.total_seconds() / <span class="number">3600</span>),</span><br><span class="line">        <span class="string">"total_minutes"</span>: sign * (delta.total_seconds() / <span class="number">60</span>),</span><br><span class="line">        <span class="string">"total_seconds"</span>: sign * delta.total_seconds(),</span><br><span class="line">        <span class="string">"timedelta_object"</span>: delta <span class="keyword">if</span> sign == <span class="number">1</span> <span class="keyword">else</span> -delta</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例</span></span><br><span class="line">start_time = <span class="string">"2025-05-10 09:00:00"</span></span><br><span class="line">end_time = <span class="string">"2025-05-12 11:30:45"</span></span><br><span class="line"></span><br><span class="line">diff = get_difference_between_datetimes(start_time, end_time)</span><br><span class="line"><span class="keyword">if</span> diff:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"从 '<span class="subst">{start_time}</span>' 到 '<span class="subst">{end_time}</span>':"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  相差天数: <span class="subst">{diff[<span class="string">'days'</span>]}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  总小时数: <span class="subst">{diff[<span class="string">'total_hours'</span>]:<span class="number">.2</span>f}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  总分钟数: <span class="subst">{diff[<span class="string">'total_minutes'</span>]:<span class="number">.2</span>f}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  总秒数: <span class="subst">{diff[<span class="string">'total_seconds'</span>]:<span class="number">.0</span>f}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  Timedelta对象: <span class="subst">{diff[<span class="string">'timedelta_object'</span>]}</span>"</span>)</span><br><span class="line"></span><br><span class="line">diff_reverse = get_difference_between_datetimes(end_time, start_time)</span><br><span class="line"><span class="keyword">if</span> diff_reverse:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n从 '<span class="subst">{end_time}</span>' 到 '<span class="subst">{start_time}</span>':"</span>) <span class="comment"># 注意这里是反向的</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  相差天数: <span class="subst">{diff_reverse[<span class="string">'days'</span>]}</span>"</span>) <span class="comment"># 将会是负数</span></span><br></pre></td></tr></tbody></table></figure><h4 id="time-与-datetime-模块的选择与注意事项"><a href="#time-与-datetime-模块的选择与注意事项" class="headerlink" title="time 与 datetime 模块的选择与注意事项"></a><code>time</code> 与 <code>datetime</code> 模块的选择与注意事项</h4><ul><li><strong>精度</strong>：<code>time.time()</code> 返回的时间戳通常具有微秒级精度（取决于操作系统）。<code>datetime</code> 对象也支持微秒。</li><li><strong>易用性</strong>：对于复杂的日期时间运算、时区处理以及更清晰的API，<code>datetime</code> 模块通常是更好的选择。</li><li><strong>底层访问</strong>：如果你需要与C库或其他需要时间戳（秒数）的系统交互，<code>time.time()</code> 很直接。</li><li><strong>时区处理</strong>：<ul><li><code>time</code> 模块对时区的支持有限，<code>time.localtime()</code> 依赖于系统本地时区，<code>time.gmtime()</code> 提供UTC时间。</li><li><code>datetime</code> 模块通过 <code>tzinfo</code> 抽象基类及其子类（如 <code>timezone</code>）提供了更健壮的时区处理能力。处理跨时区应用时，强烈建议使用 <code>datetime</code> 并明确指定时区（通常将所有时间转换为UTC存储和处理，仅在显示时转换为本地时区）。</li></ul></li><li><strong>字符串转换</strong>：<code>strftime</code> 和 <code>strptime</code> 是这两个模块共有的重要功能，但它们作用的对象类型不同 (<code>struct_time</code> vs <code>datetime</code> 对象)。<code>datetime</code> 对象的 <code>strftime</code> 方法通常更易用。</li><li><strong>不可变性</strong>：<code>date</code>, <code>time</code>, <code>datetime</code> 对象都是不可变的，这使得它们在用作字典键或在多线程环境中更安全。</li><li><strong>ISO 8601 格式</strong>：在进行数据交换时，推荐使用 ISO 8601 标准格式（例如 <code>YYYY-MM-DDTHH:MM:SS.ffffff</code> 或 <code>YYYY-MM-DDTHH:MM:SSZ</code> 表示UTC）。<code>datetime</code> 对象有 <code>isoformat()</code> 方法可以直接生成此格式。</li></ul><p>在现代 Python 开发中，除非有特定需求要使用 <code>time</code> 模块的底层功能或性能计数器，否则**<code>datetime</code> 模块通常是进行日期和时间操作的首选**</p><h3 id="2、随机数模块详解"><a href="#2、随机数模块详解" class="headerlink" title="2、随机数模块详解"></a>2、随机数模块详解</h3><p>在编程中，随机数扮演着重要的角色，可用于模拟、游戏、数据抽样、生成测试数据等多种场景。Python 的标准库通过 <code>random</code> 模块提供了生成伪随机数的工具。</p><h4 id="random-模块介绍"><a href="#random-模块介绍" class="headerlink" title="random 模块介绍"></a><code>random</code> 模块介绍</h4><p><code>random</code> 模块实现了用于各种分布的伪随机数生成器。这些是<strong>伪随机数 (Pseudo-random numbers)</strong>，意味着它们是通过一个确定性的算法生成的，但其序列在统计上看起来是随机的。如果不显式设置“种子”（seed），序列的起点通常是不可预测的。</p><h4 id="random-模块常用函数"><a href="#random-模块常用函数" class="headerlink" title="random 模块常用函数"></a><code>random</code> 模块常用函数</h4><p>下表列出了 <code>random</code> 模块中一些核心且常用的函数：</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>random.seed(a=None, version=2)</code></td><td>初始化随机数生成器，让随机序列可以被复现。</td></tr><tr><td><code>random.getstate()</code></td><td>获取随机数生成器当前的内部状态。</td></tr><tr><td><code>random.setstate(state)</code></td><td>恢复随机数生成器到之前保存的状态。</td></tr><tr><td><code>random.random()</code></td><td>返回一个 $0.0$ 到 $1.0$ 之间 (不包括 $1.0$) 的随机小数。</td></tr><tr><td><code>random.uniform(a, b)</code></td><td>返回一个在 $a$ 和 $b$ 之间的随机小数。</td></tr><tr><td><code>random.randint(a, b)</code></td><td>返回一个在 $a$ 和 $b$ 之间 (包括 $a$ 和 $b$) 的随机整数。</td></tr><tr><td><code>random.randrange(start, stop[, step])</code></td><td>从一个按步长生成的整数序列中随机选一个数 (不包括 <code>stop</code>)。</td></tr><tr><td><code>random.choice(seq)</code></td><td>从一个列表、元组或字符串等序列中随机选择一个元素。</td></tr><tr><td><code>random.choices(population, ..., k=1)</code></td><td>从总体中进行 <code>k</code> 次可重复的随机抽样，可以设置权重。</td></tr><tr><td><code>random.sample(population, k)</code></td><td>从总体中随机选择 <code>k</code> 个不重复的元素。</td></tr><tr><td><code>random.shuffle(x[, random])</code></td><td>将一个列表中的元素顺序随机打乱 (直接修改原列表)。</td></tr><tr><td><code>random.gauss(mu, sigma)</code></td><td>生成一个符合正态分布 (高斯分布) 的随机数，<code>mu</code>是平均值，<code>sigma</code>是标准差。</td></tr><tr><td><code>random.expovariate(lambd)</code></td><td>生成一个符合指数分布的随机数。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆函数</strong></p><ul><li><code>random.seed()</code>: 需要结果可复现时使用。</li><li><code>random.random()</code>: 生成基础随机小数。</li><li><code>random.randint(a, b)</code>: <strong>非常常用</strong>，获取范围内随机整数。</li><li><code>random.choice(seq)</code>: <strong>非常常用</strong>，从序列中随机挑一个。</li><li><code>random.sample(population, k)</code>: 选取多个不重复项。</li><li><code>random.shuffle(x)</code>: 打乱列表顺序。</li><li><code>random.choices(population, weights=..., k=...)</code>: 带权重或可重复抽样时使用。</li></ul></blockquote><h4 id="random-模块代码示例"><a href="#random-模块代码示例" class="headerlink" title="random 模块代码示例"></a><code>random</code> 模块代码示例</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line"><span class="comment"># 1.设置随机数种子以获得可复现的结果</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">print_header(<span class="string">"随机数种子设置"</span>)</span><br><span class="line"><span class="comment">#random.seed(101)  # 使用特定的种子 -&gt; 为了下面的测试，这里需要注释掉</span></span><br><span class="line">print_info(<span class="string">f"使用种子101生成的第一个随机数: <span class="subst">{random.random()}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"使用种子101生成的第二个随机数: <span class="subst">{random.random()}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#random.seed(101)  # 重置种子 -&gt; 同上，这里需要注释掉</span></span><br><span class="line">print_info(<span class="string">f"重置种子101后生成的第一个随机数: <span class="subst">{random.random()}</span>"</span>)  <span class="comment"># 输出会和上面第一个相同</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line"><span class="comment"># 2.生成 [0.0 1.0] 之间的随机浮点数</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">print_header(<span class="string">"生成随机浮点数"</span>)</span><br><span class="line">print_info(<span class="string">f"生成的随机浮点数: <span class="subst">{random.random()}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line"><span class="comment"># 3.生成指定范围内的随机浮点数(只有浮点数会变)</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">print_header(<span class="string">"生成指定范围内的随机浮点数"</span>)</span><br><span class="line">rand_float_range = random.uniform(<span class="number">5.5</span>, <span class="number">15.5</span>)</span><br><span class="line">print_info(<span class="string">f"生成的随机浮点数 (5~15.5): <span class="subst">{rand_float_range}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line"><span class="comment"># 4. 生成指定范围内的随机整数</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">print_header(<span class="string">"生成随机范围的随机整数"</span>)</span><br><span class="line">rand_int_range = random.randint(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">print_info(<span class="string">f"生成的随机整数 (10 到 20): <span class="subst">{rand_int_range}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line"><span class="comment"># 5. randrange指定步长的随机整数</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">print_header(<span class="string">"生成指定步长的随机整数"</span>)</span><br><span class="line">rand_int_step = random.randrange(<span class="number">0</span>, <span class="number">100</span>, <span class="number">5</span>)  <span class="comment"># 从0到100中选择一个5的倍数</span></span><br><span class="line">print_info(<span class="string">f"生成的随机整数 (0 到 100, 步长5): <span class="subst">{rand_int_step}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line"><span class="comment"># 6.从序列中随机选择一个元素</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">print_header(<span class="string">"从序列中随机选择一个元素"</span>)</span><br><span class="line">my_colors = [<span class="string">'红'</span>, <span class="string">'橙'</span>, <span class="string">'黄'</span>, <span class="string">'绿'</span>, <span class="string">'蓝'</span>, <span class="string">'紫'</span>]</span><br><span class="line">random_color = random.choice(my_colors)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"颜色列表: <span class="subst">{my_colors}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"随机选择的颜色 (choice): <span class="subst">{random_color}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line"><span class="comment"># 7. 从序列中随机选择k个元素 (可重复，带权重 - choices)</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">print_header(<span class="string">"从序列中随机选择k个元素 (可重复)"</span>)</span><br><span class="line">elements_pool = [<span class="string">'石头'</span>, <span class="string">'剪刀'</span>, <span class="string">'布'</span>]</span><br><span class="line">element_weights = [<span class="number">0.8</span>, <span class="number">0.1</span>, <span class="number">0.1</span>] <span class="comment"># 石头有80%的概率被选中，剪刀和布各有10%的概率</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择1个 (默认k=1)</span></span><br><span class="line">chosen_one_weighted = random.choices(elements_pool, weights=element_weights)</span><br><span class="line">print_info(<span class="string">f"带权重选择1个元素 (choices): <span class="subst">{chosen_one_weighted}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择5个可重复的元素</span></span><br><span class="line">chosen_five_weighted = random.choices(elements_pool, weights=element_weights, k=<span class="number">5</span>)</span><br><span class="line">print_info(<span class="string">f"带权重选择5个可重复元素 (choices): <span class="subst">{chosen_five_weighted}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line"><span class="comment"># 8.随机打乱新序列元素的顺序</span></span><br><span class="line"><span class="comment"># =========================================================</span></span><br><span class="line">print_header(<span class="string">"随机打乱新序列元素的顺序"</span>)</span><br><span class="line">game_players = [<span class="string">'玩家A'</span>, <span class="string">'玩家B'</span>, <span class="string">'玩家C'</span>, <span class="string">'玩家D'</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"原始玩家顺序: <span class="subst">{game_players}</span>"</span>)</span><br><span class="line">random.shuffle(game_players) <span class="comment"># 直接修改 game_players</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"打乱后的玩家顺序 (shuffle): <span class="subst">{game_players}</span>"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="random-模块开箱即用函数-场景"><a href="#random-模块开箱即用函数-场景" class="headerlink" title="random 模块开箱即用函数/场景"></a><code>random</code> 模块开箱即用函数/场景</h4><h5 id="a-生成指定长度的随机字符串（用于非加密场景）"><a href="#a-生成指定长度的随机字符串（用于非加密场景）" class="headerlink" title="a. 生成指定长度的随机字符串（用于非加密场景）"></a>a. 生成指定长度的随机字符串（用于非加密场景）</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_simple_random_string</span>(<span class="params">length=<span class="number">10</span>, use_letters=<span class="literal">True</span>, use_digits=<span class="literal">True</span>, use_punctuation=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    生成一个指定长度的简单随机字符串。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    length (int): 生成字符串的长度。</span></span><br><span class="line"><span class="string">    use_letters (bool): 是否包含大小写字母。</span></span><br><span class="line"><span class="string">    use_digits (bool): 是否包含数字。</span></span><br><span class="line"><span class="string">    use_punctuation (bool): 是否包含标点符号。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    str: 生成的随机字符串。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    char_pool = <span class="string">""</span></span><br><span class="line">    <span class="keyword">if</span> use_letters:</span><br><span class="line">        char_pool += string.ascii_letters</span><br><span class="line">    <span class="keyword">if</span> use_digits:</span><br><span class="line">        char_pool += string.digits</span><br><span class="line">    <span class="keyword">if</span> use_punctuation:</span><br><span class="line">        char_pool += string.punctuation</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> char_pool: <span class="comment"># 如果用户什么都没选，默认只用小写字母</span></span><br><span class="line">        char_pool = string.ascii_lowercase</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(random.choice(char_pool) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line">simple_id = generate_simple_random_string(<span class="number">8</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"生成的8位随机ID (字母数字): <span class="subst">{simple_id}</span>"</span>)</span><br><span class="line"></span><br><span class="line">complex_code = generate_simple_random_string(<span class="number">12</span>, use_punctuation=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"生成的12位复杂随机码: <span class="subst">{complex_code}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>安全提示</strong>：此函数生成的随机字符串不应用于密码、会话令牌等安全敏感的场景。对于这些场景，请务必使用 Python 的 <code>secrets</code> 模块，它能提供密码学强度的随机性。</p></blockquote><h5 id="b-模拟多次掷骰子并统计结果"><a href="#b-模拟多次掷骰子并统计结果" class="headerlink" title="b. 模拟多次掷骰子并统计结果"></a>b. 模拟多次掷骰子并统计结果</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simulate_dice_rolls</span>(<span class="params">num_rolls=<span class="number">100</span>, num_sides=<span class="number">6</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    模拟多次掷骰子并返回每次的结果及统计。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    num_rolls (int): 掷骰子的次数。</span></span><br><span class="line"><span class="string">    num_sides (int): 骰子的面数。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    tuple: (包含所有掷骰结果的列表, 结果计数的Counter对象)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    rolls = [random.randint(<span class="number">1</span>, num_sides) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_rolls)]</span><br><span class="line">    counts = Counter(rolls)</span><br><span class="line">    <span class="keyword">return</span> rolls, counts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line">rolls_100, counts_100 = simulate_dice_rolls(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"\n模拟掷100次6面骰子:"</span>)</span><br><span class="line"><span class="comment"># print(f"  所有结果: {rolls_100}") # 列表可能太长，选择性打印</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  结果统计: <span class="subst">{counts_100}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"  最常出现的点数: <span class="subst">{counts_100.most_common(<span class="number">1</span>)}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h5 id="c-从加权列表中随机抽取奖励"><a href="#c-从加权列表中随机抽取奖励" class="headerlink" title="c. 从加权列表中随机抽取奖励"></a>c. 从加权列表中随机抽取奖励</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weighted_reward</span>(<span class="params">rewards_with_weights</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    根据权重从奖励列表中随机抽取一个奖励。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    rewards_with_weights (dict): 一个字典，键是奖励，值是对应的权重 (整数或浮点数)。</span></span><br><span class="line"><span class="string">                                 例如: {'金币': 50, '装备': 30, '药水': 20}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    any: 抽中的奖励。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> rewards_with_weights:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span> <span class="comment"># 或者抛出异常</span></span><br><span class="line">        </span><br><span class="line">    population = <span class="built_in">list</span>(rewards_with_weights.keys())</span><br><span class="line">    weights = <span class="built_in">list</span>(rewards_with_weights.values())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> random.choices(population, weights=weights, k=<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line">daily_rewards = {</span><br><span class="line">    <span class="string">'100 金币'</span>: <span class="number">60</span>,</span><br><span class="line">    <span class="string">'小体力药剂'</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">'随机材料包'</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">'稀有装备碎片'</span>: <span class="number">5</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n模拟每日签到奖励抽取5次:"</span>)</span><br><span class="line"><span class="keyword">for</span> day <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    reward = get_weighted_reward(daily_rewards)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  第 <span class="subst">{day}</span> 天签到获得: <span class="subst">{reward}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h5 id="d-生成一个范围内的随机日期"><a href="#d-生成一个范围内的随机日期" class="headerlink" title="d. 生成一个范围内的随机日期"></a>d. 生成一个范围内的随机日期</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date, timedelta</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_random_date</span>(<span class="params">start_date_str, end_date_str, date_format=<span class="string">"%Y-%m-%d"</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    在给定的开始日期和结束日期之间生成一个随机日期。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    start_date_str (str): 开始日期字符串。</span></span><br><span class="line"><span class="string">    end_date_str (str): 结束日期字符串。</span></span><br><span class="line"><span class="string">    date_format (str): 日期字符串的格式。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    datetime.date: 生成的随机日期对象，如果日期解析失败则返回None。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        start_dt = date.strptime(start_date_str, date_format)</span><br><span class="line">        end_dt = date.strptime(end_date_str, date_format)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"日期格式错误或日期无效。"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> start_dt &gt; end_dt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"开始日期不能晚于结束日期。"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    time_between_dates = end_dt - start_dt</span><br><span class="line">    days_between_dates = time_between_dates.days</span><br><span class="line">    <span class="keyword">if</span> days_between_dates &lt; <span class="number">0</span>: <span class="keyword">return</span> <span class="literal">None</span> <span class="comment"># 再次检查以防万一</span></span><br><span class="line"></span><br><span class="line">    random_number_of_days = random.randrange(days_between_dates + <span class="number">1</span>) <span class="comment"># 加1使结束日期也可能被选中</span></span><br><span class="line">    random_date = start_dt + timedelta(days=random_number_of_days)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> random_date</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line">start = <span class="string">"2024-01-01"</span></span><br><span class="line">end = <span class="string">"2024-12-31"</span></span><br><span class="line">random_birthday = get_random_date(start, end)</span><br><span class="line"><span class="keyword">if</span> random_birthday:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n在 <span class="subst">{start}</span> 和 <span class="subst">{end}</span> 之间随机生成的生日: <span class="subst">{random_birthday.strftime(<span class="string">'%Y年%m月%d日'</span>)}</span>"</span>)</span><br><span class="line"></span><br><span class="line">invalid_start = <span class="string">"2025-01-01"</span></span><br><span class="line">get_random_date(invalid_start, end) <span class="comment"># 会打印错误信息</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3、操作系统交互与文件处理模块"><a href="#3、操作系统交互与文件处理模块" class="headerlink" title="3、操作系统交互与文件处理模块"></a>3、操作系统交互与文件处理模块</h3><p>在 Python 编程中，与操作系统进行交互（如管理文件和目录、执行系统命令）以及处理文件（如复制、移动、压缩）是非常常见的任务。Python 标准库为此提供了多个强大的模块，主要包括 <code>os</code>、<code>shutil</code>、<code>zipfile</code> 和 <code>tarfile</code>。</p><h4 id="os-模块：与操作系统交互的基础（核心）"><a href="#os-模块：与操作系统交互的基础（核心）" class="headerlink" title="os 模块：与操作系统交互的基础（核心）"></a><code>os</code> 模块：与操作系统交互的基础（核心）</h4><p><code>os</code> 模块提供了一种可移植的方式来使用操作系统的功能，例如读取或写入文件、操作目录路径、获取环境变量等。它的一个重要子模块是 <code>os.path</code>，专门用于处理路径字符串。</p><h5 id="os-及-os-path-常用功能"><a href="#os-及-os-path-常用功能" class="headerlink" title="os 及 os.path 常用功能"></a><code>os</code> 及 <code>os.path</code> 常用功能</h5><table><thead><tr><th>方法/属性</th><th>描述</th></tr></thead><tbody><tr><td><code>os.getcwd()</code></td><td>获取当前Python脚本的工作目录路径。</td></tr><tr><td><code>os.chdir(path)</code></td><td>更改当前Python脚本的工作目录到 <code>path</code>。</td></tr><tr><td><code>os.listdir(path='.')</code></td><td>列出指定目录 <code>path</code> 下的所有文件和文件夹名称。</td></tr><tr><td><code>os.mkdir(path)</code></td><td>创建一个名为 <code>path</code> 的新目录 (如果路径中的父目录不存在会失败)。</td></tr><tr><td><code>os.makedirs(path, exist_ok=False)</code></td><td>递归创建多级目录，如果 <code>exist_ok=True</code> 则目录已存在时不会报错。</td></tr><tr><td><code>os.remove(path)</code></td><td>删除指定路径 <code>path</code> 的文件。</td></tr><tr><td><code>os.rmdir(path)</code></td><td>删除指定路径 <code>path</code> 的空目录 (如果目录非空则会失败)。</td></tr><tr><td><code>os.rename(src, dst)</code></td><td>重命名文件或目录，从 <code>src</code> 名称改为 <code>dst</code> 名称。</td></tr><tr><td><code>os.environ</code></td><td>一个表示环境变量的字典，可以用来获取或设置环境变量。</td></tr><tr><td><code>os.system(command)</code></td><td>在系统的shell中执行 <code>command</code> 命令 (谨慎使用，有安全风险)。</td></tr><tr><td><code>os.path.join(path, *paths)</code></td><td><strong>强烈推荐</strong>：智能地拼接一个或多个路径部分，自动处理不同操作系统的分隔符。</td></tr><tr><td><code>os.path.exists(path)</code></td><td>检查指定的路径 <code>path</code> 是否存在 (文件或目录)。</td></tr><tr><td><code>os.path.isfile(path)</code></td><td>检查指定的路径 <code>path</code> 是否是一个文件。</td></tr><tr><td><code>os.path.isdir(path)</code></td><td>检查指定的路径 <code>path</code> 是否是一个目录。</td></tr><tr><td><code>os.path.getsize(path)</code></td><td>获取指定文件 <code>path</code> 的大小 (以字节为单位)。</td></tr><tr><td><code>os.path.basename(path)</code></td><td>获取路径 <code>path</code> 中的文件名部分。</td></tr><tr><td><code>os.path.dirname(path)</code></td><td>获取路径 <code>path</code> 中的目录部分。</td></tr><tr><td><code>os.path.abspath(path)</code></td><td>获取路径 <code>path</code> 的绝对路径。</td></tr><tr><td><code>os.path.splitext(path)</code></td><td>将路径 <code>path</code> 分割为 (文件名主体, 扩展名) 的元组。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>os</code> 和 <code>os.path</code>)</strong></p><ul><li><code>os.getcwd()</code>, <code>os.chdir()</code>: 管理当前工作目录。</li><li><code>os.listdir()</code>: 查看目录内容。</li><li><code>os.mkdir()</code>, <code>os.makedirs()</code>: 创建目录。</li><li><code>os.remove()</code>, <code>os.rmdir()</code>: 删除文件和空目录。</li><li><code>os.path.join()</code>: <strong>极其重要</strong>，用于跨平台安全地构造路径。</li><li><code>os.path.exists()</code>, <code>os.path.isfile()</code>, <code>os.path.isdir()</code>: 判断路径类型。</li><li><code>os.path.basename()</code>, <code>os.path.dirname()</code>, <code>os.path.splitext()</code>: 解析路径字符串。</li></ul></blockquote><h5 id="os-模块代码示例"><a href="#os-模块代码示例" class="headerlink" title="os 模块代码示例"></a><code>os</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============== 目录操作 ==============</span></span><br><span class="line">print_header(<span class="string">"目录操作"</span>)</span><br><span class="line">current_directory = os.getcwd()</span><br><span class="line">print_info(<span class="string">f"当前工作目录: <span class="subst">{current_directory}</span>"</span>)</span><br><span class="line"></span><br><span class="line">new_dir_name = <span class="string">"my_test_directory"</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(new_dir_name):</span><br><span class="line">    os.mkdir(new_dir_name)  <span class="comment"># 创建单级目录</span></span><br><span class="line">    print_info(<span class="string">f"目录 '<span class="subst">{new_dir_name}</span>' 已创建。"</span>)</span><br><span class="line"></span><br><span class="line">multi_level_dir = os.path.join(<span class="string">"parent_dir"</span>, <span class="string">"child_dir"</span>)  <span class="comment"># 推荐使用 os.path.join</span></span><br><span class="line">os.makedirs(multi_level_dir, exist_ok=<span class="literal">True</span>)  <span class="comment"># 递归创建，存在亦可</span></span><br><span class="line">print_info(<span class="string">f"多级目录 '<span class="subst">{multi_level_dir}</span>' 已创建或已存在。"</span>)</span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"当前目录内容: <span class="subst">{os.listdir(<span class="string">'.'</span>)[:<span class="number">5</span>]}</span>"</span>)  <span class="comment"># 列出当前目录内容 (最多显示5个)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ============== 路径操作 (os.path) ==============</span></span><br><span class="line">print_header(<span class="string">"路径操作 (os.path)"</span>)</span><br><span class="line">file_path_str = <span class="string">"/usr/local/bin/python_script.py"</span>  <span class="comment"># 示例路径</span></span><br><span class="line">print_info(<span class="string">f"处理路径: '<span class="subst">{file_path_str}</span>'"</span>)</span><br><span class="line">print_info(<span class="string">f"  目录名: <span class="subst">{os.path.dirname(file_path_str)}</span>"</span>)  <span class="comment"># 输出: /usr/local/bin</span></span><br><span class="line">print_info(<span class="string">f"  文件名: <span class="subst">{os.path.basename(file_path_str)}</span>"</span>)  <span class="comment"># 输出: python_script.py</span></span><br><span class="line">print_info(<span class="string">f"  扩展名: <span class="subst">{os.path.splitext(file_path_str)[<span class="number">1</span>]}</span>"</span>)  <span class="comment"># 输出: .py</span></span><br><span class="line">print_info(<span class="string">f"  分割 (主体, 扩展名): <span class="subst">{os.path.splitext(file_path_str)}</span>"</span>)  <span class="comment"># 输出: ('/usr/local/bin/python_script', '.py')</span></span><br><span class="line"></span><br><span class="line">path1 = <span class="string">"projects"</span></span><br><span class="line">path2 = <span class="string">"my_project"</span></span><br><span class="line">filename = <span class="string">"main.py"</span></span><br><span class="line">full_project_path = os.path.join(current_directory, path1, path2, filename)</span><br><span class="line">print_info(<span class="string">f"使用 os.path.join 拼接的路径: <span class="subst">{full_project_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============== 文件操作 ==============</span></span><br><span class="line">print_header(<span class="string">"文件操作"</span>)</span><br><span class="line">test_file_name = <span class="string">"temp_file.txt"</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(test_file_name, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">"Hello from os module example!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.exists(test_file_name):</span><br><span class="line">    print_info(<span class="string">f"文件 '<span class="subst">{test_file_name}</span>' 存在。"</span>)</span><br><span class="line">    print_info(<span class="string">f"  是否是文件: <span class="subst">{os.path.isfile(test_file_name)}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  文件大小: <span class="subst">{os.path.getsize(test_file_name)}</span> 字节"</span>)</span><br><span class="line"></span><br><span class="line">    renamed_file_name = <span class="string">"renamed_temp_file.txt"</span></span><br><span class="line">    os.rename(test_file_name, renamed_file_name)  <span class="comment"># 重命名</span></span><br><span class="line">    print_info(<span class="string">f"文件已重命名为: '<span class="subst">{renamed_file_name}</span>'"</span>)</span><br><span class="line"></span><br><span class="line">    os.remove(renamed_file_name)  <span class="comment"># 删除文件</span></span><br><span class="line">    print_info(<span class="string">f"文件 '<span class="subst">{renamed_file_name}</span>' 已删除。"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_info(<span class="string">f"文件 '<span class="subst">{test_file_name}</span>' 不存在。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============== 环境变量 ==============</span></span><br><span class="line">print_header(<span class="string">"环境变量"</span>)</span><br><span class="line">python_path = os.environ.get(<span class="string">'PYTHONPATH'</span>)  <span class="comment"># 获取环境变量</span></span><br><span class="line">print_info(<span class="string">f"环境变量 PYTHONPATH: <span class="subst">{python_path <span class="keyword">if</span> python_path <span class="keyword">else</span> <span class="string">'未设置'</span>}</span>"</span>)</span><br><span class="line"><span class="comment"># os.environ['MY_CUSTOM_VAR'] = 'my_value' # 设置环境变量 (仅对当前进程及其子进程有效)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ============== 执行系统命令 ==============</span></span><br><span class="line">print_header(<span class="string">"执行系统命令"</span>)</span><br><span class="line"><span class="comment"># print_info("执行系统命令 'ls -l' (或 'dir' on Windows):")</span></span><br><span class="line"><span class="comment"># return_code = os.system("ls -l" if os.name != 'nt' else "dir") # os.name 可以判断操作系统</span></span><br><span class="line"><span class="comment"># print_info(f"命令执行完毕，返回码: {return_code}")</span></span><br><span class="line">print_info(<span class="string">"更好的方式是使用 subprocess 模块，它提供了更强的控制能力和安全性。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============== 清理创建的目录 ==============</span></span><br><span class="line"><span class="comment"># 使用更加优雅的方式去递归删除：(shutil.rmtree)</span></span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_directory</span>(<span class="params">directory_path</span>):</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(directory_path):</span><br><span class="line">        shutil.rmtree(directory_path)</span><br><span class="line">        print_info(<span class="string">f"目录 '<span class="subst">{directory_path}</span>' 已成功删除。"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_info(<span class="string">f"目录 '<span class="subst">{directory_path}</span>' 不存在。"</span>)</span><br><span class="line">remove_directory(<span class="string">"parent_dir"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>os</code> 模块)</strong>:</p><ul><li><strong>路径拼接</strong>：务必使用 <code>os.path.join()</code> 来构造路径，它会自动处理不同操作系统（Windows <code>\</code> vs Linux/macOS <code>/</code>）的路径分隔符，增强代码的可移植性。</li><li><strong><code>os.system()</code></strong>：尽量避免使用 <code>os.system()</code>，尤其当命令包含用户输入时，可能存在安全风险（命令注入）。对于需要执行外部命令的场景，<code>subprocess</code> 模块是更安全、更灵活的选择。</li><li><strong><code>os.remove()</code> vs <code>os.rmdir()</code></strong>：<code>os.remove()</code> 用于删除文件，<code>os.rmdir()</code> 用于删除空目录。如果要删除非空目录及其所有内容，请使用 <code>shutil.rmtree()</code>。</li><li><strong>权限问题</strong>：文件和目录操作可能会因为权限不足而失败，应使用 <code>try-except PermissionError</code> 来捕获和处理这类异常。</li><li><strong><code>pathlib</code> 模块</strong>：对于更现代、面向对象的文件系统路径操作，Python 3.4+ 引入的 <code>pathlib</code> 模块是一个很好的选择，它提供了更直观的 APi，但从使用层面受众程度来说，使用os模块的程序员会占更多数</li></ul></blockquote><h4 id="shutil-模块：高级文件操作"><a href="#shutil-模块：高级文件操作" class="headerlink" title="shutil 模块：高级文件操作"></a><code>shutil</code> 模块：高级文件操作</h4><p><code>shutil</code> (shell utilities) 模块提供了许多高级的文件和文件集合操作功能，例如复制、移动、删除整个目录树等，是对 <code>os</code> 模块中基本文件操作的补充。</p><h5 id="shutil-常用函数"><a href="#shutil-常用函数" class="headerlink" title="shutil 常用函数"></a><code>shutil</code> 常用函数</h5><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>shutil.copy(src, dst)</code></td><td>复制文件 <code>src</code> 到 <code>dst</code> (如果 <code>dst</code> 是目录，则复制到该目录下)。</td></tr><tr><td><code>shutil.copy2(src, dst)</code></td><td>类似 <code>copy()</code>，但同时会尝试复制文件的元数据 (如权限、时间戳)。</td></tr><tr><td><code>shutil.copyfile(src, dst)</code></td><td>仅复制文件内容从 <code>src</code> 到 <code>dst</code> (不复制元数据)。</td></tr><tr><td><code>shutil.copytree(src, dst, dirs_exist_ok=False)</code></td><td>递归地复制整个目录树从 <code>src</code> 到 <code>dst</code>。</td></tr><tr><td><code>shutil.rmtree(path)</code></td><td><strong>危险操作</strong>：递归地删除整个目录树 <code>path</code> (包括非空目录)。</td></tr><tr><td><code>shutil.move(src, dst)</code></td><td>递归地移动文件或目录 <code>src</code> 到 <code>dst</code> (类似 Unix 的 <code>mv</code> 命令)。</td></tr><tr><td><code>shutil.make_archive(base_name, format, root_dir)</code></td><td>创建一个压缩归档文件 (如 zip 或 tar)。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆函数 (<code>shutil</code> 模块)</strong></p><ul><li><code>shutil.copy2()</code>: 复制文件时通常比 <code>copy()</code> 更好，因为它保留元数据。</li><li><code>shutil.copytree()</code>: 复制整个文件夹。</li><li><code>shutil.rmtree()</code>: <strong>要特别小心使用</strong>，用于删除整个文件夹及其内容。</li><li><code>shutil.move()</code>: 移动文件或文件夹。</li><li><code>shutil.make_archive()</code>: 创建压缩包。</li></ul></blockquote><h5 id="shutil-模块代码示例"><a href="#shutil-模块代码示例" class="headerlink" title="shutil 模块代码示例"></a><code>shutil</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 准备测试环境 ---</span></span><br><span class="line">src_dir = <span class="string">"shutil_source_dir"</span></span><br><span class="line">dst_dir_base = <span class="string">"shutil_dest_base"</span></span><br><span class="line">os.makedirs(src_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">os.makedirs(dst_dir_base, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">src_file = os.path.join(src_dir, <span class="string">"original_file.txt"</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(src_file, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">"源文件测试"</span>)</span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"准备的源文件: <span class="subst">{src_file}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 复制文件</span></span><br><span class="line"><span class="comment"># shutil.copy(src, dst) 或 shutil.copy2(src, dst)</span></span><br><span class="line"><span class="comment"># 如果dst是一个目录，文件会被复制到该目录下并保持原名</span></span><br><span class="line"><span class="comment"># 如果dst是一个文件名，则文件会被复制并重命名为dst</span></span><br><span class="line">copied_file_path = os.path.join(dst_dir_base, <span class="string">"copied_file.txt"</span>)</span><br><span class="line">shutil.copy2(src_file, copied_file_path) <span class="comment"># copy2 保留更多元数据</span></span><br><span class="line">print_info(<span class="string">f"文件 '<span class="subst">{src_file}</span>' 已使用 copy2 复制到 '<span class="subst">{copied_file_path}</span>'"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 复制目录树</span></span><br><span class="line"><span class="comment"># shutil.copytree(src, dst)</span></span><br><span class="line"><span class="comment"># dst 必须是不存在的目录，copytree 会创建它</span></span><br><span class="line">copied_tree_path = os.path.join(dst_dir_base, <span class="string">"copied_source_tree"</span>)</span><br><span class="line"><span class="keyword">if</span> os.path.exists(copied_tree_path): <span class="comment"># 先清理，防止上次运行残留</span></span><br><span class="line">    shutil.rmtree(copied_tree_path)</span><br><span class="line">shutil.copytree(src_dir, copied_tree_path)</span><br><span class="line">print_info(<span class="string">f"目录树 '<span class="subst">{src_dir}</span>' 已复制到 '<span class="subst">{copied_tree_path}</span>'"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 移动文件或目录</span></span><br><span class="line"><span class="comment"># shutil.move(src, dst)</span></span><br><span class="line">moved_file_destination_dir = os.path.join(dst_dir_base, <span class="string">"moved_files_here"</span>)</span><br><span class="line">os.makedirs(moved_file_destination_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">moved_file_path = shutil.move(copied_file_path, moved_file_destination_dir) <span class="comment"># 移动文件</span></span><br><span class="line">print_info(<span class="string">f"文件 '<span class="subst">{copied_file_path}</span>' 已移动到 '<span class="subst">{moved_file_path}</span>'"</span>) <span class="comment"># move返回目标路径</span></span><br><span class="line"></span><br><span class="line">moved_tree_path_new_name = os.path.join(dst_dir_base, <span class="string">"moved_source_tree_new_name"</span>)</span><br><span class="line">shutil.move(copied_tree_path, moved_tree_path_new_name) <span class="comment"># 移动并重命名目录</span></span><br><span class="line">print_info(<span class="string">f"目录 '<span class="subst">{copied_tree_path}</span>' 已移动并重命名为 '<span class="subst">{moved_tree_path_new_name}</span>'"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 删除目录树</span></span><br><span class="line"><span class="comment"># shutil.rmtree(path) - 非常危险，会无提示删除所有内容</span></span><br><span class="line">dir_to_delete_completely = os.path.join(dst_dir_base, <span class="string">"temp_delete_me"</span>)</span><br><span class="line">os.makedirs(os.path.join(dir_to_delete_completely, <span class="string">"subdir"</span>), exist_ok=<span class="literal">True</span>) <span class="comment"># 创建一些内容</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(dir_to_delete_completely, <span class="string">"file.txt"</span>), <span class="string">"w"</span>) <span class="keyword">as</span> f: f.write(<span class="string">"temp"</span>)</span><br><span class="line">print_info(<span class="string">f"准备删除目录: <span class="subst">{dir_to_delete_completely}</span>"</span>)</span><br><span class="line">shutil.rmtree(dir_to_delete_completely)</span><br><span class="line">print_info(<span class="string">f"目录 '<span class="subst">{dir_to_delete_completely}</span>' 已使用 rmtree 删除。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 创建压缩包</span></span><br><span class="line"><span class="comment"># shutil.make_archive(base_name, format, root_dir)</span></span><br><span class="line"><span class="comment"># base_name 是不带扩展名的归档文件名</span></span><br><span class="line"><span class="comment"># format 是归档格式，如 'zip', 'tar', 'gztar', 'bztar'</span></span><br><span class="line"><span class="comment"># root_dir 是要压缩的根目录</span></span><br><span class="line">archive_output_name = os.path.join(dst_dir_base, <span class="string">"my_archive"</span>) <span class="comment"># 生成 my_archive.zip</span></span><br><span class="line">shutil.make_archive(archive_output_name, <span class="string">'zip'</span>, src_dir)</span><br><span class="line">print_info(<span class="string">f"目录 '<span class="subst">{src_dir}</span>' 已压缩为 '<span class="subst">{archive_output_name}</span>.zip'"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 清理测试环境 ---</span></span><br><span class="line">shutil.rmtree(src_dir)</span><br><span class="line">shutil.rmtree(dst_dir_base)</span><br><span class="line">print_info(<span class="string">"\nshutil 测试环境已清理。"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="pathlib-模块：面向对象的文件系统路径"><a href="#pathlib-模块：面向对象的文件系统路径" class="headerlink" title="pathlib 模块：面向对象的文件系统路径"></a><code>pathlib</code> 模块：面向对象的文件系统路径</h4><p><code>pathlib</code> 模块是 Python 3.4 版本引入的标准库，它将文件系统路径表示为具有方法和属性的实际对象，而不是简单的字符串。这种面向对象的方法使得路径操作更加清晰、易读，并且减少了在处理不同操作系统路径分隔符时可能出现的错误。</p><h5 id="pathlib-常用类与方法"><a href="#pathlib-常用类与方法" class="headerlink" title="pathlib 常用类与方法"></a><code>pathlib</code> 常用类与方法</h5><p>核心类是 <code>Path</code>，它同时代表文件和目录路径。</p><table><thead><tr><th>类/属性/方法</th><th>描述</th></tr></thead><tbody><tr><td><code>from pathlib import Path</code></td><td>导入核心的 <code>Path</code> 类。</td></tr><tr><td><code>Path(path_str_or_Path_obj, ...)</code></td><td>创建一个 <code>Path</code> 对象，可以传入字符串路径或已有的 <code>Path</code> 对象。</td></tr><tr><td><code>Path.cwd()</code></td><td>(类方法) 返回一个表示当前工作目录的 <code>Path</code> 对象。</td></tr><tr><td><code>Path.home()</code></td><td>(类方法) 返回一个表示用户主目录的 <code>Path</code> 对象。</td></tr><tr><td><code>path_obj / "another_part"</code></td><td>使用 <code>/</code> 操作符轻松、跨平台地拼接路径部分。</td></tr><tr><td><code>path_obj.joinpath(*other_paths)</code></td><td>另一种拼接路径部分的方法，可以接受多个参数。</td></tr><tr><td><code>path_obj.name</code></td><td>(属性) 获取路径的最后一部分 (文件名或目录名)。</td></tr><tr><td><code>path_obj.stem</code></td><td>(属性) 获取文件名中不包含最后一个后缀的部分。</td></tr><tr><td><code>path_obj.suffix</code></td><td>(属性) 获取路径的最后一个文件扩展名 (例如 <code>.txt</code>)。</td></tr><tr><td><code>path_obj.suffixes</code></td><td>(属性) 获取路径中所有文件扩展名的列表 (例如 <code>['.tar', '.gz']</code>)。</td></tr><tr><td><code>path_obj.parent</code></td><td>(属性) 获取路径的直接父目录。</td></tr><tr><td><code>path_obj.parents</code></td><td>(属性) 一个序列，包含路径的所有父级目录，直到根目录。</td></tr><tr><td><code>path_obj.exists()</code></td><td>检查路径是否存在 (无论是文件还是目录)。</td></tr><tr><td><code>path_obj.is_file()</code></td><td>检查路径是否指向一个已存在的文件。</td></tr><tr><td><code>path_obj.is_dir()</code></td><td>检查路径是否指向一个已存在的目录。</td></tr><tr><td><code>path_obj.is_symlink()</code></td><td>检查路径是否指向一个符号链接。</td></tr><tr><td><code>path_obj.is_absolute()</code></td><td>检查路径是否为绝对路径。</td></tr><tr><td><code>path_obj.resolve(strict=False)</code></td><td>将路径解析为绝对路径，并处理任何符号链接 (如果 <code>strict=True</code> 且路径不存在则报错)。</td></tr><tr><td><code>path_obj.absolute()</code></td><td>返回路径的绝对形式 (不解析符号链接)。</td></tr><tr><td><code>path_obj.mkdir(mode=0o777, parents=False, exist_ok=False)</code></td><td>创建此路径表示的目录，<code>parents=True</code> 会创建所有必需的父目录，<code>exist_ok=True</code> 则目录已存在时不报错。</td></tr><tr><td><code>path_obj.rmdir()</code></td><td>删除此路径表示的空目录。</td></tr><tr><td><code>path_obj.unlink(missing_ok=False)</code></td><td>删除此路径表示的文件或符号链接 (如果 <code>missing_ok=True</code> 且文件不存在则不报错)。</td></tr><tr><td><code>path_obj.rename(target)</code></td><td>将此路径重命名或移动到 <code>target</code> 路径。</td></tr><tr><td><code>path_obj.replace(target)</code></td><td>类似 <code>rename</code>，但在目标已存在时会覆盖它 (如果操作系统支持原子操作)。</td></tr><tr><td><code>path_obj.touch(mode=0o666, exist_ok=True)</code></td><td>创建此路径表示的文件 (类似 Unix <code>touch</code> 命令)，如果文件已存在则更新其修改时间 (除非 <code>exist_ok=False</code>)。</td></tr><tr><td><code>path_obj.read_text(encoding=None, ...)</code></td><td>读取文件内容并将其作为字符串返回。</td></tr><tr><td><code>path_obj.write_text(data, encoding=None, ...)</code></td><td>将字符串 <code>data</code> 写入文件 (会覆盖已有内容)。</td></tr><tr><td><code>path_obj.read_bytes()</code></td><td>读取文件内容并将其作为字节串返回。</td></tr><tr><td><code>path_obj.write_bytes(data)</code></td><td>将字节串 <code>data</code> 写入文件 (会覆盖已有内容)。</td></tr><tr><td><code>path_obj.open(mode='r', ...)</code></td><td>以指定模式打开文件，返回一个文件对象 (与内置 <code>open()</code> 类似)。</td></tr><tr><td><code>path_obj.iterdir()</code></td><td>返回一个迭代器，产生此目录路径下的所有直接子项 (文件和目录) 的 <code>Path</code> 对象。</td></tr><tr><td><code>path_obj.glob(pattern)</code></td><td>在此路径下查找匹配 <code>pattern</code> 的文件和目录，返回一个生成器。</td></tr><tr><td><code>path_obj.rglob(pattern)</code></td><td>递归地在此路径及其所有子目录下查找匹配 <code>pattern</code> 的文件和目录，返回一个生成器。</td></tr><tr><td><code>path_obj.stat()</code></td><td>返回一个包含此路径元数据信息的 <code>os.stat_result</code> 对象 (如大小、修改时间等)。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>pathlib</code> 模块)</strong></p><ul><li><code>Path()</code>: 创建 <code>Path</code> 对象是所有操作的开始。</li><li><code>/</code> 操作符: <strong>非常常用且直观</strong>，用于安全地拼接路径。</li><li><code>.exists()</code>, <code>.is_file()</code>, <code>.is_dir()</code>: 判断路径状态。</li><li><code>.name</code>, <code>.stem</code>, <code>.suffix</code>, <code>.parent</code>: 方便地获取路径的各个组成部分。</li><li><code>.mkdir(parents=True, exist_ok=True)</code>: 创建目录的常用组合。</li><li><code>.read_text()</code>, <code>.write_text()</code>, <code>.read_bytes()</code>, <code>.write_bytes()</code>: 简单快速地读写文件内容。</li><li><code>.iterdir()</code>, <code>.glob()</code>, <code>.rglob()</code>: 遍历和搜索目录内容。</li><li>使用 <code>with path_obj.open(...) as f:</code> 进行文件操作，确保文件正确关闭。</li></ul></blockquote><h5 id="pathlib-模块代码示例"><a href="#pathlib-模块代码示例" class="headerlink" title="pathlib 模块代码示例"></a><code>pathlib</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> os  <span class="comment"># 用于获取当前目录等辅助操作</span></span><br><span class="line"><span class="keyword">import</span> shutil  <span class="comment"># 用于演示后清理目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. pathlib 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"pathlib 模块功能演示"</span>)</span><br><span class="line"><span class="comment"># 创建一个临时的演示工作目录</span></span><br><span class="line">DEMO_ROOT_DIR_NAME: <span class="built_in">str</span> = <span class="string">"pathlib_demo_space"</span>  <span class="comment"># 演示目录名称</span></span><br><span class="line">DEMO_ROOT_PATH: Path = Path.cwd() / DEMO_ROOT_DIR_NAME  <span class="comment"># 使用 / 拼接</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_demo_environment</span>(<span class="params">base_path: Path</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    准备演示环境：创建目录结构和文件</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_info(<span class="string">f"创建演示环境于 <span class="subst">{base_path}</span>"</span>)</span><br><span class="line">    <span class="keyword">if</span> base_path.exists():</span><br><span class="line">        shutil.rmtree(base_path)  <span class="comment"># 递归删除清理旧环境</span></span><br><span class="line">    base_path.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)  <span class="comment"># Parents=True 确保父目录也创建 exist_ok=True 避免重复创建</span></span><br><span class="line"></span><br><span class="line">    (base_path / <span class="string">"documents"</span>).mkdir()  <span class="comment"># 创建 文件 目录</span></span><br><span class="line">    (base_path / <span class="string">"images"</span>).mkdir()  <span class="comment"># 创建 图片 目录</span></span><br><span class="line">    (base_path / <span class="string">"archives"</span>).mkdir()  <span class="comment"># 创建 压缩包 目录</span></span><br><span class="line"></span><br><span class="line">    (base_path / <span class="string">"main_script.py"</span>).write_text(<span class="string">"# 主脚本"</span>)  <span class="comment"># 创建主脚本文件</span></span><br><span class="line">    (base_path / <span class="string">"readme.md"</span>).write_text(<span class="string">"# 项目说明"</span>)  <span class="comment"># 创建项目说明文件</span></span><br><span class="line">    (base_path / <span class="string">"data.csv"</span>).write_text(<span class="string">"name,age\nJohn,30\nJane,25"</span>)  <span class="comment"># 创建数据文件</span></span><br><span class="line">    (base_path / <span class="string">"documents"</span> / <span class="string">"report.pdf"</span>).write_text(<span class="string">"# 报告"</span>)  <span class="comment"># 创建文档文件</span></span><br><span class="line">    (base_path / <span class="string">"images"</span> / <span class="string">"logo.png"</span>).write_text(<span class="string">"# 图片"</span>)  <span class="comment"># 创建图片文件</span></span><br><span class="line">    (base_path / <span class="string">"archives"</span> / <span class="string">"archive.zip"</span>).write_text(<span class="string">"# 压缩包"</span>)  <span class="comment"># 创建压缩包文件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在documents下递归创建三层目录结构的数字txt文件</span></span><br><span class="line">    <span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建三层目录结构的数字文件</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># 第一层</span></span><br><span class="line">        first_dir = base_path / <span class="string">"documents"</span> / <span class="string">f"level_<span class="subst">{i + <span class="number">1</span>}</span>"</span></span><br><span class="line">        first_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># 第二层</span></span><br><span class="line">            second_dir = first_dir / <span class="string">f"sublevel_<span class="subst">{j + <span class="number">1</span>}</span>"</span></span><br><span class="line">            second_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):  <span class="comment"># 第三层，每个第三层目录创建5个文件</span></span><br><span class="line">                file_num = random.randint(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">                (second_dir / <span class="string">f"file_<span class="subst">{file_num}</span>.txt"</span>).write_text(<span class="string">f"# 第<span class="subst">{i + <span class="number">1</span>}</span>层第<span class="subst">{j + <span class="number">1</span>}</span>子层的数字文件 <span class="subst">{file_num}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    print_success(<span class="string">f"演示环境准备完成于 <span class="subst">{base_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cleanup_demo_environment</span>(<span class="params">base_path: Path</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    清理演示环境</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_info(<span class="string">f"清理演示环境于 <span class="subst">{base_path}</span>"</span>)</span><br><span class="line">    <span class="keyword">if</span> base_path.exists():</span><br><span class="line">        shutil.rmtree(base_path)  <span class="comment"># 递归删除演示目录</span></span><br><span class="line">        print_success(<span class="string">f"演示环境清理完成，清理路径为 =&gt; <span class="subst">{base_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. Path 对象创建与基本属性</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_path_creation_and_attributes</span>(<span class="params">base_path: Path</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    print_subheader(<span class="string">"1. Path 对象创建与基本属性"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从字符串创建 Path 对象</span></span><br><span class="line">    p1: Path = Path(<span class="string">"/usr/local/bin"</span>)  <span class="comment"># 绝对路径(示例)</span></span><br><span class="line">    p2: Path = base_path / <span class="string">"main_script.py"</span>  <span class="comment"># 相对路径(示例)</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f"Path 对象 p1: <span class="subst">{p1}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"Path 对象 p2: <span class="subst">{p2}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 基本属性</span></span><br><span class="line">    print_info(<span class="string">f"p1 是否为绝对路径: <span class="subst">{p1.is_absolute()}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"p2 是否为绝对路径: <span class="subst">{p2.is_absolute()}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 下面都以 p2 来做为演示</span></span><br><span class="line">    print_info(<span class="string">f"p2 的文件名: <span class="subst">{p2.name}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"p2 的后缀: <span class="subst">{p2.suffix}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"p2 的父目录: <span class="subst">{p2.parent}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"p2 的祖先目录: <span class="subst">{p2.parents}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"p2 的绝对路径: <span class="subst">{p2.resolve()}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"p2 的规范化路径: <span class="subst">{p2.as_posix()}</span>"</span>)  <span class="comment"># 用于跨平台路径表示</span></span><br><span class="line">    print_info(<span class="string">f"p2 的网络路径: <span class="subst">{p2.as_uri()}</span>"</span>)  <span class="comment"># 用于网络路径表示</span></span><br><span class="line">    <span class="keyword">for</span> i, parent_dir <span class="keyword">in</span> <span class="built_in">enumerate</span>(p2.parents):</span><br><span class="line">        print_info(<span class="string">f"p2 的第 <span class="subst">{i + <span class="number">1</span>}</span> 个祖先目录: <span class="subst">{parent_dir}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 当前工作目录和用户主目录</span></span><br><span class="line">    cwd_path: Path = Path.cwd()</span><br><span class="line">    home_path: Path = Path.home()</span><br><span class="line">    print_info(<span class="string">f"当前工作目录 (Path.cwd()): <span class="subst">{cwd_path}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"用户主目录 (Path.home()): <span class="subst">{home_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================输出结果=================</span></span><br><span class="line"><span class="string">r"""</span></span><br><span class="line"><span class="string">  1. Path 对象创建与基本属性</span></span><br><span class="line"><span class="string"> INFO: Path 对象 p1: \usr\local\bin</span></span><br><span class="line"><span class="string"> INFO: Path 对象 p2: D:\python\PythonStudy\pathlib_demo_space\main_script.py</span></span><br><span class="line"><span class="string"> INFO: p1 是否为绝对路径: False</span></span><br><span class="line"><span class="string"> INFO: p2 是否为绝对路径: True</span></span><br><span class="line"><span class="string"> INFO: p2 的文件名: main_script.py</span></span><br><span class="line"><span class="string"> INFO: p2 的后缀: .py</span></span><br><span class="line"><span class="string"> INFO: p2 的父目录: D:\python\PythonStudy\pathlib_demo_space</span></span><br><span class="line"><span class="string"> INFO: p2 的祖先目录: &lt;WindowsPath.parents&gt;</span></span><br><span class="line"><span class="string"> INFO: p2 的绝对路径: D:\python\PythonStudy\pathlib_demo_space\main_script.py</span></span><br><span class="line"><span class="string"> INFO: p2 的规范化路径: D:/python/PythonStudy/pathlib_demo_space/main_script.py</span></span><br><span class="line"><span class="string"> INFO: p2 的网络路径: file:///D:/python/PythonStudy/pathlib_demo_space/main_script.py</span></span><br><span class="line"><span class="string"> INFO: p2 的第 1 个祖先目录: D:\python\PythonStudy\pathlib_demo_space</span></span><br><span class="line"><span class="string"> INFO: p2 的第 2 个祖先目录: D:\python\PythonStudy</span></span><br><span class="line"><span class="string"> INFO: p2 的第 3 个祖先目录: D:\python</span></span><br><span class="line"><span class="string"> INFO: p2 的第 4 个祖先目录: D:\</span></span><br><span class="line"><span class="string"> INFO: 当前工作目录 (Path.cwd()): D:\python\PythonStudy</span></span><br><span class="line"><span class="string"> INFO: 用户主目录 (Path.home()): C:\Users\Prorise</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==============================输出结果====================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 路径拼接与解析</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_path_joining_and_resolution</span>(<span class="params">base_path: Path</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示路径的拼接和解析。"""</span></span><br><span class="line">    print_subheader(<span class="string">"2. 路径拼接与解析"</span>)</span><br><span class="line"></span><br><span class="line">    part1 = base_path</span><br><span class="line">    part2: <span class="built_in">str</span> = <span class="string">"documents"</span></span><br><span class="line">    part3: <span class="built_in">str</span> = <span class="string">"report_final.docx"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 / 操作符拼接</span></span><br><span class="line">    joined_path1 = Path = part1 / part2 / part3</span><br><span class="line">    print_info(<span class="string">f"使用 / 操作符拼接: <span class="subst">{joined_path1}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 joinPath () 方法拼接</span></span><br><span class="line">    joined_path2 = part1.joinpath(part2, part3)</span><br><span class="line">    print_info(<span class="string">f"使用 joinPath () 方法拼接: <span class="subst">{joined_path2}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取绝对路径</span></span><br><span class="line">    <span class="comment">#  前面我们创建了 base_path / "readme.md" 所以他应该是存在的</span></span><br><span class="line">    readme_path: Path = base_path / <span class="string">"readme.md"</span></span><br><span class="line">    <span class="keyword">if</span> readme_path.exists():</span><br><span class="line">        print_info(<span class="string">f"  'readme.md' 的相对路径: <span class="subst">{readme_path}</span>"</span>)</span><br><span class="line">        print_info(<span class="string">f"  'readme.md' 的绝对路径 (absolute()): <span class="subst">{readme_path.absolute()}</span>"</span>)</span><br><span class="line">        print_info(<span class="string">f"  'readme.md' 的解析后绝对路径 (resolve()): <span class="subst">{readme_path.resolve()}</span>"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_warning(<span class="string">f" 'readme.md' 不存在，无法进行绝对路径解析。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line"><span class="string">r"""</span></span><br><span class="line"><span class="string"> INFO: 使用 / 操作符拼接: D:\python\PythonStudy\pathlib_demo_space\documents\report_final.docx</span></span><br><span class="line"><span class="string"> INFO: 使用 joinPath () 方法拼接: D:\python\PythonStudy\pathlib_demo_space\documents\report_final.docx</span></span><br><span class="line"><span class="string"> INFO:   'readme.md' 的相对路径: D:\python\PythonStudy\pathlib_demo_space\readme.md</span></span><br><span class="line"><span class="string"> INFO:   'readme.md' 的绝对路径 (absolute()): D:\python\PythonStudy\pathlib_demo_space\readme.md</span></span><br><span class="line"><span class="string"> INFO:   'readme.md' 的解析后绝对路径 (resolve()): D:\python\PythonStudy\pathlib_demo_space\readme.md</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 检查路径类型和状态</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_path_type_checks</span>(<span class="params">base_path: Path</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示检查路径的类型和状态。"""</span></span><br><span class="line">    print_subheader(<span class="string">"3. 检查路径类型和状态"</span>)</span><br><span class="line"></span><br><span class="line">    file_p: Path = base_path / <span class="string">"readme.md"</span></span><br><span class="line">    dir_p: Path = base_path / <span class="string">"documents"</span></span><br><span class="line">    non_existent_p: Path = base_path / <span class="string">"non_existent_file.tmp"</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f"路径 '<span class="subst">{file_p.name}</span>':"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  - 是否存在 (exists()): <span class="subst">{file_p.exists()}</span>"</span>)  <span class="comment"># True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  - 是否是文件 (is_file()): <span class="subst">{file_p.is_file()}</span>"</span>)  <span class="comment"># True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  - 是否是目录 (is_dir()): <span class="subst">{file_p.is_dir()}</span>"</span>)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f"路径 '<span class="subst">{dir_p.name}</span>':"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  - 是否存在 (exists()): <span class="subst">{dir_p.exists()}</span>"</span>)  <span class="comment"># True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  - 是否是文件 (is_file()): <span class="subst">{dir_p.is_file()}</span>"</span>)  <span class="comment"># False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  - 是否是目录 (is_dir()): <span class="subst">{dir_p.is_dir()}</span>"</span>)  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f"路径 '<span class="subst">{non_existent_p.name}</span>':"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  - 是否存在 (exists()): <span class="subst">{non_existent_p.exists()}</span>"</span>)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 文件和目录操作</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_file_directory_operations</span>(<span class="params">base_path: Path</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示文件的创建、读写和目录的创建、遍历。"""</span></span><br><span class="line">    print_subheader(<span class="string">"4. 文件和目录操作"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建新目录</span></span><br><span class="line">    new_sub_dir: Path = base_path / <span class="string">"new_app_data"</span> / <span class="string">"config"</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># parents=True: 如果父目录不存在，则一并创建</span></span><br><span class="line">        <span class="comment"># exist_ok=True: 如果目录已存在，不抛出错误</span></span><br><span class="line">        new_sub_dir.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">        print_success(<span class="string">f"  目录 '<span class="subst">{new_sub_dir}</span>' 已创建 (或已存在)。"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 在新目录中创建并写入文件</span></span><br><span class="line">        config_file: Path = new_sub_dir / <span class="string">"settings.json"</span></span><br><span class="line">        sample_json_data: <span class="built_in">str</span> = <span class="string">'{"theme": "dark", "version": "1.0"}'</span></span><br><span class="line">        config_file.write_text(sample_json_data, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        print_success(<span class="string">f"  文件 '<span class="subst">{config_file.name}</span>' 已创建并写入内容。"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 读取文件内容</span></span><br><span class="line">        read_data: <span class="built_in">str</span> = config_file.read_text(encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        print_info(<span class="string">f"  从 '<span class="subst">{config_file.name}</span>' 读取的内容: <span class="subst">{read_data}</span>"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 重命名文件</span></span><br><span class="line">        renamed_config_file: Path = new_sub_dir / <span class="string">"settings_v2.json"</span></span><br><span class="line">        config_file.rename(renamed_config_file)</span><br><span class="line">        print_success(<span class="string">f"  文件已重命名为: '<span class="subst">{renamed_config_file.name}</span>'"</span>)</span><br><span class="line">        print_info(<span class="string">f"  旧路径 '<span class="subst">{config_file}</span>' 是否还存在: <span class="subst">{config_file.exists()}</span>"</span>)  <span class="comment"># False</span></span><br><span class="line">        print_info(<span class="string">f"  新路径 '<span class="subst">{renamed_config_file}</span>' 是否存在: <span class="subst">{renamed_config_file.exists()}</span>"</span>)  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 删除文件</span></span><br><span class="line">        renamed_config_file.unlink(missing_ok=<span class="literal">True</span>)  <span class="comment"># missing_ok=True: 如果文件不存在不报错</span></span><br><span class="line">        print_warning(<span class="string">f"  文件 '<span class="subst">{renamed_config_file.name}</span>' 已删除。"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 删除空目录</span></span><br><span class="line">        <span class="keyword">if</span> new_sub_dir.is_dir(): new_sub_dir.rmdir()  <span class="comment"># 只能删除空目录</span></span><br><span class="line">        print_warning(<span class="string">f"  空目录 '<span class="subst">{new_sub_dir}</span>' 已删除。"</span>)</span><br><span class="line">        <span class="comment"># 如果要删除包含父目录的整个空结构，需要逐级删除或使用 shutil.rmtree 建议直接使用 shutil.rmtree</span></span><br><span class="line">        <span class="keyword">if</span> new_sub_dir.parent.is_dir() <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">list</span>(new_sub_dir.parent.iterdir()):</span><br><span class="line">            new_sub_dir.parent.rmdir()</span><br><span class="line">            print_warning(<span class="string">f"  空目录 '<span class="subst">{new_sub_dir.parent}</span>' 已删除。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"  文件/目录操作时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 5. 目录遍历与文件搜索 (glob, rglob, iterdir)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_directory_iteration</span>(<span class="params">base_path: Path</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示遍历目录内容和使用 glob 搜索文件。"""</span></span><br><span class="line">    print_subheader(<span class="string">"5. 目录遍历与文件搜索"</span>)</span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f"遍历 '<span class="subst">{base_path / <span class="string">'documents'</span>}</span>' 目录 (iterdir()):"</span>)</span><br><span class="line">    docs_dir: Path = base_path / <span class="string">"documents"</span></span><br><span class="line">    <span class="keyword">if</span> docs_dir.is_dir():</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> docs_dir.iterdir():  <span class="comment"># 只遍历当前目录下的内容</span></span><br><span class="line">            item_type = <span class="string">"[目录]"</span> <span class="keyword">if</span> item.is_dir() <span class="keyword">else</span> <span class="string">"[文件]"</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f" <span class="subst">{item_type}</span> <span class="subst">{item.name}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用 glob 搜索当前目录下的 .txt 文件</span></span><br><span class="line">    print_info(<span class="string">f"\n在 '<span class="subst">{base_path / <span class="string">'documents'</span>}</span>' 目录下搜索所有 .txt 文件 (glob('*.txt')):"</span>)</span><br><span class="line">    <span class="keyword">for</span> txt_file <span class="keyword">in</span> docs_dir.glob(<span class="string">"*.txt"</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"  [文件] <span class="subst">{txt_file.name}</span>"</span>) <span class="comment">#  这里按照道理来说他只能访问到level的目录，他的里面是下一级的子目录，所以是没有文件的</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用 rglob 递归搜索所有子目录中的 .txt 文件</span></span><br><span class="line">    print_info(<span class="string">f"\n在 '<span class="subst">{base_path / <span class="string">'documents'</span>}</span>' 及其所有子目录下搜索 .txt 文件 (rglob('*.txt')):"</span>)</span><br><span class="line">    <span class="keyword">for</span> txt_file <span class="keyword">in</span> docs_dir.rglob(<span class="string">"*.txt"</span>): <span class="comment"># 而 rglob 可以递归搜索所有子目录中的文件</span></span><br><span class="line">        <span class="comment"># 显示相对于 docs_dir 的路径</span></span><br><span class="line">        rel_path = txt_file.relative_to(docs_dir)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"  [文件] <span class="subst">{rel_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 准备演示环境</span></span><br><span class="line">    setup_demo_environment(DEMO_ROOT_PATH)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清理演示环境</span></span><br><span class="line">    <span class="comment"># cleanup_demo_environment(DEMO_ROOT_PATH)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示Pathlib的所有操作属性</span></span><br><span class="line">    <span class="comment"># demo_path_creation_and_attributes(DEMO_ROOT_PATH)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示路径拼接与解析</span></span><br><span class="line">    <span class="comment"># demo_path_joining_and_resolution(DEMO_ROOT_PATH)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示检查路径的类型和状态</span></span><br><span class="line">    <span class="comment"># demo_path_type_checks(DEMO_ROOT_PATH)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示文件和目录操作</span></span><br><span class="line">    <span class="comment"># demo_file_directory_operations(DEMO_ROOT_PATH)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示目录遍历与文件搜索</span></span><br><span class="line">    demo_directory_iteration(DEMO_ROOT_PATH)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h5 id="pathlib-模块开箱即用场景"><a href="#pathlib-模块开箱即用场景" class="headerlink" title="pathlib 模块开箱即用场景"></a><code>pathlib</code> 模块开箱即用场景</h5><h6 id="a-递归查找指定类型的文件并处理"><a href="#a-递归查找指定类型的文件并处理" class="headerlink" title="a. 递归查找指定类型的文件并处理"></a>a. 递归查找指定类型的文件并处理</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, Generator <span class="comment"># 用于类型注解</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_files_by_extension</span>(<span class="params">directory: Path, extension: <span class="built_in">str</span></span>) -&gt; Generator[Path, <span class="literal">None</span>, <span class="literal">None</span>]:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    递归查找指定目录下具有特定扩展名的所有文件。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">        directory (Path): 要搜索的根目录。</span></span><br><span class="line"><span class="string">        extension (str): 文件扩展名 (例如: ".txt", ".jpg")，注意包含点。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">        Generator[Path, None, None]: 一个生成器，逐个产生找到的文件路径对象。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_info(<span class="string">f"在目录 '<span class="subst">{directory}</span>' 中递归查找所有 '<span class="subst">{extension}</span>' 文件..."</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> directory.is_dir():</span><br><span class="line">        print_error(<span class="string">f"错误: '<span class="subst">{directory}</span>' 不是一个有效的目录。"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># Path.rglob() 返回一个生成器</span></span><br><span class="line">    <span class="keyword">for</span> file_path <span class="keyword">in</span> directory.rglob(<span class="string">f"*<span class="subst">{extension}</span>"</span>): <span class="comment"># 例如 "*.txt"</span></span><br><span class="line">        <span class="keyword">if</span> file_path.is_file(): <span class="comment"># 确保是文件，因为 rglob 也可能匹配到带 .txt 后缀的目录名</span></span><br><span class="line">            <span class="keyword">yield</span> file_path</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>: <span class="comment"># 仅在此场景独立运行时执行</span></span><br><span class="line">    <span class="comment"># 创建一些临时文件用于演示 find_files_by_extension</span></span><br><span class="line">    _demo_search_path = Path.cwd() / <span class="string">"pathlib_find_demo"</span></span><br><span class="line">    _demo_search_path.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">    (_demo_search_path / <span class="string">"doc1.txt"</span>).write_text(<span class="string">"text content 1"</span>)</span><br><span class="line">    (_demo_search_path / <span class="string">"image.png"</span>).touch()</span><br><span class="line">    (_demo_search_path / <span class="string">"subfolder"</span>).mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">    (_demo_search_path / <span class="string">"subfolder"</span> / <span class="string">"doc2.txt"</span>).write_text(<span class="string">"text content 2"</span>)</span><br><span class="line">    (_demo_search_path / <span class="string">"subfolder"</span> / <span class="string">"another.log"</span>).touch()</span><br><span class="line">    (_demo_search_path / <span class="string">"archive.txt.gz"</span>).touch() <span class="comment"># 注意这个后缀是 .gz</span></span><br><span class="line"></span><br><span class="line">    print_header(<span class="string">"find_files_by_extension 函数演示"</span>)</span><br><span class="line">    found_files: <span class="type">List</span>[Path] = <span class="built_in">list</span>(find_files_by_extension(_demo_search_path, <span class="string">".txt"</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found_files:</span><br><span class="line">        print_success(<span class="string">f"找到以下 .txt 文件 (共 <span class="subst">{<span class="built_in">len</span>(found_files)}</span> 个):"</span>)</span><br><span class="line">        <span class="keyword">for</span> f_path <span class="keyword">in</span> found_files:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"  - <span class="subst">{f_path}</span>"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_warning(<span class="string">"未找到任何 .txt 文件。"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 清理</span></span><br><span class="line">    <span class="keyword">import</span> shutil</span><br><span class="line">    <span class="keyword">if</span> _demo_search_path.exists():</span><br><span class="line">        shutil.rmtree(_demo_search_path)</span><br><span class="line">        print_info(<span class="string">f"已清理演示目录: <span class="subst">{_demo_search_path}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h6 id="b-安全地创建多级目录结构"><a href="#b-安全地创建多级目录结构" class="headerlink" title="b. 安全地创建多级目录结构"></a>b. 安全地创建多级目录结构</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span> <span class="comment"># 用于类型注解</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ensure_directory_exists</span>(<span class="params">dir_path: <span class="type">Union</span>[<span class="built_in">str</span>, Path]</span>) -&gt; Path:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    确保指定的目录路径存在，如果不存在则创建它 (包括所有必需的父目录)。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">        dir_path (Union[str, Path]): 要确保存在的目录路径 (可以是字符串或Path对象)。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">        Path: 对应的Path对象。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    引发:</span></span><br><span class="line"><span class="string">        OSError: 如果路径存在但不是一个目录，或者创建失败且非权限问题。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    path_obj = Path(dir_path)</span><br><span class="line">    print_info(<span class="string">f"检查并确保目录 '<span class="subst">{path_obj}</span>' 存在..."</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        path_obj.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># parents=True: 如果父目录不存在，一并创建。</span></span><br><span class="line">        <span class="comment"># exist_ok=True: 如果目录已存在，不引发 FileExistsError。</span></span><br><span class="line">        print_success(<span class="string">f"目录 '<span class="subst">{path_obj}</span>' 现在已存在。"</span>)</span><br><span class="line">        <span class="keyword">return</span> path_obj</span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> e: <span class="comment"># 更广泛地捕获可能的OS错误，如权限问题</span></span><br><span class="line">        print_error(<span class="string">f"创建目录 '<span class="subst">{path_obj}</span>' 时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line">        <span class="keyword">raise</span> <span class="comment"># 将异常重新抛出，让调用者处理</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>: <span class="comment"># 仅在此场景独立运行时执行</span></span><br><span class="line">    print_header(<span class="string">"ensure_directory_exists 函数演示"</span>)</span><br><span class="line">    </span><br><span class="line">    new_data_path_str = <span class="string">"project_alpha/raw_data/year_2025"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 演示使用字符串路径</span></span><br><span class="line">    created_path_obj: Path = ensure_directory_exists(new_data_path_str)</span><br><span class="line">    print_info(<span class="string">f"返回的 Path 对象: <span class="subst">{created_path_obj}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  该路径是否是目录: <span class="subst">{created_path_obj.is_dir()}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示使用已存在的路径 (应该不会报错)</span></span><br><span class="line">    ensure_directory_exists(created_path_obj)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 清理 (如果需要)</span></span><br><span class="line">    <span class="keyword">import</span> shutil</span><br><span class="line">    <span class="comment"># 要删除 project_alpha，需要先删除其父目录 (如果它是唯一的)</span></span><br><span class="line">    <span class="comment"># 或者直接删除 project_alpha (如果它是顶层创建的)</span></span><br><span class="line">    top_level_created_dir = Path(<span class="string">"project_alpha"</span>)</span><br><span class="line">    <span class="keyword">if</span> top_level_created_dir.exists():</span><br><span class="line">        shutil.rmtree(top_level_created_dir)</span><br><span class="line">        print_info(<span class="string">f"已清理演示目录: <span class="subst">{top_level_created_dir}</span>"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>pathlib</code> 模块)</strong>:</p><ul><li><strong>面向对象思维转变</strong>: 如果你习惯了 <code>os.path</code> 中基于字符串的函数式调用 (例如 <code>os.path.join(path, name)</code>), 切换到 <code>pathlib</code> 的面向对象方式 (例如 <code>Path(path) / name</code>) 可能需要一点时间适应，但适应后通常会觉得更自然和强大。</li><li><strong>性能考虑</strong>: 在绝大多数应用场景下，<code>pathlib</code> 的性能与 <code>os.path</code> 相当，甚至在某些情况下由于内部优化可能更快。只有在对路径操作进行极端密集的循环（例如，每秒处理数百万个路径）时，才可能需要进行性能分析比较。对于日常脚本和大多数应用程序，<code>pathlib</code> 带来的可读性和易用性提升远比微小的性能差异更重要。</li><li><strong>与旧代码的互操作性</strong>: <code>Path</code> 对象实现了 <code>os.PathLike</code> 接口，这意味着在很多接受字符串路径作为参数的内置函数和标准库函数中（包括 <code>open()</code>, <code>os.chdir()</code>, <code>shutil</code> 的很多函数等），你可以直接传递 <code>Path</code> 对象，Python 会自动将其转换为字符串路径。这使得逐步迁移到 <code>pathlib</code> 或在现有代码中引入它变得容易。</li><li><strong>绝对路径 vs. 相对路径</strong>: 要清楚你的 <code>Path</code> 对象代表的是绝对路径还是相对路径。<code>resolve()</code> 方法可以获取一个路径的绝对、规范化形式，并解析所有符号链接。<code>absolute()</code> 则简单地将相对路径转换为绝对路径，但不解析符号链接。</li><li><strong>文件系统操作的原子性</strong>: 像 <code>Path.rename()</code> 或 <code>Path.replace()</code> 这样的操作，其原子性（即操作要么完全成功，要么完全不执行，不会留下中间状态）取决于底层操作系统和文件系统的支持。</li><li><strong>异常处理</strong>: 所有执行实际文件系统I/O操作（如创建、删除、读写文件/目录）的 <code>pathlib</code> 方法都可能引发 <code>OSError</code> 的各种子类异常 (如 <code>FileNotFoundError</code>, <code>PermissionError</code>, <code>FileExistsError</code>)。务必使用 <code>try-except</code> 块来妥善处理这些潜在的错误。</li></ul></blockquote><p><code>pathlib</code> 提供了一种更现代、更 Pythonic 的方式来与文件系统路径交互。一旦熟悉了它的面向对象特性，很多路径相关的编程任务都会变得更加简单和愉快。</p><h4 id="zipfile-模块：处理-ZIP-压缩文件"><a href="#zipfile-模块：处理-ZIP-压缩文件" class="headerlink" title="zipfile 模块：处理 ZIP 压缩文件"></a><code>zipfile</code> 模块：处理 ZIP 压缩文件</h4><p><code>zipfile</code> 模块用于创建、读取、写入、追加和列出 ZIP 文件的内容。通常与 <code>with</code> 语句一起使用以确保文件正确关闭。</p><h5 id="zipfile-常用功能-基于-ZipFile-对象"><a href="#zipfile-常用功能-基于-ZipFile-对象" class="headerlink" title="zipfile 常用功能 (基于 ZipFile 对象)"></a><code>zipfile</code> 常用功能 (基于 <code>ZipFile</code> 对象)</h5><table><thead><tr><th>方法/属性</th><th>描述</th></tr></thead><tbody><tr><td><code>ZipFile(file, mode='r', ...)</code></td><td>打开或创建一个 ZIP 文件 (<code>mode</code>: ‘r’读, ‘w’写, ‘a’追加)。</td></tr><tr><td><code>zf.namelist()</code></td><td>返回 ZIP 文件中所有成员的名称列表。</td></tr><tr><td><code>zf.infolist()</code></td><td>返回 ZIP 文件中所有成员的 <code>ZipInfo</code> 对象列表 (包含详细信息)。</td></tr><tr><td><code>zf.getinfo(name)</code></td><td>获取指定成员 <code>name</code> 的 <code>ZipInfo</code> 对象。</td></tr><tr><td><code>zf.extract(member, path=None)</code></td><td>从 ZIP 文件中提取单个成员 <code>member</code> 到指定路径 <code>path</code>。</td></tr><tr><td><code>zf.extractall(path=None, ...)</code></td><td>从 ZIP 文件中提取所有成员到指定路径 <code>path</code>。</td></tr><tr><td><code>zf.write(filename, arcname=None)</code></td><td>将文件 <code>filename</code> 写入 ZIP 文件，可选的 <code>arcname</code> 是在压缩包中的名称。</td></tr><tr><td><code>zf.read(name)</code></td><td>读取 ZIP 文件中成员 <code>name</code> 的内容并返回字节串。</td></tr><tr><td><code>zf.close()</code></td><td>关闭 ZIP 文件 (推荐使用 <code>with</code> 语句自动管理)。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>zipfile</code> 模块)</strong></p><ul><li>使用 <code>with zipfile.ZipFile(...) as zf:</code> 打开文件。</li><li><code>zf.write()</code>: 向压缩包中添加文件。</li><li><code>zf.extractall()</code>: 解压整个压缩包。</li><li><code>zf.namelist()</code>: 查看压缩包内容。</li></ul></blockquote><h5 id="zipfile-模块代码示例"><a href="#zipfile-模块代码示例" class="headerlink" title="zipfile 模块代码示例"></a><code>zipfile</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 准备测试文件 ---</span></span><br><span class="line">zip_test_dir = <span class="string">"zip_test_files"</span></span><br><span class="line">os.makedirs(zip_test_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">file1_path = os.path.join(zip_test_dir, <span class="string">"doc1.txt"</span>)</span><br><span class="line">file2_path = os.path.join(zip_test_dir, <span class="string">"image.jpg"</span>) <span class="comment"># 模拟文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file1_path, <span class="string">"w"</span>) <span class="keyword">as</span> f: f.write(<span class="string">"This is document one."</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file2_path, <span class="string">"w"</span>) <span class="keyword">as</span> f: f.write(<span class="string">"Fake image data."</span>)</span><br><span class="line"></span><br><span class="line">zip_filename = <span class="string">"my_documents.zip"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建 ZIP 文件并添加文件</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"创建 ZIP 文件: <span class="subst">{zip_filename}</span>"</span>)</span><br><span class="line"><span class="keyword">with</span> zipfile.ZipFile(zip_filename, mode=<span class="string">'w'</span>, compression=zipfile.ZIP_DEFLATED) <span class="keyword">as</span> zf:</span><br><span class="line">    zf.write(file1_path, arcname=<span class="string">"text_files/document1.txt"</span>) <span class="comment"># arcname 指定在zip中的路径和名称</span></span><br><span class="line">    zf.write(file2_path, arcname=<span class="string">"images/photo.jpg"</span>)</span><br><span class="line">    zf.writestr(<span class="string">"manuals/readme.txt"</span>, <span class="string">"This is a readme file created directly in zip."</span>) <span class="comment"># 直接写入字符串内容</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"ZIP 文件创建完成。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 读取 ZIP 文件内容</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"\n读取 ZIP 文件 '<span class="subst">{zip_filename}</span>' 的内容:"</span>)</span><br><span class="line"><span class="keyword">with</span> zipfile.ZipFile(zip_filename, mode=<span class="string">'r'</span>) <span class="keyword">as</span> zf:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"  文件列表 (namelist):"</span>)</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> zf.namelist():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"    - <span class="subst">{name}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n  文件详细信息 (infolist):"</span>)</span><br><span class="line">    <span class="keyword">for</span> zipinfo <span class="keyword">in</span> zf.infolist():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"    - 文件名: <span class="subst">{zipinfo.filename}</span>, 大小: <span class="subst">{zipinfo.file_size}</span> bytes, 修改日期: <span class="subst">{zipinfo.date_time}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取特定文件内容</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        readme_content = zf.read(<span class="string">"manuals/readme.txt"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"\n  'manuals/readme.txt' 的内容: <span class="subst">{readme_content.decode(<span class="string">'utf-8'</span>)}</span>"</span>)</span><br><span class="line">    <span class="keyword">except</span> KeyError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"  'manuals/readme.txt' 未在压缩包中找到。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 解压 ZIP 文件</span></span><br><span class="line">extract_to_dir = <span class="string">"extracted_zip_contents"</span></span><br><span class="line">os.makedirs(extract_to_dir, exist_ok=<span class="literal">True</span>) <span class="comment"># 确保解压目录存在</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"\n解压 ZIP 文件 '<span class="subst">{zip_filename}</span>' 到 '<span class="subst">{extract_to_dir}</span>':"</span>)</span><br><span class="line"><span class="keyword">with</span> zipfile.ZipFile(zip_filename, mode=<span class="string">'r'</span>) <span class="keyword">as</span> zf:</span><br><span class="line">    zf.extractall(path=extract_to_dir)</span><br><span class="line">    <span class="comment"># # 或者只解压特定文件</span></span><br><span class="line">    <span class="comment"># zf.extract("images/photo.jpg", path=os.path.join(extract_to_dir, "specific_image"))</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"ZIP 文件解压完成。查看 '<span class="subst">{extract_to_dir}</span>' 目录。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 清理 ---</span></span><br><span class="line">os.remove(zip_filename)</span><br><span class="line">shutil.rmtree(zip_test_dir)</span><br><span class="line">shutil.rmtree(extract_to_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\nzipfile 测试环境已清理。"</span>)</span><br></pre></td></tr></tbody></table></figure><h4 id="tarfile-模块：处理-TAR-归档文件"><a href="#tarfile-模块：处理-TAR-归档文件" class="headerlink" title="tarfile 模块：处理 TAR 归档文件"></a><code>tarfile</code> 模块：处理 TAR 归档文件</h4><p><code>tarfile</code> 模块用于读取和写入 tar 归档文件，包括使用 gzip, bz2 和 lzma 压缩的 tar 文件。与 <code>zipfile</code> 类似，推荐使用 <code>with</code> 语句。</p><h5 id="tarfile-常用功能-基于-TarFile-对象"><a href="#tarfile-常用功能-基于-TarFile-对象" class="headerlink" title="tarfile 常用功能 (基于 TarFile 对象)"></a><code>tarfile</code> 常用功能 (基于 <code>TarFile</code> 对象)</h5><table><thead><tr><th>方法/属性</th><th>描述 (</th></tr></thead><tbody><tr><td><code>tarfile.open(name, mode='r', ...)</code></td><td>打开或创建一个 TAR 文件 (<code>mode</code>: ‘r’读, ‘w’写, ‘a’追加, ‘r:gz’, ‘w:bz2’等)。</td></tr><tr><td><code>tf.getnames()</code></td><td>返回归档中所有成员的名称列表。</td></tr><tr><td><code>tf.getmembers()</code></td><td>返回归档中所有成员的 <code>TarInfo</code> 对象列表 (包含详细信息)。</td></tr><tr><td><code>tf.getmember(name)</code></td><td>获取指定成员 <code>name</code> 的 <code>TarInfo</code> 对象。</td></tr><tr><td><code>tf.extract(member, path="", ...)</code></td><td>从归档中提取单个成员 <code>member</code> 到指定路径 <code>path</code>。</td></tr><tr><td><code>tf.extractall(path=".", members=...)</code></td><td>从归档中提取所有 (或指定 <code>members</code>) 到路径 <code>path</code>。</td></tr><tr><td><code>tf.add(name, arcname=None, ...)</code></td><td>将文件或目录 <code>name</code> 添加到归档，可选 <code>arcname</code> 是在归档中的名称。</td></tr><tr><td><code>tf.extractfile(member)</code></td><td>返回一个类似文件的对象，用于读取成员 <code>member</code> 的内容 (不实际解压到磁盘)。</td></tr><tr><td><code>tf.close()</code></td><td>关闭 TAR 文件 (推荐使用 <code>with</code> 语句自动管理)。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>tarfile</code> 模块)</strong></p><ul><li>使用 <code>with tarfile.open(...) as tf:</code> 打开文件，注意 <code>mode</code> (如 ‘w:gz’ 创建gz压缩包)。</li><li><code>tf.add()</code>: 向归档中添加文件或目录。</li><li><code>tf.extractall()</code>: 解压整个归档。</li><li><code>tf.getnames()</code>: 查看归档内容。</li></ul></blockquote><h5 id="tarfile-模块代码示例"><a href="#tarfile-模块代码示例" class="headerlink" title="tarfile 模块代码示例"></a><code>tarfile</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil <span class="comment"># 用于清理</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 准备测试文件 ---</span></span><br><span class="line">tar_test_dir = <span class="string">"tar_test_files"</span></span><br><span class="line">os.makedirs(tar_test_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">os.makedirs(os.path.join(tar_test_dir, <span class="string">"subdir"</span>), exist_ok=<span class="literal">True</span>) <span class="comment"># 创建子目录</span></span><br><span class="line"></span><br><span class="line">file_content1 = <span class="string">"Content for tar file 1."</span></span><br><span class="line">file_content2 = <span class="string">"Content for tar file 2, in a subdirectory."</span></span><br><span class="line">path_file1 = os.path.join(tar_test_dir, <span class="string">"data.txt"</span>)</span><br><span class="line">path_file2 = os.path.join(tar_test_dir, <span class="string">"subdir"</span>, <span class="string">"notes.log"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path_file1, <span class="string">"w"</span>) <span class="keyword">as</span> f: f.write(file_content1)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path_file2, <span class="string">"w"</span>) <span class="keyword">as</span> f: f.write(file_content2)</span><br><span class="line"></span><br><span class="line">tar_gz_filename = <span class="string">"my_archive.tar.gz"</span> <span class="comment"># 创建 .tar.gz 格式的压缩包</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建 TAR 归档文件 (例如 .tar.gz)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"创建 TAR.GZ 文件: <span class="subst">{tar_gz_filename}</span>"</span>)</span><br><span class="line"><span class="comment"># mode 'w:gz' 表示以 gzip 压缩方式写入</span></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(tar_gz_filename, mode=<span class="string">'w:gz'</span>) <span class="keyword">as</span> tf:</span><br><span class="line">    tf.add(tar_test_dir, arcname=<span class="string">"archive_root"</span>) <span class="comment"># 添加整个目录，arcname指定其在压缩包内的根名称</span></span><br><span class="line">    <span class="comment"># # 或者分别添加文件</span></span><br><span class="line">    <span class="comment"># tf.add(path_file1, arcname="text_files/data_document.txt")</span></span><br><span class="line">    <span class="comment"># tf.add(path_file2, arcname="logs/important_notes.log")</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"TAR.GZ 文件创建完成。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 读取 TAR 归档文件内容</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"\n读取 TAR 文件 '<span class="subst">{tar_gz_filename}</span>' 的内容:"</span>)</span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(tar_gz_filename, mode=<span class="string">'r:gz'</span>) <span class="keyword">as</span> tf: <span class="comment"># 'r:gz' 表示以 gzip 方式读取</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"  文件列表 (getnames):"</span>)</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> tf.getnames():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"    - <span class="subst">{name}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n  文件详细信息 (getmembers):"</span>)</span><br><span class="line">    <span class="keyword">for</span> tarinfo <span class="keyword">in</span> tf.getmembers():</span><br><span class="line">        type_str = <span class="string">"DIR"</span> <span class="keyword">if</span> tarinfo.isdir() <span class="keyword">else</span> (<span class="string">"FILE"</span> <span class="keyword">if</span> tarinfo.isfile() <span class="keyword">else</span> <span class="string">"OTHER"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"    - 名称: <span class="subst">{tarinfo.name}</span>, 类型: <span class="subst">{type_str}</span>, 大小: <span class="subst">{tarinfo.size}</span>, 修改时间: <span class="subst">{tarinfo.mtime}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取特定文件内容 (不解压到磁盘)</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        member_to_read = <span class="string">"archive_root/subdir/notes.log"</span> <span class="comment"># 假设这是压缩包内的路径</span></span><br><span class="line">        <span class="keyword">if</span> member_to_read <span class="keyword">in</span> tf.getnames():</span><br><span class="line">            extracted_file_obj = tf.extractfile(member_to_read)</span><br><span class="line">            <span class="keyword">if</span> extracted_file_obj:</span><br><span class="line">                content_bytes = extracted_file_obj.read()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"\n  '<span class="subst">{member_to_read}</span>' 的内容: <span class="subst">{content_bytes.decode(<span class="string">'utf-8'</span>)}</span>"</span>)</span><br><span class="line">                extracted_file_obj.close()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"  文件 '<span class="subst">{member_to_read}</span>' 在归档中未找到。"</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">except</span> KeyError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"  读取归档成员时出错: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 解压 TAR 归档文件</span></span><br><span class="line">extract_tar_to_dir = <span class="string">"extracted_tar_contents"</span></span><br><span class="line">os.makedirs(extract_tar_to_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"\n解压 TAR 文件 '<span class="subst">{tar_gz_filename}</span>' 到 '<span class="subst">{extract_tar_to_dir}</span>':"</span>)</span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(tar_gz_filename, mode=<span class="string">'r:gz'</span>) <span class="keyword">as</span> tf:</span><br><span class="line">    tf.extractall(path=extract_tar_to_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"TAR 文件解压完成。查看 '<span class="subst">{extract_tar_to_dir}</span>' 目录。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 清理 ---</span></span><br><span class="line">os.remove(tar_gz_filename)</span><br><span class="line">shutil.rmtree(tar_test_dir)</span><br><span class="line">shutil.rmtree(extract_tar_to_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\ntarfile 测试环境已清理。"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="4-系统交互与进程管理模块"><a href="#4-系统交互与进程管理模块" class="headerlink" title="4.系统交互与进程管理模块"></a>4.系统交互与进程管理模块</h3><p>在 Python 开发中，与程序运行的底层环境（如操作系统、解释器本身）进行交互，以及启动和管理外部的子进程，是非常常见的需求。<code>sys</code>、<code>argparse</code> 和 <code>subprocess</code> 这三个标准库模块为此提供了强大的支持。</p><h4 id="sys-模块：与-Python-解释器深度交互"><a href="#sys-模块：与-Python-解释器深度交互" class="headerlink" title="sys 模块：与 Python 解释器深度交互"></a><code>sys</code> 模块：与 Python 解释器深度交互</h4><p><code>sys</code> 模块提供了访问和操作 Python 解释器本身以及其运行时环境的变量和函数。通过它，我们可以获取命令行参数、管理模块搜索路径、控制程序退出、了解当前平台信息等。</p><h5 id="sys-模块常用属性和函数"><a href="#sys-模块常用属性和函数" class="headerlink" title="sys 模块常用属性和函数"></a><code>sys</code> 模块常用属性和函数</h5><table><thead><tr><th>属性/方法</th><th>描述</th></tr></thead><tbody><tr><td><code>sys.argv</code></td><td>获取脚本启动时传入的命令行参数列表 (第一个是脚本名)。</td></tr><tr><td><code>sys.exit([status])</code></td><td>用来终止当前 Python 程序的执行，可以指定一个退出状态码。</td></tr><tr><td><code>sys.path</code></td><td>一个列表，指明了 Python 导入模块时会去哪些目录下查找。</td></tr><tr><td><code>sys.platform</code></td><td>返回一个字符串，告诉你当前运行 Python 的操作系统平台是什么。</td></tr><tr><td><code>sys.version</code></td><td>获取当前 Python 解释器的详细版本信息字符串。</td></tr><tr><td><code>sys.version_info</code></td><td>以元组形式提供 Python 版本号的各部分 (主版本、次版本等)。</td></tr><tr><td><code>sys.executable</code></td><td>获取当前正在运行的 Python 解释器程序文件的绝对路径。</td></tr><tr><td><code>sys.stdin</code></td><td>代表标准输入流的对象，程序可以从中读取数据 (通常来自键盘)。</td></tr><tr><td><code>sys.stdout</code></td><td>代表标准输出流的对象，<code>print()</code> 函数默认向这里输出 (通常是屏幕)。</td></tr><tr><td><code>sys.stderr</code></td><td>代表标准错误流的对象，用于输出错误和警告信息 (通常是屏幕)。</td></tr><tr><td><code>sys.getrecursionlimit()</code></td><td>查询 Python 解释器允许的最大递归调用层数。</td></tr><tr><td><code>sys.setrecursionlimit(limit)</code></td><td>修改 Python 解释器允许的最大递归调用层数。</td></tr><tr><td><code>sys.modules</code></td><td>一个字典，记录了当前已加载的所有模块及其对象。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>sys</code> 模块)</strong></p><ul><li><code>sys.argv</code>: 开发命令行工具时，获取用户输入参数的起点。</li><li><code>sys.exit()</code>: 控制脚本的退出行为和状态。</li><li><code>sys.path</code>: 理解 Python 如何找到模块，偶尔需要动态修改它。</li><li><code>sys.platform</code>, <code>sys.version_info</code>: 编写跨平台或版本兼容代码时的判断依据。</li><li><code>sys.stdin</code>, <code>sys.stdout</code>, <code>sys.stderr</code>: 对于需要精细控制输入输出的脚本很有用。</li></ul></blockquote><h5 id="sys-模块代码示例"><a href="#sys-模块代码示例" class="headerlink" title="sys 模块代码示例"></a><code>sys</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># 用于路径操作示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. 模块说明与准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"sys 模块功能演示"</span>)</span><br><span class="line">print_info(<span class="string">"以下示例展示 sys 模块的常用功能。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 命令行参数 (sys.argv)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 命令行参数 (sys.argv)"</span>)</span><br><span class="line"><span class="comment"># 假设脚本运行时命令为: python your_script.py first_arg 123 --enable-feature</span></span><br><span class="line">print_info(<span class="string">f"脚本本身的名称 (sys.argv[0]): <span class="subst">{sys.argv[<span class="number">0</span>]}</span>"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &gt; <span class="number">1</span>:</span><br><span class="line">    print_info(<span class="string">f"所有命令行参数 (sys.argv): <span class="subst">{sys.argv}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"第一个传递的参数 (sys.argv[1]): <span class="subst">{sys.argv[<span class="number">1</span>]}</span>"</span>)</span><br><span class="line">    <span class="comment"># 真实场景中，参数解析通常会交给 argparse 模块</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_warning(<span class="string">"未提供额外的命令行参数给脚本。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. Python 版本和平台信息</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. Python 版本和平台信息"</span>)</span><br><span class="line">print_info(<span class="string">f"Python 完整版本字符串 (sys.version):\n<span class="subst">{sys.version}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"Python 版本信息元组 (sys.version_info): <span class="subst">{sys.version_info}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  主版本号 (major): <span class="subst">{sys.version_info.major}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  次版本号 (minor): <span class="subst">{sys.version_info.minor}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  修订版本号 (micro): <span class="subst">{sys.version_info.micro}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"当前操作系统平台 (sys.platform): <span class="subst">{sys.platform}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"Python 解释器可执行文件路径 (sys.executable):\n  <span class="subst">{sys.executable}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 模块搜索路径 (sys.path)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. 模块搜索路径 (sys.path)"</span>)</span><br><span class="line">print_info(<span class="string">"Python 解释器查找模块时会依次检查以下路径 (仅显示前5条):"</span>)</span><br><span class="line"><span class="keyword">for</span> i, search_path <span class="keyword">in</span> <span class="built_in">enumerate</span>(sys.path[:<span class="number">5</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  路径 <span class="subst">{i}</span>: <span class="subst">{search_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例: 动态添加一个自定义模块目录到 sys.path</span></span><br><span class="line"><span class="comment"># 假设在脚本同级目录下有一个名为 'my_custom_libs' 的文件夹</span></span><br><span class="line">custom_lib_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), <span class="string">'my_custom_libs'</span>)</span><br><span class="line"><span class="keyword">if</span> custom_lib_path <span class="keyword">not</span> <span class="keyword">in</span> sys.path:</span><br><span class="line">    sys.path.insert(<span class="number">0</span>, custom_lib_path) <span class="comment"># 插入到最前面，优先搜索</span></span><br><span class="line">    print_success(<span class="string">f"已将 '<span class="subst">{custom_lib_path}</span>' 添加到 sys.path。现在可以尝试导入该目录下的模块。"</span>)</span><br><span class="line">    <span class="comment"># 之后若要移除: sys.path.pop(0) 或者 sys.path.remove(custom_lib_path)</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_info(<span class="string">f"路径 '<span class="subst">{custom_lib_path}</span>' 已存在于 sys.path 中。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 标准输入、输出、错误流 (sys.stdin, sys.stdout, sys.stderr)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"4. 标准输入、输出、错误流"</span>)</span><br><span class="line">sys.stdout.write(<span class="string">f"<span class="subst">{Colors.GREEN}</span>  ✔ 这是一条通过 sys.stdout.write 输出的成功消息。<span class="subst">{Colors.END}</span>\n"</span>)</span><br><span class="line">sys.stderr.write(<span class="string">f"<span class="subst">{Colors.FAIL}</span>  ❌ 这是一条通过 sys.stderr.write 输出的错误消息。<span class="subst">{Colors.END}</span>\n"</span>)</span><br><span class="line"><span class="comment"># print_info("尝试从 sys.stdin 读取一行 (程序会在此等待输入):")</span></span><br><span class="line"><span class="comment"># try:</span></span><br><span class="line"><span class="comment">#     user_input = sys.stdin.readline().strip()</span></span><br><span class="line"><span class="comment">#     print_success(f"从 stdin 读取到: '{user_input}'")</span></span><br><span class="line"><span class="comment"># except KeyboardInterrupt:</span></span><br><span class="line"><span class="comment">#     print_warning("用户中断了输入。")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 5. 递归深度限制</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"5. 递归深度限制"</span>)</span><br><span class="line">current_recursion_limit = sys.getrecursionlimit()</span><br><span class="line">print_info(<span class="string">f"当前的递归深度限制是: <span class="subst">{current_recursion_limit}</span>"</span>)</span><br><span class="line"><span class="comment"># 谨慎修改递归限制，过高可能导致栈溢出使程序崩溃</span></span><br><span class="line"><span class="comment"># sys.setrecursionlimit(current_recursion_limit + 100)</span></span><br><span class="line"><span class="comment"># print_info(f"修改后的递归深度限制是: {sys.getrecursionlimit()}")</span></span><br><span class="line"><span class="comment"># sys.setrecursionlimit(current_recursion_limit) # 恢复原状</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 6. 程序退出 (sys.exit)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"6. 程序退出 (sys.exit)"</span>)</span><br><span class="line">print_warning(<span class="string">"以下 sys.exit() 调用将被注释掉，以允许脚本继续执行。"</span>)</span><br><span class="line"><span class="comment"># try:</span></span><br><span class="line"><span class="comment">#     print_info("准备通过 sys.exit(0) 正常退出程序...")</span></span><br><span class="line"><span class="comment">#     sys.exit(0) # 0 通常表示成功</span></span><br><span class="line"><span class="comment">#     print_error("这行代码不应被执行，因为 sys.exit() 会引发 SystemExit。")</span></span><br><span class="line"><span class="comment"># except SystemExit as e:</span></span><br><span class="line"><span class="comment">#     # SystemExit 默认不会被普通 except Exception 捕获</span></span><br><span class="line"><span class="comment">#     print_success(f"程序已通过 SystemExit 退出，退出码: {e.code}")</span></span><br><span class="line"><span class="comment">#     # 如果在这里不重新引发或再次调用 sys.exit，程序实际上可能不会完全终止（取决于上下文）</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">"sys 模块演示结束。"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>sys</code> 模块)</strong>:</p><ul><li><strong><code>sys.argv</code> 的手动解析</strong>: 对于需要多个参数、不同类型参数、可选参数、帮助信息等的命令行工具，手动解析 <code>sys.argv</code> 会变得非常复杂和易错。强烈推荐使用 <code>argparse</code> 模块来处理命令行参数。</li><li><strong><code>sys.path</code> 的修改时机与影响</strong>: 动态修改 <code>sys.path</code> 主要用于临时解决模块导入问题或在特定环境下加载模块。过度依赖动态修改 <code>sys.path</code> 可能导致项目结构混乱和难以维护。优先考虑使用 Python 的包管理机制、虚拟环境 (如 venv, conda) 和设置 <code>PYTHONPATH</code> 环境变量。</li><li><strong><code>sys.exit()</code> 与异常处理</strong>: <code>sys.exit()</code> 通过引发 <code>SystemExit</code> 异常来终止程序。这意味着 <code>try...finally</code> 块中的 <code>finally</code> 子句在程序退出前仍会执行，这对于释放资源（如关闭文件、网络连接）非常重要。捕获 <code>SystemExit</code> 异常通常是不必要的，除非你有非常特殊的理由需要在程序退出前执行一些额外的清理逻辑，并且标准的 <code>finally</code> 块无法满足需求。</li><li><strong>递归深度的修改</strong>: Python 设置递归深度限制是为了防止因无限递归或过深递归耗尽调用栈空间，从而导致程序崩溃。只有在你完全理解递归算法的特性和潜在风险，并且确认需要更大深度时，才应谨慎地使用 <code>sys.setrecursionlimit()</code>。大多数情况下，如果遇到递归深度限制，应首先检查算法是否存在逻辑错误或考虑将其转换为迭代实现。</li><li><strong>标准流的编码</strong>: <code>sys.stdin</code>, <code>sys.stdout</code>, <code>sys.stderr</code> 的默认编码取决于操作系统和环境设置。在处理非 ASCII 字符时，尤其是在跨平台应用中，要注意编码问题，可能需要显式设置流的编码或使用 <code>PYTHONIOENCODING</code> 环境变量。</li></ul></blockquote><h4 id="argparse-模块：强大的命令行参数解析（核心）"><a href="#argparse-模块：强大的命令行参数解析（核心）" class="headerlink" title="argparse 模块：强大的命令行参数解析（核心）"></a><code>argparse</code> 模块：强大的命令行参数解析（核心）</h4><p>当你的 Python 脚本需要从命令行接收参数时，<code>sys.argv</code> 提供了原始的参数列表。但手动解析 <code>sys.argv</code> 会非常繁琐且容易出错，特别是当参数变多、类型各异、或需要可选参数和帮助信息时。这时，<code>argparse</code> 模块就派上了大用场。它使得创建用户友好的命令行界面变得简单。</p><h5 id="argparse-模块核心功能"><a href="#argparse-模块核心功能" class="headerlink" title="argparse 模块核心功能"></a><code>argparse</code> 模块核心功能</h5><table><thead><tr><th>功能/方法</th><th>描述</th></tr></thead><tbody><tr><td><code>argparse.ArgumentParser(...)</code></td><td>创建一个新的参数解析器对象，它是定义和解析参数的起点。</td></tr><tr><td><code>parser.add_argument(name_or_flags, ...)</code></td><td>向解析器添加一个参数定义，指定其名称、类型、行为等。</td></tr><tr><td><code>parser.parse_args([args])</code></td><td>解析命令行传入的参数 (默认来自 <code>sys.argv[1:]</code>)，并返回一个包含参数值的对象。</td></tr><tr><td><code>parser.add_subparsers(...)</code></td><td>添加子命令功能，使你的工具可以像 <code>git &lt;command&gt;</code> 一样拥有多个操作模式。</td></tr><tr><td><strong><code>add_argument()</code> 常用参数:</strong></td><td></td></tr><tr><td><code>name_or_flags</code></td><td>定义参数的名称 (如 <code>'filename'</code>) 或标志 (如 <code>'-f'</code>, <code>'--file'</code>)。</td></tr><tr><td><code>type</code></td><td>指定参数应该被自动转换成的目标类型 (如 <code>int</code>, <code>float</code>, <code>str</code>)。</td></tr><tr><td><code>default</code></td><td>如果用户在命令行中没有提供该参数，则赋予该参数一个默认值。</td></tr><tr><td><code>help</code></td><td>为该参数提供一段简短的描述，会显示在自动生成的帮助信息中。</td></tr><tr><td><code>action</code></td><td>定义当参数出现时应执行的动作 (如 <code>'store_true'</code> 用于布尔开关, <code>'count'</code> 用于计数)。</td></tr><tr><td><code>required=True/False</code></td><td>指明一个可选参数 (<code>--option</code>) 是否必须被用户提供。</td></tr><tr><td><code>choices=[...]</code></td><td>限制参数的值只能从一个给定的选项列表中选择。</td></tr><tr><td><code>nargs</code></td><td>指定该参数可以接受的值的数量 (如 <code>'+'</code> 表示一个或多个)。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>argparse</code> 模块)</strong></p><ul><li><code>ArgumentParser()</code>: 创建解析器的第一步，可以设置程序描述等。</li><li><code>add_argument()</code>: <strong>最核心的方法</strong>，用它来定义你的工具接受哪些位置参数和可选参数，以及它们的行为。</li><li><code>parse_args()</code>: 调用此方法来实际解析 <code>sys.argv</code> 中的参数，并得到一个包含所有参数值的命名空间对象。</li><li>熟悉 <code>add_argument()</code> 的各种选项 (<code>type</code>, <code>default</code>, <code>help</code>, <code>action</code>, <code>nargs</code>, <code>choices</code>) 是用好 <code>argparse</code> 的关键。</li><li><code>add_subparsers()</code>: 当你的命令行工具功能较多，需要划分为不同的子命令时（例如 <code>mytool command1 --optionA</code> 和 <code>mytool command2 --optionB</code>），此功能非常有用。</li></ul></blockquote><h5 id="argparse-模块代码示例"><a href="#argparse-模块代码示例" class="headerlink" title="argparse 模块代码示例"></a><code>argparse</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys  <span class="comment"># 用于 parse_args() 的默认行为和模拟输入</span></span><br><span class="line"><span class="keyword">import</span> os  <span class="comment"># 用于文件操作</span></span><br><span class="line"><span class="keyword">import</span> shutil  <span class="comment"># 用于高级文件操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. argparse 模块演示准备 - 文件操作工具</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_directory</span>(<span class="params">directory, all_files=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"列出目录: <span class="subst">{directory}</span>"</span>)</span><br><span class="line">    <span class="keyword">if</span> all_files:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"显示所有文件和目录"</span>)</span><br><span class="line">        <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"当前目录: <span class="subst">{root}</span>"</span>)</span><br><span class="line">            <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"  文件: <span class="subst">{file}</span>"</span>)</span><br><span class="line">            <span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> dirs:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"  目录: <span class="subst">{<span class="built_in">dir</span>}</span>"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\n"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"显示目录内容"</span>)</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(directory):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"  文件: <span class="subst">{file}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\n"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_file</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(path):</span><br><span class="line">            os.remove(path)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"文件已删除: <span class="subst">{path}</span>"</span>)</span><br><span class="line">        <span class="keyword">elif</span> os.path.isdir(path):</span><br><span class="line">            shutil.rmtree(path)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"目录已删除: <span class="subst">{path}</span>"</span>)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_parser</span>():</span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    <span class="comment"># 1. 创建 ArgumentParser 对象</span></span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建一个解析器对象，用于定义和处理命令行参数</span></span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">        prog=<span class="string">"FileManager"</span>,  <span class="comment"># 程序名称，会显示在帮助信息中</span></span><br><span class="line">        description=<span class="string">"一个用于文件操作的命令行工具。"</span>,  <span class="comment"># 程序描述</span></span><br><span class="line">        epilog=<span class="string">"--- File Manager Help Footer ---"</span>  <span class="comment"># 帮助信息的结尾文本</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    <span class="comment"># 2. 添加子命令 (Subparsers) - 不同的文件操作</span></span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    <span class="comment"># dest:指的是命令行参数的名称</span></span><br><span class="line">    subparsers = parser.add_subparsers(</span><br><span class="line">        dest=<span class="string">"command"</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">"选择要执行的操作"</span>,</span><br><span class="line">        required=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    <span class="comment"># 3. 添加子命令 - 列出目录内容</span></span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    parser_list = subparsers.add_parser(</span><br><span class="line">        <span class="string">"list"</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">"列出目录内容"</span></span><br><span class="line">    )</span><br><span class="line">    parser_list.add_argument(</span><br><span class="line">        <span class="string">"directory"</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">"要列出的目录路径"</span>,</span><br><span class="line">        default=<span class="string">"."</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    parser_list.add_argument(</span><br><span class="line">        <span class="string">"--all"</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">"显示所有文件和目录"</span>,</span><br><span class="line">        action=<span class="string">"store_true"</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    <span class="comment"># 4. 添加子命令 - 删除文件</span></span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    parser_delete = subparsers.add_parser(</span><br><span class="line">        <span class="string">"delete"</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">"删除文件"</span></span><br><span class="line">    )</span><br><span class="line">    parser_delete.add_argument(</span><br><span class="line">        <span class="string">"path"</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">"要删除的文件路径"</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> parser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = setup_parser()</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"""</span></span><br><span class="line"><span class="string">    ██████╗ ██████╗  ██████╗ ██████╗ ██╗███████╗███████╗</span></span><br><span class="line"><span class="string">    ██╔══██╗██╔══██╗██╔═══██╗██╔══██╗██║██╔════╝██╔════╝</span></span><br><span class="line"><span class="string">    ██████╔╝██████╔╝██║   ██║██████╔╝██║███████╗█████╗  </span></span><br><span class="line"><span class="string">    ██╔═══╝ ██╔══██╗██║   ██║██╔══██╗██║╚════██║██╔══╝  </span></span><br><span class="line"><span class="string">    ██║     ██║  ██║╚██████╔╝██║  ██║██║███████║███████╗</span></span><br><span class="line"><span class="string">    ╚═╝     ╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═╝╚═╝╚══════╝╚══════╝</span></span><br><span class="line"><span class="string">    """</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> args.command == <span class="string">"list"</span>:</span><br><span class="line">        list_directory(args.directory, args.<span class="built_in">all</span>)</span><br><span class="line">    <span class="keyword">elif</span> args.command == <span class="string">"delete"</span>:</span><br><span class="line">        delete_file(args.path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        parser.print_help()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>argparse</code> 模块)</strong>:</p><ul><li><strong>用户友好性是目标</strong>：精心设计你的命令行参数和帮助信息。<code>argparse</code> 能够自动生成规范的帮助文档 (<code>-h</code> 或 <code>--help</code>)，这是 CLI 工具易用性的重要组成部分。利用 <code>description</code> 和 <code>epilog</code> 参数美化整体帮助信息，为每个参数提供清晰的 <code>help</code> 文本。</li><li><strong>参数类型 (<code>type</code>) 和 <code>choices</code></strong>：充分利用 <code>type</code> 参数进行自动类型转换 (例如，<code>type=int</code> 会将用户输入的字符串 “10” 转换为整数 <code>10</code>)。如果类型转换失败，<code>argparse</code> 会自动向用户报告错误。使用 <code>choices</code> 参数可以限制参数的有效取值范围。</li><li><strong>布尔开关 (<code>action='store_true'</code>, <code>action='store_false'</code>)</strong>：对于表示“是/否”状态的选项（例如 <code>--verbose</code>, <code>--quiet</code>, <code>--debug</code>），使用 <code>action="store_true"</code> (如果参数出现，则对应属性值为 <code>True</code>，否则为 <code>False</code>) 或 <code>action="store_false"</code> (如果参数出现，则对应属性值为 <code>False</code>，否则为 <code>True</code>) 非常方便。</li><li><strong><code>nargs</code> 的灵活运用</strong>：<ul><li><code>nargs='?'</code>: 参数可选，如果提供了值则使用该值，否则使用 <code>default</code> 值 (如果未提供值但参数标志存在，则使用 <code>const</code> 值，需与 <code>action</code> 配合)。</li><li><code>nargs='*'</code>: 零个或多个参数值，收集到一个列表中。</li><li><code>nargs='+'</code>: 一个或多个参数值，收集到一个列表中 (至少需要一个)。</li><li><code>nargs=整数N</code>: 固定需要 N 个参数值。</li></ul></li><li><strong>子命令 (<code>add_subparsers</code>) 的强大之处</strong>：当你的工具功能复杂，包含多个独立的操作模式时（例如，像版本控制系统 <code>git</code> 那样，有 <code>clone</code>, <code>commit</code>, <code>push</code>, <code>pull</code> 等不同命令），子命令是组织这些功能的理想方式。每个子命令可以拥有自己的一套参数，使得整体界面更加清晰。务必为子命令设置 <code>dest</code> 参数，以便后续判断用户选择了哪个子命令。</li><li><strong>默认值 (<code>default</code>) 的合理设置</strong>：为可选参数提供明智的默认值可以减少用户需要输入的参数数量，提升使用体验。帮助信息中可以使用 <code>%(default)s</code> 来自动显示默认值。</li><li><strong>互斥参数组 (<code>add_mutually_exclusive_group</code>)</strong>：当你有一组参数，其中用户在任何时候只能指定一个时（例如，<code>--verbose</code> 和 <code>--quiet</code> 不能同时出现），可以使用互斥参数组来强制这种约束。</li><li><strong>参数顺序</strong>：<code>argparse</code> 通常不关心可选参数 (<code>--option</code>) 在命令行中出现的顺序，但位置参数必须按照它们被 <code>add_argument()</code> 添加的顺序提供。</li><li><strong>错误处理</strong>：<code>argparse</code> 会自动处理很多常见的用户输入错误（如缺少必需参数、参数类型错误、无效选项值等），并向用户显示友好的错误信息和用法提示。你通常不需要自己编写大量的参数验证代码。</li></ul></blockquote><p><code>argparse</code> 是构建专业、健壮且用户友好的 Python 命令行应用程序的标准工具。投入时间学习和熟练运用它的各种特性，将极大提升你开发 CLI 工具的效率和质量。</p><h4 id="subprocess-模块：管理子进程"><a href="#subprocess-模块：管理子进程" class="headerlink" title="subprocess 模块：管理子进程"></a><code>subprocess</code> 模块：管理子进程</h4><p><code>subprocess</code> 模块允许你创建新的子进程，连接到它们的输入/输出/错误管道，并获取它们的返回码。它是 Python 中执行外部命令和管理子进程的推荐方式，取代了像 <code>os.system()</code>, <code>os.spawn*</code> 等一些旧的模块和函数。</p><h5 id="subprocess-常用功能"><a href="#subprocess-常用功能" class="headerlink" title="subprocess 常用功能"></a><code>subprocess</code> 常用功能</h5><table><thead><tr><th>函数/类/参数</th><th>描述</th></tr></thead><tbody><tr><td><code>subprocess.run(args, ...)</code></td><td><strong>推荐</strong>：运行 <code>args</code> 指定的命令并等待其完成，返回一个 <code>CompletedProcess</code> 对象。</td></tr><tr><td><code>subprocess.Popen(args, ...)</code></td><td>更底层的接口，创建一个子进程对象，可以进行非阻塞操作或更复杂的交互。</td></tr><tr><td><code>args</code> (用于 <code>run</code> 和 <code>Popen</code>)</td><td>要执行的命令及其参数，通常是一个列表 (如 <code>['ls', '-l']</code>) 或字符串 (当 <code>shell=True</code> 时)。</td></tr><tr><td><code>capture_output=True</code> (用于 <code>run</code>)</td><td>如果设为 <code>True</code>，则会捕获子进程的标准输出和标准错误流的内容。</td></tr><tr><td><code>text=True</code> (用于 <code>run</code> 和 <code>Popen</code>)</td><td>如果设为 <code>True</code>，标准输入、输出和错误流会以文本模式处理 (自动进行编解码)。</td></tr><tr><td><code>check=True</code> (用于 <code>run</code>)</td><td>如果设为 <code>True</code> 且命令返回非零退出码 (表示错误)，则会抛出 <code>CalledProcessError</code> 异常。</td></tr><tr><td><code>shell=True</code> (用于 <code>run</code> 和 <code>Popen</code>)</td><td><strong>谨慎使用</strong>：如果为 <code>True</code>，命令将通过系统的 shell 执行 (可能带来安全风险)。</td></tr><tr><td><code>stdin</code>, <code>stdout</code>, <code>stderr</code> (用于 <code>run</code> 和 <code>Popen</code>)</td><td>指定子进程的标准输入、输出、错误流的来源或去向 (如 <code>subprocess.PIPE</code> 用于捕获)。</td></tr><tr><td><code>CompletedProcess</code> 对象</td><td><code>run()</code> 函数成功完成后的返回值，包含 <code>args</code>, <code>returncode</code>, <code>stdout</code>, <code>stderr</code> 等信息。</td></tr><tr><td><code>Popen.communicate(input=None, timeout=None)</code></td><td>与子进程交互：向其 <code>stdin</code> 发送数据，并从其 <code>stdout</code> 和 <code>stderr</code> 读取所有输出，直到结束。</td></tr><tr><td><code>Popen.wait(timeout=None)</code></td><td>等待子进程执行完成，并返回其退出状态码。</td></tr><tr><td><code>Popen.poll()</code></td><td>检查子进程是否已经结束，如果结束则返回退出码，否则立即返回 <code>None</code> (非阻塞)。</td></tr><tr><td><code>Popen.terminate()</code> / <code>Popen.kill()</code> / <code>Popen.send_signal(signal)</code></td><td>用于向子进程发送信号以终止它 (terminate 较温和，kill 较强制)。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>subprocess</code> 模块)</strong></p><ul><li><code>subprocess.run()</code>: <strong>首选函数</strong>，适用于大多数执行外部命令并等待其完成的场景。它是对 <code>Popen</code> 的高级封装。</li><li><code>args</code> 参数的正确形式：当 <code>shell=False</code> (默认且推荐) 时，<code>args</code> 应为列表；当 <code>shell=True</code> 时，<code>args</code> 为字符串。</li><li><code>capture_output=True</code> 和 <code>text=True</code>: 获取命令输出时非常方便，可以得到解码后的文本。</li><li><code>check=True</code>: 使得在命令执行失败时能自动抛出异常，简化错误处理。</li><li><code>subprocess.PIPE</code>: 当你需要捕获子进程的输出或向其输入数据时，将其用于 <code>stdout</code>, <code>stderr</code>, <code>stdin</code> 参数。</li><li><code>Popen</code> 类：当需要更精细的控制，例如非阻塞 I/O、与进程进行持续的双向交互，或者需要并行运行多个子进程时使用。</li></ul></blockquote><h5 id="subprocess-模块代码示例"><a href="#subprocess-模块代码示例" class="headerlink" title="subprocess 模块代码示例"></a><code>subprocess</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys <span class="comment"># 用于演示平台差异和获取解释器路径</span></span><br><span class="line"><span class="keyword">import</span> os  <span class="comment"># 用于 Popen 示例中的 cwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. subprocess 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"subprocess 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 基本命令执行与等待 (subprocess.run)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 基本命令执行与等待 (subprocess.run)"</span>)</span><br><span class="line"><span class="comment"># 根据操作系统选择一个简单命令</span></span><br><span class="line">list_files_command = [<span class="string">'ls'</span>, <span class="string">'-la'</span>] <span class="keyword">if</span> sys.platform != <span class="string">'win32'</span> <span class="keyword">else</span> [<span class="string">'dir'</span>, <span class="string">'/A'</span>]</span><br><span class="line">print_info(<span class="string">f"尝试执行命令: <span class="subst">{<span class="string">' '</span>.join(list_files_command)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># subprocess.run() 会等待命令完成</span></span><br><span class="line"><span class="comment"># capture_output=True 来捕获标准输出和标准错误</span></span><br><span class="line"><span class="comment"># text=True 使输出以文本形式解码 (通常是 UTF-8 或系统默认编码)</span></span><br><span class="line"><span class="comment"># check=False 表示即使命令返回非0退出码，也不会抛出异常 (我们手动检查)</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    completed_process_simple = subprocess.run(</span><br><span class="line">        list_files_command,</span><br><span class="line">        capture_output=<span class="literal">True</span>,</span><br><span class="line">        text=<span class="literal">True</span>, <span class="comment"># Python 3.7+，使 stdout/stderr 为字符串</span></span><br><span class="line">        check=<span class="literal">False</span> <span class="comment"># 手动检查 returncode</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f"  命令实际执行: <span class="subst">{<span class="string">' '</span>.join(completed_process_simple.args)}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  命令退出码: <span class="subst">{completed_process_simple.returncode}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> completed_process_simple.returncode == <span class="number">0</span>:</span><br><span class="line">        print_success(<span class="string">"  命令成功执行。"</span>)</span><br><span class="line">        print_info(<span class="string">"  标准输出 (前5行):"</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> completed_process_simple.stdout.splitlines()[:<span class="number">5</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"    <span class="subst">{line}</span>"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_warning(<span class="string">f"  命令执行可能存在问题 (退出码非0)。"</span>)</span><br><span class="line">        <span class="keyword">if</span> completed_process_simple.stderr:</span><br><span class="line">            print_error(<span class="string">"  标准错误输出:"</span>)</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> completed_process_simple.stderr.splitlines()[:<span class="number">5</span>]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"    <span class="subst">{line}</span>"</span>)</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    print_error(<span class="string">f"  命令 '<span class="subst">{list_files_command[<span class="number">0</span>]}</span>' 未找到。请确保它在系统 PATH 中。"</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print_error(<span class="string">f"  执行命令时发生意外错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 自动错误检查 (check=True)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 自动错误检查 (check=True)"</span>)</span><br><span class="line">print_info(<span class="string">"尝试执行一个不存在的命令，并使用 check=True:"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    subprocess.run(</span><br><span class="line">        [<span class="string">"command_that_does_not_exist_12345"</span>],</span><br><span class="line">        check=<span class="literal">True</span>, <span class="comment"># 如果命令返回非0退出码，会引发 CalledProcessError</span></span><br><span class="line">        capture_output=<span class="literal">True</span>, text=<span class="literal">True</span> <span class="comment"># 捕获输出以便在异常中查看</span></span><br><span class="line">    )</span><br><span class="line">    print_success(<span class="string">"  (理论上这行不会执行，因为上面命令会失败)"</span>)</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</span><br><span class="line">    print_warning(<span class="string">f"  命令未找到 (FileNotFoundError): <span class="subst">{e}</span>"</span>)</span><br><span class="line"><span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">    print_warning(<span class="string">f"  命令执行失败 (CalledProcessError): <span class="subst">{e}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"    失败命令的返回码: <span class="subst">{e.returncode}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"    失败命令的输出 (stdout): <span class="subst">{e.stdout.strip() <span class="keyword">if</span> e.stdout <span class="keyword">else</span> <span class="string">'无'</span>}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"    失败命令的错误 (stderr): <span class="subst">{e.stderr.strip() <span class="keyword">if</span> e.stderr <span class="keyword">else</span> <span class="string">'无'</span>}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 向子进程传递输入 (input 参数)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. 向子进程传递输入 (input 参数)"</span>)</span><br><span class="line"><span class="comment"># Linux/macOS: 使用 'grep' 查找包含 'Python' 的行</span></span><br><span class="line"><span class="comment"># Windows: 使用 'findstr' 查找包含 'Python' 的行</span></span><br><span class="line">search_tool_command = [<span class="string">'grep'</span>, <span class="string">'Python'</span>] <span class="keyword">if</span> sys.platform != <span class="string">'win32'</span> <span class="keyword">else</span> [<span class="string">'findstr'</span>, <span class="string">'Python'</span>]</span><br><span class="line">text_to_search = <span class="string">"Hello World\nWelcome to Python scripting\nAnother line with Python here\nEnd of text"</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"将向 <span class="subst">{<span class="string">' '</span>.join(search_tool_command)}</span> 命令输入以下文本:\n'''\n<span class="subst">{text_to_search}</span>\n'''"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    search_result = subprocess.run(</span><br><span class="line">        search_tool_command,</span><br><span class="line">        <span class="built_in">input</span>=text_to_search, <span class="comment"># 将此字符串作为子进程的标准输入</span></span><br><span class="line">        capture_output=<span class="literal">True</span>,</span><br><span class="line">        text=<span class="literal">True</span>,</span><br><span class="line">        check=<span class="literal">False</span> <span class="comment"># grep/findstr 找不到时退出码可能非0</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> search_result.returncode == <span class="number">0</span>: <span class="comment"># 0 通常表示找到匹配</span></span><br><span class="line">        print_success(<span class="string">"  找到匹配的行:"</span>)</span><br><span class="line">        <span class="built_in">print</span>(search_result.stdout)</span><br><span class="line">    <span class="keyword">elif</span> search_result.returncode == <span class="number">1</span> <span class="keyword">and</span> <span class="keyword">not</span> search_result.stderr: <span class="comment"># grep/findstr 未找到匹配的典型退出码</span></span><br><span class="line">        print_warning(<span class="string">"  未找到任何匹配 'Python' 的行。"</span>)</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># 其他错误</span></span><br><span class="line">        print_error(<span class="string">f"  命令执行出错或未找到，退出码: <span class="subst">{search_result.returncode}</span>"</span>)</span><br><span class="line">        <span class="keyword">if</span> search_result.stderr:</span><br><span class="line">            print_error(<span class="string">f"  标准错误: <span class="subst">{search_result.stderr.strip()}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">     print_error(<span class="string">f"  命令 '<span class="subst">{search_tool_command[<span class="number">0</span>]}</span>' 未找到。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 使用 shell=True (需要格外小心！)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"4. 使用 shell=True (需要格外小心！)"</span>)</span><br><span class="line"><span class="comment"># shell=True 允许你执行包含 shell 特性（如管道、通配符、环境变量展开）的命令字符串。</span></span><br><span class="line"><span class="comment"># 但如果命令字符串包含任何来自不可信来源的内容，则极易受到命令注入攻击。</span></span><br><span class="line"><span class="comment"># 示例: 安全地获取当前目录下的文件列表 (不推荐，仅为演示 shell 特性)</span></span><br><span class="line"><span class="comment"># 更安全的方式是使用 Python 的 os.listdir() 和 glob 模块</span></span><br><span class="line">shell_list_command = <span class="string">"ls -a"</span> <span class="keyword">if</span> sys.platform != <span class="string">'win32'</span> <span class="keyword">else</span> <span class="string">"dir /A"</span></span><br><span class="line">print_warning(<span class="string">f"演示执行 shell 命令: '<span class="subst">{shell_list_command}</span>' (通常应避免 shell=True)"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    shell_result = subprocess.run(shell_list_command, shell=<span class="literal">True</span>, capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>, check=<span class="literal">True</span>)</span><br><span class="line">    print_info(<span class="string">"  Shell 命令输出 (前5行):"</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> shell_result.stdout.splitlines()[:<span class="number">5</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"    <span class="subst">{line}</span>"</span>)</span><br><span class="line"><span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">    print_error(<span class="string">f"  Shell 命令执行失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    print_error(<span class="string">f"  Shell 或命令未找到。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 5. 使用 Popen 进行更精细的异步或交互式控制</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"5. 使用 Popen 进行更精细控制"</span>)</span><br><span class="line">print_info(<span class="string">"启动一个 Python 子进程，并通过管道与其交互:"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子进程执行的 Python 代码：从标准输入读取一行，转换为大写，然后打印到标准输出</span></span><br><span class="line">python_child_code = <span class="string">"import sys; line = sys.stdin.readline().strip(); print(f'Child received and uppercased: {line.upper()}')"</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># Popen 不会阻塞，子进程会立即开始执行</span></span><br><span class="line">    process = subprocess.Popen(</span><br><span class="line">        [sys.executable, <span class="string">"-c"</span>, python_child_code], <span class="comment"># [解释器, '-c', '代码字符串']</span></span><br><span class="line">        stdin=subprocess.PIPE,  <span class="comment"># 创建到子进程 stdin 的管道</span></span><br><span class="line">        stdout=subprocess.PIPE, <span class="comment"># 创建从子进程 stdout 的管道</span></span><br><span class="line">        stderr=subprocess.PIPE, <span class="comment"># 创建从子进程 stderr 的管道</span></span><br><span class="line">        text=<span class="literal">True</span>,              <span class="comment"># 使用文本模式进行 I/O</span></span><br><span class="line">        cwd=os.getcwd()         <span class="comment"># 可以指定子进程的工作目录</span></span><br><span class="line">    )</span><br><span class="line">    print_info(<span class="string">f"  Popen 子进程已启动 (PID: <span class="subst">{process.pid}</span>)。"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通过 communicate() 与子进程交互：</span></span><br><span class="line">    <span class="comment"># - 向子进程的 stdin 发送数据 (input 参数)</span></span><br><span class="line">    <span class="comment"># - 从子进程的 stdout 和 stderr 读取所有输出，直到它们关闭</span></span><br><span class="line">    <span class="comment"># - 等待子进程结束</span></span><br><span class="line">    <span class="comment"># communicate() 是一次性交互，适合简单场景。</span></span><br><span class="line">    input_to_child = <span class="string">"hello from parent process"</span></span><br><span class="line">    print_info(<span class="string">f"  向子进程发送: '<span class="subst">{input_to_child}</span>'"</span>)</span><br><span class="line">    stdout_data, stderr_data = process.communicate(<span class="built_in">input</span>=input_to_child, timeout=<span class="number">5</span>) <span class="comment"># timeout 防止无限等待</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f"  子进程退出码: <span class="subst">{process.returncode}</span>"</span>)</span><br><span class="line">    <span class="keyword">if</span> stdout_data:</span><br><span class="line">        print_success(<span class="string">f"  子进程标准输出:\n    <span class="subst">{stdout_data.strip()}</span>"</span>)</span><br><span class="line">    <span class="keyword">if</span> stderr_data:</span><br><span class="line">        print_warning(<span class="string">f"  子进程标准错误:\n    <span class="subst">{stderr_data.strip()}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">    print_error(<span class="string">"  与 Popen 子进程交互超时！正在尝试终止..."</span>)</span><br><span class="line">    process.kill() <span class="comment"># 强制终止</span></span><br><span class="line">    stdout_data, stderr_data = process.communicate() <span class="comment"># 清理管道</span></span><br><span class="line">    print_warning(<span class="string">"  子进程已被终止。"</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print_error(<span class="string">f"  Popen 交互过程中发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"subprocess 模块演示结束。"</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="5-日志与配置管理模块"><a href="#5-日志与配置管理模块" class="headerlink" title="5.日志与配置管理模块"></a>5.日志与配置管理模块</h3><p>在开发应用程序时，通过配置文件管理程序行为以及记录程序运行状态和错误信息（即日志）是至关重要的实践。Python 标准库为此提供了 <code>configparser</code> 和 <code>logging</code> 两个核心模块。</p><h4 id="configparser-模块：读写-INI-配置文件"><a href="#configparser-模块：读写-INI-配置文件" class="headerlink" title="configparser 模块：读写 INI 配置文件"></a><code>configparser</code> 模块：读写 INI 配置文件</h4><p><code>configparser</code> 模块用于处理结构化的配置文件，其格式类似于 Windows INI 文件。这种文件通常以 <code>.ini</code> 或 <code>.cfg</code> 为扩展名，由一个或多个“节 (section)”组成，每个节内包含若干“键=值 (key=value)”对。它非常适合存储应用程序的设置和参数。</p><p><strong>示例配置文件 (<code>example.ini</code>) 内容可能如下：</strong></p><figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这是一个注释行</span></span><br><span class="line"><span class="comment">; 这也是一个注释行</span></span><br><span class="line"></span><br><span class="line"><span class="section">[DEFAULT]</span> <span class="comment">; DEFAULT 节比较特殊，它的值会作为其他节的默认值</span></span><br><span class="line"><span class="attr">app_name</span> = MyApplication</span><br><span class="line"><span class="attr">debug_mode</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">timeout</span> = <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">db_type</span> = mysql</span><br><span class="line"><span class="attr">host</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="attr">username</span> = db_user</span><br><span class="line"><span class="attr">password</span> = secret_password <span class="comment"># 在实际应用中，密码不应明文存储在配置文件中</span></span><br><span class="line"><span class="attr">db_name</span> = my_database</span><br><span class="line"><span class="attr">connection_retries</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="section">[user_settings]</span></span><br><span class="line"><span class="attr">theme</span> = dark</span><br><span class="line"><span class="attr">language</span> = en-us</span><br><span class="line"><span class="attr">notifications_enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">items_per_page</span> = <span class="number">25</span></span><br></pre></td></tr></tbody></table></figure><h5 id="configparser-常用功能"><a href="#configparser-常用功能" class="headerlink" title="configparser 常用功能"></a><code>configparser</code> 常用功能</h5><table><thead><tr><th>方法/类</th><th>描述</th></tr></thead><tbody><tr><td><code>configparser.ConfigParser(...)</code></td><td>创建一个配置文件解析器对象，用于后续的读写操作。</td></tr><tr><td><code>config.read(filenames, encoding=None)</code></td><td>从指定的一个或多个文件 <code>filenames</code> 中读取配置信息。</td></tr><tr><td><code>config.sections()</code></td><td>返回配置文件中所有节的名称列表 (不包括 <code>DEFAULT</code> 节)。</td></tr><tr><td><code>config.has_section(section_name)</code></td><td>检查配置文件中是否存在名为 <code>section_name</code> 的节。</td></tr><tr><td><code>config.options(section_name)</code></td><td>返回指定节 <code>section_name</code> 下所有选项 (键) 的名称列表。</td></tr><tr><td><code>config.has_option(section, option)</code></td><td>检查指定的 <code>section</code> 中是否存在名为 <code>option</code> 的选项。</td></tr><tr><td><code>config.items(section_name)</code></td><td>返回指定节 <code>section_name</code> 下所有选项的 (键, 值) 对列表。</td></tr><tr><td><code>config.get(section, option, ...)</code></td><td>获取指定节 <code>section</code> 中选项 <code>option</code> 的值 (始终作为字符串返回)。</td></tr><tr><td><code>config.getint(section, option, ...)</code></td><td>获取选项值并将其转换为整数。</td></tr><tr><td><code>config.getfloat(section, option, ...)</code></td><td>获取选项值并将其转换为浮点数。</td></tr><tr><td><code>config.getboolean(section, option, ...)</code></td><td>获取选项值并将其转换为布尔值 (如 ‘true’, ‘yes’, ‘1’ 会转为 <code>True</code>)。</td></tr><tr><td><code>config.add_section(section_name)</code></td><td>在配置中添加一个新的节 <code>section_name</code>。</td></tr><tr><td><code>config.set(section, option, value)</code></td><td>设置指定节 <code>section</code> 中选项 <code>option</code> 的值为 <code>value</code> (注意 <code>value</code> 必须是字符串)。</td></tr><tr><td><code>config.remove_option(section, option)</code></td><td>从指定节 <code>section</code> 中移除选项 <code>option</code>。</td></tr><tr><td><code>config.remove_section(section)</code></td><td>移除整个节 <code>section</code> 及其所有选项。</td></tr><tr><td><code>config.write(fileobject, ...)</code></td><td>将当前的配置数据写入到一个已打开的文件对象 <code>fileobject</code> 中。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>configparser</code> 模块)</strong></p><ul><li><code>ConfigParser()</code>: 创建实例是第一步。</li><li><code>read(filename)</code>: 加载配置文件内容。</li><li><code>sections()</code>, <code>options(section)</code>, <code>items(section)</code>: 遍历配置结构。</li><li><code>get(section, option)</code>: 获取配置值 (字符串)。</li><li><code>getint()</code>, <code>getfloat()</code>, <code>getboolean()</code>: <strong>常用</strong>，获取特定类型的值。</li><li><code>set(section, option, value)</code>: 修改或添加配置项。</li><li><code>write(file_object)</code>: 保存更改到文件。</li></ul></blockquote><h5 id="configparser-模块代码示例-读取、修改、创建"><a href="#configparser-模块代码示例-读取、修改、创建" class="headerlink" title="configparser 模块代码示例 (读取、修改、创建)"></a><code>configparser</code> 模块代码示例 (读取、修改、创建)</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. configparser 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"configparser 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个临时的示例配置文件</span></span><br><span class="line">temp_config_filename = <span class="string">"userConfig.ini"</span></span><br><span class="line">temp_config_content = <span class="string">"""</span></span><br><span class="line"><span class="string">[DEFAULT]</span></span><br><span class="line"><span class="string">name = John Doe</span></span><br><span class="line"><span class="string">age = 30</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[DATABASE]</span></span><br><span class="line"><span class="string">host = localhost</span></span><br><span class="line"><span class="string">port = 3306</span></span><br><span class="line"><span class="string">user = root</span></span><br><span class="line"><span class="string">password = root</span></span><br><span class="line"><span class="string">is_connected = True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[USER]</span></span><br><span class="line"><span class="string">username = admin</span></span><br><span class="line"><span class="string">password = admin</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意 DEFAULT较为特殊，他会给所有的配置名都加上它所定义的键 - 值</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(temp_config_filename, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(temp_config_content.strip())</span><br><span class="line">print_info(<span class="string">f"已创建临时配置文件: <span class="subst">{temp_config_filename}</span>"</span>)</span><br><span class="line"><span class="comment"># 实例化 ConfigParser</span></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_config_file</span>(<span class="params">temp_config_filename: <span class="built_in">str</span> = <span class="string">"userConfig.ini"</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    <span class="comment"># 1. 读取配置文件</span></span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    print_subheader(<span class="string">"1. 读取配置文件"</span>)</span><br><span class="line">    <span class="comment"># read() 方法可以读取一个或多个文件，如果文件不存在，则会忽略</span></span><br><span class="line">    <span class="comment"># 返回成功读取的文件列表</span></span><br><span class="line">    files_read = config.read(temp_config_filename, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> files_read:</span><br><span class="line">        print_error(<span class="string">f"错误: 无法读取配置文件 '<span class="subst">{temp_config_filename}</span>'"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_success(<span class="string">f"成功读取配置文件: <span class="subst">{files_read}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_config_sections</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># 查看所有 section (不包括 DEFAULT)</span></span><br><span class="line">    print_info(<span class="string">f"所有节 (不包括 DEFAULT): <span class="subst">{config.sections()}</span>"</span>)  <span class="comment"># ['DATABASE', 'USER']</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查看 DEFAULT 节中的默认值 (可以直接通过 config['DEFAULT'] 访问，或通过 defaults() 方法)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"DEFAULT"</span> <span class="keyword">in</span> config:  <span class="comment"># 也可以用 config.defaults() 访问</span></span><br><span class="line">        print_info(<span class="string">"DEFAULT 节中的默认值:"</span>)</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> config.defaults().items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f" <span class="subst">{key}</span> = <span class="subst">{value}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查看特定节 (例如 "DATABASE") 中的所有键值对</span></span><br><span class="line">    database_config = <span class="string">"DATABASE"</span></span><br><span class="line">    <span class="keyword">if</span> config.has_section(database_config):</span><br><span class="line">        print_info(<span class="string">f"'<span class="subst">{database_config}</span>' 节的选项 (options): <span class="subst">{config.options(database_config)}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取特定节中特定选项的值</span></span><br><span class="line">    host_value = config.get(database_config, <span class="string">"host"</span>)  <span class="comment"># 返回字符串</span></span><br><span class="line">    port_value_int = config.getint(database_config, <span class="string">"port"</span>)  <span class="comment"># 返回整数</span></span><br><span class="line">    is_connected_value_bool = config.getboolean(database_config, <span class="string">"is_connected"</span>)  <span class="comment"># 返回布尔值</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f" <span class="subst">{database_config}</span> 节中的 'host' 值: <span class="subst">{host_value}</span> -&gt; <span class="subst">{<span class="built_in">type</span>(host_value)}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f" <span class="subst">{database_config}</span> 节中的 'port' 值: <span class="subst">{port_value_int}</span> -&gt; <span class="subst">{<span class="built_in">type</span>(port_value_int)}</span>"</span>)</span><br><span class="line">    print_info(</span><br><span class="line">        <span class="string">f" <span class="subst">{database_config}</span> 节中的 'is_connected' 值: <span class="subst">{is_connected_value_bool}</span> -&gt; <span class="subst">{<span class="built_in">type</span>(is_connected_value_bool)}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 访问 DEFAULT 节中的值 (如果子节中没有定义，会从 DEFAULT 继承)</span></span><br><span class="line">    default_name = config.get(<span class="string">"DEFAULT"</span>, <span class="string">"name"</span>)</span><br><span class="line">    default_age = config.getint(<span class="string">"DEFAULT"</span>, <span class="string">"age"</span>)</span><br><span class="line">    print_info(<span class="string">f"DEFAULT 节中的 'name' 值: <span class="subst">{default_name}</span> -&gt; <span class="subst">{<span class="built_in">type</span>(default_name)}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"DEFAULT 节中的 'age' 值: <span class="subst">{default_age}</span> -&gt; <span class="subst">{<span class="built_in">type</span>(default_age)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 修改配置文件内容 (在内存中)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify_config_file</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    print_subheader(<span class="string">"2. 修改配置文件内容 (在内存中)"</span>)</span><br><span class="line">    <span class="comment"># 修改特定节中的值</span></span><br><span class="line">    <span class="keyword">if</span> config.has_section(<span class="string">"DATABASE"</span>):</span><br><span class="line">        config.<span class="built_in">set</span>(<span class="string">"DATABASE"</span>, <span class="string">"port"</span>, <span class="string">"3307"</span>)  <span class="comment"># 修改端口号</span></span><br><span class="line">        config.<span class="built_in">set</span>(<span class="string">"DATABASE"</span>, <span class="string">"is_connected"</span>, <span class="string">"False"</span>)  <span class="comment"># 修改连接状态</span></span><br><span class="line">        print_success(<span class="string">"已修改 'DATABASE' 节中的值"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加新的选项</span></span><br><span class="line">    config.<span class="built_in">set</span>(<span class="string">"DATABASE"</span>, <span class="string">"database"</span>, <span class="string">"mydb"</span>)  <span class="comment"># 添加新的数据库名称</span></span><br><span class="line">    print_success(<span class="string">"已添加新的选项 'database'"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加新的节</span></span><br><span class="line">    config.add_section(<span class="string">"LOGGING"</span>)</span><br><span class="line">    config.<span class="built_in">set</span>(<span class="string">"LOGGING"</span>, <span class="string">"level"</span>, <span class="string">"INFO"</span>)</span><br><span class="line">    print_success(<span class="string">"已添加新的节 'LOGGING'"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 移除一个选项</span></span><br><span class="line">    <span class="keyword">if</span> config.has_option(<span class="string">"DATABASE"</span>, <span class="string">"password"</span>):</span><br><span class="line">        config.remove_option(<span class="string">"DATABASE"</span>, <span class="string">"password"</span>)</span><br><span class="line">        print_success(<span class="string">"已移除 'password' 选项"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 将修改后的配置写回文件</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_config_file</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    print_subheader(<span class="string">"3. 将修改后的配置写回文件"</span>)</span><br><span class="line">    <span class="comment"># 写回文件 (注意: 写回文件时，会覆盖原文件内容)</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(temp_config_filename, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> configfile:</span><br><span class="line">        config.write(configfile)</span><br><span class="line">        print_success(<span class="string">f"已将修改后的配置写回文件: <span class="subst">{temp_config_filename}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 以编程方式创建全新的配置文件</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_new_config_file</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    print_subheader(<span class="string">"4. 以编程方式创建全新的配置文件"</span>)</span><br><span class="line">    new_config = configparser.ConfigParser()</span><br><span class="line">    <span class="comment"># 添加新的节和选项</span></span><br><span class="line">    new_config[<span class="string">"DEFAULT"</span>] = {</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"Alice"</span>,</span><br><span class="line">        <span class="string">"age"</span>: <span class="number">25</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加其他节和选项</span></span><br><span class="line">    new_config[<span class="string">'WebApp'</span>] = {}  <span class="comment"># 必须先创建节</span></span><br><span class="line">    web_app_section = new_config[<span class="string">'WebApp'</span>]</span><br><span class="line">    web_app_section[<span class="string">'base_url'</span>] = <span class="string">'https://myapp.com'</span></span><br><span class="line">    web_app_section[<span class="string">'api_key'</span>] = <span class="string">'YOUR_API_KEY_HERE'</span>  <span class="comment"># 值必须是字符串</span></span><br><span class="line">    web_app_section[<span class="string">'debug_port'</span>] = <span class="built_in">str</span>(<span class="number">9000</span>)  <span class="comment"># 如果是数字，需要转为字符串</span></span><br><span class="line"></span><br><span class="line">    new_config.add_section(<span class="string">'FTPCredentials'</span>)</span><br><span class="line">    new_config.<span class="built_in">set</span>(<span class="string">'FTPCredentials'</span>, <span class="string">'ftp_host'</span>, <span class="string">'ftp.example.com'</span>)</span><br><span class="line">    new_config.<span class="built_in">set</span>(<span class="string">'FTPCredentials'</span>, <span class="string">'ftp_user'</span>, <span class="string">'ftp_user_01'</span>)</span><br><span class="line">    new_config.<span class="built_in">set</span>(<span class="string">'FTPCredentials'</span>, <span class="string">'use_passive_mode'</span>, <span class="string">'True'</span>)  <span class="comment"># 布尔值也应是字符串</span></span><br><span class="line">    print_info(<span class="string">"为新配置添加了 'WebApp' 和 'FTPCredentials' 节及选项。"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将新创建的配置写入文件</span></span><br><span class="line">    created_config_filename = <span class="string">"temp_created_config.ini"</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(created_config_filename, <span class="string">'w'</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f_new_config:</span><br><span class="line">            new_config.write(f_new_config)</span><br><span class="line">        print_success(<span class="string">f"新创建的配置已写入到: <span class="subst">{created_config_filename}</span>"</span>)</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"写入新创建的配置文件失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    read_config_file()  <span class="comment"># 读取配置文件</span></span><br><span class="line">    check_config_sections()  <span class="comment"># 检查配置文件中的节和选项</span></span><br><span class="line">    modify_config_file()  <span class="comment"># 修改配置文件内容</span></span><br><span class="line">    write_config_file()  <span class="comment"># 将修改后的配置写回文件</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h5><a href="#" class="headerlink"></a></h5><h4 id="logging-模块：Python的日志记录系统（核心）"><a href="#logging-模块：Python的日志记录系统（核心）" class="headerlink" title="logging 模块：Python的日志记录系统（核心）"></a><code>logging</code> 模块：Python的日志记录系统（核心）</h4><p><code>logging</code> 模块是 Python 内置的、功能强大且灵活的日志记录框架。良好的日志记录对于应用程序的调试、监控、问题排查和审计至关重要。它允许开发者根据日志的重要性（级别）将其发送到不同的目的地（如控制台、文件、网络等），并可以自定义日志的格式。</p><h5 id="logging-模块基本使用与日志级别"><a href="#logging-模块基本使用与日志级别" class="headerlink" title="logging 模块基本使用与日志级别"></a><code>logging</code> 模块基本使用与日志级别</h5><p>日志级别从低到高表示日志信息的重要性：</p><table><thead><tr><th>日志级别 (Level)</th><th>数值 (Value)</th><th>描述</th></tr></thead><tbody><tr><td><code>DEBUG</code></td><td>10</td><td>最详细的诊断信息，通常只在调试问题时关心。</td></tr><tr><td><code>INFO</code></td><td>20</td><td>确认程序按预期运行的常规信息。</td></tr><tr><td><code>WARNING</code></td><td>30</td><td>表明发生了意外情况，或在不久的将来可能出现问题，但程序仍能按预期工作。</td></tr><tr><td><code>ERROR</code></td><td>40</td><td>由于更严重的问题，程序未能执行某些功能。</td></tr><tr><td><code>CRITICAL</code></td><td>50</td><td>严重错误，表明程序本身可能无法继续运行。</td></tr></tbody></table><p>Python 的 <code>logging</code> 模块默认的日志级别是 <code>WARNING</code>。这意味着，如果你不进行任何配置，只有 <code>WARNING</code>, <code>ERROR</code>, <code>CRITICAL</code> 级别的日志消息会被处理和显示。</p><p><strong><code>logging.basicConfig(**kwargs)</code></strong> 是一个快速配置日志系统的便捷函数，通常在脚本的早期调用。如果root logger已经配置过handlers，它将不起作用。</p><table><thead><tr><th><code>basicConfig</code> 常用参数</th><th>描述</th></tr></thead><tbody><tr><td><code>level</code></td><td>设置日志记录器处理消息的最低级别 (如 <code>logging.DEBUG</code>, <code>logging.INFO</code>)。</td></tr><tr><td><code>format</code></td><td>定义日志消息的输出格式字符串。</td></tr><tr><td><code>datefmt</code></td><td>如果 <code>format</code> 中包含时间 (<code>%(asctime)s</code>)，此参数定义时间的显示格式。</td></tr><tr><td><code>filename</code></td><td>指定日志输出到的文件名；如果省略，则输出到控制台 (<code>sys.stderr</code>)。</td></tr><tr><td><code>filemode</code></td><td>如果指定了 <code>filename</code>，此参数定义文件的打开模式 (如 <code>'a'</code> 追加, <code>'w'</code> 覆盖)。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>logging</code> 模块 - 基础)</strong></p><ul><li><strong>日志级别</strong>：理解五个基本级别及其含义。</li><li><code>logging.basicConfig()</code>: 进行简单、快速的日志配置的首选方法，尤其适用于小型脚本或应用的初期。</li><li><code>logging.debug()</code>, <code>logging.info()</code>, <code>logging.warning()</code>, <code>logging.error()</code>, <code>logging.critical()</code>: 发出不同级别日志消息的函数。</li><li><strong>默认级别是 <code>WARNING</code></strong>: 如果不配置，<code>DEBUG</code> 和 <code>INFO</code> 消息不会显示。</li></ul></blockquote><h5 id="logging-模块基础配置代码示例-basicConfig"><a href="#logging-模块基础配置代码示例-basicConfig" class="headerlink" title="logging 模块基础配置代码示例 (basicConfig)"></a><code>logging</code> 模块基础配置代码示例 (<code>basicConfig</code>)</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. logging 模块基础配置演示</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"logging 模块基础配置 (basicConfig) 演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 最简单的日志记录 (默认配置)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_logging_basic</span>():</span><br><span class="line">    print_subheader(<span class="string">"1. 最简单的日志记录 (默认配置)"</span>)</span><br><span class="line">    <span class="comment"># 此时没有调用 basicConfig，日志级别默认为 WARNING，输出到 stderr</span></span><br><span class="line">    logging.debug(<span class="string">"这是一条 DEBUG 消息 (默认情况下不显示)。"</span>)</span><br><span class="line">    logging.info(<span class="string">"这是一条 INFO 消息 (默认情况下不显示)。"</span>)</span><br><span class="line">    logging.warning(<span class="string">"这是一条 WARNING 消息 (默认显示)。"</span>)  <span class="comment"># 会以 WARNING:root:消息 的格式输出</span></span><br><span class="line">    logging.error(<span class="string">"这是一条 ERROR 消息 (默认显示)。"</span>)</span><br><span class="line">    logging.critical(<span class="string">"这是一条 CRITICAL 消息 (默认显示)。"</span>)</span><br><span class="line">    print_info(<span class="string">"注意：上面 DEBUG 和 INFO 级别的日志在默认情况下不会打印。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 让所有日志级别都能打印出来</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_logging_basic_level</span>():</span><br><span class="line">    print_subheader(<span class="string">"2. 让所有日志级别都能打印出来"</span>)</span><br><span class="line">    <span class="comment"># 配置日志级别为 DEBUG，输出到 stderr</span></span><br><span class="line">    logging.basicConfig(level=logging.DEBUG)</span><br><span class="line">    logging.debug(<span class="string">"这是一条 DEBUG 消息 (现在显示)。"</span>)</span><br><span class="line">    logging.info(<span class="string">"这是一条 INFO 消息 (现在显示)。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># print_logging_basic()</span></span><br><span class="line">    print_logging_basic_level()</span><br></pre></td></tr></tbody></table></figure><h5 id="logging-模块核心组件-Loggers-Handlers-Formatters"><a href="#logging-模块核心组件-Loggers-Handlers-Formatters" class="headerlink" title="logging 模块核心组件 (Loggers, Handlers, Formatters)"></a><code>logging</code> 模块核心组件 (Loggers, Handlers, Formatters)</h5><p>对于更复杂的日志需求，<code>basicConfig()</code> 可能不够用。这时需要了解 <code>logging</code> 模块的三个核心组件：</p><ol><li><strong>Loggers (日志记录器)</strong>:</li></ol><ul><li><strong>它是与应用程序代码直接打交道的对象。</strong><ul><li>你可以通过 <code>logging.getLogger(name)</code> 获取 Logger 实例。通常使用模块名 <code>__name__</code>作为 logger 名称 (例如 <code>logger = logging.getLogger(__name__)</code>)，这样可以方便地根据日志来源模块来配置和过滤日志。</li><li>Loggers 有层级关系，类似 Python 的包名。例如，名为 <code>app.module1</code> 的 logger 是名为 <code>app</code> 的 logger 的子级。</li><li>Loggers 可以设置自己的日志级别。如果一个 logger 的级别未设置，它会继承其父级 logger 的级别，最终到 root logger。</li><li>日志消息会沿着 logger 层级向上传播 (propagate) 到父级 logger 的 handlers，除非将 logger 的 <code>propagate</code> 属性设为 <code>False</code>。</li></ul></li></ul><ol start="2"><li><strong>Handlers (处理器)</strong>:</li></ol><ul><li><strong>决定日志消息的最终去向</strong>。一个 logger 可以关联多个 handler。<ul><li>常见的 Handlers 类型包括：<ul><li><code>StreamHandler</code>: 将日志发送到流，如 <code>sys.stdout</code> 或 <code>sys.stderr</code> (控制台)。</li><li><code>FileHandler</code>: 将日志写入磁盘文件。</li><li><code>RotatingFileHandler</code>: 支持日志文件按大小轮转（达到一定大小时创建新文件）。</li><li><code>TimedRotatingFileHandler</code>: 支持日志文件按时间间隔轮转（如每天、每小时）。</li><li><code>NullHandler</code>: 什么也不做，常用于库模块中，让应用开发者决定如何处理库的日志。</li><li>还有用于网络发送 (如 <code>HTTPHandler</code>, <code>SMTPHandler</code>)、系统日志等的 handlers。</li></ul></li><li>Handlers 也可以设置自己的日志级别，只处理高于或等于该级别的日志消息。</li></ul></li></ul><ol start="3"><li><strong>Formatters (格式化器)</strong>:</li></ol><ul><li>定义最终输出的日志消息的布局和格式。<ul><li>创建一个 Formatter 对象时，可以指定一个格式字符串，其中包含各种预定义的属性（如 <code>%(asctime)s</code> 时间, <code>%(levelname)s</code> 级别名, <code>%(message)s</code> 日志内容, <code>%(name)s</code> logger名, <code>%(module)s</code> 模块名, <code>%(lineno)d</code> 行号等）。</li><li>创建好的 Formatter 对象需要附加到一个或多个 Handler 上。</li></ul></li></ul><blockquote><p><strong>批注：核心记忆功能 (<code>logging</code> 模块 - 组件)</strong></p><ul><li><code>logging.getLogger(name)</code>: 获取 Logger 实例，是进行高级日志配置的入口。</li><li><strong>Handlers 决定日志去哪儿</strong> (控制台、文件、网络等)，并可设置级别。</li><li><strong>Formatters 决定日志长什么样</strong> (时间格式、包含哪些信息等)。</li><li>Logger -&gt; Handler -&gt; Formatter 是日志消息处理的基本流程。</li></ul></blockquote><h5 id="logging-模块高级配置代码示例-使用字典配置-dictConfig"><a href="#logging-模块高级配置代码示例-使用字典配置-dictConfig" class="headerlink" title="logging 模块高级配置代码示例 (使用字典配置 dictConfig)"></a><code>logging</code> 模块高级配置代码示例 (使用字典配置 <code>dictConfig</code>)</h5><p>使用字典来配置日志是推荐的方式，因为它清晰、灵活，并且可以从 JSON 或 YAML 等配置文件加载。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *  <span class="comment"># 假设 print_utils.py 可用</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_advanced_logging</span>():</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    设置并配置高级日志系统</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_header(<span class="string">"logging 模块高级配置 (dictConfig) 演示"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建日志目录</span></span><br><span class="line">    log_directory = <span class="string">"app_logs_adv"</span></span><br><span class="line">    os.makedirs(log_directory, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    application_log_file = os.path.join(log_directory, <span class="string">"advanced_app.log"</span>)</span><br><span class="line">    error_log_file = os.path.join(log_directory, <span class="string">"error_only.log"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义日志配置</span></span><br><span class="line">    print_subheader(<span class="string">"1. 定义日志配置字典"</span>)</span><br><span class="line">    logging_config = {</span><br><span class="line">        <span class="string">'version'</span>: <span class="number">1</span>,  <span class="comment"># 配置版本，目前只能是 1</span></span><br><span class="line">        <span class="string">'disable_existing_loggers'</span>: <span class="literal">False</span>,  <span class="comment"># 是否禁用现有的日志记录器</span></span><br><span class="line">        <span class="comment"># 日志格式化器 (Formatters)</span></span><br><span class="line">        <span class="string">'formatters'</span>: {</span><br><span class="line">            <span class="string">'verbose'</span>: {</span><br><span class="line">                <span class="string">'format'</span>: <span class="string">'%(asctime)s - %(name)s - [%(levelname)s] - (%(module)s.%(funcName)s:%(lineno)d) - %(message)s'</span>,</span><br><span class="line">                <span class="string">'datefmt'</span>: <span class="string">'%Y-%m-%d %H:%M:%S'</span></span><br><span class="line">            },</span><br><span class="line">            <span class="string">'simple'</span>: {</span><br><span class="line">                <span class="string">'format'</span>: <span class="string">'[%(levelname)s] %(asctime)s: %(message)s'</span>,</span><br><span class="line">                <span class="string">'datefmt'</span>: <span class="string">'%H:%M:%S'</span></span><br><span class="line">            },</span><br><span class="line">        },z</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 过滤器 (Filters) - 这里不详细演示，可以用于更细致的日志过滤</span></span><br><span class="line">        <span class="string">'filters'</span>: {},</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理器 (Handlers)</span></span><br><span class="line">        <span class="string">'handlers'</span>: {</span><br><span class="line">            <span class="string">'console_stdout'</span>: {  <span class="comment"># 输出到控制台 (标准输出)</span></span><br><span class="line">                <span class="string">'class'</span>: <span class="string">'logging.StreamHandler'</span>,</span><br><span class="line">                <span class="string">'level'</span>: <span class="string">'DEBUG'</span>,  <span class="comment"># 此 handler 处理 DEBUG 及以上级别</span></span><br><span class="line">                <span class="string">'formatter'</span>: <span class="string">'simple'</span>,</span><br><span class="line">                <span class="string">'stream'</span>: sys.stdout,  <span class="comment"># 明确指定流</span></span><br><span class="line">            },</span><br><span class="line">            <span class="string">'app_file_handler'</span>: {  <span class="comment"># 输出到应用日志文件，带轮转</span></span><br><span class="line">                <span class="string">'class'</span>: <span class="string">'logging.handlers.RotatingFileHandler'</span>,</span><br><span class="line">                <span class="string">'level'</span>: <span class="string">'INFO'</span>,  <span class="comment"># 此 handler 处理 INFO 及以上级别</span></span><br><span class="line">                <span class="string">'formatter'</span>: <span class="string">'verbose'</span>,</span><br><span class="line">                <span class="string">'filename'</span>: application_log_file,</span><br><span class="line">                <span class="string">'maxBytes'</span>: <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">5</span>,  <span class="comment"># 5 MB</span></span><br><span class="line">                <span class="string">'backupCount'</span>: <span class="number">3</span>,  <span class="comment"># 保留3个备份文件</span></span><br><span class="line">                <span class="string">'encoding'</span>: <span class="string">'utf-8'</span>,</span><br><span class="line">            },</span><br><span class="line">            <span class="string">'error_file_handler'</span>: {  <span class="comment"># 单独记录 ERROR 及以上级别到错误日志文件</span></span><br><span class="line">                <span class="string">'class'</span>: <span class="string">'logging.FileHandler'</span>,  <span class="comment"># 简单文件 handler</span></span><br><span class="line">                <span class="string">'level'</span>: <span class="string">'ERROR'</span>,</span><br><span class="line">                <span class="string">'formatter'</span>: <span class="string">'verbose'</span>,</span><br><span class="line">                <span class="string">'filename'</span>: error_log_file,</span><br><span class="line">                <span class="string">'encoding'</span>: <span class="string">'utf-8'</span>,</span><br><span class="line">                <span class="string">'mode'</span>: <span class="string">'a'</span>  <span class="comment"># 追加模式</span></span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 日志记录器 (Loggers)</span></span><br><span class="line">        <span class="string">'loggers'</span>: {</span><br><span class="line">            <span class="string">'my_app_module'</span>: {  <span class="comment"># 假设我们有一个名为 'my_app_module' 的 logger</span></span><br><span class="line">                <span class="string">'handlers'</span>: [<span class="string">'console_stdout'</span>, <span class="string">'app_file_handler'</span>, <span class="string">'error_file_handler'</span>],</span><br><span class="line">                <span class="string">'level'</span>: <span class="string">'DEBUG'</span>,  <span class="comment"># 此 logger 捕获 DEBUG 及以上级别</span></span><br><span class="line">                <span class="string">'propagate'</span>: <span class="literal">False</span>,  <span class="comment"># 不再向父级 (root) logger 传播，避免重复记录</span></span><br><span class="line">            },</span><br><span class="line">            <span class="string">'another_module'</span>: {</span><br><span class="line">                <span class="string">'handlers'</span>: [<span class="string">'console_stdout'</span>],</span><br><span class="line">                <span class="string">'level'</span>: <span class="string">'INFO'</span>,</span><br><span class="line">                <span class="string">'propagate'</span>: <span class="literal">False</span>,</span><br><span class="line">            },</span><br><span class="line">            <span class="comment"># 可以配置 root logger (所有未明确指定 logger 的日志最终会到这里，如果 propagate 为 True)</span></span><br><span class="line">            <span class="comment"># 'root': {</span></span><br><span class="line">            <span class="comment">#     'handlers': ['console_stdout'], # 默认情况下 root logger 也有一个 handler</span></span><br><span class="line">            <span class="comment">#     'level': 'WARNING',</span></span><br><span class="line">            <span class="comment"># }</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    print_info(<span class="string">"日志配置字典已定义。"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 应用配置</span></span><br><span class="line">    print_subheader(<span class="string">"2. 应用字典配置"</span>)</span><br><span class="line">    logging.config.dictConfig(logging_config)</span><br><span class="line">    print_success(<span class="string">"已使用 dictConfig 应用日志配置。"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> logging_config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_logging_usage</span>():</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    演示如何使用配置好的日志系统</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_subheader(<span class="string">"3. 获取并使用 Logger 实例"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示应用模块日志记录</span></span><br><span class="line">    app_logger = logging.getLogger(<span class="string">'my_app_module'</span>)</span><br><span class="line">    print_info(<span class="string">"获取 logger: 'my_app_module'"</span>)</span><br><span class="line">    app_logger.debug(<span class="string">"这是来自 'my_app_module' 的 DEBUG 日志。 (应出现在控制台)"</span>)</span><br><span class="line">    app_logger.info(<span class="string">"这是来自 'my_app_module' 的 INFO 日志。 (应出现在控制台和 app_file)"</span>)</span><br><span class="line">    app_logger.warning(<span class="string">"这是来自 'my_app_module' 的 WARNING 日志。 (处理同 INFO)"</span>)</span><br><span class="line">    app_logger.error(<span class="string">"这是来自 'my_app_module' 的 ERROR 日志。 (应出现在控制台、app_file 和 error_file)"</span>)</span><br><span class="line">    app_logger.critical(<span class="string">"这是来自 'my_app_module' 的 CRITICAL 日志。 (处理同 ERROR)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示其他模块日志记录</span></span><br><span class="line">    other_logger = logging.getLogger(<span class="string">'another_module'</span>)</span><br><span class="line">    print_info(<span class="string">"\n获取 logger: 'another_module'"</span>)</span><br><span class="line">    other_logger.debug(<span class="string">"这是来自 'another_module' 的 DEBUG 日志。 (不应出现，因为 other_logger 级别是 INFO)"</span>)</span><br><span class="line">    other_logger.info(<span class="string">"这是来自 'another_module' 的 INFO 日志。 (应出现在控制台)"</span>)</span><br><span class="line">    other_logger.error(<span class="string">"这是来自 'another_module' 的 ERROR 日志。 (应出现在控制台)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示未配置的日志记录器</span></span><br><span class="line">    unconfigured_logger = logging.getLogger(<span class="string">'some.other.unconfigured.module'</span>)</span><br><span class="line">    print_info(<span class="string">"\n获取 logger: 'some.other.unconfigured.module' (将使用 root logger 配置)"</span>)</span><br><span class="line">    <span class="comment"># 如果 root logger 未配置 handlers，可能无输出或输出到默认 stderr (WARNING级别)</span></span><br><span class="line">    <span class="comment"># 如果 root logger 在 logging_config 中配置了，则按其配置</span></span><br><span class="line">    unconfigured_logger.warning(<span class="string">"这是来自 'unconfigured' logger 的 WARNING。(行为取决于 root logger)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行日志系统设置和演示</span></span><br><span class="line">setup_advanced_logging()</span><br><span class="line">demonstrate_logging_usage()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h5 id="logging-模块使用文件配置-ini-cfg"><a href="#logging-模块使用文件配置-ini-cfg" class="headerlink" title="logging 模块使用文件配置 (.ini/.cfg)"></a><code>logging</code> 模块使用文件配置 (<code>.ini</code>/<code>.cfg</code>)</h5><p>除了字典配置，<code>logging</code> 模块也支持从类似 INI 格式的配置文件加载配置，这通过 <code>logging.config.fileConfig()</code> 函数实现。</p><p><strong>示例 <code>log.cfg</code> 文件内容 (简化版):</strong></p><figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[loggers]</span></span><br><span class="line"><span class="attr">keys</span>=root,module_logger</span><br><span class="line"></span><br><span class="line"><span class="section">[handlers]</span></span><br><span class="line"><span class="attr">keys</span>=consoleHandler,fileHandler</span><br><span class="line"></span><br><span class="line"><span class="section">[formatters]</span></span><br><span class="line"><span class="attr">keys</span>=simpleFormatter,detailFormatter</span><br><span class="line"></span><br><span class="line"><span class="section">[logger_root]</span></span><br><span class="line"><span class="attr">level</span>=WARNING</span><br><span class="line"><span class="attr">handlers</span>=consoleHandler</span><br><span class="line"></span><br><span class="line"><span class="section">[logger_module_logger]</span></span><br><span class="line"><span class="attr">level</span>=DEBUG</span><br><span class="line"><span class="attr">handlers</span>=consoleHandler,fileHandler</span><br><span class="line"><span class="attr">qualname</span>=my_app.moduleX <span class="comment"># 用于getLogger('my_app.moduleX')</span></span><br><span class="line"><span class="attr">propagate</span>=<span class="number">0</span> <span class="comment"># 不向root传递</span></span><br><span class="line"></span><br><span class="line"><span class="section">[handler_consoleHandler]</span></span><br><span class="line"><span class="attr">class</span>=StreamHandler</span><br><span class="line"><span class="attr">level</span>=DEBUG</span><br><span class="line"><span class="attr">formatter</span>=simpleFormatter</span><br><span class="line"><span class="attr">args</span>=(sys.stdout,)</span><br><span class="line"></span><br><span class="line"><span class="section">[handler_fileHandler]</span></span><br><span class="line"><span class="attr">class</span>=FileHandler</span><br><span class="line"><span class="attr">level</span>=INFO</span><br><span class="line"><span class="attr">formatter</span>=detailFormatter</span><br><span class="line"><span class="attr">args</span>=(<span class="string">'app_from_fileconfig.log'</span>, <span class="string">'a'</span>, <span class="string">'utf-8'</span>) <span class="comment"># 文件名, 模式, 编码</span></span><br><span class="line"></span><br><span class="line"><span class="section">[formatter_simpleFormatter]</span></span><br><span class="line"><span class="attr">format</span>=%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><br><span class="line"><span class="attr">datefmt</span>=%H:%M:%S</span><br><span class="line"></span><br><span class="line"><span class="section">[formatter_detailFormatter]</span></span><br><span class="line"><span class="attr">format</span>=%(asctime)s [%(levelname)-<span class="number">8</span>s] %(name)s (%(filename)s:%(line<span class="literal">no</span>)d) %(message)s</span><br><span class="line"><span class="attr">datefmt</span>=%Y-%m-%d %H:%M:%S</span><br></pre></td></tr></tbody></table></figure><p><strong>使用 <code>fileConfig</code> 加载:</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. logging 模块 fileConfig 演示</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"logging 模块 fileConfig 演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个临时的 log.cfg 文件</span></span><br><span class="line">temp_log_cfg_content = <span class="string">"""</span></span><br><span class="line"><span class="string">[loggers]</span></span><br><span class="line"><span class="string">keys=root,sampleLogger</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[handlers]</span></span><br><span class="line"><span class="string">keys=consoleHandler</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[formatters]</span></span><br><span class="line"><span class="string">keys=simpleFormatter</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[logger_root]</span></span><br><span class="line"><span class="string">level=WARNING</span></span><br><span class="line"><span class="string">handlers=consoleHandler</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[logger_sampleLogger]</span></span><br><span class="line"><span class="string">level=DEBUG</span></span><br><span class="line"><span class="string">handlers=consoleHandler</span></span><br><span class="line"><span class="string">qualname=sampleApp</span></span><br><span class="line"><span class="string">propagate=0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[handler_consoleHandler]</span></span><br><span class="line"><span class="string">class=StreamHandler</span></span><br><span class="line"><span class="string">level=DEBUG</span></span><br><span class="line"><span class="string">formatter=simpleFormatter</span></span><br><span class="line"><span class="string">args=(sys.stdout,)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[formatter_simpleFormatter]</span></span><br><span class="line"><span class="string">format=[%(levelname)s] %(name)s: %(message)s</span></span><br><span class="line"><span class="string">datefmt=</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">cfg_filename = <span class="string">"temp_log_for_fileconfig.cfg"</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(cfg_filename, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f_cfg:</span><br><span class="line">    f_cfg.write(temp_log_cfg_content)</span><br><span class="line">print_info(<span class="string">f"已创建临时日志配置文件: <span class="subst">{cfg_filename}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 使用 fileConfig 加载配置</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 使用 fileConfig 加载配置"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 默认情况下，fileConfig 可能对 UTF-8 BOM 或某些编码处理不佳</span></span><br><span class="line">    <span class="comment"># disable_existing_loggers=False 确保不会禁用通过 dictConfig 等方式已配置的 logger</span></span><br><span class="line">    logging.config.fileConfig(cfg_filename, disable_existing_loggers=<span class="literal">False</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># Python 3.10+ 支持 encoding 参数</span></span><br><span class="line">    print_success(<span class="string">f"已从 '<span class="subst">{cfg_filename}</span>' 加载日志配置。"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    <span class="comment"># 2. 使用配置好的 Logger</span></span><br><span class="line">    <span class="comment"># =============================================================</span></span><br><span class="line">    print_subheader(<span class="string">"2. 使用配置好的 Logger"</span>)</span><br><span class="line">    logger_from_file = logging.getLogger(<span class="string">'sampleApp'</span>) <span class="comment"># 'sampleApp' 是 qualname 定义的</span></span><br><span class="line">    logger_from_file.debug(<span class="string">"这是一条来自 fileConfig 配置的 DEBUG 日志 (sampleApp)。"</span>)</span><br><span class="line">    logger_from_file.info(<span class="string">"这是一条来自 fileConfig 配置的 INFO 日志 (sampleApp)。"</span>)</span><br><span class="line"></span><br><span class="line">    root_logger_test = logging.getLogger(<span class="string">"non_existent_so_root"</span>)</span><br><span class="line">    root_logger_test.warning(<span class="string">"这是一条来自 root logger 的 WARNING 日志 (通过 fileConfig 配置)。"</span>)</span><br><span class="line">    root_logger_test.debug(<span class="string">"这是一条来自 root logger 的 DEBUG 日志 (root 级别是 WARNING，所以不显示)。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print_error(<span class="string">f"使用 fileConfig 加载配置时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    print_warning(<span class="string">"注意：fileConfig 对编码的处理可能不如 dictConfig 灵活。"</span>)</span><br><span class="line">    print_warning(<span class="string">"如果遇到编码问题，可能需要确保配置文件不含 BOM，或在旧版 Python 中修改 configparser 源码（不推荐）。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理</span></span><br><span class="line"><span class="keyword">if</span> os.path.exists(cfg_filename):</span><br><span class="line">    os.remove(cfg_filename)</span><br><span class="line">    print_info(<span class="string">f"已删除临时文件: <span class="subst">{cfg_filename}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"fileConfig 演示结束。"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong><code>fileConfig</code> 的编码问题</strong>:<br><code>fileConfig</code> 在 Windows 下处理 UTF-8 文件（尤其是有 BOM 的）时可能存在问题，需要修改 <code>configparser</code> 源码的 <code>read</code> 方法来指定编码。这是一个历史问题。<br><strong>好消息是</strong>：从 Python 3.10 开始，<code>logging.config.fileConfig()</code> 函数增加了 <code>encoding</code> 参数，可以直接指定文件编码，例如 <code>logging.config.fileConfig('log.conf', encoding='utf-8')</code>。<br>对于旧版 Python，如果遇到此问题，更推荐的做法是：</p><ol><li>确保配置文件本身保存为不带 BOM 的 UTF-8。</li><li>或者，考虑将配置迁移到使用 <code>dictConfig</code>，因为 <code>dictConfig</code> 从 Python 字典加载配置，字典可以从任何来源（如 JSON, YAML 文件）以正确的编码读取，从而避免 <code>fileConfig</code> 的编码限制。</li></ol></blockquote><h5 id="logging-模块开箱即用场景"><a href="#logging-模块开箱即用场景" class="headerlink" title="logging 模块开箱即用场景"></a><code>logging</code> 模块开箱即用场景</h5><h6 id="a-为脚本快速设置日志记录到文件和控制台"><a href="#a-为脚本快速设置日志记录到文件和控制台" class="headerlink" title="a. 为脚本快速设置日志记录到文件和控制台"></a>a. 为脚本快速设置日志记录到文件和控制台</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_script_logging</span>(<span class="params">log_file_name=<span class="string">"script.log"</span>, console_level=logging.INFO, file_level=logging.DEBUG</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    为脚本设置一个简单的日志记录器，同时输出到控制台和文件。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_info(<span class="string">f"尝试设置日志，输出到控制台 (级别: <span class="subst">{logging.getLevelName(console_level)}</span>) 和文件 '<span class="subst">{log_file_name}</span>' (级别: <span class="subst">{logging.getLevelName(file_level)}</span>)"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 获取根日志记录器或创建一个特定的记录器</span></span><br><span class="line">    <span class="comment"># logger = logging.getLogger() # 获取 root logger</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"MyScriptLogger"</span>) <span class="comment"># 或者使用一个特定的 logger 名称</span></span><br><span class="line">    logger.setLevel(logging.DEBUG) <span class="comment"># 设置 logger 的最低捕获级别为 DEBUG，具体输出由 handler 控制</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 防止重复添加 handler (如果此函数可能被多次调用)</span></span><br><span class="line">    <span class="keyword">if</span> logger.hasHandlers():</span><br><span class="line">        print_warning(<span class="string">"Logger 已有 handlers，不再重复添加。"</span>)</span><br><span class="line">        <span class="comment"># 或者根据需要移除旧的 handlers:</span></span><br><span class="line">        <span class="comment"># for handler in logger.handlers[:]:</span></span><br><span class="line">        <span class="comment">#     logger.removeHandler(handler)</span></span><br><span class="line">        <span class="comment"># return logger # 如果已有，直接返回</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建控制台处理器 (StreamHandler)</span></span><br><span class="line">    console_handler = logging.StreamHandler(sys.stdout) <span class="comment"># 输出到标准输出</span></span><br><span class="line">    console_handler.setLevel(console_level)</span><br><span class="line">    console_formatter = logging.Formatter(<span class="string">'%(asctime)s [%(levelname)-7s] %(message)s'</span>, datefmt=<span class="string">'%H:%M:%S'</span>)</span><br><span class="line">    console_handler.setFormatter(console_formatter)</span><br><span class="line">    logger.addHandler(console_handler)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建文件处理器 (FileHandler)</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 确保日志目录存在 (如果 log_file_name 包含路径)</span></span><br><span class="line">        log_dir = os.path.dirname(log_file_name)</span><br><span class="line">        <span class="keyword">if</span> log_dir <span class="keyword">and</span> <span class="keyword">not</span> os.path.exists(log_dir):</span><br><span class="line">            os.makedirs(log_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">            print_info(<span class="string">f"创建日志目录: <span class="subst">{log_dir}</span>"</span>)</span><br><span class="line"></span><br><span class="line">        file_handler = logging.FileHandler(log_file_name, mode=<span class="string">'a'</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># 'a' for append</span></span><br><span class="line">        file_handler.setLevel(file_level)</span><br><span class="line">        file_formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - [%(levelname)-8s] (%(filename)s:%(lineno)d) - %(message)s'</span>, datefmt=<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">        file_handler.setFormatter(file_formatter)</span><br><span class="line">        logger.addHandler(file_handler)</span><br><span class="line">        print_success(<span class="string">f"日志将记录到文件: <span class="subst">{os.path.abspath(log_file_name)}</span>"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"设置文件日志处理器失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">        <span class="comment"># 即使文件处理器失败，控制台处理器仍然可能工作</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> logger</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>: <span class="comment"># 仅在此脚本直接运行时执行</span></span><br><span class="line">    print_header(<span class="string">"setup_script_logging 函数演示"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第一次设置</span></span><br><span class="line">    my_logger = setup_script_logging(log_file_name=<span class="string">"logs/my_app_activity.log"</span>)</span><br><span class="line">    </span><br><span class="line">    my_logger.debug(<span class="string">"这是一条详细的调试信息，用于诊断。"</span>)</span><br><span class="line">    my_logger.info(<span class="string">"应用程序已开始正常运行。"</span>)</span><br><span class="line">    my_logger.warning(<span class="string">"一个非关键性问题发生，但不影响核心功能。"</span>)</span><br><span class="line">    my_logger.error(<span class="string">"处理请求时发生错误，操作失败。"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模拟另一个模块使用同一个 logger name</span></span><br><span class="line">    another_part_logger = logging.getLogger(<span class="string">"MyScriptLogger"</span>)</span><br><span class="line">    another_part_logger.info(<span class="string">"来自应用另一部分的信息。"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试再次调用 setup (理想情况下，配置只做一次)</span></span><br><span class="line">    print_info(<span class="string">"\n尝试再次调用 setup_script_logging (应提示已有 handlers):"</span>)</span><br><span class="line">    setup_script_logging() <span class="comment"># 应该会提示已有 handlers 而不重复添加 (如果上面 hasHandlers 逻辑生效)</span></span><br><span class="line">    </span><br><span class="line">    my_logger.info(<span class="string">"第二次调用 setup 后的日志。"</span>)</span><br><span class="line"></span><br><span class="line">    print_header(<span class="string">"日志记录演示结束。请检查控制台输出和 'logs/my_app_activity.log' 文件。"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="Loguru-模块：更简单的日志记录"><a href="#Loguru-模块：更简单的日志记录" class="headerlink" title="Loguru 模块：更简单的日志记录"></a><code>Loguru</code> 模块：更简单的日志记录</h4><p><code>Loguru</code> 是一个golang语言非常受欢迎的第三方日志库，在Python中也有类似的日志库，其设计目标是让日志记录变得尽可能简单和愉悦，同时又不失强大和灵活。它提供了许多开箱即用的功能，大大减少了配置日志所需的样板代码，尽管我们是介绍标准内置库，但原生logging的配置流程实在是太过繁琐</p><h5 id="Loguru-核心特性与常用功能"><a href="#Loguru-核心特性与常用功能" class="headerlink" title="Loguru 核心特性与常用功能"></a><code>Loguru</code> 核心特性与常用功能</h5><table><thead><tr><th>方法/特性</th><th>描述</th></tr></thead><tbody><tr><td><code>from loguru import logger</code></td><td>导入 Loguru 的核心 <code>logger</code> 对象，大多数操作都通过它进行。</td></tr><tr><td><code>logger.add(sink, ...)</code></td><td><strong>核心方法</strong>：添加一个新的“接收器”(sink)来处理日志消息，如文件、函数或流。</td></tr><tr><td><code>logger.debug("...")</code> 至 <code>logger.critical("...")</code></td><td>与标准库类似的日志记录方法，用于发出不同级别的日志消息。</td></tr><tr><td><code>logger.exception("...")</code></td><td>记录一条 <code>ERROR</code> 级别的消息，并自动附加当前的异常信息和堆栈跟踪。</td></tr><tr><td><code>logger.catch(exception=Exception, ...)</code></td><td>一个装饰器，可以优雅地捕获函数中发生的异常并自动记录它们。</td></tr><tr><td><code>logger.bind(**kwargs)</code></td><td>将自定义的键值对数据绑定到后续的日志记录中，方便实现结构化日志。</td></tr><tr><td><code>logger.remove(handler_id=None)</code></td><td>移除之前通过 <code>add()</code> 添加的日志处理器 (sink)。</td></tr><tr><td><strong><code>add()</code> 常用参数:</strong></td><td></td></tr><tr><td><code>sink</code></td><td>日志的输出目标 (文件名字符串、文件对象、可调用对象等)。</td></tr><tr><td><code>level="DEBUG"</code></td><td>此 sink 处理的最低日志级别。</td></tr><tr><td><code>format="..."</code></td><td>定义此 sink 输出日志的格式字符串 (Loguru 有自己丰富的格式化标记)。</td></tr><tr><td><code>rotation="..."</code></td><td>设置日志文件轮转条件 (如 <code>"500 MB"</code>, <code>"1 week"</code>, <code>"00:00"</code> 每天午夜)。</td></tr><tr><td><code>retention="..."</code></td><td>设置旧日志文件的保留策略 (如 <code>"10 days"</code>, <code>5</code> 保留最新的5个文件)。</td></tr><tr><td><code>compression="..."</code></td><td>设置日志文件压缩格式 (如 <code>"zip"</code>, <code>"gz"</code>)。</td></tr><tr><td><code>serialize=True</code></td><td>将日志消息序列化为 JSON 格式输出，用于结构化日志。</td></tr><tr><td><code>enqueue=True</code></td><td>异步记录日志，将日志消息放入队列中处理，可提高性能。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>Loguru</code> 模块)</strong></p><ul><li><code>logger.add()</code>: <strong>最重要的方法</strong>，几乎所有的日志输出配置都通过它完成，极其灵活。</li><li><code>logger.debug()</code>, <code>info()</code>, <code>warning()</code>, <code>error()</code>, <code>critical()</code>: 日常使用的日志记录方法。</li><li><code>logger.exception()</code>: 记录错误和异常信息时非常方便。</li><li><code>format</code> 参数 (在 <code>add()</code> 中): 灵活定义日志输出格式。</li><li><code>rotation</code>, <code>retention</code>, <code>compression</code> 参数 (在 <code>add()</code> 中): 强大的日志文件管理功能。</li></ul></blockquote><h5 id="Loguru-模块代码示例"><a href="#Loguru-模块代码示例" class="headerlink" title="Loguru 模块代码示例"></a><code>Loguru</code> 模块代码示例</h5><p><strong>重要提示</strong>: <code>Loguru</code> 是一个第三方库，您需要先安装它：<br><code>pip install loguru</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =========标准库======================</span></span><br><span class="line"><span class="keyword">import</span> sys  <span class="comment"># 用于配置 logger 输出到 stdout</span></span><br><span class="line"><span class="keyword">import</span> os  <span class="comment"># 用于文件路径操作</span></span><br><span class="line"><span class="keyword">import</span> time  <span class="comment"># 用于演示 rotation</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =========三方库======================</span></span><br><span class="line"><span class="keyword">import</span> loguru</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger  <span class="comment"># 导入 Loguru</span></span><br><span class="line"><span class="comment"># =========个人库========================</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. Loguru 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"Loguru 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_loguru</span>():</span><br><span class="line">    print_info(<span class="string">"Loguru 默认会将日志输出到 stderr，并带有颜色和良好格式。"</span>)</span><br><span class="line">    <span class="comment"># 2025-05-17 16:49:28.178 | INFO     | __main__:demo_loguru:21 - 这是默认的日志信息</span></span><br><span class="line">    <span class="comment"># 他的格式为：日期 时间 日志级别 模块名:函数名:行号 - 日志内容</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 先演示一下默认的日志</span></span><br><span class="line">    logger.info(<span class="string">"这是默认的日志信息"</span>)</span><br><span class="line">    logger.warning(<span class="string">"这是警告信息"</span>)</span><br><span class="line">    logger.error(<span class="string">"这是错误信息"</span>)</span><br><span class="line">    logger.debug(<span class="string">"这是调试信息"</span>)</span><br><span class="line">    logger.success(<span class="string">"这是成功信息"</span>)</span><br><span class="line">    logger.critical(<span class="string">"这是严重错误信息"</span>)</span><br><span class="line">    logger.exception(<span class="string">"这是异常信息"</span>)</span><br><span class="line">    logger.log(<span class="string">"INFO"</span>, <span class="string">"这是自定义日志级别"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 添加基本控制台输出 (stdout)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">append_stdout</span>():</span><br><span class="line">    print_subheader(<span class="string">"1. 添加基本控制台输出 (stdout)"</span>)</span><br><span class="line">    <span class="comment"># 移除 Loguru 的默认处理器 (通常是一个输出到 stderr 的处理器)</span></span><br><span class="line">    <span class="comment"># 这样我们可以完全控制日志的输出目的地和格式</span></span><br><span class="line">    logger.remove()</span><br><span class="line">    logger.add(</span><br><span class="line">        sys.stdout,  <span class="comment"># Sink:标准输出流</span></span><br><span class="line">        level=<span class="string">"DEBUG"</span>,  <span class="comment"># 处理 DEBUG 及以上级别的日志</span></span><br><span class="line">        <span class="built_in">format</span>=<span class="string">"&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss.SSS}&lt;/green&gt; | &lt;level&gt;{level: &lt;8}&lt;/level&gt; | &lt;cyan&gt;{name}&lt;/cyan&gt;:&lt;cyan&gt;{function}&lt;/cyan&gt;:&lt;cyan&gt;{line}&lt;/cyan&gt; - &lt;level&gt;{message}&lt;/level&gt;"</span>,</span><br><span class="line">        colorize=<span class="literal">True</span>,  <span class="comment"># 启用颜色</span></span><br><span class="line">    )</span><br><span class="line">    print_success(<span class="string">"已添加一个输出到stdout的Loguru处理器"</span>)</span><br><span class="line">    logger.info(<span class="string">"这是添加了处理器后的日志信息"</span>)</span><br><span class="line">    logger.debug(<span class="string">"这条消息不会被输出到stdout，因为级别低于DEBUG"</span>)</span><br><span class="line">    logger.warning(<span class="string">"这是一个警告信息"</span>)</span><br><span class="line">    logger.error(<span class="string">"这是一个错误信息"</span>)</span><br><span class="line">    logger.success(<span class="string">"这是一个成功信息"</span>)</span><br><span class="line">    logger.critical(<span class="string">"这是一个严重错误信息"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 添加文件输出，并配置轮转和保留</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">append_file</span>():</span><br><span class="line">    print_subheader(<span class="string">"2. 添加文件输出，并配置轮转和保留"</span>)</span><br><span class="line">    <span class="comment"># 移除所有处理器</span></span><br><span class="line">    logger.remove()</span><br><span class="line">    log_file_path = <span class="string">"logs/loguru_app_{time:YYYY-MM-DD}.log"</span>  <span class="comment"># 文件名中可以包含时间格式</span></span><br><span class="line">    error_log_file_path = <span class="string">"logs/loguru_error_{time}.log"</span>  <span class="comment"># 错误日志</span></span><br><span class="line">    <span class="comment"># 确保 logs 目录存在</span></span><br><span class="line">    os.makedirs(<span class="string">"logs"</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    logger.add(</span><br><span class="line">        log_file_path,</span><br><span class="line">        level=<span class="string">"DEBUG"</span>,</span><br><span class="line">        rotation=<span class="string">"10 KB"</span>,  <span class="comment"># 当文件达到 10KB 时轮转 (创建新文件)</span></span><br><span class="line">        <span class="comment"># 也可以是 "12:00" (每天中午12点轮转), "1 week" (每周轮转)</span></span><br><span class="line">        retention=<span class="number">5</span>,  <span class="comment"># 最多保留5个轮转后的日志文件</span></span><br><span class="line">        <span class="comment"># 也可以是 "1 month" (保留1个月的日志)</span></span><br><span class="line">        compression=<span class="string">"zip"</span>,  <span class="comment"># 将轮转后的旧日志文件压缩为 .zip 格式</span></span><br><span class="line">        <span class="built_in">format</span>=<span class="string">"{time:HH:mm:ss} | {level} | {module}.{function} | {message}"</span>,  <span class="comment"># 以时间 级别 模块.函数 消息格式输出</span></span><br><span class="line">        encoding=<span class="string">"utf-8"</span></span><br><span class="line">    )</span><br><span class="line">    print_success(<span class="string">f"已添加一个输出到 '<span class="subst">{log_file_path}</span>' 的文件处理器 (INFO级别, 10KB轮转, 保留5个, zip压缩)。"</span>)</span><br><span class="line"></span><br><span class="line">    logger.add(</span><br><span class="line">        error_log_file_path,</span><br><span class="line">        level=<span class="string">"ERROR"</span>,  <span class="comment"># 此文件只记录 ERROR 及以上级别</span></span><br><span class="line">        <span class="built_in">format</span>=<span class="string">"&lt;red&gt;{time}&lt;/red&gt; - {level} - {name}:{function}:{line} - {message}"</span>,</span><br><span class="line">        rotation=<span class="string">"1 MB"</span>,</span><br><span class="line">        retention=<span class="string">"30 days"</span>,</span><br><span class="line">        encoding=<span class="string">"utf-8"</span></span><br><span class="line">    )</span><br><span class="line">    print_success(<span class="string">f"已添加一个输出到 '<span class="subst">{error_log_file_path}</span>' 的错误日志处理器 (ERROR级别)。"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试轮转</span></span><br><span class="line">    [logger.info(<span class="string">f"这是第 <span class="subst">{i}</span> 条日志信息"</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100000</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 使用 @logger.catch 装饰器捕获函数异常</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="meta">@logger.catch</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a / b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_catch</span>():</span><br><span class="line">    print_subheader(<span class="string">"4. 使用 @logger.catch 装饰器捕获函数异常"</span>)</span><br><span class="line">    divide(<span class="number">1</span>, <span class="number">0</span>)  <span class="comment"># 这将触发异常，并被 @logger.catch 捕获</span></span><br><span class="line">    divide(<span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># 这不会触发异常</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 5. 使用 logger.bind() 实现结构化日志 (或添加上下文)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_bind</span>():</span><br><span class="line">    print_subheader(<span class="string">"5. 使用 logger.bind() 实现结构化日志 (或添加上下文)"</span>)</span><br><span class="line">    <span class="comment"># 先移除之前的 stdout handler，重新配置一个支持额外参数的</span></span><br><span class="line">    logger.remove()  <span class="comment"># 移除所有已配置的 handlers</span></span><br><span class="line">    logger.add(</span><br><span class="line">        sys.stdout,</span><br><span class="line">        level=<span class="string">"INFO"</span>,</span><br><span class="line">        <span class="built_in">format</span>=<span class="string">"{time:HH:mm:ss} | {level: &lt;7} | {extra} | {message}"</span>,  <span class="comment"># {extra} 会显示 bind 的内容</span></span><br><span class="line">        colorize=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">    print_success(<span class="string">"已重新配置 stdout handler 以显示 {extra}。"</span>)</span><br><span class="line"></span><br><span class="line">    user_logger = logger.bind(user_id=<span class="number">123</span>, session_id=<span class="string">"abcdef123"</span>)</span><br><span class="line">    user_logger.info(<span class="string">"用户登录成功。"</span>)  <span class="comment"># 这条日志会包含 user_id 和 session_id</span></span><br><span class="line">    user_logger.warning(<span class="string">"用户尝试访问未授权资源。"</span>, resource_path=<span class="string">"/admin"</span>)  <span class="comment"># 也可以在记录时临时绑定</span></span><br><span class="line"></span><br><span class="line">    logger.bind(ip=<span class="string">"192.168.1.100"</span>).info(<span class="string">"来自特定IP的请求。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 6. 序列化为 JSON (结构化日志)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_json</span>():</span><br><span class="line">    print_subheader(<span class="string">"6. 序列化为 JSON (结构化日志)"</span>)</span><br><span class="line">    json_log_file = <span class="string">"logs/structured_logs.json"</span></span><br><span class="line">    <span class="comment"># 移除所有处理器</span></span><br><span class="line">    logger.remove()</span><br><span class="line">    logger.add(</span><br><span class="line">        json_log_file,</span><br><span class="line">        level=<span class="string">"INFO"</span>,</span><br><span class="line">        serialize=<span class="literal">True</span>,  <span class="comment"># 关键：将日志记录序列化为JSON</span></span><br><span class="line">        <span class="built_in">format</span>=<span class="string">"{time:HH:mm:ss} | {level: &lt;7} | {extra} | {message}"</span>,  <span class="comment"># {extra} 会显示 bind 的内容</span></span><br><span class="line">        rotation=<span class="string">"1 MB"</span>,</span><br><span class="line">        encoding=<span class="string">"utf-8"</span></span><br><span class="line">    )</span><br><span class="line">    print_success(<span class="string">f"已添加一个输出到 '<span class="subst">{json_log_file}</span>' 的 JSON 格式文件处理器。"</span>)</span><br><span class="line"></span><br><span class="line">    logger.bind(transaction_id=<span class="string">"txn_789"</span>).info(</span><br><span class="line">        <span class="string">"订单已处理"</span>,</span><br><span class="line">        order_id=<span class="number">456</span>,</span><br><span class="line">        customer_email=<span class="string">"customer@example.com"</span>,</span><br><span class="line">        amount=<span class="number">99.99</span>,</span><br><span class="line">        items_count=<span class="number">3</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 打开 structured_logs.json 文件会看到 JSON 格式的日志</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># demo_loguru()</span></span><br><span class="line">    <span class="comment"># append_stdout()</span></span><br><span class="line">    <span class="comment"># append_file()</span></span><br><span class="line">    <span class="comment"># demo_catch()</span></span><br><span class="line">    <span class="comment"># demo_bind()</span></span><br><span class="line">    demo_json()</span><br></pre></td></tr></tbody></table></figure><h5 id="Loguru-模块开箱即用场景"><a href="#Loguru-模块开箱即用场景" class="headerlink" title="Loguru 模块开箱即用场景"></a><code>Loguru</code> 模块开箱即用场景</h5><h6 id="a-快速为脚本设置控制台和文件日志"><a href="#a-快速为脚本设置控制台和文件日志" class="headerlink" title="a. 快速为脚本设置控制台和文件日志"></a>a. 快速为脚本设置控制台和文件日志</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_quick_loguru_logging</span>(<span class="params"></span></span><br><span class="line"><span class="params">    console_level=<span class="string">"INFO"</span>, </span></span><br><span class="line"><span class="params">    log_file=<span class="string">"app_activity_{time:YYYY-MM-DD}.log"</span>, </span></span><br><span class="line"><span class="params">    file_level=<span class="string">"DEBUG"</span>,</span></span><br><span class="line"><span class="params">    log_dir=<span class="string">"my_app_logs"</span> <span class="comment"># 新增日志目录参数</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    快速配置 Loguru，将日志同时输出到控制台和带轮转的文件。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_info(<span class="string">"正在配置 Loguru 日志系统..."</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 确保日志目录存在</span></span><br><span class="line">    os.makedirs(log_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    full_log_file_path = os.path.join(log_dir, log_file)</span><br><span class="line"></span><br><span class="line">    logger.remove() <span class="comment"># 清除所有旧的 handlers，确保配置纯净</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置控制台输出</span></span><br><span class="line">    logger.add(</span><br><span class="line">        sys.stderr, <span class="comment"># 通常日志输出到 stderr，print 到 stdout</span></span><br><span class="line">        level=console_level.upper(),</span><br><span class="line">        <span class="built_in">format</span>=<span class="string">"&lt;level&gt;{level: &lt;8}&lt;/level&gt; | &lt;cyan&gt;{time:HH:mm:ss}&lt;/cyan&gt; | &lt;level&gt;{message}&lt;/level&gt;"</span>,</span><br><span class="line">        colorize=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">    print_success(<span class="string">f"Loguru 控制台日志已配置 (级别: <span class="subst">{console_level.upper()}</span>)。"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置文件输出</span></span><br><span class="line">    logger.add(</span><br><span class="line">        full_log_file_path,</span><br><span class="line">        level=file_level.upper(),</span><br><span class="line">        <span class="built_in">format</span>=<span class="string">"{time:YYYY-MM-DD HH:mm:ss.SSS} | {level: &lt;8} | {name}:{function}:{line} | {message}"</span>,</span><br><span class="line">        rotation=<span class="string">"10 MB"</span>,    <span class="comment"># 每 10MB 轮转</span></span><br><span class="line">        retention=<span class="string">"7 days"</span>,  <span class="comment"># 保留最近7天的日志</span></span><br><span class="line">        compression=<span class="string">"zip"</span>,   <span class="comment"># 压缩旧日志</span></span><br><span class="line">        encoding=<span class="string">"utf-8"</span>,</span><br><span class="line">        enqueue=<span class="literal">True</span>         <span class="comment"># 异步写入，提高性能</span></span><br><span class="line">    )</span><br><span class="line">    print_success(<span class="string">f"Loguru 文件日志已配置 (级别: <span class="subst">{file_level.upper()}</span>)，路径: '<span class="subst">{os.path.abspath(full_log_file_path)}</span>'"</span>)</span><br><span class="line">    </span><br><span class="line">    logger.info(<span class="string">"Loguru 日志系统初始化完成。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print_header(<span class="string">"快速设置 Loguru 日志场景演示"</span>)</span><br><span class="line">    setup_quick_loguru_logging(log_dir=<span class="string">"project_X_logs"</span>) <span class="comment"># 指定日志目录</span></span><br><span class="line"></span><br><span class="line">    logger.debug(<span class="string">"这是一条 DEBUG 级别的调试信息，只有文件日志会记录。"</span>)</span><br><span class="line">    logger.info(<span class="string">"用户 'Alice' 登录了系统。"</span>)</span><br><span class="line">    logger.warning(<span class="string">"配置项 'API_KEY' 未找到，使用默认值。"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        items = []</span><br><span class="line">        items[<span class="number">0</span>] <span class="comment"># 故意引发 IndexError</span></span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        logger.exception(<span class="string">"处理项目列表时发生错误！"</span>)</span><br><span class="line">    </span><br><span class="line">    logger.info(<span class="string">"脚本演示部分执行完毕。"</span>)</span><br><span class="line">    print_header(<span class="string">"请检查控制台输出和 'project_X_logs' 目录下的日志文件。"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p>自此，Python最常用的标准库就介绍完了=&gt;(Python是全世界三方库生态最好的语言)，所以掌握一定的标准库即可，剩下的库作为了解或是做底层开发会合适</p></blockquote><h3 id="6-较为不常用实用库"><a href="#6-较为不常用实用库" class="headerlink" title="6.较为不常用实用库"></a>6.较为不常用实用库</h3><p>Python 标准库中包含了许多小而精的模块，它们为日常开发中的特定任务提供了便捷的解决方案。本节将介绍几个常用的工具模块：<code>contextlib</code> 用于简化上下文管理，<code>tempfile</code> 用于处理临时文件和目录，<code>glob</code> 用于文件路径的模式匹配，以及 <code>uuid</code> 用于生成通用唯一标识符。</p><h4 id="contextlib-模块：简化上下文管理器"><a href="#contextlib-模块：简化上下文管理器" class="headerlink" title="contextlib 模块：简化上下文管理器"></a><code>contextlib</code> 模块：简化上下文管理器</h4><p>上下文管理器是 Python 中一种重要的编程构造，主要通过 <code>with</code> 语句来使用。它能够帮助我们自动获取和释放资源，或者在代码块执行前后执行特定操作（如加锁/解锁，打开/关闭文件）。<code>contextlib</code> 模块提供了一些工具来更方便地创建和使用上下文管理器。</p><h5 id="contextlib-常用功能"><a href="#contextlib-常用功能" class="headerlink" title="contextlib 常用功能"></a><code>contextlib</code> 常用功能</h5><blockquote><p>这个模块最常用的只有**@contextlib.contextmanage**这个装饰器，其他的方法并不常用，简单了解即可</p></blockquote><table><thead><tr><th>函数/装饰器</th><th>描述</th></tr></thead><tbody><tr><td><code>@contextlib.contextmanager</code></td><td>一个装饰器，能让你用简单的生成器函数快速创建支持 <code>with</code> 语句的上下文管理器。</td></tr><tr><td><code>contextlib.closing(thing)</code></td><td>为那些有 <code>close()</code> 方法但本身不是上下文管理器的对象创建一个上下文管理器，确保其 <code>close()</code> 被调用。</td></tr><tr><td><code>contextlib.suppress(*exceptions)</code></td><td>创建一个上下文管理器，在其管理的 <code>with</code> 代码块中可以忽略指定的几种异常类型。</td></tr><tr><td><code>contextlib.ExitStack()</code></td><td>一个上下文管理器，可以动态地注册和管理多个其他的上下文管理器，确保它们都能被正确清理。</td></tr><tr><td><code>contextlib.nullcontext(enter_result=None)</code></td><td>一个什么也不做的上下文管理器，有时用于在条件分支中提供一个“空操作”的 <code>with</code> 目标。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>contextlib</code> 模块)</strong></p><ul><li><code>@contextlib.contextmanager</code>: <strong>非常常用</strong>，是将自定义资源管理逻辑封装为上下文管理器的最便捷方式。</li><li><code>contextlib.closing()</code>: 当遇到只有 <code>close()</code> 方法的老旧对象时很有用。</li><li><code>contextlib.suppress()</code>: 优雅地处理某些预期内且不需要特别处理的异常。</li><li><code>contextlib.ExitStack()</code>: 管理多个或动态数量的资源时非常强大。</li></ul></blockquote><h5 id="contextlib-模块代码示例"><a href="#contextlib-模块代码示例" class="headerlink" title="contextlib 模块代码示例"></a><code>contextlib</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Any</span>  <span class="comment"># 用于类型提示</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. contextlib 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"contextlib 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 使用 @contextlib.contextmanager 创建自定义上下文管理器</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 使用 @contextlib.contextmanager 创建计时器"</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">yield 之前的部分 ≈ __enter__ 方法:</span></span><br><span class="line"><span class="string">当 with 语句开始执行时， @contextlib.contextmanager 装饰的生成器函数中，yield 关键字之前的所有代码会被执行。这部分代码通常用来做一些准备工作，比如打开文件、连接数据库、获取资源等。如果 yield 语句产生了一个值 (例如 yield resource)，这个值会赋给 with ... as var 中的 var。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">yield 执行的时刻:</span></span><br><span class="line"><span class="string">程序执行到 yield 时，会将控制权交还给 with 语句块内部的代码，让 with 块中的代码开始执行。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">yield 之后的部分 (通常在 finally 块中) ≈ __exit__ 方法:</span></span><br><span class="line"><span class="string">当 with 语句块中的代码执行完毕（无论是正常结束还是发生异常），程序会回到生成器函数中，从 yield 语句之后的地方继续执行。这部分代码（通常放在 finally 块中以确保其总能执行）用来做清理工作，比如关闭文件、释放资源、回滚事务等。finally 块保证了即使 with 块中发生错误，清理操作也能进行。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">简单来说，@contextlib.contextmanager 巧妙地利用了生成器的特性，将一个普通的生成器函数变成了符合上下文管理器协议的对象，使得 yield 前的代码在进入 with 块时运行，yield 后的代码在退出 with 块时运行。这种方式比手动定义一个包含 __enter__ 和 __exit__ 方法的类要简洁得多。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simple_timer</span>(<span class="params">label: <span class="built_in">str</span> = <span class="string">"默认计时器"</span></span>):</span><br><span class="line">    start = time.perf_counter()  <span class="comment"># 获取当前精确的时间戳</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span>  <span class="comment"># yield 之前是 __enter__ 部分，yield 之后是 __exit__ 部分</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        end = time.perf_counter()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{label}</span> 耗时: <span class="subst">{end - start:<span class="number">.6</span>f}</span> 秒"</span>)</span><br><span class="line">        print_info(<span class="string">f"计时器 <span class="subst">{label}</span> 结束。耗时: <span class="subst">{end - start:<span class="number">.4</span>f}</span> 秒"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义的计时器</span></span><br><span class="line"><span class="keyword">with</span> simple_timer(<span class="string">"文件读取"</span>):</span><br><span class="line">    print_info(<span class="string">"模拟读取文件内容..."</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)  <span class="comment"># 模拟读取文件的耗时</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> simple_timer(<span class="string">"数据处理"</span>):</span><br><span class="line">    print_info(<span class="string">"模拟数据处理..."</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)  <span class="comment"># 模拟数据处理的耗时</span></span><br></pre></td></tr></tbody></table></figure><h4 id="tempfile-模块：处理临时文件和目录"><a href="#tempfile-模块：处理临时文件和目录" class="headerlink" title="tempfile 模块：处理临时文件和目录"></a><code>tempfile</code> 模块：处理临时文件和目录</h4><p>在程序运行过程中，有时需要创建一些临时的文件或目录来存储中间数据，这些数据在程序结束或不再需要时应该被自动清理。<code>tempfile</code> 模块为此提供了安全且便捷的解决方案。</p><h5 id="tempfile-常用功能"><a href="#tempfile-常用功能" class="headerlink" title="tempfile 常用功能"></a><code>tempfile</code> 常用功能</h5><table><thead><tr><th>函数/类</th><th>描述</th></tr></thead><tbody><tr><td><code>tempfile.TemporaryFile(mode='w+b', ...)</code></td><td>创建一个匿名的临时文件对象 (没有可见的文件名)，文件关闭时自动删除。</td></tr><tr><td><code>tempfile.NamedTemporaryFile(mode='w+b', delete=True, ...)</code></td><td>创建一个带名字的临时文件，文件关闭时通常也会自动删除 (除非 <code>delete=False</code>)。</td></tr><tr><td><code>tempfile.SpooledTemporaryFile(max_size=0, ...)</code></td><td>创建一个在内存中操作的临时文件，当内容超过 <code>max_size</code> 字节时，会自动溢出到磁盘。</td></tr><tr><td><code>tempfile.TemporaryDirectory(suffix=None, ...)</code></td><td>创建一个临时目录，当上下文管理器退出或目录对象被垃圾回收时，目录及其内容会被自动删除。</td></tr><tr><td><code>tempfile.gettempdir()</code></td><td>获取系统用于存放临时文件的默认目录路径。</td></tr><tr><td><code>tempfile.gettempprefix()</code></td><td>获取生成临时文件或目录名称时使用的默认前缀。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>tempfile</code> 模块)</strong></p><ul><li><code>NamedTemporaryFile()</code>: 当你需要一个临时文件并且需要知道它的文件名时使用，通常配合 <code>with</code> 语句。</li><li><code>TemporaryDirectory()</code>: 当你需要一个临时的目录来存放多个文件，并且希望它能自动清理时使用，通常配合 <code>with</code> 语句。</li><li><code>TemporaryFile()</code>: 用于完全匿名的临时文件，不需要文件名。</li></ul></blockquote><h5 id="tempfile-模块代码示例"><a href="#tempfile-模块代码示例" class="headerlink" title="tempfile 模块代码示例"></a><code>tempfile</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil  <span class="comment"># 用于演示 mkdtemp 的清理</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. tempfile 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"tempfile 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 获取系统临时目录信息</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 获取系统临时目录信息"</span>)</span><br><span class="line">system_temp_dir = tempfile.gettempdir()</span><br><span class="line">print_info(<span class="string">f"系统默认的临时目录路径: <span class="subst">{system_temp_dir}</span>"</span>)  <span class="comment"># C:\Users\Prorise\AppData\Local\Temp</span></span><br><span class="line">temp_prefix = tempfile.gettempprefix()</span><br><span class="line">print_info(<span class="string">f"生成临时文件/目录的默认前缀: <span class="subst">{temp_prefix}</span>"</span>)  <span class="comment"># 生成临时文件/目录的默认前缀: tmp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 创建匿名的临时文件 (TemporaryFile)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 创建匿名的临时文件 (TemporaryFile)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># TemporaryFile 创建的文件在文件系统上通常没有可见的目录项(文件名)</span></span><br><span class="line"><span class="comment"># 他是一个真正的临时文件，关闭后即删除</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_temporary_file</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> tempfile.TemporaryFile(mode=<span class="string">"w+t"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> tf:</span><br><span class="line">            print_info(<span class="string">f"临时文件创建成功: <span class="subst">{tf.name}</span>"</span>)</span><br><span class="line">            tf.write(<span class="string">"这是一个临时文件的内容"</span>)</span><br><span class="line">            tf.write(<span class="string">"\n这是第二行内容"</span>)</span><br><span class="line">            tf.seek(<span class="number">0</span>)  <span class="comment"># 回到文件开头才能读取</span></span><br><span class="line">            content = tf.read()</span><br><span class="line">            print_info(<span class="string">f"临时文件内容: <span class="subst">{content}</span>"</span>)</span><br><span class="line">        print_success(<span class="string">"匿名临时文件已在 with 块结束时自动关闭并删除"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"创建临时文件时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 创建带名字的临时文件 (NamedTemporaryFile)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># NamedTemporaryFile 创建的文件在文件系统中有可见的文件名</span></span><br><span class="line"><span class="comment"># 默认情况下 (delete=True)，文件关闭时也会被自动删除</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_named_temporary_file</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> tempfile.NamedTemporaryFile(mode=<span class="string">'w+t'</span>, encoding=<span class="string">'utf-8'</span>, prefix=<span class="string">'my_app_temp_'</span>, suffix=<span class="string">'.data'</span>,</span><br><span class="line">                                         delete=<span class="literal">True</span>) <span class="keyword">as</span> nf:</span><br><span class="line">            print_info(<span class="string">f"带名字的临时文件创建成功: <span class="subst">{nf.name}</span>"</span>)</span><br><span class="line">            nf.write(<span class="string">"这是一个带名字的临时文件的内容"</span>)</span><br><span class="line">            nf.write(<span class="string">"\n这是第二行内容"</span>)</span><br><span class="line">            nf.seek(<span class="number">0</span>)  <span class="comment"># 回到文件开头才能读取</span></span><br><span class="line">            content = nf.read()</span><br><span class="line">            print_info(<span class="string">f"临时文件内容: <span class="subst">{content}</span>"</span>)</span><br><span class="line">        print_success(<span class="string">"带名字的临时文件已在 with 块结束时自动关闭"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"创建带名字的临时文件时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 创建临时目录 (TemporaryDirectory)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_temporary_directory</span>():</span><br><span class="line">    print_subheader(<span class="string">"4.创建临时目录 (TemporaryDirectory)"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> tempfile.TemporaryDirectory() <span class="keyword">as</span> temp_dir:</span><br><span class="line">            print_info(<span class="string">f"临时目录创建成功: <span class="subst">{temp_dir}</span>"</span>)</span><br><span class="line">            <span class="comment"># 在临时目录中创建文件</span></span><br><span class="line">            <span class="comment"># 可以在这个临时目录中创建文件和子目录</span></span><br><span class="line">            temp_file_in_dir = os.path.join(temp_dir, <span class="string">"temp_file.txt"</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(temp_file_in_dir, <span class="string">"w"</span>) <span class="keyword">as</span> f_in_dir:</span><br><span class="line">                f_in_dir.write(<span class="string">"这是文件在临时目录中的内容"</span>)</span><br><span class="line">            print_info(<span class="string">f"临时文件创建成功: <span class="subst">{temp_file_in_dir}</span>"</span>)</span><br><span class="line">            <span class="comment"># 临时目录会在 with 块结束时自动删除</span></span><br><span class="line">        print_success(<span class="string">"临时目录已在 with 块结束时自动删除"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"创建临时目录时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    create_temporary_file()  <span class="comment"># INFO: 临时文件创建成功: C:\Users\Prorise\AppData\Local\Temp\tmpfrqy2tno</span></span><br><span class="line">    create_named_temporary_file()  <span class="comment"># INFO: 带名字的临时文件创建成功: C:\Users\Prorise\AppData\Local\Temp\my_app_temp_k0g52b1n.data</span></span><br><span class="line">    create_temporary_directory() <span class="comment"># INFO: 临时目录创建成功: C:\Users\Prorise\AppData\Local\Temp\tmpwivr5y11</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil  <span class="comment"># 用于演示 mkdtemp 的清理</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. tempfile 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"tempfile 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 获取系统临时目录信息</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 获取系统临时目录信息"</span>)</span><br><span class="line">system_temp_dir = tempfile.gettempdir()</span><br><span class="line">print_info(<span class="string">f"系统默认的临时目录路径: <span class="subst">{system_temp_dir}</span>"</span>)  <span class="comment"># C:\Users\Prorise\AppData\Local\Temp</span></span><br><span class="line">temp_prefix = tempfile.gettempprefix()</span><br><span class="line">print_info(<span class="string">f"生成临时文件/目录的默认前缀: <span class="subst">{temp_prefix}</span>"</span>)  <span class="comment"># 生成临时文件/目录的默认前缀: tmp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 创建匿名的临时文件 (TemporaryFile)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 创建匿名的临时文件 (TemporaryFile)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># TemporaryFile 创建的文件在文件系统上通常没有可见的目录项(文件名)</span></span><br><span class="line"><span class="comment"># 他是一个真正的临时文件，关闭后即删除</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_temporary_file</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> tempfile.TemporaryFile(mode=<span class="string">"w+t"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> tf:</span><br><span class="line">            print_info(<span class="string">f"临时文件创建成功: <span class="subst">{tf.name}</span>"</span>)</span><br><span class="line">            tf.write(<span class="string">"这是一个临时文件的内容"</span>)</span><br><span class="line">            tf.write(<span class="string">"\n这是第二行内容"</span>)</span><br><span class="line">            tf.seek(<span class="number">0</span>)  <span class="comment"># 回到文件开头才能读取</span></span><br><span class="line">            content = tf.read()</span><br><span class="line">            print_info(<span class="string">f"临时文件内容: <span class="subst">{content}</span>"</span>)</span><br><span class="line">        print_success(<span class="string">"匿名临时文件已在 with 块结束时自动关闭并删除"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"创建临时文件时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 创建带名字的临时文件 (NamedTemporaryFile)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># NamedTemporaryFile 创建的文件在文件系统中有可见的文件名</span></span><br><span class="line"><span class="comment"># 默认情况下 (delete=True)，文件关闭时也会被自动删除</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_named_temporary_file</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> tempfile.NamedTemporaryFile(mode=<span class="string">'w+t'</span>, encoding=<span class="string">'utf-8'</span>, prefix=<span class="string">'my_app_temp_'</span>, suffix=<span class="string">'.data'</span>,</span><br><span class="line">                                         delete=<span class="literal">True</span>) <span class="keyword">as</span> nf:</span><br><span class="line">            print_info(<span class="string">f"带名字的临时文件创建成功: <span class="subst">{nf.name}</span>"</span>)</span><br><span class="line">            nf.write(<span class="string">"这是一个带名字的临时文件的内容"</span>)</span><br><span class="line">            nf.write(<span class="string">"\n这是第二行内容"</span>)</span><br><span class="line">            nf.seek(<span class="number">0</span>)  <span class="comment"># 回到文件开头才能读取</span></span><br><span class="line">            content = nf.read()</span><br><span class="line">            print_info(<span class="string">f"临时文件内容: <span class="subst">{content}</span>"</span>)</span><br><span class="line">        print_success(<span class="string">"带名字的临时文件已在 with 块结束时自动关闭"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"创建带名字的临时文件时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 创建临时目录 (TemporaryDirectory)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_temporary_directory</span>():</span><br><span class="line">    print_subheader(<span class="string">"4.创建临时目录 (TemporaryDirectory)"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> tempfile.TemporaryDirectory() <span class="keyword">as</span> temp_dir:</span><br><span class="line">            print_info(<span class="string">f"临时目录创建成功: <span class="subst">{temp_dir}</span>"</span>)</span><br><span class="line">            <span class="comment"># 在临时目录中创建文件</span></span><br><span class="line">            <span class="comment"># 可以在这个临时目录中创建文件和子目录</span></span><br><span class="line">            temp_file_in_dir = os.path.join(temp_dir, <span class="string">"temp_file.txt"</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(temp_file_in_dir, <span class="string">"w"</span>) <span class="keyword">as</span> f_in_dir:</span><br><span class="line">                f_in_dir.write(<span class="string">"这是文件在临时目录中的内容"</span>)</span><br><span class="line">            print_info(<span class="string">f"临时文件创建成功: <span class="subst">{temp_file_in_dir}</span>"</span>)</span><br><span class="line">            <span class="comment"># 临时目录会在 with 块结束时自动删除</span></span><br><span class="line">        print_success(<span class="string">"临时目录已在 with 块结束时自动删除"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"创建临时目录时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    create_temporary_file()  <span class="comment"># INFO: 临时文件创建成功: C:\Users\Prorise\AppData\Local\Temp\tmpfrqy2tno</span></span><br><span class="line">    create_named_temporary_file()  <span class="comment"># INFO: 带名字的临时文件创建成功: C:\Users\Prorise\AppData\Local\Temp\my_app_temp_k0g52b1n.data</span></span><br><span class="line">    create_temporary_directory() <span class="comment"># INFO: 临时目录创建成功: C:\Users\Prorise\AppData\Local\Temp\tmpwivr5y11</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>tempfile</code> 模块)</strong>:</p><ul><li><strong>自动清理</strong>: <code>TemporaryFile</code>, <code>NamedTemporaryFile</code> (当 <code>delete=True</code>, 默认行为), 和 <code>TemporaryDirectory</code> 在与 <code>with</code> 语句一起使用时，会在退出 <code>with</code> 块时自动关闭并删除对应的文件或目录。这是它们主要的便利之处。</li><li><strong><code>NamedTemporaryFile</code> 的 <code>delete=True</code> 在 Windows 上的行为</strong>: 在 Windows 上，当 <code>NamedTemporaryFile</code> 以 <code>delete=True</code> (默认) 打开时，文件在创建后不能被其他进程（甚至同一进程中的其他代码）通过其文件名再次打开，直到该 <code>NamedTemporaryFile</code> 对象被关闭。如果你需要在文件保持打开状态时让其他部分通过名字访问它，或者希望在关闭后文件仍然保留以便后续处理，应设置 <code>delete=False</code>，但这种情况下你需要自己负责在不再需要时手动删除文件 (例如使用 <code>os.remove()</code>)。</li><li><strong>文件名安全性</strong>: <code>tempfile</code> 模块在生成临时文件名时会采取措施避免可预测的文件名，有助于防止一些安全问题。通常不建议使用像 <code>mktemp()</code> 这样只返回一个文件名但不实际创建文件的旧函数，因为它在文件名生成和文件创建之间存在竞争条件风险。优先使用 <code>TemporaryFile</code>, <code>NamedTemporaryFile</code>, <code>TemporaryDirectory</code> 这些会实际创建并管理临时实体的工具。</li><li><strong>权限</strong>: 创建临时文件或目录仍然受限于当前用户的操作系统权限。如果程序没有在临时目录中写入的权限，操作将会失败。</li><li><strong>资源泄露</strong>: 如果不使用 <code>with</code> 语句，而是手动创建 <code>TemporaryFile</code> 或 <code>TemporaryDirectory</code> 对象，你需要确保调用它们的 <code>close()</code> 方法（对于文件）或 <code>cleanup()</code> 方法（对于目录，尽管目录对象被垃圾回收时也会尝试清理）来释放资源和删除实体。<code>with</code> 语句是推荐的最佳实践。</li></ul></blockquote><h4 id="glob-模块：文件路径名模式匹配"><a href="#glob-模块：文件路径名模式匹配" class="headerlink" title="glob 模块：文件路径名模式匹配"></a><code>glob</code> 模块：文件路径名模式匹配</h4><p><code>glob</code> 模块用于查找所有匹配特定模式的文件路径名，它使用的模式规则类似 Unix shell 中的通配符。这对于需要批量处理符合某种命名规则的文件非常有用。</p><h5 id="glob-常用功能"><a href="#glob-常用功能" class="headerlink" title="glob 常用功能"></a><code>glob</code> 常用功能</h5><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>glob.glob(pathname, *, recursive=False)</code></td><td>返回一个包含所有匹配 <code>pathname</code> 模式的文件和目录路径的列表。</td></tr><tr><td><code>glob.iglob(pathname, *, recursive=False)</code></td><td>返回一个迭代器，逐个产生匹配 <code>pathname</code> 模式的文件和目录路径 (更节省内存)。</td></tr><tr><td><code>glob.escape(pathname)</code></td><td>对 <code>pathname</code> 中的特殊字符 (如 <code>*</code>, <code>?</code>, <code>[</code>) 进行转义，使其能被字面匹配。</td></tr></tbody></table><p><strong><code>glob</code> 模式中的特殊字符：</strong></p><ul><li><code>*</code>: 匹配任意多个（包括零个）任意字符。</li><li><code>?</code>: 匹配单个任意字符。</li><li><code>[...]</code>: 匹配方括号中出现的任意一个字符 (例如 <code>[abc]</code> 匹配 ‘a’, ‘b’, 或 ‘c’)。可以使用连字符表示范围 (例如 <code>[0-9]</code> 匹配任意数字)。</li><li><code>[!...]</code>: 匹配任意不在方括号中出现的字符。</li><li><code>**</code> (当 <code>recursive=True</code> 时): 匹配任意文件和任意层级的目录 (递归匹配)。</li></ul><blockquote><p><strong>批注：核心记忆功能 (<code>glob</code> 模块)</strong></p><ul><li><code>glob.glob(pattern)</code>: 最常用的功能，直接获取所有匹配路径的列表。</li><li>理解 <code>*</code>, <code>?</code>, <code>[...]</code> 通配符的含义。</li><li><code>recursive=True</code> 配合 <code>**</code> 进行递归搜索。</li></ul></blockquote><h5 id="glob-模块代码示例"><a href="#glob-模块代码示例" class="headerlink" title="glob 模块代码示例"></a><code>glob</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil <span class="comment"># 用于创建和清理测试目录/文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. glob 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"glob 模块功能演示"</span>)</span><br><span class="line">test_glob_dir = <span class="string">"glob_playground"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_glob_test_environment</span>():</span><br><span class="line">    print_info(<span class="string">f"创建测试环境 '<span class="subst">{test_glob_dir}</span>'..."</span>)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(test_glob_dir):</span><br><span class="line">        shutil.rmtree(test_glob_dir) <span class="comment"># 清理旧的测试目录</span></span><br><span class="line">    os.makedirs(os.path.join(test_glob_dir, <span class="string">"subdir1"</span>, <span class="string">"subsubdir"</span>), exist_ok=<span class="literal">True</span>)</span><br><span class="line">    os.makedirs(os.path.join(test_glob_dir, <span class="string">"subdir2"</span>), exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建一些测试文件</span></span><br><span class="line">    files_to_create = [</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"report.txt"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"report_final.txt"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"image01.jpg"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"image02.png"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"data_2025.csv"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"config.ini"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"subdir1"</span>, <span class="string">"notes.txt"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"subdir1"</span>, <span class="string">"archive.zip"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"subdir1"</span>, <span class="string">"subsubdir"</span>, <span class="string">"deep_log.txt"</span>),</span><br><span class="line">        os.path.join(test_glob_dir, <span class="string">"subdir2"</span>, <span class="string">"backup_2024.dat"</span>),</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> f_path <span class="keyword">in</span> files_to_create:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(f_path, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">f"Content of <span class="subst">{os.path.basename(f_path)}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">"测试文件和目录已创建。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cleanup_glob_test_environment</span>():</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(test_glob_dir):</span><br><span class="line">        shutil.rmtree(test_glob_dir)</span><br><span class="line">        print_info(<span class="string">f"已清理测试环境 '<span class="subst">{test_glob_dir}</span>'。"</span>)</span><br><span class="line"></span><br><span class="line">setup_glob_test_environment()</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 基本通配符匹配 (glob.glob)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 基本通配符匹配 (glob.glob)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配所有 .txt 文件</span></span><br><span class="line">txt_files_pattern = os.path.join(test_glob_dir, <span class="string">"*.txt"</span>)</span><br><span class="line">print_info(<span class="string">f"查找模式: '<span class="subst">{txt_files_pattern}</span>'"</span>)</span><br><span class="line">found_txt_files = glob.glob(txt_files_pattern)</span><br><span class="line">print_info(<span class="string">f"  找到的 .txt 文件: <span class="subst">{found_txt_files}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配所有以 'image' 开头的文件</span></span><br><span class="line">image_files_pattern = os.path.join(test_glob_dir, <span class="string">"image*"</span>)</span><br><span class="line">print_info(<span class="string">f"查找模式: '<span class="subst">{image_files_pattern}</span>'"</span>)</span><br><span class="line">found_image_files = glob.glob(image_files_pattern)</span><br><span class="line">print_info(<span class="string">f"  找到的以 'image' 开头的文件: <span class="subst">{found_image_files}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配单个字符 'image0?.jpg' 或 'image0?.png'</span></span><br><span class="line">specific_image_pattern = os.path.join(test_glob_dir, <span class="string">"image0?.jp*g"</span>) <span class="comment"># ? 匹配一个字符, * 匹配多个</span></span><br><span class="line">print_info(<span class="string">f"查找模式: '<span class="subst">{specific_image_pattern}</span>'"</span>)</span><br><span class="line">found_specific_images = glob.glob(specific_image_pattern)</span><br><span class="line">print_info(<span class="string">f"  找到的 'image0X.jp(e)g' 文件: <span class="subst">{found_specific_images}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配字符集 [abc] 或 [0-9]</span></span><br><span class="line">data_files_pattern = os.path.join(test_glob_dir, <span class="string">"data_[0-9][0-9][0-9][0-9].csv"</span>)</span><br><span class="line">print_info(<span class="string">f"查找模式: '<span class="subst">{data_files_pattern}</span>'"</span>)</span><br><span class="line">found_data_files = glob.glob(data_files_pattern)</span><br><span class="line">print_info(<span class="string">f"  找到的 'data_YYYY.csv' 文件: <span class="subst">{found_data_files}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 递归匹配 (recursive=True 和 ** 通配符)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 递归匹配 (recursive=True 和 **)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归查找所有子目录中的 .txt 文件</span></span><br><span class="line"><span class="comment"># 注意: '**' 必须单独作为路径的一部分才能正确递归</span></span><br><span class="line">recursive_txt_pattern = os.path.join(test_glob_dir, <span class="string">"**"</span>, <span class="string">"*.txt"</span>)</span><br><span class="line">print_info(<span class="string">f"递归查找模式: '<span class="subst">{recursive_txt_pattern}</span>'"</span>)</span><br><span class="line">all_txt_recursively = glob.glob(recursive_txt_pattern, recursive=<span class="literal">True</span>)</span><br><span class="line">print_info(<span class="string">f"  递归找到的所有 .txt 文件: <span class="subst">{all_txt_recursively}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 使用迭代器进行匹配 (glob.iglob)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. 使用迭代器进行匹配 (glob.iglob)"</span>)</span><br><span class="line">print_info(<span class="string">f"使用 iglob 迭代查找 '<span class="subst">{recursive_txt_pattern}</span>' (适合大量匹配结果):"</span>)</span><br><span class="line"><span class="comment"># iglob 返回一个迭代器，当你处理大量文件时可以节省内存</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> filepath <span class="keyword">in</span> glob.iglob(recursive_txt_pattern, recursive=<span class="literal">True</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"    - (iglob) 找到: <span class="subst">{filepath}</span>"</span>)</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">print_success(<span class="string">f"  iglob 共找到 <span class="subst">{count}</span> 个匹配项。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 转义特殊字符 (glob.escape)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"4. 转义特殊字符 (glob.escape)"</span>)</span><br><span class="line"><span class="comment"># 假设我们有一个文件名包含特殊字符，例如 'file_with[star]*.txt'</span></span><br><span class="line"><span class="comment"># 如果想字面匹配它，而不是让 '*' 和 '[]' 作为通配符，就需要转义</span></span><br><span class="line">literal_filename_with_star = <span class="string">"file_with[star]*.txt"</span></span><br><span class="line"><span class="comment"># os.path.join(test_glob_dir, literal_filename_with_star) # 如果实际创建此文件</span></span><br><span class="line"></span><br><span class="line">escaped_pattern_part = glob.escape(literal_filename_with_star)</span><br><span class="line">print_info(<span class="string">f"  原始文件名含特殊字符: '<span class="subst">{literal_filename_with_star}</span>'"</span>)</span><br><span class="line">print_info(<span class="string">f"  转义后的部分: '<span class="subst">{escaped_pattern_part}</span>'"</span>)</span><br><span class="line"><span class="comment"># 完整的查找模式会是: os.path.join(test_glob_dir, escaped_pattern_part)</span></span><br><span class="line"><span class="comment"># 假设我们真的创建了这个文件:</span></span><br><span class="line"><span class="comment"># with open(os.path.join(test_glob_dir, literal_filename_with_star), 'w') as f: f.write("test")</span></span><br><span class="line"><span class="comment"># found_escaped = glob.glob(os.path.join(test_glob_dir, escaped_pattern_part))</span></span><br><span class="line"><span class="comment"># print_info(f"  查找转义后的模式结果: {found_escaped}")</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cleanup_glob_test_environment()</span><br><span class="line">print_header(<span class="string">"glob 模块演示结束。"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>glob</code> 模块)</strong>:</p><ul><li><strong><code>**</code> 与 <code>recursive=True</code></strong>: 要想让 <code>**</code> 通配符实现递归匹配（即匹配任意层级的子目录），必须同时在 <code>glob.glob()</code> 或 <code>glob.iglob()</code> 函数中将 <code>recursive</code> 参数设置为 <code>True</code>。</li><li><strong>路径分隔符</strong>: <code>glob</code> 模块会自动处理当前操作系统的路径分隔符（Windows 上的 <code>\</code> 和 Linux/macOS 上的 <code>/</code>）。你在模式中可以使用 <code>/</code>，它在 Windows 上也能正常工作。</li><li><strong>结果顺序</strong>: <code>glob</code> 函数返回的路径列表的顺序是不确定的，它依赖于操作系统底层 <code>listdir()</code> 函数返回的顺序。如果需要排序的结果，你需要自己对返回的列表进行排序（例如 <code>sorted(glob.glob(...))</code>）。</li><li><strong>性能</strong>: 对于非常大的目录结构或非常多的文件，<code>glob.glob()</code> 会一次性将所有匹配项加载到内存中，可能消耗较多内存。在这种情况下，使用 <code>glob.iglob()</code> 返回一个迭代器会更节省内存，因为它逐个产生匹配项。</li><li><strong>隐藏文件 (以 <code>.</code>开头的文件)</strong>: 在 Unix-like 系统上，像 <code>*</code> 这样的通配符默认不会匹配以点 <code>.</code> 开头的隐藏文件或目录名。如果需要匹配它们，模式需要显式地包含点，例如 <code>.*</code> 或 <code>.[^.]*</code>。</li><li><strong><code>pathlib</code> 模块的替代方案</strong>: Python 3.4+ 引入的 <code>pathlib</code> 模块提供了面向对象的路径操作。<code>Path</code> 对象有自己的 <code>glob()</code> 和 <code>rglob()</code> (recursive glob) 方法，使用起来可能更直观和 Pythonic。例如：<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line">p = Path(<span class="string">"./my_dir"</span>)</span><br><span class="line">txt_files = <span class="built_in">list</span>(p.glob(<span class="string">"*.txt"</span>))       <span class="comment"># 非递归</span></span><br><span class="line">all_py_files = <span class="built_in">list</span>(p.rglob(<span class="string">"*.py"</span>))    <span class="comment"># 递归</span></span><br></pre></td></tr></tbody></table></figure></li><li><strong>无匹配项</strong>: 如果没有文件或目录匹配给定的模式，<code>glob.glob()</code> 会返回一个空列表，<code>glob.iglob()</code> 会返回一个空的迭代器。程序不会因此报错。</li></ul></blockquote><h4 id="uuid-模块：生成通用唯一标识符"><a href="#uuid-模块：生成通用唯一标识符" class="headerlink" title="uuid 模块：生成通用唯一标识符"></a><code>uuid</code> 模块：生成通用唯一标识符</h4><p>UUID (Universally Unique Identifier) 是一种128位长的数字，设计用来在空间和时间上保证唯一性，而不需要一个中央协调机构。<code>uuid</code> 模块提供了生成各种版本 UUID 的功能。这些 ID 在分布式系统、数据库主键、临时文件名、会话 ID 等场景中非常有用。</p><h5 id="uuid-常用功能与版本"><a href="#uuid-常用功能与版本" class="headerlink" title="uuid 常用功能与版本"></a><code>uuid</code> 常用功能与版本</h5><table><thead><tr><th>函数/属性</th><th>描述</th></tr></thead><tbody><tr><td><code>uuid.uuid1([node, clock_seq])</code></td><td>基于当前时间和计算机的 MAC 地址生成 UUID (版本1)。可能涉及隐私。</td></tr><tr><td><code>uuid.uuid3(namespace, name)</code></td><td>基于一个命名空间 UUID 和一个名称的 MD5 哈希值生成 UUID (版本3)，结果是确定的。</td></tr><tr><td><code>uuid.uuid4()</code></td><td><strong>推荐常用</strong>：生成一个完全随机的 UUID (版本4)。</td></tr><tr><td><code>uuid.uuid5(namespace, name)</code></td><td>基于一个命名空间 UUID 和一个名称的 SHA-1 哈希值生成 UUID (版本5)，结果是确定的。</td></tr><tr><td><code>UUID(hex=..., bytes=..., int=...)</code></td><td>(类构造器) 从不同表示形式（十六进制字符串、字节串、整数）创建一个 UUID 对象。</td></tr><tr><td><code>my_uuid.hex</code></td><td>(UUID对象属性) 获取 UUID 的32个字符的十六进制字符串表示 (无连字符)。</td></tr><tr><td><code>str(my_uuid)</code></td><td>(UUID对象转字符串) 获取 UUID 的标准36个字符的十六进制字符串表示 (带连字符)。</td></tr><tr><td><code>my_uuid.bytes</code></td><td>(UUID对象属性) 获取 UUID 的16字节表示。</td></tr><tr><td><code>my_uuid.int</code></td><td>(UUID对象属性) 获取 UUID 的128位整数表示。</td></tr><tr><td><code>my_uuid.version</code></td><td>(UUID对象属性) 获取 UUID 的版本号 (1, 3, 4, 或 5)。</td></tr></tbody></table><p><strong>预定义的命名空间 (用于 <code>uuid3</code> 和 <code>uuid5</code>):</strong></p><ul><li><code>uuid.NAMESPACE_DNS</code>: 当 <code>name</code> 是一个完全限定域名时使用。</li><li><code>uuid.NAMESPACE_URL</code>: 当 <code>name</code> 是一个 URL 时使用。</li><li><code>uuid.NAMESPACE_OID</code>: 当 <code>name</code> 是一个 ISO OID 时使用。</li><li><code>uuid.NAMESPACE_X500</code>: 当 <code>name</code> 是一个 X.500 DN 时使用。</li></ul><blockquote><p><strong>批注：核心记忆功能 (<code>uuid</code> 模块)</strong></p><ul><li><code>uuid.uuid4()</code>: <strong>最常用</strong>，用于生成随机的、无法预测的唯一 ID。</li><li><code>str(generated_uuid)</code>: 将 UUID 对象转换为标准的带连字符的字符串形式，便于存储和显示。</li><li><code>generated_uuid.hex</code>: 获取不带连字符的紧凑十六进制字符串。</li></ul></blockquote><h5 id="uuid-模块代码示例"><a href="#uuid-模块代码示例" class="headerlink" title="uuid 模块代码示例"></a><code>uuid</code> 模块代码示例</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. uuid 模块演示准备</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"uuid 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 生成 UUID 版本 1 (基于时间和 MAC 地址)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 生成 UUID 版本 1 (基于时间和 MAC 地址)"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    uuid_v1 = uuid.uuid1()</span><br><span class="line">    print_info(<span class="string">f"UUID v1: <span class="subst">{uuid_v1}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  - 字符串表示: <span class="subst">{<span class="built_in">str</span>(uuid_v1)}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  - 十六进制 (hex): <span class="subst">{uuid_v1.<span class="built_in">hex</span>}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  - 版本号: <span class="subst">{uuid_v1.version}</span>"</span>)</span><br><span class="line">    <span class="comment"># print_info(f"  - 节点 (可能含MAC地址): {uuid_v1.node:x}") # 以十六进制显示节点</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print_warning(<span class="string">f"生成 UUID v1 时可能出现问题 (例如，无法获取 MAC 地址): <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 生成 UUID 版本 4 (随机生成 - 推荐常用)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 生成 UUID 版本 4 (随机生成)"</span>)</span><br><span class="line">uuid_v4_1 = uuid.uuid4()</span><br><span class="line">uuid_v4_2 = uuid.uuid4()</span><br><span class="line">print_info(<span class="string">f"UUID v4 (示例1): <span class="subst">{uuid_v4_1}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  - 字符串表示: <span class="subst">{<span class="built_in">str</span>(uuid_v4_1)}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  - 十六进制 (hex): <span class="subst">{uuid_v4_1.<span class="built_in">hex</span>}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  - 版本号: <span class="subst">{uuid_v4_1.version}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"UUID v4 (示例2): <span class="subst">{uuid_v4_2}</span> (每次调用都不同)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 生成 UUID 版本 3 (基于命名空间和名称的 MD5 哈希)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. 生成 UUID 版本 3 (MD5 哈希)"</span>)</span><br><span class="line"><span class="comment"># uuid3 和 uuid5 是确定性的：相同的命名空间和名称总是产生相同的 UUID</span></span><br><span class="line">namespace_for_v3 = uuid.NAMESPACE_DNS <span class="comment"># 使用预定义的 DNS 命名空间</span></span><br><span class="line">name_for_v3 = <span class="string">"example.com"</span></span><br><span class="line">uuid_v3 = uuid.uuid3(namespace_for_v3, name_for_v3)</span><br><span class="line">print_info(<span class="string">f"UUID v3 (NAMESPACE_DNS, '<span class="subst">{name_for_v3}</span>'): <span class="subst">{uuid_v3}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  - 版本号: <span class="subst">{uuid_v3.version}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次用相同参数生成，结果应该一样</span></span><br><span class="line">uuid_v3_again = uuid.uuid3(namespace_for_v3, name_for_v3)</span><br><span class="line">print_info(<span class="string">f"  再次生成 (应相同): <span class="subst">{uuid_v3_again == uuid_v3}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 生成 UUID 版本 5 (基于命名空间和名称的 SHA-1 哈希)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"4. 生成 UUID 版本 5 (SHA-1 哈希)"</span>)</span><br><span class="line">namespace_for_v5 = uuid.NAMESPACE_URL <span class="comment"># 使用预定义的 URL 命名空间</span></span><br><span class="line">name_for_v5 = <span class="string">"https://www.python.org/"</span></span><br><span class="line">uuid_v5 = uuid.uuid5(namespace_for_v5, name_for_v5)</span><br><span class="line">print_info(<span class="string">f"UUID v5 (NAMESPACE_URL, '<span class="subst">{name_for_v5}</span>'): <span class="subst">{uuid_v5}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  - 版本号: <span class="subst">{uuid_v5.version}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 5. 从字符串或其他形式创建 UUID 对象</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"5. 从字符串或其他形式创建 UUID 对象"</span>)</span><br><span class="line">uuid_string = <span class="string">"a1b2c3d4-e5f6-7890-1234-567890abcdef"</span> <span class="comment"># 必须是标准格式</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    uuid_from_string = uuid.UUID(uuid_string)</span><br><span class="line">    print_info(<span class="string">f"从字符串 '<span class="subst">{uuid_string}</span>' 创建的 UUID 对象: <span class="subst">{uuid_from_string}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  其整数表示 (uuid_from_string.int): <span class="subst">{uuid_from_string.<span class="built_in">int</span>}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  其字节表示 (uuid_from_string.bytes): <span class="subst">{uuid_from_string.<span class="built_in">bytes</span>}</span>"</span>)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    print_error(<span class="string">f"从字符串创建 UUID 失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">"uuid 模块演示结束。"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>uuid</code> 模块)</strong>:</p><ul><li><strong>版本选择</strong>:<ul><li><strong><code>uuid.uuid4()</code> (版本4)</strong>: <strong>通常是最佳选择</strong>。它生成基于高质量随机数的 UUID，碰撞概率极低，且不包含任何可识别的硬件或时间信息，因此对隐私更友好。</li><li><code>uuid.uuid1()</code> (版本1): 基于当前时间和计算机的 MAC 地址生成。虽然能保证在同一台机器上按时间顺序生成（大致上），但它可能暴露生成 UUID 的机器的 MAC 地址和生成时间，存在一定的隐私和安全风险。在需要基于时间排序且能容忍这些风险的特定场景下使用。</li><li><code>uuid.uuid3()</code> 和 <code>uuid.uuid5()</code>: 这两个版本是确定性的，即对于相同的命名空间 UUID 和相同的名称字符串，它们总是生成相同的 UUID。<code>uuid3</code> 使用 MD5 哈希，<code>uuid5</code> 使用 SHA-1 哈希。它们适用于需要基于某个已知名称（如 URL、DNS名、OID等）生成一个唯一的、可重现的标识符的场景。由于 MD5 和 SHA-1 在密码学上已不被认为是强哈希算法，这些 UUID 主要用于标识，而非安全目的。</li></ul></li><li><strong>碰撞概率</strong>: UUID 的设计目标是全球唯一。对于版本4的随机 UUID，其可能性的数量非常巨大（ $2^{122}$ 种，因为有几位用于版本和变体信息），因此两个独立生成的 <code>uuid4</code> 相同的概率微乎其微，在实际应用中基本可以忽略。</li><li><strong>存储与表示</strong>:<ul><li><code>str(my_uuid_obj)</code>: 返回标准的36字符十六进制表示，包含连字符 (例如 <code>xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx</code>)。这是最常见的交换和显示格式。</li><li><code>my_uuid_obj.hex</code>: 返回32字符的紧凑十六进制表示，不含连字符。</li><li><code>my_uuid_obj.bytes</code>: 返回16字节的字节串表示。</li><li><code>my_uuid_obj.int</code>: 返回128位的整数表示。<br>根据存储系统（数据库、文件名等）的要求和效率选择合适的表示形式。例如，某些数据库可能对存储字节串或整数形式的 UUID 更高效。</li></ul></li><li><strong>命名空间的使用 (<code>uuid3</code>, <code>uuid5</code>)</strong>: 当使用 <code>uuid3</code> 或 <code>uuid5</code> 时，选择合适的预定义命名空间（<code>NAMESPACE_DNS</code>, <code>NAMESPACE_URL</code>, <code>NAMESPACE_OID</code>, <code>NAMESPACE_X500</code>）或者自己生成一个固定的 UUID 作为自定义命名空间，对于确保生成的 ID 的上下文和唯一性非常重要。</li></ul></blockquote><h3 id="7-底层工具库"><a href="#7-底层工具库" class="headerlink" title="7.底层工具库"></a>7.底层工具库</h3><p>本小节将探讨 Python 标准库中一系列强大的工具，它们可以帮助我们更有效地处理迭代、函数式编程、数据复制、美化输出、定义枚举、实现抽象基类以及运用类型提示来构建更健壮的应用程序。</p><h5 id="typing-模块：类型提示支持"><a href="#typing-模块：类型提示支持" class="headerlink" title="typing 模块：类型提示支持"></a><code>typing</code> 模块：类型提示支持</h5><p><code>typing</code> 模块是 Python 中用于支持类型提示 (Type Hints) 的核心工具。类型提示允许开发者为变量、函数参数和函数返回值指定预期的类型。虽然 Python 本质上是动态类型语言（类型在运行时检查），但类型提示有诸多好处：</p><ul><li><strong>提高代码可读性和可理解性</strong>：明确了函数期望什么类型的输入，以及会返回什么类型的结果。</li><li><strong>辅助静态分析工具</strong>：像 MyPy, Pyright, Pytype 这样的静态类型检查器可以使用类型提示来检测代码中潜在的类型错误，而无需实际运行代码。</li><li><strong>改善IDE支持</strong>：IDE 可以利用类型提示提供更准确的代码补全、重构和错误高亮。</li><li><strong>促进更好的API设计</strong>：思考类型有助于设计出更清晰、更健壮的函数和类接口。</li></ul><p>类型提示在运行时通常不会强制执行（除非使用特定库如 <code>pydantic</code>），它们更多的是给开发者和工具看的元数据。</p><h6 id="typing-常用类型与构造器"><a href="#typing-常用类型与构造器" class="headerlink" title="typing 常用类型与构造器"></a><code>typing</code> 常用类型与构造器</h6><table><thead><tr><th>类型/构造器</th><th>描述</th></tr></thead><tbody><tr><td><code>List[T]</code> (或 Python 3.9+ <code>list[T]</code>)</td><td>表示元素类型为 <code>T</code> 的列表。例如 <code>List[int]</code> 表示整数列表。</td></tr><tr><td><code>Dict[K, V]</code> (或 Python 3.9+ <code>dict[K, V]</code>)</td><td>表示键类型为 <code>K</code>、值类型为 <code>V</code> 的字典。例如 <code>Dict[str, int]</code>。</td></tr><tr><td><code>Tuple[T1, T2, ...]</code> (或 Python 3.9+ <code>tuple[T1, ...]</code>)</td><td>表示一个元组，其中每个元素都有特定的类型。例如 <code>Tuple[str, int, bool]</code>。</td></tr><tr><td><code>Tuple[T, ...]</code> (或 Python 3.9+ <code>tuple[T, ...]</code>)</td><td>表示一个所有元素类型均为 <code>T</code> 的可变长度元组。</td></tr><tr><td><code>Set[T]</code> (或 Python 3.9+ <code>set[T]</code>)</td><td>表示元素类型为 <code>T</code> 的集合。例如 <code>Set[str]</code>。</td></tr><tr><td><code>Optional[T]</code></td><td>表示一个值可以是类型 <code>T</code> 或者 <code>None</code>。等价于 <code>Union[T, None]</code>。</td></tr><tr><td><code>Union[T1, T2, ...]</code> (或 Python 3.10+ `T1</td><td>T2</td></tr><tr><td><code>Any</code></td><td>表示一个未受约束的类型，可以是任何类型 (应谨慎使用，因为它会削弱类型检查)。</td></tr><tr><td><code>Callable[[Arg1Type, Arg2Type], ReturnType]</code></td><td>表示一个可调用对象 (如函数)，指定其参数类型和返回类型。</td></tr><tr><td><code>TypeVar('T')</code></td><td>用于定义泛型类型变量，常用于编写泛型函数和类。</td></tr><tr><td><code>Generic[T]</code></td><td>用于创建泛型类的基类。</td></tr><tr><td><code>NewType('TypeName', BaseType)</code></td><td>创建一个概念上不同但运行时与 <code>BaseType</code> 相同的“新类型”，主要用于静态类型检查。</td></tr><tr><td><code>Type[C]</code></td><td>表示类 <code>C</code> 本身 (或其子类)，而不是 <code>C</code> 的实例。</td></tr><tr><td><code>Iterable[T]</code>, <code>Iterator[T]</code></td><td>分别表示可迭代对象和迭代器，其元素类型为 <code>T</code>。</td></tr><tr><td><code>Mapping[K, V]</code>, <code>Sequence[T]</code></td><td>表示更通用的映射类型 (如字典) 和序列类型 (如列表、元组)。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>typing</code> 模块)</strong></p><ul><li>基本集合类型：<code>List</code>, <code>Dict</code>, <code>Tuple</code>, <code>Set</code> 的泛型版本。</li><li><code>Optional[T]</code>: 处理可能为 <code>None</code> 的值。</li><li><code>Union[T1, T2]</code>: 当一个值可能有几种不同类型时使用 (或 Python 3.10+ 的 <code>T1 | T2</code> 语法)。</li><li><code>Callable</code>: 为回调函数或作为参数传递的函数指定签名。</li><li><code>Any</code>: 在确实无法或不需要指定具体类型时使用，但应尽量避免滥用。</li><li><strong>Python 3.9+ 的改进</strong>: 许多标准集合类型 (如 <code>list</code>, <code>dict</code>, <code>tuple</code>, <code>set</code>)可以直接用作泛型类型，无需从 <code>typing</code> 模块导入对应的大写版本。例如，用 <code>list[int]</code> 代替 <code>List[int]</code>。</li><li><strong>Python 3.10+ 的改进</strong>: 引入了 <code>|</code> 操作符作为 <code>Union</code> 的更简洁语法，例如 <code>int | str</code> 代替 <code>Union[int, str]</code>。</li></ul></blockquote><h6 id="typing-模块代码示例"><a href="#typing-模块代码示例" class="headerlink" title="typing 模块代码示例"></a><code>typing</code> 模块代码示例</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">## 对于 Python 3.9+，许多大写的类型 (List, Dict等) 可以用小写内置类型替代</span></span><br><span class="line"><span class="comment">## 例如，用 list[int] 代替 List[int]</span></span><br><span class="line"><span class="comment">## 为了兼容性，这里仍然使用 typing 中的大写版本，除非特别说明</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> (</span><br><span class="line">    <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Tuple</span>, <span class="type">Set</span>, <span class="type">Optional</span>, <span class="type">Union</span>, <span class="type">Any</span>, <span class="type">Callable</span>, </span><br><span class="line">    TypeVar, <span class="type">Generic</span>, NewType, <span class="type">Type</span>, <span class="type">Sequence</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># 用于示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 0. typing 模块演示准备</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_header(<span class="string">"typing 模块 (类型提示) 功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 1. 基本类型提示 (函数参数和返回值)</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 基本类型提示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">name: <span class="built_in">str</span>, age: <span class="built_in">int</span>, is_vip: <span class="built_in">bool</span> = <span class="literal">False</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">"""根据用户信息生成问候语。"""</span></span><br><span class="line">    title: <span class="built_in">str</span> = <span class="string">"VIP "</span> <span class="keyword">if</span> is_vip <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"Hello, <span class="subst">{title}</span><span class="subst">{name}</span>! You are <span class="subst">{age}</span> years old."</span></span><br><span class="line"></span><br><span class="line">message: <span class="built_in">str</span> = greet(<span class="string">"Alice"</span>, <span class="number">30</span>, is_vip=<span class="literal">True</span>)</span><br><span class="line">print_success(<span class="string">f"greet() 返回: <span class="subst">{message}</span>"</span>)</span><br><span class="line"><span class="comment">## message = greet("Bob", "forty") # MyPy 这类静态检查器会警告 "forty" 不是 int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">data: <span class="type">List</span>[<span class="built_in">int</span>], factor: <span class="built_in">float</span> = <span class="number">1.0</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">"""处理一个整数列表，返回一个浮点数列表。"""</span></span><br><span class="line">    <span class="keyword">return</span> [item * factor <span class="keyword">for</span> item <span class="keyword">in</span> data]</span><br><span class="line"></span><br><span class="line">int_list: <span class="type">List</span>[<span class="built_in">int</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">float_list: <span class="type">List</span>[<span class="built_in">float</span>] = process_data(int_list, <span class="number">0.5</span>)</span><br><span class="line">print_success(<span class="string">f"process_data(<span class="subst">{int_list}</span>, 0.5) 返回: <span class="subst">{float_list}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 2. Optional, Union, Any</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. Optional, Union, Any"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_user</span>(<span class="params">user_id: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">    <span class="string">"""根据用户ID查找用户，如果找不到则返回 None。"""</span></span><br><span class="line">    users_db: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]] = {</span><br><span class="line">        <span class="number">101</span>: {<span class="string">"name"</span>: <span class="string">"Alice"</span>, <span class="string">"email"</span>: <span class="string">"alice@example.com"</span>},</span><br><span class="line">        <span class="number">102</span>: {<span class="string">"name"</span>: <span class="string">"Bob"</span>, <span class="string">"active"</span>: <span class="literal">False</span>}</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> users_db.get(user_id) <span class="comment"># .get() 找不到键时默认返回 None</span></span><br><span class="line"></span><br><span class="line">user_profile: <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]] = find_user(<span class="number">101</span>)</span><br><span class="line"><span class="keyword">if</span> user_profile:</span><br><span class="line">    print_success(<span class="string">f"找到用户 101: <span class="subst">{user_profile}</span>"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_warning(<span class="string">"用户 101 未找到。"</span>)</span><br><span class="line"></span><br><span class="line">user_profile_none: <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]] = find_user(<span class="number">999</span>)</span><br><span class="line">print_info(<span class="string">f"查找用户 999: <span class="subst">{user_profile_none}</span>"</span>) <span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_value</span>(<span class="params">value: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">int</span>, <span class="built_in">float</span>]</span>) -&gt; <span class="built_in">str</span>: <span class="comment"># Python 3.10+ 可以写 str | int | float</span></span><br><span class="line">    <span class="string">"""根据不同类型的值返回描述。"""</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"String value: '<span class="subst">{value}</span>'"</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(value, <span class="built_in">int</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Integer value: <span class="subst">{value}</span>"</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(value, <span class="built_in">float</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Float value: <span class="subst">{value:<span class="number">.2</span>f}</span>"</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Unknown type"</span> <span class="comment"># 理论上不会到这里，因为 Union 限制了类型</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"parse_value('hello'): <span class="subst">{parse_value(<span class="string">'hello'</span>)}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"parse_value(123): <span class="subst">{parse_value(<span class="number">123</span>)}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"parse_value(3.14159): <span class="subst">{parse_value(<span class="number">3.14159</span>)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_anything</span>(<span class="params">data: <span class="type">Any</span>, operation: <span class="built_in">str</span> = <span class="string">"print"</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""处理任何类型的数据 (应谨慎使用 Any)。"""</span></span><br><span class="line">    print_info(<span class="string">f"Processing '<span class="subst">{operation}</span>' on data of type <span class="subst">{<span class="built_in">type</span>(data).__name__}</span>: <span class="subst">{data}</span>"</span>)</span><br><span class="line"></span><br><span class="line">process_anything([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">"summing (simulated)"</span>)</span><br><span class="line">process_anything({<span class="string">"key"</span>: <span class="string">"value"</span>}, <span class="string">"logging (simulated)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 3. Callable (可调用对象)</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. Callable (可调用对象)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_operation</span>(<span class="params">x: <span class="built_in">int</span>, y: <span class="built_in">int</span>, operation: <span class="type">Callable</span>[[<span class="built_in">int</span>, <span class="built_in">int</span>], <span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">"""应用一个二元整数操作并返回结果。"""</span></span><br><span class="line">    <span class="keyword">return</span> operation(x, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>: <span class="keyword">return</span> a + b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>: <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line">result_add: <span class="built_in">int</span> = apply_operation(<span class="number">10</span>, <span class="number">5</span>, add)</span><br><span class="line">result_multiply: <span class="built_in">int</span> = apply_operation(<span class="number">10</span>, <span class="number">5</span>, multiply)</span><br><span class="line"><span class="comment">## result_wrong = apply_operation(10, 5, lambda s: s.upper()) # MyPy 会报错，lambda签名不匹配</span></span><br><span class="line"></span><br><span class="line">print_success(<span class="string">f"apply_operation(10, 5, add) = <span class="subst">{result_add}</span>"</span>)</span><br><span class="line">print_success(<span class="string">f"apply_operation(10, 5, multiply) = <span class="subst">{result_multiply}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 4. TypeVar 和 Generic (泛型)</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"4. TypeVar 和 Generic (泛型)"</span>)</span><br><span class="line"></span><br><span class="line">T = TypeVar(<span class="string">'T'</span>) <span class="comment"># 定义一个类型变量 T (可以是任何类型)</span></span><br><span class="line">K = TypeVar(<span class="string">'K'</span>)</span><br><span class="line">V = TypeVar(<span class="string">'V'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_first_element</span>(<span class="params">items: <span class="type">Sequence</span>[T]</span>) -&gt; <span class="type">Optional</span>[T]: <span class="comment"># Sequence[T] 比 List[T] 更通用</span></span><br><span class="line">    <span class="string">"""获取序列的第一个元素，如果序列为空则返回 None。"""</span></span><br><span class="line">    <span class="keyword">return</span> items[<span class="number">0</span>] <span class="keyword">if</span> items <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"get_first_element([10, 20, 30]): <span class="subst">{get_first_element([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>])}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"get_first_element(['a', 'b']): <span class="subst">{get_first_element([<span class="string">'a'</span>, <span class="string">'b'</span>])}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"get_first_element([]): <span class="subst">{get_first_element([])}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span>(<span class="type">Generic</span>[T]): <span class="comment"># 定义一个泛型类 Container，它可以容纳类型 T 的项目</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, item: T</span>):</span><br><span class="line">        <span class="variable language_">self</span>._item: T = item</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_item</span>(<span class="params">self</span>) -&gt; T:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._item</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Container[<span class="subst">{<span class="built_in">type</span>(self._item).__name__}</span>](item=<span class="subst">{self._item!r}</span>)"</span></span><br><span class="line"></span><br><span class="line">int_container = Container[<span class="built_in">int</span>](<span class="number">123</span>) <span class="comment"># 明确指定 T 是 int</span></span><br><span class="line">str_container = Container(<span class="string">"hello"</span>)  <span class="comment"># 类型检查器通常能推断出 T 是 str</span></span><br><span class="line"></span><br><span class="line">print_success(<span class="string">f"int_container: <span class="subst">{int_container}</span>, item: <span class="subst">{int_container.get_item()}</span>"</span>)</span><br><span class="line">print_success(<span class="string">f"str_container: <span class="subst">{str_container}</span>, item: <span class="subst">{str_container.get_item()}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 5. NewType 和 Type (简介)</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"5. NewType 和 Type (简介)"</span>)</span><br><span class="line"></span><br><span class="line">UserId = NewType(<span class="string">'UserId'</span>, <span class="built_in">int</span>) <span class="comment"># 创建一个概念上不同的类型 UserId，但运行时它仍然是 int</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_by_id</span>(<span class="params">user_id: UserId</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line"><span class="comment">#    # MyPy 会将 user_id 视为 UserId 类型，有助于防止意外传递普通 int</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"User data for ID <span class="subst">{user_id}</span>"</span></span><br><span class="line"></span><br><span class="line">my_user_id: UserId = UserId(<span class="number">101</span>) <span class="comment"># 创建 UserId 实例</span></span><br><span class="line"><span class="comment">## another_id: int = 102</span></span><br><span class="line"><span class="comment">## print_info(get_user_by_id(another_id)) # MyPy 可能会警告类型不匹配</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"get_user_by_id(my_user_id): <span class="subst">{get_user_by_id(my_user_id)}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  类型 of my_user_id: <span class="subst">{<span class="built_in">type</span>(my_user_id).__name__}</span> (运行时仍是 int)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_instance</span>(<span class="params">cls: <span class="type">Type</span>[Container[<span class="built_in">str</span>]], value: <span class="built_in">str</span></span>) -&gt; Container[<span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">"""创建一个指定类 (必须是 Container[str] 或其子类) 的实例。"""</span></span><br><span class="line">    <span class="keyword">return</span> cls(value)</span><br><span class="line"></span><br><span class="line"><span class="comment">## MyContainer = Container # 可以是 Container 本身</span></span><br><span class="line"><span class="comment">## instance = create_instance(MyContainer, "some_string")</span></span><br><span class="line"><span class="comment">## print_success(f"create_instance(Container, 'some_string'): {instance}")</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">pass</span> <span class="comment"># 演示已在各节内进行</span></span><br><span class="line">print_header(<span class="string">"typing 模块演示结束。"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>typing</code> 模块)</strong>:</p><ul><li><strong>运行时无强制性 (通常)</strong>：类型提示主要是给静态类型检查器（如 MyPy）和 IDE 看的，Python 解释器本身在运行时通常不会因为类型不匹配而报错（除非你使用了像 <code>pydantic</code> 这样会进行运行时验证的库）。它们的目的是在开发阶段帮助发现潜在错误。</li><li><strong>逐渐采用 (Gradual Typing)</strong>：你不需要一次性为整个项目添加类型提示。可以从新的代码开始，或者从项目的关键部分开始，逐步引入类型提示。</li><li><strong><code>Any</code> 的使用</strong>: <code>Any</code> 类型表示“可以是任何类型”，它会有效地关闭对该变量或表达式的类型检查。应尽量避免使用 <code>Any</code>，只在确实无法确定类型或为了兼容旧代码时才用。过度使用 <code>Any</code> 会降低类型提示带来的好处。</li><li><strong>Python 版本与类型提示语法</strong>:<ul><li><strong>Python 3.9+</strong>: 许多标准内置集合类型 (如 <code>list</code>, <code>dict</code>, <code>tuple</code>, <code>set</code>) 可以直接用作泛型类型注解，例如 <code>list[int]</code> 而不是 <code>from typing import List; List[int]</code>。这使得代码更简洁。</li><li><strong>Python 3.10+</strong>: 引入了使用 <code>|</code> 操作符来表示联合类型 (<code>Union</code>) 的语法，例如 <code>int | str</code> 代替 <code>Union[int, str]</code>。还引入了 <code>ParamSpec</code> 和 <code>Concatenate</code> 用于更精确地注解高阶函数和装饰器。</li><li><strong><code>from __future__ import annotations</code></strong>: 在 Python 3.7+ 的文件中，可以在文件顶部添加 <code>from __future__ import annotations</code>。这使得所有类型提示都被视为字符串字面量，从而可以使用在当前 Python 版本中可能尚不支持的未来类型提示语法（例如，在 Python 3.8 中使用 <code>list[int]</code> 而不是 <code>List[int]</code>，如果配合这个导入）。</li></ul></li><li><strong>泛型 (<code>TypeVar</code>, <code>Generic</code>)</strong>: 当你编写的函数或类可以处理多种不同类型的数据，并且希望保持这些类型之间的一致性时（例如，一个函数接受一个列表并返回该列表中的一个元素，元素的类型应该相同），泛型是非常有用的。</li><li><strong>循环导入与类型提示</strong>: 有时在进行类型提示时，如果两个模块相互导入对方定义的类型，可能会导致循环导入问题。一种常见的解决方法是将其中一个导入放在 <code>if TYPE_CHECKING:</code> 块中（需要 <code>from typing import TYPE_CHECKING</code>），或者使用字符串字面量作为类型提示 (例如 <code>my_var: 'MyOtherClass'</code>)。</li><li><strong>类型别名 (Type Aliases)</strong>：对于复杂的类型签名，可以使用类型别名来提高可读性。例如：<br><code>Vector = List[float]</code><br><code>UserRecord = Dict[str, Union[int, str, bool]]</code><br><code>def process_vector(v: Vector) -&gt; None: ...</code></li></ul></blockquote><p><code>itertools</code> 提供了高效的迭代工具，<code>functools</code> 增强了函数式编程能力，<code>copy</code> 解决了对象复制的深浅问题，<code>pprint</code> 让复杂数据显示更友好，<code>enum</code> 带来了更安全和可读的常量定义方式，<code>abc</code> 模块是实现面向对象中接口和抽象的基石，而 <code>typing</code> 模块则为 Python 代码的健壮性和可维护性提供了强大的支持。掌握这些模块能让你的 Python 编程技能更上一层楼。</p><h5 id="itertools-模块：高效的迭代器构建工具"><a href="#itertools-模块：高效的迭代器构建工具" class="headerlink" title="itertools 模块：高效的迭代器构建工具"></a><code>itertools</code> 模块：高效的迭代器构建工具</h5><p><code>itertools</code> 模块提供了一系列用于创建和使用迭代器的函数。这些函数实现了很多常见的迭代算法，运行速度快，内存效率高，并且能够以简洁的方式组合使用。当你需要处理复杂的迭代逻辑时，这个模块往往能提供优雅的解决方案。</p><h6 id="itertools-常用功能"><a href="#itertools-常用功能" class="headerlink" title="itertools 常用功能"></a><code>itertools</code> 常用功能</h6><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>itertools.count(start=0, step=1)</code></td><td>创建一个从 <code>start</code> 开始，按 <code>step</code> 无限递增 (或递减) 的数字迭代器。</td></tr><tr><td><code>itertools.cycle(iterable)</code></td><td>创建一个无限循环遍历 <code>iterable</code> 中元素的迭代器。</td></tr><tr><td><code>itertools.repeat(object[, times])</code></td><td>创建一个重复生成 <code>object</code> 的迭代器，可以指定重复 <code>times</code> 次，或无限重复。</td></tr><tr><td><code>itertools.chain(*iterables)</code></td><td>将多个可迭代对象连接起来，形成一个更长的迭代器。</td></tr><tr><td><code>itertools.islice(iterable, stop)</code> 或 <code>itertools.islice(iterable, start, stop[, step])</code></td><td>从可迭代对象中返回指定切片的元素，类似列表切片但作用于迭代器。</td></tr><tr><td><code>itertools.product(*iterables, repeat=1)</code></td><td>计算多个可迭代对象的笛卡尔积，相当于嵌套的 for 循环。</td></tr><tr><td><code>itertools.permutations(iterable, r=None)</code></td><td>从 <code>iterable</code> 中生成长度为 <code>r</code> 的所有可能排列 (元素不重复，顺序有关)。</td></tr><tr><td><code>itertools.combinations(iterable, r)</code></td><td>从 <code>iterable</code> 中生成长度为 <code>r</code> 的所有可能组合 (元素不重复，顺序无关)。</td></tr><tr><td><code>itertools.combinations_with_replacement(iterable, r)</code></td><td>允许元素重复的组合。</td></tr><tr><td><code>itertools.groupby(iterable, key=None)</code></td><td>根据 <code>key</code> 函数对连续的元素进行分组，返回 (键, 组内元素迭代器) 对。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>itertools</code> 模块)</strong></p><ul><li><code>count()</code>, <code>cycle()</code>, <code>repeat()</code>: 创建特定模式的无限或有限迭代器。</li><li><code>chain()</code>: 轻松合并多个序列。</li><li><code>product()</code>, <code>permutations()</code>, <code>combinations()</code>: 处理排列组合问题。</li><li><code>groupby()</code>: 对已排序或按键分组的数据进行聚合处理。</li><li><code>islice()</code>: 安全地从无限迭代器或普通迭代器中取一部分。</li></ul></blockquote><h6 id="itertools-模块代码示例"><a href="#itertools-模块代码示例" class="headerlink" title="itertools 模块代码示例"></a><code>itertools</code> 模块代码示例</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Iterable, <span class="type">Any</span>, <span class="type">Tuple</span>, Iterator, <span class="type">List</span>  <span class="comment"># 用于类型注解</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 0. itertools 模块演示准备</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_header(<span class="string">"itertools 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 1. 无限迭代器 (count, cycle, repeat) 与 islice</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 无限迭代器与 islice"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_infinite_iterators</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 count, cycle, repeat 及如何使用 islice 获取部分元素。"""</span></span><br><span class="line">    print_info(<span class="string">"itertools.count(start, step):"</span>)</span><br><span class="line">    <span class="comment">#    # count(10, 2) 会生成 10, 12, 14, ...</span></span><br><span class="line">    <span class="comment">#    # islice 用于从迭代器中获取指定数量的元素，避免无限循环</span></span><br><span class="line">    limited_count: <span class="type">List</span>[<span class="built_in">int</span>] = <span class="built_in">list</span>(itertools.islice(itertools.count(<span class="number">10</span>, <span class="number">2</span>), <span class="number">5</span>))</span><br><span class="line">    print_success(<span class="string">f"  从 count(10, 2) 中获取前5个元素: <span class="subst">{limited_count}</span>"</span>)  <span class="comment"># 输出: [10, 12, 14, 16, 18]</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\nitertools.cycle(iterable):"</span>)</span><br><span class="line">    <span class="comment">#    # cycle(['A', 'B', 'C']) 会生成 A, B, C, A, B, C, ...</span></span><br><span class="line">    limited_cycle: <span class="type">List</span>[<span class="built_in">str</span>] = <span class="built_in">list</span>(itertools.islice(itertools.cycle([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]), <span class="number">8</span>))</span><br><span class="line">    print_success(</span><br><span class="line">        <span class="string">f"  从 cycle(['A', 'B', 'C']) 中获取前8个元素: <span class="subst">{limited_cycle}</span>"</span>)  <span class="comment"># 输出: ['A', 'B', 'C', 'A', 'B', 'C', 'A', 'B']</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\nitertools.repeat(object, times):"</span>)</span><br><span class="line">    <span class="comment">#    # repeat('Hi', 3) 会生成 Hi, Hi, Hi</span></span><br><span class="line">    limited_repeat: <span class="type">List</span>[<span class="built_in">str</span>] = <span class="built_in">list</span>(itertools.islice(itertools.repeat(<span class="string">"Hi"</span>, <span class="number">3</span>), <span class="number">3</span>))</span><br><span class="line">    print_success(<span class="string">f"  从 repeat('Hi', 3) 中获取前3个元素: <span class="subst">{limited_repeat}</span>"</span>)  <span class="comment"># 输出: ['Hi', 'Hi', 'Hi']</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 2. 连接与组合迭代器 (chain, product, permutations, combinations)</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 连接与组合迭代器"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_combining_iterators</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 chain, product, permutations, combinations 的用法。"""</span></span><br><span class="line">    list1: <span class="type">List</span>[<span class="built_in">str</span>] = [<span class="string">'a'</span>, <span class="string">'b'</span>]</span><br><span class="line">    tuple1: <span class="type">Tuple</span>[<span class="built_in">int</span>, ...] = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    string1: <span class="built_in">str</span> = <span class="string">"XY"</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"itertools.chain(*iterables):"</span>)</span><br><span class="line">    <span class="comment"># chain 可以将多个可迭代对象连接在一起</span></span><br><span class="line">    chained_elements: <span class="type">List</span>[<span class="built_in">any</span>] = <span class="built_in">list</span>(itertools.chain(list1, tuple1, string1))</span><br><span class="line">    print_success(<span class="string">f"  连接后的元素: <span class="subst">{chained_elements}</span>"</span>)  <span class="comment"># 输出: ['a', 'b', 1, 2, 'X', 'Y']</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\nitertools.product(*iterables, repeat=1):"</span>)</span><br><span class="line">    <span class="comment"># product 生成多个可迭代对象的笛卡尔积</span></span><br><span class="line">    cartesian_product: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]] = <span class="built_in">list</span>(itertools.product(<span class="string">'AB'</span>, <span class="string">'12'</span>))</span><br><span class="line">    print_success(</span><br><span class="line">        <span class="string">f"  product('AB', '12') 结果: <span class="subst">{cartesian_product}</span>"</span>)  <span class="comment"># 输出: [('A', '1'), ('A', '2'), ('B', '1'), ('B', '2')]</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\nitertools.permutations(iterable, r):"</span>)</span><br><span class="line">    <span class="comment"># permutations 生成可迭代对象的所有可能排列</span></span><br><span class="line">    perms: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">str</span>, ...]] = <span class="built_in">list</span>(itertools.permutations(<span class="string">"ABC"</span>, <span class="number">2</span>))</span><br><span class="line">    print_success(</span><br><span class="line">        <span class="string">f"  permutations('ABC', 2) 结果: <span class="subst">{perms}</span>"</span>)  <span class="comment"># 输出: [('A', 'B'), ('A', 'C'), ('B', 'A'), ('B', 'C'), ('C', 'A'), ('C', 'B')]</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\nitertools.combinations(iterable, r):"</span>)</span><br><span class="line">    <span class="comment"># combinations 生成可迭代对象的所有可能组合（不考虑顺序）</span></span><br><span class="line">    combos: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">str</span>, ...]] = <span class="built_in">list</span>(itertools.combinations(<span class="string">"ABC"</span>, <span class="number">2</span>))</span><br><span class="line">    print_success(<span class="string">f"  combinations('ABC', 2) 结果: <span class="subst">{combos}</span>"</span>)  <span class="comment"># 输出: [('A', 'B'), ('A', 'C'), ('B', 'C')]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 3. 分组迭代器 (groupby)</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. 分组迭代器 (groupby)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_groupby_iterator</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 groupby。重要：groupby 需要数据预先按分组键排序。"""</span></span><br><span class="line">    data_to_group: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]] = [</span><br><span class="line">        (<span class="string">'A'</span>, <span class="string">'Apple'</span>), (<span class="string">'A'</span>, <span class="string">'Ant'</span>),</span><br><span class="line">        (<span class="string">'B'</span>, <span class="string">'Ball'</span>), (<span class="string">'B'</span>, <span class="string">'Banana'</span>), (<span class="string">'B'</span>, <span class="string">'Bat'</span>),</span><br><span class="line">        (<span class="string">'C'</span>, <span class="string">'Cat'</span>), (<span class="string">'C'</span>, <span class="string">'Cow'</span>), (<span class="string">'C'</span>, <span class="string">'Car'</span>), (<span class="string">"C"</span>, <span class="string">"Com"</span>)</span><br><span class="line">    ]</span><br><span class="line">    print_info(<span class="string">f"待分组数据 (已按首字母排序): <span class="subst">{data_to_group}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 按首字母分组</span></span><br><span class="line">    <span class="comment"># 其中 key_char 是分组键，group_iter 是一个迭代器，包含该组的所有元素</span></span><br><span class="line">    <span class="comment"># keyfunc = lambda x: x[0] #  可以省略，因为元组默认按第一个元素比较</span></span><br><span class="line">    <span class="keyword">for</span> key_char, group_iter <span class="keyword">in</span> itertools.groupby(data_to_group, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>]):</span><br><span class="line">        group_items: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]] = <span class="built_in">list</span>(group_iter)  <span class="comment"># group_iter 是一个迭代器，需要转换为列表</span></span><br><span class="line">        print_success(<span class="string">f"  以 <span class="subst">{key_char}</span> 开头的分组: <span class="subst">{group_items}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\n对未排序数据使用 groupby (可能不符合预期):"</span>)</span><br><span class="line">    unsorted_data: <span class="type">List</span>[<span class="built_in">int</span>] = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>]</span><br><span class="line">    print_info(<span class="string">f"  未排序数据: <span class="subst">{unsorted_data}</span>"</span>)</span><br><span class="line">    <span class="keyword">for</span> key_num, group_iter_num <span class="keyword">in</span> itertools.groupby(unsorted_data): <span class="comment"># 未排序</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"    键 '<span class="subst">{key_num}</span>': <span class="subst">{<span class="built_in">list</span>(group_iter_num)}</span>"</span>)</span><br><span class="line">    print_warning(<span class="string">"  注意：groupby 对未排序数据是按连续相同元素进行分组的。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># demo_infinite_iterators()</span></span><br><span class="line">    <span class="comment"># demo_combining_iterators()</span></span><br><span class="line">    demo_groupby_iterator()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>itertools</code> 模块)</strong>:</p><ul><li><strong>无限迭代器</strong>: 像 <code>count()</code>, <code>cycle()</code>, <code>repeat()</code> (不带 <code>times</code> 参数) 这样的函数会产生无限序列。在直接使用它们进行迭代时，务必配合 <code>itertools.islice()</code> 或其他机制来限制迭代次数，否则会导致无限循环。</li><li><strong>迭代器消耗</strong>: <code>itertools</code> 中的函数通常返回迭代器。迭代器是一次性的，遍历过后就会耗尽。如果需要多次使用结果，应先将其转换为列表或元组 (例如 <code>list(my_iterator)</code>)。</li><li><strong><code>groupby()</code> 的前提</strong>: <code>itertools.groupby()</code> 函数在对数据进行分组前，要求数据<strong>必须已经按照分组的键排好序</strong>。如果数据未排序，它只会将连续出现的相同键的元素分为一组，可能与预期不符。</li><li><strong>内存效率</strong>: <code>itertools</code> 的函数通常设计为内存高效的，因为它们是基于迭代器操作的，一次只处理一个元素，而不是一次性加载所有数据到内存。这使得它们非常适合处理大型数据集。</li><li><strong>组合性</strong>: <code>itertools</code> 函数的强大之处在于它们的组合性。你可以将多个 <code>itertools</code> 函数串联起来，用非常少的代码构建出复杂的迭代逻辑。</li></ul></blockquote><h5 id="functools-模块：高阶函数与可调用对象工具"><a href="#functools-模块：高阶函数与可调用对象工具" class="headerlink" title="functools 模块：高阶函数与可调用对象工具"></a><code>functools</code> 模块：高阶函数与可调用对象工具</h5><p><code>functools</code> 模块包含了一些用于高阶函数（操作或返回其他函数的函数）的工具。这些工具可以帮助你修改或扩展函数及其他可调用对象的行为，而无需完全重写它们。</p><h6 id="functools-常用功能"><a href="#functools-常用功能" class="headerlink" title="functools 常用功能"></a><code>functools</code> 常用功能</h6><table><thead><tr><th>函数/装饰器</th><th>描述</th></tr></thead><tbody><tr><td><code>functools.partial(func, *args, **keywords)</code></td><td>创建一个新的函数，该函数在调用时会自动传入预设的 <code>args</code> 和 <code>keywords</code> 参数。</td></tr><tr><td><code>functools.reduce(function, iterable[, initializer])</code></td><td>将一个二元函数 <code>function</code> 累积地应用到 <code>iterable</code> 的项上，从而将序列规约为单个值。</td></tr><tr><td><code>functools.wraps(wrapped_func)</code></td><td>一个装饰器，用于更新一个包装函数 (wrapper) 的元信息 (如名称、文档字符串) 以匹配被包装函数 <code>wrapped_func</code>。</td></tr><tr><td><code>@functools.lru_cache(maxsize=128, typed=False)</code></td><td>一个装饰器，为函数调用结果提供最近最少使用 (LRU) 缓存，可以显著提高重复调用相同参数的耗时函数的性能。</td></tr><tr><td><code>@functools.total_ordering</code></td><td>一个类装饰器，如果你定义了 <code>__eq__()</code> 和至少一个其他比较方法 (<code>__lt__</code>, <code>__le__</code>, <code>__gt__</code>, <code>__ge__</code>)，它会自动为你补全所有其他的比较方法。</td></tr><tr><td><code>@functools.singledispatch</code></td><td>一个装饰器，将函数转换为单分派泛函数 (generic function)，可以根据第一个参数的类型注册不同的实现。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>functools</code> 模块)</strong></p><ul><li><code>partial()</code>: 当你需要固定函数的一些参数，生成一个更特化的函数版本时非常有用。</li><li><code>reduce()</code>: 用于执行累积计算，如求和、求积、或更复杂的聚合。</li><li><code>wraps()</code>: 编写自定义装饰器时<strong>务必使用</strong>，以保持被装饰函数的元数据。</li><li><code>lru_cache()</code>: 对于计算成本高且参数可能重复调用的函数，这是一个简单有效的性能优化手段。</li></ul></blockquote><h6 id="functools-模块代码示例"><a href="#functools-模块代码示例" class="headerlink" title="functools 模块代码示例"></a><code>functools</code> 模块代码示例</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span>, <span class="type">Any</span>, <span class="type">List</span> <span class="comment"># 用于类型注解</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 0. functools 模块演示准备</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_functools_intro</span>():</span><br><span class="line">    print_header(<span class="string">"functools 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 1. functools.partial: 固定函数参数</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_partial</span>():</span><br><span class="line">    print_subheader(<span class="string">"1. functools.partial: 固定函数参数"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">power</span>(<span class="params">base: <span class="built_in">float</span>, exponent: <span class="built_in">float</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="string">"""计算 base 的 exponent 次方。"""</span></span><br><span class="line">        <span class="keyword">return</span> base ** exponent</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 创建一个总是计算平方的函数</span></span><br><span class="line">    square: <span class="type">Callable</span>[[<span class="built_in">float</span>], <span class="built_in">float</span>] = functools.partial(power, exponent=<span class="number">2</span>)</span><br><span class="line">    <span class="comment">## 创建一个总是计算立方的函数</span></span><br><span class="line">    cube: <span class="type">Callable</span>[[<span class="built_in">float</span>], <span class="built_in">float</span>] = functools.partial(power, exponent=<span class="number">3</span>)</span><br><span class="line">    <span class="comment">## 创建一个总是计算以2为底的幂的函数</span></span><br><span class="line">    power_of_2: <span class="type">Callable</span>[[<span class="built_in">float</span>], <span class="built_in">float</span>] = functools.partial(power, <span class="number">2</span>) <span class="comment"># 第一个未命名参数被固定为 base</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">f"power(3, 2) = <span class="subst">{power(<span class="number">3</span>, <span class="number">2</span>)}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"square(3) (partial(power, exponent=2)): <span class="subst">{square(<span class="number">3</span>)}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"cube(3) (partial(power, exponent=3)): <span class="subst">{cube(<span class="number">3</span>)}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"power_of_2(5) (partial(power, 2)): <span class="subst">{power_of_2(<span class="number">5</span>)}</span>"</span>) <span class="comment"># 2**5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 2. functools.reduce: 累积计算</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_reduce</span>():</span><br><span class="line">    print_subheader(<span class="string">"2. functools.reduce: 累积计算"</span>)</span><br><span class="line">    <span class="comment">## 计算阶乘: 5! = 5 * 4 * 3 * 2 * 1</span></span><br><span class="line">    numbers_for_factorial: <span class="type">List</span>[<span class="built_in">int</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    factorial_5: <span class="built_in">int</span> = functools.reduce(<span class="keyword">lambda</span> x, y: x * y, numbers_for_factorial)</span><br><span class="line">    print_success(<span class="string">f"reduce(lambda x, y: x * y, <span class="subst">{numbers_for_factorial}</span>) = <span class="subst">{factorial_5}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 3. @functools.lru_cache: 函数结果缓存</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_lru_cache</span>():</span><br><span class="line">    print_subheader(<span class="string">"3. @functools.lru_cache: 函数结果缓存"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @functools.lru_cache(<span class="params">maxsize=<span class="number">128</span></span>) </span><span class="comment"># maxsize=None 表示不限制缓存大小</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expensive_fibonacci</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">"""一个计算斐波那契数的耗时函数 (递归实现，不加缓存效率极低)。"""</span></span><br><span class="line">        print_info(<span class="string">f"  计算(<span class="subst">{n}</span>)..."</span>) <span class="comment"># 打印这条可以看出函数是否实际执行</span></span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line">        time.sleep(<span class="number">0.5</span>) <span class="comment"># 模拟计算耗时</span></span><br><span class="line">        <span class="keyword">return</span> expensive_fibonacci(n - <span class="number">1</span>) + expensive_fibonacci(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 第一次调用 (计算并缓存)</span></span><br><span class="line">    print_info(<span class="string">"第一次调用 expensive_fibonacci(10):"</span>)</span><br><span class="line">    start_time = time.perf_counter()</span><br><span class="line">    fib_10_first_call = expensive_fibonacci(<span class="number">10</span>)</span><br><span class="line">    duration1 = time.perf_counter() - start_time</span><br><span class="line">    print_success(<span class="string">f"  fibonacci(10) = <span class="subst">{fib_10_first_call}</span>, 耗时: <span class="subst">{duration1:<span class="number">.6</span>f}</span> 秒"</span>)</span><br><span class="line">    print_info(<span class="string">f"  缓存信息: <span class="subst">{expensive_fibonacci.cache_info()}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 第二次调用 (应从缓存中获取，非常快)</span></span><br><span class="line">    print_info(<span class="string">"\n第二次调用 expensive_fibonacci(10) (应从缓存读取):"</span>)</span><br><span class="line">    start_time_cached = time.perf_counter()</span><br><span class="line">    fib_10_second_call = expensive_fibonacci(<span class="number">10</span>)</span><br><span class="line">    duration2 = time.perf_counter() - start_time_cached</span><br><span class="line">    print_success(<span class="string">f"  fibonacci(10) = <span class="subst">{fib_10_second_call}</span>, 耗时: <span class="subst">{duration2:<span class="number">.6</span>f}</span> 秒 (缓存)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">## 清除缓存</span></span><br><span class="line">    expensive_fibonacci.cache_clear()</span><br><span class="line">    print_info(<span class="string">f"\n缓存已清除。缓存信息: <span class="subst">{expensive_fibonacci.cache_info()}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 4. @functools.wraps: 编写行为正确的装饰器</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_wraps</span>():</span><br><span class="line">    print_subheader(<span class="string">"4. @functools.wraps: 编写行为正确的装饰器"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">simple_logging_decorator</span>(<span class="params">original_function: <span class="type">Callable</span></span>) -&gt; <span class="type">Callable</span>:</span><br><span class="line">        <span class="string">"""一个简单的日志装饰器，演示 @functools.wraps 的作用。"""</span></span><br><span class="line">    <span class="comment">#    # 如果没有 @functools.wraps(original_function)，</span></span><br><span class="line">    <span class="comment">#    # decorated_function 的 __name__, __doc__ 等元信息会变成 wrapper 的。</span></span><br><span class="line"><span class="meta">        @functools.wraps(<span class="params">original_function</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args: <span class="type">Any</span>, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">            <span class="string">"""wrapper 函数的文档字符串。"""</span></span><br><span class="line">            print_info(<span class="string">f"    装饰器: 调用函数 '<span class="subst">{original_function.__name__}</span>' 之前..."</span>)</span><br><span class="line">            result = original_function(*args, **kwargs)</span><br><span class="line">            print_info(<span class="string">f"    装饰器: 调用函数 '<span class="subst">{original_function.__name__}</span>' 之后，结果: <span class="subst">{result}</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">    @simple_logging_decorator</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">greet_person</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">"""向一个人问好并返回问候语。"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Hello, <span class="subst">{name}</span>!"</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"调用被装饰的 greet_person('Alice'):"</span>)</span><br><span class="line">    greeting_output = greet_person(<span class="string">"Alice"</span>)</span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\n检查被装饰函数的元信息:"</span>)</span><br><span class="line">    print_success(<span class="string">f"  函数名 (greet_person.__name__): '<span class="subst">{greet_person.__name__}</span>' (应为 'greet_person')"</span>)</span><br><span class="line">    print_success(<span class="string">f"  文档字符串 (greet_person.__doc__):\n    '''<span class="subst">{greet_person.__doc__.strip()}</span>''' (应为 greet_person 的文档)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">"""主函数，用于调用各个演示函数"""</span></span><br><span class="line">    show_functools_intro()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 用户选择要运行的演示</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n请选择要运行的演示:"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"1. functools.partial 演示"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"2. functools.reduce 演示"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"3. functools.lru_cache 演示"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"4. functools.wraps 演示"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"5. 运行所有演示"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"0. 退出"</span>)</span><br><span class="line">    </span><br><span class="line">    choice = <span class="built_in">input</span>(<span class="string">"\n请输入选项编号: "</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> choice == <span class="string">'1'</span>:</span><br><span class="line">        demo_partial()</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">'2'</span>:</span><br><span class="line">        demo_reduce()</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">'3'</span>:</span><br><span class="line">        demo_lru_cache()</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">'4'</span>:</span><br><span class="line">        demo_wraps()</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">'5'</span>:</span><br><span class="line">        demo_partial()</span><br><span class="line">        demo_reduce()</span><br><span class="line">        demo_lru_cache()</span><br><span class="line">        demo_wraps()</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">'0'</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"退出程序"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"无效选项，请重新运行程序"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>functools</code> 模块)</strong>:</p><ul><li><strong><code>partial()</code> 的参数顺序</strong>: <code>partial()</code> 会按顺序填充位置参数，然后是关键字参数。如果 <code>func</code> 本身有一些默认参数，<code>partial</code> 可以覆盖它们，或者提供那些未被 <code>partial</code> 固定的参数。</li><li><strong><code>reduce()</code> 的可读性</strong>: 虽然 <code>reduce()</code> 很强大，但对于简单的求和、求积等操作，直接使用内置的 <code>sum()</code> 或一个显式的循环通常更具可读性。<code>reduce()</code> 更适用于一些自定义的复杂累积逻辑。确保 <code>reduce</code> 中使n用的二元函数易于理解。</li><li><strong><code>lru_cache()</code> 的适用场景</strong>:<ul><li>适用于那些输入参数组合相对有限，且单次计算成本较高的纯函数（即对于相同的输入总是返回相同输出，且没有副作用的函数）。</li><li>不适用于参数是可变对象（如列表、字典）且函数行为依赖于对象内部状态变化的情况，因为缓存是基于参数值的哈希。如果可变对象被修改但其哈希不变（或哈希变化但对象视为等价），可能导致缓存命中错误。<code>typed=True</code> 可以让缓存区分不同类型的参数（如 <code>3</code> 和 <code>3.0</code>）。</li><li><code>maxsize</code> 参数很重要，设置太小可能导致缓存命中率低，<code>None</code> 则不限制大小，可能消耗过多内存。</li></ul></li><li><strong><code>wraps()</code> 的必要性</strong>: 在编写任何自定义装饰器时，<strong>强烈建议</strong>使用 <code>@functools.wraps(original_function)</code> 来装饰内部的 <code>wrapper</code> 函数。这能确保被装饰后的函数保留其原始函数的名称 (<code>__name__</code>)、文档字符串 (<code>__doc__</code>)、参数列表、模块名等重要元信息，这对于调试、文档生成和代码可维护性至关重要。</li></ul></blockquote><h5 id="copy-模块：对象的浅拷贝与深拷贝"><a href="#copy-模块：对象的浅拷贝与深拷贝" class="headerlink" title="copy 模块：对象的浅拷贝与深拷贝"></a><code>copy</code> 模块：对象的浅拷贝与深拷贝</h5><p>在 Python 中，赋值操作 (<code>=</code>) 对于可变对象（如列表、字典）通常只是创建了一个新的引用，指向同一个对象。这意味着修改一个引用会影响到所有指向该对象的引用。<code>copy</code> 模块提供了创建对象副本的方法，分为浅拷贝和深拷贝，用于在不同程度上复制对象及其内容。</p><h6 id="copy-常用功能"><a href="#copy-常用功能" class="headerlink" title="copy 常用功能"></a><code>copy</code> 常用功能</h6><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>copy.copy(x)</code></td><td>创建对象 <code>x</code> 的<strong>浅拷贝 (shallow copy)</strong>。</td></tr><tr><td><code>copy.deepcopy(x)</code></td><td>创建对象 <code>x</code> 的<strong>深拷贝 (deep copy)</strong>。</td></tr></tbody></table><p><strong>浅拷贝 (Shallow Copy) vs. 深拷贝 (Deep Copy):</strong></p><ul><li><p><strong>浅拷贝 (<code>copy.copy()</code>)</strong>:</p><ol><li>创建一个新的复合对象 (例如一个新的列表实例)。</li><li>然后，对于原始对象中的元素，如果是不可变类型（如数字、字符串、元组），则直接复制其值。</li><li>如果是可变类型（如列表、字典、自定义对象），则<strong>复制其引用</strong>。也就是说，新列表中的可变元素和旧列表中的对应可变元素将指向内存中<strong>同一个</strong>对象。</li></ol></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/image-20250518152854653.png" alt="image-20250518152854653"></p><p><strong>影响</strong>: 修改新拷贝中嵌套的可变对象的内容，会影响到原始对象中对应的嵌套可变对象。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/image-20250518153103717.png" alt="image-20250518153103717"></p><ul><li><p><strong>深拷贝 (<code>copy.deepcopy()</code>)</strong>:</p><ol><li>创建一个新的复合对象。</li><li>然后，<strong>递归地</strong>复制原始对象中的所有内容。这意味着，如果遇到嵌套的可变对象，它会为这些嵌套的可变对象也创建新的副本，而不是仅仅复制引用。</li></ol><ul><li><strong>影响</strong>: 修改新拷贝中嵌套的可变对象的内容，<strong>不会</strong>影响到原始对象，因为它们是完全独立的副本。</li></ul></li><li><p><code>deepcopy</code> 能够正确处理循环引用（对象内部直接或间接引用自身）。</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/image-20250518153447234.png" alt="image-20250518153447234"></p><blockquote><p><strong>批注：核心记忆功能 (<code>copy</code> 模块)</strong></p><ul><li>理解<strong>浅拷贝</strong>和<strong>深拷贝</strong>的根本区别：浅拷贝只复制顶层容器，内部元素如果是可变对象则共享引用；深拷贝会递归复制所有嵌套的可变对象，创建完全独立的副本。</li><li><code>copy.copy()</code>: 用于浅拷贝。</li><li><code>copy.deepcopy()</code>: <strong>常用且重要</strong>，当你需要一个与原始对象完全独立的副本，尤其是当对象包含嵌套的可变结构时，应使用深拷贝。</li></ul></blockquote><h5 id="pprint-模块：数据结构的美化输出"><a href="#pprint-模块：数据结构的美化输出" class="headerlink" title="pprint 模块：数据结构的美化输出"></a><code>pprint</code> 模块：数据结构的美化输出</h5><p>当需要打印复杂的 Python 数据结构（如深度嵌套的列表、字典）时，内置的 <code>print()</code> 函数的输出可能挤在一行，难以阅读和理解。<code>pprint</code> 模块 (pretty-print) 提供了“美化打印”的功能，可以将这些数据结构以更易读的格式输出，例如自动换行、缩进和排序（可选）。</p><h6 id="pprint-常用功能"><a href="#pprint-常用功能" class="headerlink" title="pprint 常用功能"></a><code>pprint</code> 常用功能</h6><table><thead><tr><th>函数/类</th><th>描述</th></tr></thead><tbody><tr><td><code>pprint.pprint(object, stream=None, ...)</code></td><td>将对象 <code>object</code> 美化输出到指定的流 <code>stream</code> (默认为 <code>sys.stdout</code>)。</td></tr><tr><td><code>pprint.pformat(object, indent=1, width=80, ...)</code></td><td>返回对象 <code>object</code> 美化后的字符串表示，而不是直接打印。</td></tr><tr><td><code>pprint.PrettyPrinter(indent=1, width=80, depth=None, stream=None, *, compact=False, sort_dicts=True)</code></td><td>创建一个 <code>PrettyPrinter</code> 对象，可以更细致地控制美化输出的参数，并可复用。</td></tr></tbody></table><p><strong><code>PrettyPrinter</code> 或 <code>pprint</code>/<code>pformat</code> 的常用参数：</strong></p><ul><li><code>indent</code>: 每级缩进的空格数。</li><li><code>width</code>: 输出内容的目标宽度，超过此宽度会尝试换行。</li><li><code>depth</code>: 控制嵌套数据结构的打印深度，超出此深度的部分会用 <code>...</code> 表示。</li><li><code>stream</code>: 输出流。</li><li><code>compact</code>: 如果为 <code>True</code>，则输出会更紧凑，尽可能将多个短元素放在同一行。</li><li><code>sort_dicts</code>: (Python 3.8+) 如果为 <code>True</code> (默认)，则字典会按键排序后输出，保证输出顺序的一致性。</li></ul><blockquote><p><strong>批注：核心记忆功能 (<code>pprint</code> 模块)</strong></p><ul><li><code>pprint.pprint(my_complex_data)</code>: <strong>最常用</strong>，直接美化打印数据结构。</li><li><code>pprint.pformat(my_complex_data)</code>: 当你需要获取美化后的字符串而不是直接打印时使用。</li><li><code>PrettyPrinter(sort_dicts=False)</code>: 如果不希望字典输出时按键排序，可以创建 <code>PrettyPrinter</code> 实例并设置。</li></ul></blockquote><h6 id="pprint-模块代码示例"><a href="#pprint-模块代码示例" class="headerlink" title="pprint 模块代码示例"></a><code>pprint</code> 模块代码示例</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> * <span class="comment"># 假设 print_utils.py 可用</span></span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">import</span> datetime <span class="comment"># 用于示例数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 0. pprint 模块演示准备</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_header(<span class="string">"pprint 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_complex_data_structure</span>() -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    <span class="string">"""创建一个复杂的嵌套数据结构用于演示。"""</span></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="string">'user_id'</span>: <span class="number">1001</span>,</span><br><span class="line">        <span class="string">'username'</span>: <span class="string">'alpha_user'</span>,</span><br><span class="line">        <span class="string">'is_active'</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">'profile'</span>: {</span><br><span class="line">            <span class="string">'full_name'</span>: <span class="string">'Alpha Centauri User'</span>,</span><br><span class="line">            <span class="string">'email'</span>: <span class="string">'alpha@example.com'</span>,</span><br><span class="line">            <span class="string">'date_joined'</span>: datetime.date(<span class="number">2023</span>, <span class="number">1</span>, <span class="number">15</span>),</span><br><span class="line">            <span class="string">'preferences'</span>: {</span><br><span class="line">                <span class="string">'theme'</span>: <span class="string">'dark_solarized'</span>,</span><br><span class="line">                <span class="string">'notifications'</span>: [<span class="string">'email'</span>, <span class="string">'push'</span>],</span><br><span class="line">                <span class="string">'language'</span>: <span class="string">'en-US'</span></span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        <span class="string">'posts'</span>: [</span><br><span class="line">            {<span class="string">'post_id'</span>: <span class="string">'p001'</span>, <span class="string">'title'</span>: <span class="string">'First Post'</span>, <span class="string">'tags'</span>: [<span class="string">'intro'</span>, <span class="string">'python'</span>]},</span><br><span class="line">            {<span class="string">'post_id'</span>: <span class="string">'p002'</span>, <span class="string">'title'</span>: <span class="string">'Advanced Python Topics'</span>, <span class="string">'tags'</span>: [<span class="string">'python'</span>, <span class="string">'advanced'</span>, <span class="string">'performance'</span>]},</span><br><span class="line">            {<span class="string">'post_id'</span>: <span class="string">'p003'</span>, <span class="string">'title'</span>: <span class="string">'Data Structures in Python'</span>, </span><br><span class="line">             <span class="string">'comments'</span>: [</span><br><span class="line">                 {<span class="string">'user'</span>: <span class="string">'beta_user'</span>, <span class="string">'text'</span>: <span class="string">'Great article!'</span>},</span><br><span class="line">                 {<span class="string">'user'</span>: <span class="string">'gamma_user'</span>, <span class="string">'text'</span>: <span class="string">'Very helpful, thanks.'</span>}</span><br><span class="line">             ]</span><br><span class="line">            }</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">'friends_ids'</span>: <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1020</span>, <span class="number">1035</span>)) <span class="comment"># 一个较长的列表</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">complex_data: <span class="built_in">dict</span> = create_complex_data_structure()</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 1. 使用 pprint.pprint() 直接美化打印</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 使用 pprint.pprint() 直接美化打印"</span>)</span><br><span class="line">print_info(<span class="string">"使用普通 print() 打印复杂数据 (对比用):"</span>)</span><br><span class="line"><span class="comment">## print(complex_data) # 输出会很拥挤</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">"\n使用 pprint.pprint() 打印复杂数据:"</span>)</span><br><span class="line">pprint.pprint(complex_data, indent=<span class="number">2</span>, width=<span class="number">100</span>, sort_dicts=<span class="literal">False</span>) <span class="comment"># sort_dicts=False 保持字典插入顺序(Python 3.7+)或原始顺序</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 2. 使用 pprint.pformat() 获取美化后的字符串</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"\n2. 使用 pprint.pformat() 获取美化后的字符串"</span>)</span><br><span class="line">formatted_string: <span class="built_in">str</span> = pprint.pformat(complex_data, indent=<span class="number">2</span>, width=<span class="number">80</span>, depth=<span class="number">3</span>, compact=<span class="literal">True</span>, sort_dicts=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">## depth=3: 只打印到第3层嵌套，更深的用 ...</span></span><br><span class="line"><span class="comment">## compact=True: 尝试更紧凑的输出</span></span><br><span class="line"><span class="comment">## sort_dicts=True: 字典按键排序输出，保证一致性</span></span><br><span class="line">print_info(<span class="string">"使用 pformat 获取的格式化字符串 (depth=3, compact=True, sort_dicts=True):"</span>)</span><br><span class="line"><span class="built_in">print</span>(formatted_string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 3. 使用 PrettyPrinter 类进行更细致的控制和复用</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"\n3. 使用 PrettyPrinter 类"</span>)</span><br><span class="line"><span class="comment">## 创建一个 PrettyPrinter 实例，可以预设参数</span></span><br><span class="line">custom_printer = pprint.PrettyPrinter(</span><br><span class="line">    indent=<span class="number">4</span>, </span><br><span class="line">    width=<span class="number">120</span>, </span><br><span class="line">    depth=<span class="literal">None</span>, <span class="comment"># None 表示不限制深度</span></span><br><span class="line">    compact=<span class="literal">False</span>,</span><br><span class="line">    sort_dicts=<span class="literal">False</span> <span class="comment"># 不排序字典</span></span><br><span class="line">)</span><br><span class="line">print_info(<span class="string">"使用自定义的 PrettyPrinter 实例打印:"</span>)</span><br><span class="line">custom_printer.pprint(complex_data[<span class="string">'profile'</span>])</span><br><span class="line"></span><br><span class="line">print_info(<span class="string">"\n使用另一个配置 (字典排序) 的 PrettyPrinter 实例:"</span>)</span><br><span class="line">sorting_printer = pprint.PrettyPrinter(indent=<span class="number">2</span>, sort_dicts=<span class="literal">True</span>)</span><br><span class="line">sorting_printer.pprint(complex_data[<span class="string">'profile'</span>][<span class="string">'preferences'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"><span class="comment">#    # 演示函数已在各自节内调用或其逻辑已在此处</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">print_header(<span class="string">"pprint 模块演示结束。"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="第二十章：Python-语法新特性总结-3-8-3-13"><a href="#第二十章：Python-语法新特性总结-3-8-3-13" class="headerlink" title="第二十章：Python 语法新特性总结 (3.8 ~ 3.13)"></a>第二十章：Python 语法新特性总结 (3.8 ~ 3.13)</h2><p>Python 语言在不断发展，每个新版本都会带来一些有用的新特性、性能改进和语法糖，使得编写代码更加高效和愉悦。本章将简要回顾从 Python 3.8 到 3.13 版本引入的一些值得关注的语法和核心库特性。</p><h3 id="Python-3-8-主要特性"><a href="#Python-3-8-主要特性" class="headerlink" title="Python 3.8 主要特性"></a>Python 3.8 主要特性</h3><p>Python 3.8 带来了赋值表达式（海象操作符）、仅位置参数、f-string 调试支持等重要更新。</p><h4 id="1-赋值表达式-海象操作符"><a href="#1-赋值表达式-海象操作符" class="headerlink" title="1. 赋值表达式 (海象操作符) :="></a>1. 赋值表达式 (海象操作符) <code>:=</code></h4><p>海象操作符 <code>:=</code> 允许你在表达式内部为变量赋值。这可以在某些情况下简化代码，尤其是在 <code>if</code> 语句或 <code>while</code> 循环中，当你需要先计算一个值，然后判断这个值，并且后续还想使用这个值时。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 海象操作符演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *  <span class="comment"># 假设 print_utils.py 可用</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_walrus_operator</span>(<span class="params">data: <span class="type">List</span>[<span class="type">Any</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示海象操作符 (:=) 的使用。"""</span></span><br><span class="line">    print_subheader(<span class="string">"1. 海象操作符 (Assignment Expressions) `:=`"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 示例1: 在 if 条件中赋值并使用</span></span><br><span class="line">    <span class="keyword">if</span> (n := <span class="built_in">len</span>(data)) &gt; <span class="number">3</span>:</span><br><span class="line">        print_success(<span class="string">f"列表长度为 <span class="subst">{n}</span>，大于3。前三个元素: <span class="subst">{data[:<span class="number">3</span>]}</span>"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_info(<span class="string">f"列表长度为 <span class="subst">{n}</span>，不大于3。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print_header(<span class="string">"Python 3.8 特性演示"</span>)</span><br><span class="line">    sample_data_list: <span class="type">List</span>[<span class="type">Any</span>] = [<span class="number">1</span>, <span class="string">"abc"</span>, [<span class="number">1</span>, <span class="number">2</span>], <span class="number">3</span>]</span><br><span class="line">    demo_walrus_operator(sample_data_list)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="2-仅位置参数"><a href="#2-仅位置参数" class="headerlink" title="2. 仅位置参数 (/)"></a>2. 仅位置参数 (<code>/</code>)</h4><p>函数定义中可以使用 <code>/</code> 来指明其前面的参数只能通过位置传递，不能作为关键字参数传递。这有助于库作者设计更清晰、更不易出错的 API。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 仅位置参数演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_positional_only_args</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示仅位置参数的使用。"""</span></span><br><span class="line">    print_subheader(<span class="string">"2. 仅位置参数 (`/`)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user_id: <span class="built_in">int</span>, name: <span class="built_in">str</span>, /, age: <span class="built_in">int</span> = <span class="number">30</span>, city: <span class="built_in">str</span> = <span class="string">"Unknown"</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        创建用户信息字典。</span></span><br><span class="line"><span class="string">        user_id 和 name 只能通过位置传递。</span></span><br><span class="line"><span class="string">        age 和 city 可以是位置参数或关键字参数。</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> {<span class="string">"id"</span>: user_id, <span class="string">"name"</span>: name, <span class="string">"age"</span>: age, <span class="string">"city"</span>: city}</span><br><span class="line">    </span><br><span class="line">    print_success(<span class="built_in">str</span>(create_user(<span class="number">1</span>, <span class="string">"Alice"</span>)))  <span class="comment"># 正确：位置参数</span></span><br><span class="line">    print_success(<span class="built_in">str</span>(create_user(<span class="number">1</span>, <span class="string">"Alice"</span>, age=<span class="number">25</span>)))  <span class="comment"># 正确：位置参数和关键字参数</span></span><br><span class="line">    print_success(<span class="built_in">str</span>(create_user(<span class="number">1</span>, <span class="string">"Alice"</span>, <span class="number">25</span>)))  <span class="comment"># 正确：age 作为位置参数也是可以的</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 演示真正的错误情况</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        create_user(<span class="built_in">id</span>=<span class="number">1</span>, name=<span class="string">"Alice"</span>)  <span class="comment"># 错误：/ 之前的参数不能用关键字方式传递</span></span><br><span class="line">    <span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"在尝试执行操作时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 此处不重复 print_header，假设按特性运行</span></span><br><span class="line">    demo_positional_only_args()</span><br></pre></td></tr></tbody></table></figure><h4 id="3-f-string-增强-用于调试"><a href="#3-f-string-增强-用于调试" class="headerlink" title="3. f-string 增强 (=) 用于调试"></a>3. f-string 增强 (<code>=</code>) 用于调试</h4><p>f-string 现在支持 <code>=</code> 说明符，可以在输出中包含表达式文本及其计算结果，非常便于调试。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === f-string 调试增强演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_fstring_debug</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 f-string 中 `=` 的调试功能。"""</span></span><br><span class="line">    print_subheader(<span class="string">"3. f-string 增强 (`=`) 用于调试"</span>)</span><br><span class="line">    </span><br><span class="line">    app_name: <span class="built_in">str</span> = <span class="string">"MyApplication"</span></span><br><span class="line">    app_version: <span class="built_in">float</span> = <span class="number">2.1</span></span><br><span class="line">    user_count: <span class="built_in">int</span> = <span class="number">1050</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 = 直接打印变量名和值</span></span><br><span class="line">    print_info(<span class="string">f"调试信息: <span class="subst">{app_name=}</span>, <span class="subst">{app_version=}</span>, <span class="subst">{user_count=}</span>"</span>)</span><br><span class="line">    <span class="comment"># 输出示例: 调试信息: app_name='MyApplication', app_version=2.1, user_count=1050</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 也可以用于更复杂的表达式</span></span><br><span class="line">    result: <span class="built_in">int</span> = user_count * <span class="number">2</span></span><br><span class="line">    print_info(<span class="string">f"计算结果: <span class="subst">{user_count * <span class="number">2</span> = }</span>"</span>) <span class="comment"># 注意 `=` 在表达式之后</span></span><br><span class="line">    <span class="comment"># 输出示例: 计算结果: user_count * 2 = 2100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    demo_fstring_debug()</span><br></pre></td></tr></tbody></table></figure><h3 id="Python-3-9-主要特性"><a href="#Python-3-9-主要特性" class="headerlink" title="Python 3.9 主要特性"></a>Python 3.9 主要特性</h3><p>Python 3.9 引入了新的字典合并操作符，类型注解可以使用内置集合类型，并为字符串添加了移除前缀/后缀的方法。</p><h4 id="1-字典合并与更新操作符-和"><a href="#1-字典合并与更新操作符-和" class="headerlink" title="1. 字典合并与更新操作符 (| 和 |=)"></a>1. 字典合并与更新操作符 (<code>|</code> 和 <code>|=</code>)</h4><p>新的操作符 <code>|</code> 用于合并两个字典，<code>|=</code> 用于原地更新字典。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 字典合并与更新操作符演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Any</span>  <span class="comment"># 兼容旧版类型提示，但在3.9+中 dict 即可</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_dict_merge_operators</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示字典的 | 和 |= 操作符。"""</span></span><br><span class="line">    print_subheader(<span class="string">"1. 字典合并 (`|`) 与更新 (`|=`) 操作符"</span>)</span><br><span class="line"></span><br><span class="line">    dict_a: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>] = {<span class="string">"name_id"</span>: <span class="number">1</span>, <span class="string">"value"</span>: <span class="number">10</span>}</span><br><span class="line">    dict_b: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>] = {<span class="string">"value"</span>: <span class="number">20</span>, <span class="string">"status"</span>: <span class="number">0</span>}  <span class="comment"># "value"键与dict_a重复</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 合并操作 (|)，如果键重复，则右边字典的值优先</span></span><br><span class="line">    merged_dict: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>] = dict_a | dict_b</span><br><span class="line">    print_info(<span class="string">f"dict_a: <span class="subst">{dict_a}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"dict_b: <span class="subst">{dict_b}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"合并后 (merged_dict = dict_a | dict_b): <span class="subst">{merged_dict}</span>"</span>)</span><br><span class="line">    <span class="comment"># 输出: {'name_id': 1, 'value': 20, 'status': 0}</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 原地更新操作 (|=)</span></span><br><span class="line">    dict_c: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>] = {<span class="string">"item_code"</span>: <span class="number">101</span>, <span class="string">"quantity"</span>: <span class="number">5</span>}</span><br><span class="line">    dict_d: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = {<span class="string">"quantity"</span>: <span class="number">15</span>, <span class="string">"description"</span>: <span class="string">"Gadget"</span>}</span><br><span class="line">    print_info(<span class="string">f"\n原始 dict_c: <span class="subst">{dict_c}</span>"</span>)</span><br><span class="line">    dict_c |= dict_d  <span class="comment"># dict_c 被修改</span></span><br><span class="line">    print_success(<span class="string">f"原地更新后 (dict_c |= dict_d): <span class="subst">{dict_c}</span>"</span>)</span><br><span class="line">    <span class="comment"># 输出: {'item_code': 101, 'quantity': 15, 'description': 'Gadget'}</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print_header(<span class="string">"Python 3.9 特性演示"</span>)</span><br><span class="line">    demo_dict_merge_operators()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="2-类型注解的内置集合类型-泛型"><a href="#2-类型注解的内置集合类型-泛型" class="headerlink" title="2. 类型注解的内置集合类型 (泛型)"></a>2. 类型注解的内置集合类型 (泛型)</h4><p>现在可以直接使用内置的集合类型 (如 <code>list</code>, <code>dict</code>, <code>tuple</code>, <code>set</code>) 作为泛型类型进行注解，而无需从 <code>typing</code> 模块导入大写版本 (如 <code>List</code>, <code>Dict</code>)。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 内置集合类型注解演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from typing import List, Dict # 在 Python 3.9+ 中不再必需，但为了兼容性或清晰性仍可使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_builtin_generic_types</span>(<span class="params">names: <span class="built_in">list</span>[<span class="built_in">str</span>], scores: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>]</span>) -&gt; <span class="built_in">tuple</span>[<span class="built_in">int</span>, <span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    演示使用内置集合类型进行类型注解。</span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">        names (list[str]): 字符串列表。</span></span><br><span class="line"><span class="string">        scores (dict[str, int]): 键为字符串，值为整数的字典。</span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">        tuple[int, float]: 包含整数和浮点数的元组。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_subheader(<span class="string">"2. 类型注解的内置集合类型"</span>)</span><br><span class="line">    print_info(<span class="string">"函数定义使用了 list[str], dict[str, int], tuple[int, float] 注解。"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> names:</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0.0</span>)</span><br><span class="line">        </span><br><span class="line">    total_score: <span class="built_in">int</span> = <span class="built_in">sum</span>(scores.get(name, <span class="number">0</span>) <span class="keyword">for</span> name <span class="keyword">in</span> names)</span><br><span class="line">    average_score: <span class="built_in">float</span> = total_score / <span class="built_in">len</span>(names) <span class="keyword">if</span> names <span class="keyword">else</span> <span class="number">0.0</span></span><br><span class="line">    </span><br><span class="line">    print_success(<span class="string">f"处理的名字: <span class="subst">{names}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"处理的分数: <span class="subst">{scores}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"返回结果: (<span class="subst">{<span class="built_in">len</span>(names)}</span>, <span class="subst">{average_score:<span class="number">.2</span>f}</span>)"</span>)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">len</span>(names), average_score)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    sample_names: <span class="built_in">list</span>[<span class="built_in">str</span>] = [<span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="string">"Charlie"</span>]</span><br><span class="line">    sample_scores: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>] = {<span class="string">"Alice"</span>: <span class="number">90</span>, <span class="string">"Bob"</span>: <span class="number">85</span>, <span class="string">"David"</span>: <span class="number">70</span>} <span class="comment"># Charlie 没有分数</span></span><br><span class="line">    demo_builtin_generic_types(sample_names, sample_scores)</span><br></pre></td></tr></tbody></table></figure><h4 id="3-字符串方法：removeprefix-和-removesuffix"><a href="#3-字符串方法：removeprefix-和-removesuffix" class="headerlink" title="3. 字符串方法：removeprefix() 和 removesuffix()"></a>3. 字符串方法：<code>removeprefix()</code> 和 <code>removesuffix()</code></h4><p>这两个新的字符串方法用于移除字符串的前缀或后缀，如果存在的话。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 字符串移除前缀/后缀演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_string_prefix_suffix_removal</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 str.removeprefix() 和 str.removesuffix()。"""</span></span><br><span class="line">    print_subheader(<span class="string">"3. 字符串方法 `removeprefix()` 和 `removesuffix()`"</span>)</span><br><span class="line"></span><br><span class="line">    filename: <span class="built_in">str</span> = <span class="string">"document_final_v2.pdf"</span></span><br><span class="line">    url: <span class="built_in">str</span> = <span class="string">"https://www.example.com/path/to/resource"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 移除后缀</span></span><br><span class="line">    name_without_suffix: <span class="built_in">str</span> = filename.removesuffix(<span class="string">".pdf"</span>)</span><br><span class="line">    print_info(<span class="string">f"'<span class="subst">{filename}</span>'.removesuffix('.pdf') -&gt; '<span class="subst">{name_without_suffix}</span>'"</span>) <span class="comment"># 'document_final_v2'</span></span><br><span class="line">    </span><br><span class="line">    non_matching_suffix: <span class="built_in">str</span> = filename.removesuffix(<span class="string">".txt"</span>) <span class="comment"># 后缀不匹配</span></span><br><span class="line">    print_info(<span class="string">f"'<span class="subst">{filename}</span>'.removesuffix('.txt') -&gt; '<span class="subst">{non_matching_suffix}</span>' (未改变)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 移除前缀</span></span><br><span class="line">    path_without_prefix: <span class="built_in">str</span> = url.removeprefix(<span class="string">"https://"</span>)</span><br><span class="line">    print_info(<span class="string">f"'<span class="subst">{url}</span>'.removeprefix('https://') -&gt; '<span class="subst">{path_without_prefix}</span>'"</span>) <span class="comment"># 'www.example.com/path/to/resource'</span></span><br><span class="line"></span><br><span class="line">    non_matching_prefix: <span class="built_in">str</span> = url.removeprefix(<span class="string">"http://"</span>) <span class="comment"># 前缀不匹配</span></span><br><span class="line">    print_info(<span class="string">f"'<span class="subst">{url}</span>'.removeprefix('http://') -&gt; '<span class="subst">{non_matching_prefix}</span>' (未改变)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    demo_string_prefix_suffix_removal()</span><br></pre></td></tr></tbody></table></figure><h3 id="Python-3-10-主要特性"><a href="#Python-3-10-主要特性" class="headerlink" title="Python 3.10 主要特性"></a>Python 3.10 主要特性</h3><p>Python 3.10 带来了备受期待的结构化模式匹配 (match/case)、更简洁的联合类型表示法以及上下文管理器语法的改进。</p><h4 id="1-结构化模式匹配-match-case"><a href="#1-结构化模式匹配-match-case" class="headerlink" title="1. 结构化模式匹配 (match/case)"></a>1. 结构化模式匹配 (<code>match</code>/<code>case</code>)</h4><p>这是一种新的控制流语句，允许你根据数据的结构和值来匹配模式，并执行相应的代码块。类似于其他语言中的 <code>switch</code> 或模式匹配。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 结构化模式匹配演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">List</span>, <span class="type">Dict</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_structural_pattern_matching</span>(<span class="params">data_packet: <span class="type">Any</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">"""演示结构化模式匹配 (match/case) 处理不同数据结构。"""</span></span><br><span class="line">    print_subheader(<span class="string">f"1. 结构化模式匹配 (`match`/`case`) - 输入: <span class="subst">{data_packet}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">match</span> data_packet:</span><br><span class="line">        <span class="keyword">case</span> {<span class="string">"type"</span>: <span class="string">"user"</span>, <span class="string">"id"</span>: user_id, <span class="string">"name"</span>: <span class="built_in">str</span>(name_val)}: <span class="comment"># 匹配字典结构，并捕获值</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"用户数据: ID=<span class="subst">{user_id}</span>, 姓名='<span class="subst">{name_val}</span>'"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">case</span> {<span class="string">"type"</span>: <span class="string">"event"</span>, <span class="string">"name"</span>: event_name, <span class="string">"details"</span>: {<span class="string">"timestamp"</span>: ts, **other_details}}: <span class="comment"># 嵌套匹配和 **other_details</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"事件: '<span class="subst">{event_name}</span>' @ <span class="subst">{ts}</span>, 其他: <span class="subst">{other_details}</span>"</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> [<span class="built_in">int</span>(x), <span class="built_in">int</span>(y)] <span class="keyword">if</span> x == y: <span class="comment"># 匹配列表，包含守卫条件 (guard)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"两个相等的整数点: (<span class="subst">{x}</span>, <span class="subst">{y}</span>)"</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> [<span class="built_in">str</span>(op), *numbers] <span class="keyword">if</span> op <span class="keyword">in</span> [<span class="string">"SUM"</span>, <span class="string">"AVG"</span>]: <span class="comment"># 捕获列表剩余部分到 *numbers</span></span><br><span class="line">            result: <span class="built_in">float</span> = <span class="built_in">sum</span>(numbers)</span><br><span class="line">            <span class="keyword">if</span> op == <span class="string">"AVG"</span> <span class="keyword">and</span> numbers:</span><br><span class="line">                result /= <span class="built_in">len</span>(numbers)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"操作 '<span class="subst">{op}</span>' 在 <span class="subst">{numbers}</span> 上的结果: <span class="subst">{result:<span class="number">.2</span>f}</span>"</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">str</span>() <span class="keyword">as</span> command <span class="keyword">if</span> command.lower() == <span class="string">"quit"</span>: <span class="comment"># 匹配字符串并用 as 绑定</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"收到退出指令。"</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> _: <span class="comment"># 通配符，匹配任何其他情况</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"未知或不匹配的数据包格式。"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print_header(<span class="string">"Python 3.10 特性演示"</span>)</span><br><span class="line">    packets_to_test: <span class="type">List</span>[<span class="type">Any</span>] = [</span><br><span class="line">        {<span class="string">"type"</span>: <span class="string">"user"</span>, <span class="string">"id"</span>: <span class="number">101</span>, <span class="string">"name"</span>: <span class="string">"Alice"</span>},</span><br><span class="line">        {<span class="string">"type"</span>: <span class="string">"event"</span>, <span class="string">"name"</span>: <span class="string">"login"</span>, <span class="string">"details"</span>: {<span class="string">"timestamp"</span>: <span class="string">"2025-05-18T10:00:00Z"</span>, <span class="string">"source_ip"</span>: <span class="string">"192.168.1.1"</span>}},</span><br><span class="line">        [<span class="number">10</span>, <span class="number">10</span>],</span><br><span class="line">        [<span class="number">5</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="string">"SUM"</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">        [<span class="string">"AVG"</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>],</span><br><span class="line">        <span class="string">"quit"</span>,</span><br><span class="line">        <span class="number">42</span></span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> i, packet <span class="keyword">in</span> <span class="built_in">enumerate</span>(packets_to_test):</span><br><span class="line">        print_info(<span class="string">f"处理包 <span class="subst">{i+<span class="number">1</span>}</span>:"</span>)</span><br><span class="line">        print_success(<span class="string">f"  结果: <span class="subst">{demo_structural_pattern_matching(packet)}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h4 id="2-联合类型操作符"><a href="#2-联合类型操作符" class="headerlink" title="2. 联合类型操作符 (|)"></a>2. 联合类型操作符 (<code>|</code>)</h4><p>现在可以使用 <code>|</code> 操作符来表示联合类型 (Union)，使得类型注解更简洁。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 联合类型操作符演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from typing import Union, Optional # 在 Python 3.10+ 中 Optional 和 Union 不再必需显式导入来使用 |</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_union_operator</span>(<span class="params">value: <span class="built_in">int</span> | <span class="built_in">str</span> | <span class="built_in">float</span></span>) -&gt; <span class="literal">None</span>: <span class="comment"># 使用 | 代替 Union[int, str, float]</span></span><br><span class="line">    <span class="string">"""演示使用 | 作为联合类型操作符。"""</span></span><br><span class="line">    print_subheader(<span class="string">"2. 联合类型操作符 (`|`)"</span>)</span><br><span class="line">    </span><br><span class="line">    print_info(<span class="string">f"接收到的值: <span class="subst">{value}</span> (类型: <span class="subst">{<span class="built_in">type</span>(value).__name__}</span>)"</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">        print_success(<span class="string">f"  数值处理: <span class="subst">{value * <span class="number">2</span>}</span>"</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">        print_success(<span class="string">f"  字符串处理: '<span class="subst">{value.upper()}</span>'"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_optional_data</span>(<span class="params">data: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>: <span class="comment"># 使用 | None 代替 Optional[str]</span></span><br><span class="line">    <span class="string">"""演示使用 | None 代替 Optional。"""</span></span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        print_warning(<span class="string">"  未提供数据。"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_success(<span class="string">f"  处理可选数据: '<span class="subst">{data}</span>'"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    demo_union_operator(<span class="number">100</span>)</span><br><span class="line">    demo_union_operator(<span class="string">"hello python 3.10"</span>)</span><br><span class="line">    demo_union_operator(<span class="number">3.14</span>)</span><br><span class="line">    process_optional_data(<span class="string">"Some data"</span>)</span><br><span class="line">    process_optional_data() <span class="comment"># data 为 None</span></span><br></pre></td></tr></tbody></table></figure><h4 id="3-上下文管理器改进：括号内多个-with-表达式"><a href="#3-上下文管理器改进：括号内多个-with-表达式" class="headerlink" title="3. 上下文管理器改进：括号内多个 with 表达式"></a>3. 上下文管理器改进：括号内多个 <code>with</code> 表达式</h4><p>现在可以在 <code>with</code> 语句后的括号内编写多个上下文表达式，而无需嵌套 <code>with</code> 语句，使代码更扁平。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 上下文管理器改进演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># 用于文件操作</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_multiple_context_expressions</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示在 with 语句中使用括号包含多个上下文表达式。"""</span></span><br><span class="line">    print_subheader(<span class="string">"3. 上下文管理器改进 (括号内多个表达式)"</span>)</span><br><span class="line">    </span><br><span class="line">    input_filename: <span class="built_in">str</span> = <span class="string">"temp_input_for_with.txt"</span></span><br><span class="line">    output_filename: <span class="built_in">str</span> = <span class="string">"temp_output_for_with.txt"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建临时输入文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_filename, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f_in_setup:</span><br><span class="line">        f_in_setup.write(<span class="string">"第一行数据。\n第二行数据。\n"</span>)</span><br><span class="line">    print_info(<span class="string">f"已创建临时输入文件: <span class="subst">{input_filename}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Python 3.10+ 的写法</span></span><br><span class="line">        <span class="keyword">with</span> (</span><br><span class="line">            <span class="built_in">open</span>(input_filename, <span class="string">"r"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> infile,</span><br><span class="line">            <span class="built_in">open</span>(output_filename, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> outfile</span><br><span class="line">        ):</span><br><span class="line">            print_info(<span class="string">f"  同时打开 '<span class="subst">{infile.name}</span>' (读) 和 '<span class="subst">{outfile.name}</span>' (写)。"</span>)</span><br><span class="line">            content: <span class="built_in">str</span> = infile.read()</span><br><span class="line">            outfile.write(content.upper()) <span class="comment"># 示例操作：转为大写后写入</span></span><br><span class="line">            print_success(<span class="string">f"  内容已从输入文件读取，处理后写入输出文件。"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 验证输出文件</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(output_filename):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(output_filename, <span class="string">"r"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f_check:</span><br><span class="line">                print_info(<span class="string">f"  输出文件 '<span class="subst">{output_filename}</span>' 内容:\n'''\n<span class="subst">{f_check.read().strip()}</span>\n'''"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"  处理文件时发生错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># 清理临时文件</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(input_filename): os.remove(input_filename)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(output_filename): os.remove(output_filename)</span><br><span class="line">        print_info(<span class="string">"临时文件已清理。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    demo_multiple_context_expressions()</span><br></pre></td></tr></tbody></table></figure><h3 id="Python-3-11-主要特性"><a href="#Python-3-11-主要特性" class="headerlink" title="Python 3.11 主要特性"></a>Python 3.11 主要特性</h3><p>Python 3.11 带来了显著的性能提升 (CPython Faster计划)，以及异常组、异常注释、<code>Self</code> 类型和 <code>LiteralString</code> 等新特性。</p><h4 id="1-异常组-ExceptionGroup-和异常注释-add-note"><a href="#1-异常组-ExceptionGroup-和异常注释-add-note" class="headerlink" title="1. 异常组 (ExceptionGroup) 和异常注释 (add_note())"></a>1. 异常组 (<code>ExceptionGroup</code>) 和异常注释 (<code>add_note()</code>)</h4><p><code>ExceptionGroup</code> 允许同时处理多个不相关的异常。<code>add_note()</code> 方法可以向异常对象添加上下文注释。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 异常组和异常注释演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from exceptiongroup import ExceptionGroup # 在 Python 3.11+ 中，ExceptionGroup 是内置的</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_exception_groups_and_notes</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 ExceptionGroup 和 e.add_note()。"""</span></span><br><span class="line">    print_subheader(<span class="string">"1. 异常组 (`ExceptionGroup`) 和异常注释 (`add_note()`)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示 add_note()</span></span><br><span class="line">    print_info(<span class="string">"演示 e.add_note():"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input: <span class="built_in">str</span> = <span class="string">"non_numeric_value"</span></span><br><span class="line">        value: <span class="built_in">int</span> = <span class="built_in">int</span>(user_input)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        e.add_note(<span class="string">f"输入的值 '<span class="subst">{user_input}</span>' 无法转换为整数。"</span>) <span class="comment"># 添加注释</span></span><br><span class="line">        e.add_note(<span class="string">"请确保输入的是有效的数字。"</span>)</span><br><span class="line">        <span class="comment"># raise # 如果要重新引发带注释的异常</span></span><br><span class="line">        print_warning(<span class="string">f"捕获到 ValueError (带注释):"</span>)</span><br><span class="line">        <span class="comment"># 要查看注释，你需要捕获异常并访问其 __notes__ 属性，或让它传播到顶层由解释器打印</span></span><br><span class="line">        <span class="comment"># print(f"  异常: {e}")</span></span><br><span class="line">        <span class="comment"># if hasattr(e, "__notes__"):</span></span><br><span class="line">        <span class="comment">#     for note in e.__notes__:</span></span><br><span class="line">        <span class="comment">#         print(f"    Note: {note}")</span></span><br><span class="line">        <span class="comment"># Python 3.11 的默认异常回溯会显示注释</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">raise</span> e <span class="comment"># 重新引发以观察其默认打印效果</span></span><br><span class="line">        <span class="keyword">except</span> ValueError <span class="keyword">as</span> e_raised:</span><br><span class="line">            print_error(<span class="string">f"  重新引发的异常 (其回溯应包含注释):\n<span class="subst">{e_raised}</span>"</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(e_raised, <span class="string">"__notes__"</span>): <span class="comment"># Python 3.11+</span></span><br><span class="line">                 print_info(<span class="string">"  异常包含的注释 (__notes__):"</span>)</span><br><span class="line">                 <span class="keyword">for</span> note_item <span class="keyword">in</span> e_raised.__notes__:</span><br><span class="line">                     <span class="built_in">print</span>(<span class="string">f"    - <span class="subst">{note_item}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 演示 ExceptionGroup (概念性)</span></span><br><span class="line">    print_info(<span class="string">"\n演示 ExceptionGroup (概念性):"</span>)</span><br><span class="line">    <span class="comment"># 假设我们有多个并发任务，每个都可能失败</span></span><br><span class="line">    exceptions_list: <span class="type">List</span>[Exception] = []</span><br><span class="line">    task1_result, task2_result = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模拟任务1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># task1_result = 10 / 0</span></span><br><span class="line">        print_info(<span class="string">"  任务1: 模拟成功。"</span>)</span><br><span class="line">        task1_result = <span class="string">"Success"</span></span><br><span class="line">    <span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e1:</span><br><span class="line">        e1.add_note(<span class="string">"任务1 (除法运算) 失败。"</span>)</span><br><span class="line">        exceptions_list.append(e1)</span><br><span class="line">        print_warning(<span class="string">"  任务1: 捕获 ZeroDivisionError。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 模拟任务2</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># data = {}</span></span><br><span class="line">        <span class="comment"># value = data["missing_key"]</span></span><br><span class="line">        print_info(<span class="string">"  任务2: 模拟成功。"</span>)</span><br><span class="line">        task2_result = <span class="string">"OK"</span></span><br><span class="line">    <span class="keyword">except</span> KeyError <span class="keyword">as</span> e2:</span><br><span class="line">        e2.add_note(<span class="string">"任务2 (字典键查找) 失败。"</span>)</span><br><span class="line">        exceptions_list.append(e2)</span><br><span class="line">        print_warning(<span class="string">"  任务2: 捕获 KeyError。"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> exceptions_list:</span><br><span class="line">        <span class="comment"># 如果有多个异常，可以用 ExceptionGroup 包装它们</span></span><br><span class="line">        <span class="comment"># 在 Python 3.11+ 中，ExceptionGroup 是内置的</span></span><br><span class="line">        <span class="comment"># from exceptiongroup import ExceptionGroup # 对于旧版本，可能需要此库</span></span><br><span class="line">        error_group = ExceptionGroup(<span class="string">"在执行多个任务时发生错误"</span>, exceptions_list)</span><br><span class="line">        print_error(<span class="string">f"  发生了异常组: <span class="subst">{error_group}</span>"</span>)</span><br><span class="line">        <span class="comment"># 处理异常组:</span></span><br><span class="line">        <span class="comment"># try:</span></span><br><span class="line">        <span class="comment">#     raise error_group</span></span><br><span class="line">        <span class="comment"># except* ValueError as eg_vg: # Python 3.11+ 的 except* 语法</span></span><br><span class="line">        <span class="comment">#     print_warning(f"  捕获到异常组中的 ValueError: {eg_vg.exceptions}")</span></span><br><span class="line">        <span class="comment"># except* TypeError as eg_tg:</span></span><br><span class="line">        <span class="comment">#     print_warning(f"  捕获到异常组中的 TypeError: {eg_tg.exceptions}")</span></span><br><span class="line">        print_info(<span class="string">"  (在实际代码中，会使用 try...except* 来处理 ExceptionGroup)"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print_success(<span class="string">"  所有模拟任务均成功完成。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print_header(<span class="string">"Python 3.11 特性演示"</span>)</span><br><span class="line">    demo_exception_groups_and_notes()</span><br></pre></td></tr></tbody></table></figure><h4 id="2-Self-类型"><a href="#2-Self-类型" class="headerlink" title="2. Self 类型"></a>2. <code>Self</code> 类型</h4><p><code>typing.Self</code> (或仅 <code>Self</code>，如果 <code>from typing import Self</code>) 提供了一种更简洁、更准确的方式来注解那些返回类自身实例的方法 (例如构造函数、工厂方法、或返回修改后自身的链式调用方法)。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === Self 类型演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Self <span class="comment"># Python 3.11+ (或 typing_extensions.Self for older)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_self_type</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 typing.Self 类型的使用。"""</span></span><br><span class="line">    print_subheader(<span class="string">"2. `Self` 类型"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ConfigBuilder</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name: <span class="built_in">str</span></span>):</span><br><span class="line">            <span class="variable language_">self</span>.name: <span class="built_in">str</span> = name</span><br><span class="line">            <span class="variable language_">self</span>.settings: <span class="built_in">dict</span> = {}</span><br><span class="line">            print_info(<span class="string">f"  ConfigBuilder '<span class="subst">{name}</span>' 已创建。"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">set_option</span>(<span class="params">self, key: <span class="built_in">str</span>, value: <span class="type">Any</span></span>) -&gt; Self: <span class="comment"># 返回类型是 Self</span></span><br><span class="line">            <span class="string">"""设置一个配置选项并返回自身，以便链式调用。"""</span></span><br><span class="line">            <span class="variable language_">self</span>.settings[key] = value</span><br><span class="line">            print_info(<span class="string">f"    选项 '<span class="subst">{key}</span>' 设置为 '<span class="subst">{value}</span>'"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span> <span class="comment"># 返回当前类的实例</span></span><br><span class="line"></span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">create_default</span>(<span class="params">cls, name: <span class="built_in">str</span></span>) -&gt; Self: <span class="comment"># 类方法返回 Self</span></span><br><span class="line">            <span class="string">"""创建一个带有默认设置的实例。"""</span></span><br><span class="line">            print_info(<span class="string">f"  调用类方法 create_default for '<span class="subst">{name}</span>'"</span>)</span><br><span class="line">            instance = cls(name) <span class="comment"># cls 指向 ConfigBuilder (或其子类)</span></span><br><span class="line">            instance.set_option(<span class="string">"default_timeout"</span>, <span class="number">30</span>)</span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">            print_info(<span class="string">f"  构建配置 '<span class="subst">{self.name}</span>'..."</span>)</span><br><span class="line">            <span class="keyword">return</span> {<span class="string">"name"</span>: <span class="variable language_">self</span>.name, <span class="string">"settings"</span>: <span class="variable language_">self</span>.settings}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用示例</span></span><br><span class="line">    builder1: ConfigBuilder = ConfigBuilder(<span class="string">"App1"</span>)</span><br><span class="line">    builder1.set_option(<span class="string">"port"</span>, <span class="number">8080</span>).set_option(<span class="string">"retries"</span>, <span class="number">3</span>) <span class="comment"># 链式调用</span></span><br><span class="line">    config1: <span class="built_in">dict</span> = builder1.build()</span><br><span class="line">    print_success(<span class="string">f"  Config1: <span class="subst">{config1}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    builder2: ConfigBuilder = ConfigBuilder.create_default(<span class="string">"App2_Default"</span>)</span><br><span class="line">    builder2.set_option(<span class="string">"theme"</span>, <span class="string">"dark"</span>)</span><br><span class="line">    config2: <span class="built_in">dict</span> = builder2.build()</span><br><span class="line">    print_success(<span class="string">f"  Config2 (from default): <span class="subst">{config2}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 演示 Self 在子类中的行为</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">AdvancedConfigBuilder</span>(<span class="title class_ inherited__">ConfigBuilder</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">enable_feature_x</span>(<span class="params">self</span>) -&gt; Self: <span class="comment"># 返回的仍然是 AdvancedConfigBuilder 类型</span></span><br><span class="line">            <span class="variable language_">self</span>.set_option(<span class="string">"feature_x"</span>, <span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">            </span><br><span class="line">    adv_builder = AdvancedConfigBuilder(<span class="string">"AdvApp"</span>).enable_feature_x().set_option(<span class="string">"mode"</span>, <span class="string">"expert"</span>)</span><br><span class="line">    adv_config = adv_builder.build()</span><br><span class="line">    print_success(<span class="string">f"  AdvancedConfig: <span class="subst">{adv_config}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  adv_builder 的类型是: <span class="subst">{<span class="built_in">type</span>(adv_builder).__name__}</span> (应为 AdvancedConfigBuilder)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    demo_self_type()</span><br></pre></td></tr></tbody></table></figure><h4 id="3-LiteralString-类型"><a href="#3-LiteralString-类型" class="headerlink" title="3. LiteralString 类型"></a>3. <code>LiteralString</code> 类型</h4><p><code>typing.LiteralString</code> 用于注解那些值必须是字面量字符串（即直接在代码中写出的字符串，而不是通过变量拼接或函数调用生成的字符串）的参数。这有助于静态分析工具检测潜在的安全风险，例如 SQL 注入。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === LiteralString 类型演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> LiteralString <span class="comment"># Python 3.11+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_literal_string_type</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 typing.LiteralString 类型。"""</span></span><br><span class="line">    print_subheader(<span class="string">"3. `LiteralString` 类型"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_safe_query</span>(<span class="params">query: LiteralString, params: <span class="built_in">tuple</span> = (<span class="params"></span>)</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        一个模拟的安全数据库查询函数。</span></span><br><span class="line"><span class="string">        它只接受字面量字符串作为查询语句，以防止SQL注入。</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        print_info(<span class="string">f"  尝试执行安全查询: '<span class="subst">{query}</span>' (参数: <span class="subst">{params}</span>)"</span>)</span><br><span class="line">        <span class="comment"># 在实际应用中，这里会与数据库交互，并可能使用参数化查询</span></span><br><span class="line">        print_success(<span class="string">f"    模拟执行查询: <span class="subst">{query}</span> (参数化: <span class="subst">{params}</span>)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 正确的用法：传递字符串字面量</span></span><br><span class="line">    execute_safe_query(<span class="string">"SELECT * FROM users WHERE status = 'active'"</span>)</span><br><span class="line">    execute_safe_query(<span class="string">"SELECT name, email FROM customers WHERE id = %s"</span>, params=(<span class="number">101</span>,))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 错误的用法：传递通过变量或拼接生成的字符串</span></span><br><span class="line">    <span class="comment"># 静态类型检查器 (如 MyPy) 会对以下调用发出警告</span></span><br><span class="line">    table_name_var: <span class="built_in">str</span> = <span class="string">"users"</span> </span><br><span class="line">    <span class="comment"># execute_safe_query(f"SELECT * FROM {table_name_var}") # MyPy 会警告: Expected LiteralString</span></span><br><span class="line">    </span><br><span class="line">    user_input_column: <span class="built_in">str</span> = <span class="built_in">input</span>(<span class="string">"请输入要查询的列名 (例如 'username'): "</span>) <span class="keyword">if</span> os.getenv(<span class="string">"ASK_INPUT"</span>) <span class="keyword">else</span> <span class="string">"username"</span> <span class="comment"># 模拟用户输入</span></span><br><span class="line">    <span class="comment"># execute_safe_query(f"SELECT {user_input_column} FROM data") # MyPy 会警告</span></span><br><span class="line"></span><br><span class="line">    print_warning(<span class="string">"  注意: LiteralString 主要用于静态类型检查。"</span>)</span><br><span class="line">    print_info(<span class="string">"  如果上面的注释行被取消且使用了 MyPy，它会标记出潜在的类型错误。"</span>)</span><br><span class="line">    print_info(<span class="string">"  在运行时，Python 本身不强制 LiteralString。"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># os.environ["ASK_INPUT"] = "1" # 取消注释以在运行时测试 input() 部分 (可选)</span></span><br><span class="line">    demo_literal_string_type()</span><br><span class="line">    <span class="comment"># if "ASK_INPUT" in os.environ: del os.environ["ASK_INPUT"]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Python-3-12-主要特性"><a href="#Python-3-12-主要特性" class="headerlink" title="Python 3.12 主要特性"></a>Python 3.12 主要特性</h3><p>Python 3.12 继续改进类型系统，带来了更简洁的泛型类和函数语法，以及 f-string 的进一步增强。</p><h4 id="1-泛型类和函数的简化语法-PEP-695"><a href="#1-泛型类和函数的简化语法-PEP-695" class="headerlink" title="1. 泛型类和函数的简化语法 (PEP 695)"></a>1. 泛型类和函数的简化语法 (PEP 695)</h4><p>现在可以使用更简洁的方括号语法直接在类或函数定义中声明类型参数，而无需从 <code>typing</code> 导入 <code>TypeVar</code>。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 简化泛型语法演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from typing import TypeVar # 在 Python 3.12+ 中 TypeVar 可以通过新语法隐式定义</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_simplified_generics_syntax</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 Python 3.12+ 中简化的泛型类和函数语法。"""</span></span><br><span class="line">    print_subheader(<span class="string">"1. 泛型类和函数的简化语法 (PEP 695)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 简化泛型函数定义</span></span><br><span class="line">    <span class="comment"># 旧方法: T = TypeVar('T'); def old_first(items: list[T]) -&gt; T | None: ...</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">new_first</span>[T](items: <span class="built_in">list</span>[T]) -&gt; T | <span class="literal">None</span>: <span class="comment"># 直接在函数名后用 [] 声明类型参数 T</span></span><br><span class="line">        <span class="string">"""获取列表的第一个元素，如果列表为空则返回 None。"""</span></span><br><span class="line">        print_info(<span class="string">f"    new_first 调用，items: <span class="subst">{items}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> items[<span class="number">0</span>] <span class="keyword">if</span> items <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    print_success(<span class="string">f"  new_first([10, 20]): <span class="subst">{new_first([<span class="number">10</span>, <span class="number">20</span>])}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"  new_first(['a', 'b']): <span class="subst">{new_first([<span class="string">'a'</span>, <span class="string">'b'</span>])}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"  new_first([]): <span class="subst">{new_first([])}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 简化泛型类定义</span></span><br><span class="line">    <span class="comment"># 旧方法: U = TypeVar('U'); class OldBox(Generic[U]): ...</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">NewBox</span>[U]: <span class="comment"># 直接在类名后用 [] 声明类型参数 U</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, content: U</span>):</span><br><span class="line">            <span class="variable language_">self</span>.content: U = content</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get_content</span>(<span class="params">self</span>) -&gt; U:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.content</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"NewBox[<span class="subst">{<span class="built_in">type</span>(self.content).__name__}</span>](content=<span class="subst">{self.content!r}</span>)"</span></span><br><span class="line"></span><br><span class="line">    int_box = NewBox[<span class="built_in">int</span>](<span class="number">123</span>) <span class="comment"># 可以显式指定类型</span></span><br><span class="line">    str_box = NewBox(<span class="string">"Python 3.12"</span>) <span class="comment"># 也可以让类型检查器推断</span></span><br><span class="line"></span><br><span class="line">    print_success(<span class="string">f"  <span class="subst">{int_box}</span> -&gt; content: <span class="subst">{int_box.get_content()}</span>"</span>)</span><br><span class="line">    print_success(<span class="string">f"  <span class="subst">{str_box}</span> -&gt; content: <span class="subst">{str_box.get_content()}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print_header(<span class="string">"Python 3.12 特性演示"</span>)</span><br><span class="line">    demo_simplified_generics_syntax()</span><br></pre></td></tr></tbody></table></figure><h4 id="2-类型别名与类型变量语法改进-type-语句-PEP-695"><a href="#2-类型别名与类型变量语法改进-type-语句-PEP-695" class="headerlink" title="2. 类型别名与类型变量语法改进 (type 语句) (PEP 695)"></a>2. 类型别名与类型变量语法改进 (<code>type</code> 语句) (PEP 695)</h4><p>Python 3.12 引入了 <code>type</code> 语句作为创建类型别名和类型变量的更清晰、更正式的方式。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === type 语句演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span> <span class="comment"># List 仍可用于兼容性或复杂场景</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3.12+ 的 type 语句</span></span><br><span class="line"><span class="comment"># 定义类型别名</span></span><br><span class="line"><span class="built_in">type</span> Point = <span class="built_in">tuple</span>[<span class="built_in">float</span>, <span class="built_in">float</span>]</span><br><span class="line"><span class="built_in">type</span> IntList = <span class="built_in">list</span>[<span class="built_in">int</span>]</span><br><span class="line"><span class="comment"># 定义类型变量 (TypeVar)</span></span><br><span class="line"><span class="built_in">type</span> T = <span class="built_in">str</span> | <span class="built_in">int</span> <span class="comment"># T 现在是一个 TypeVar，可以绑定到 str 或 int</span></span><br><span class="line"><span class="built_in">type</span> K_contra = contravariant <span class="built_in">str</span> <span class="comment"># 定义逆变类型变量 K，上界为 str</span></span><br><span class="line"><span class="built_in">type</span> V_co = covariant <span class="built_in">int</span> <span class="comment"># 定义协变类型变量 V，上界为 int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_type_statement</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 Python 3.12+ 中使用 type 语句定义类型别名和类型变量。"""</span></span><br><span class="line">    print_subheader(<span class="string">"2. 类型别名与类型变量语法改进 (`type` 语句)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_point</span>(<span class="params">p: Point</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        print_info(<span class="string">f"    处理点: <span class="subst">{p}</span>, 类型: <span class="subst">{<span class="built_in">type</span>(p)}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sum_int_list</span>(<span class="params">numbers: IntList</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(numbers)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_generic_var</span>(<span class="params">item: T</span>) -&gt; <span class="literal">None</span>: <span class="comment"># T 是 TypeVar (str | int)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(item, <span class="built_in">str</span>):</span><br><span class="line">            print_info(<span class="string">f"    泛型变量 T (字符串): <span class="subst">{item.upper()}</span>"</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(item, <span class="built_in">int</span>):</span><br><span class="line">            print_info(<span class="string">f"    泛型变量 T (整数): <span class="subst">{item * <span class="number">100</span>}</span>"</span>)</span><br><span class="line">            </span><br><span class="line">    my_point: Point = (<span class="number">1.0</span>, <span class="number">2.5</span>)</span><br><span class="line">    process_point(my_point)</span><br><span class="line">    <span class="comment"># process_point([1.0, 2.5]) # MyPy 会报错，类型不匹配</span></span><br><span class="line">    </span><br><span class="line">    my_numbers: IntList = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>]</span><br><span class="line">    print_success(<span class="string">f"  整数列表 <span class="subst">{my_numbers}</span> 的和: <span class="subst">{sum_int_list(my_numbers)}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    process_generic_var(<span class="string">"hello"</span>)</span><br><span class="line">    process_generic_var(<span class="number">5</span>)</span><br><span class="line">    <span class="comment"># process_generic_var(3.14) # MyPy 会报错，因为 T 只能是 str 或 int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    demo_type_statement()</span><br></pre></td></tr></tbody></table></figure><h4 id="3-f-string-语法进一步改进-PEP-701"><a href="#3-f-string-语法进一步改进-PEP-701" class="headerlink" title="3. f-string 语法进一步改进 (PEP 701)"></a>3. f-string 语法进一步改进 (PEP 701)</h4><p>Python 3.12 中的 f-string 更加强大和灵活，主要体现在：</p><ul><li><strong>引号重用</strong>：现在可以在 f-string 表达式内部重用与包围 f-string 自身所用类型相同的引号，无需转义。</li><li><strong>多行表达式和注释</strong>：f-string 表达式部分现在可以跨越多行，并且可以包含 <code>#</code> 注释。</li><li><strong>反斜杠</strong>：表达式部分可以使用反斜杠。</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === f-string 语法改进演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_fstring_enhancements</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 Python 3.12+ 中 f-string 的语法改进。"""</span></span><br><span class="line">    print_subheader(<span class="string">"3. f-string 语法进一步改进 (PEP 701)"</span>)</span><br><span class="line"></span><br><span class="line">    user_data: <span class="built_in">dict</span> = {<span class="string">"name"</span>: <span class="string">"Alice"</span>, <span class="string">"city"</span>: <span class="string">"Wonderland"</span>}</span><br><span class="line">    user_id: <span class="built_in">int</span> = <span class="number">101</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 引号重用</span></span><br><span class="line">    <span class="comment"># 在 3.12 之前: f"User data: {user_data['name']}" (需要不同类型的引号或转义)</span></span><br><span class="line">    <span class="comment"># 或者 f'User data: {user_data["name"]}'</span></span><br><span class="line">    message_quotes: <span class="built_in">str</span> = <span class="string">f"User: <span class="subst">{user_data[<span class="string">'name'</span>]}</span>"</span> <span class="comment"># 3.12+: 可以重用引号</span></span><br><span class="line">    print_success(<span class="string">f"  引号重用: <span class="subst">{message_quotes}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    message_quotes_single: <span class="built_in">str</span> = <span class="string">f'ID: <span class="subst">{user_data.get(<span class="string">"name"</span>, <span class="string">"N/A"</span>)!r}</span>'</span> <span class="comment"># 外层单引号，内部仍可方便使用双引号</span></span><br><span class="line">    print_success(<span class="string">f"  引号重用 (单引号): <span class="subst">{message_quotes_single}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 多行表达式和注释</span></span><br><span class="line">    <span class="comment"># (注意：在多行 f-string 表达式中，注释必须在自己的行上)</span></span><br><span class="line">    items_list: <span class="built_in">list</span>[<span class="built_in">int</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line">    formatted_multiline: <span class="built_in">str</span> = (</span><br><span class="line">        <span class="string">f"Data summary for user <span class="subst">{user_id}</span>:\n"</span></span><br><span class="line">        <span class="string">f"  - Items count: <span class="subst">{<span class="built_in">len</span>(items_list)}</span>\n"</span></span><br><span class="line">        <span class="string">f"  - Even items sum: <span class="subst">{<span class="built_in">sum</span>(</span></span></span><br><span class="line"><span class="subst"><span class="string">            x </span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="keyword">for</span> x <span class="keyword">in</span> items_list </span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>  # 这是一个 f-string 表达式内部的注释</span></span></span><br><span class="line"><span class="subst"><span class="string">        )}</span>\n"</span> <span class="comment"># 多行表达式</span></span><br><span class="line">        <span class="string">f"  - User info: <span class="subst">{user_data[<span class="string">'name'</span>].upper() # .upper() 方法调用</span></span></span><br><span class="line"><span class="subst"><span class="string">                          + <span class="string">' from '</span> + user_data[<span class="string">'city'</span>]}</span>"</span> </span><br><span class="line">    )</span><br><span class="line">    print_info(<span class="string">"  f-string 带多行表达式和注释:"</span>)</span><br><span class="line">    <span class="built_in">print</span>(formatted_multiline)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 反斜杠 (虽然不常见，但现在允许)</span></span><br><span class="line">    <span class="comment"># path_example = f"Path: {'C:\\Users\\Default'}" # 原本就这样可以</span></span><br><span class="line">    <span class="comment"># fstring_backslash = f"{'a\\nb'.split('\\n')}" # 现在更灵活</span></span><br><span class="line">    <span class="comment"># print_success(f"  f-string 中使用反斜杠: {fstring_backslash}")</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    demo_fstring_enhancements()</span><br></pre></td></tr></tbody></table></figure><h3 id="Python-3-13-主要特性"><a href="#Python-3-13-主要特性" class="headerlink" title="Python 3.13 主要特性"></a>Python 3.13 主要特性</h3><p>Python 3.13 带来了包括新的 <code>@override</code> 装饰器、JIT 编译器的初步实验（可能不直接体现在日常语法中）、以及对现有特性的一些改进。</p><h4 id="1-typing-override-装饰器-PEP-698"><a href="#1-typing-override-装饰器-PEP-698" class="headerlink" title="1. @typing.override 装饰器 (PEP 698)"></a>1. <code>@typing.override</code> 装饰器 (PEP 698)</h4><p>一个新的装饰器 <code>@override</code> (来自 <code>typing</code> 模块，或 Python 3.12+ 的 <code>typing_extensions</code> 中已有) 用于明确指示一个方法意图覆盖其父类中的同名方法。这有助于静态类型检查器和开发者捕捉由于意外拼写错误或签名不匹配导致的覆盖失败。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === @override 装饰器演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> override <span class="comment"># Python 3.13+ (或 from typing_extensions import override for 3.12)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo_override_decorator</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示 @typing.override 装饰器。"""</span></span><br><span class="line">    print_subheader(<span class="string">"1. `@typing.override` 装饰器 (PEP 698)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">BaseDocument</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get_title</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Generic Document"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">render_content</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Article</span>(<span class="title class_ inherited__">BaseDocument</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, title: <span class="built_in">str</span>, body: <span class="built_in">str</span></span>):</span><br><span class="line">            <span class="variable language_">self</span>._title = title</span><br><span class="line">            <span class="variable language_">self</span>._body = body</span><br><span class="line">            </span><br><span class="line"><span class="meta">        @override </span><span class="comment"># 明确表示此方法覆盖父类方法</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get_title</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"Article: <span class="subst">{self._title}</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">        @override </span><span class="comment"># 明确表示此方法覆盖父类方法</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">render_content</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"&lt;h1&gt;<span class="subst">{self.get_title()}</span>&lt;/h1&gt;&lt;p&gt;<span class="subst">{self._body}</span>&lt;/p&gt;"</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 如果写成 @override def get_titel(self) -&gt; str: ... (拼写错误)</span></span><br><span class="line">        <span class="comment"># MyPy 这类类型检查器会报错，因为它没有覆盖任何父类方法。</span></span><br><span class="line"></span><br><span class="line">    my_article = Article(<span class="string">"Python 3.13 News"</span>, <span class="string">"Override decorator is here!"</span>)</span><br><span class="line">    print_success(<span class="string">f"  Article Title: <span class="subst">{my_article.get_title()}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  Rendered Article (simulated):\n<span class="subst">{my_article.render_content()}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试覆盖一个不存在的基类方法 (MyPy会警告)</span></span><br><span class="line">    <span class="comment"># class BadSubclass(BaseDocument):</span></span><br><span class="line">    <span class="comment">#     @override</span></span><br><span class="line">    <span class="comment">#     def non_existent_method_in_base(self) -&gt; None:</span></span><br><span class="line">    <span class="comment">#         pass</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"  @override 帮助在静态检查时发现覆盖错误。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print_header(<span class="string">"Python 3.13 (部分) 特性演示"</span>)</span><br><span class="line">    demo_override_decorator()</span><br></pre></td></tr></tbody></table></figure><h2 id="第二十一章：项目结构规范与最佳实践"><a href="#第二十一章：项目结构规范与最佳实践" class="headerlink" title="第二十一章：项目结构规范与最佳实践"></a>第二十一章：项目结构规范与最佳实践</h2><p>一个清晰、一致的项目结构和高质量的代码是任何成功软件项目的基石。良好的项目组织不仅能让其他开发者（以及未来的你）更容易理解和维护代码，还能简化构建、测试、部署和分发流程。同样，遵循统一的代码风格和最佳实践能够显著提高代码的可读性、减少错误，并促进团队协作。</p><p>本章将探讨 Python 项目的推荐结构，并总结一些核心的代码质量与风格指南，主要基于 PEP 8。</p><h3 id="一、推荐的-Python-项目结构"><a href="#一、推荐的-Python-项目结构" class="headerlink" title="一、推荐的 Python 项目结构"></a>一、推荐的 Python 项目结构</h3><p>一个组织良好的 Python 项目通常包含应用代码、测试、文档、依赖管理和打包配置等部分。下面是一个推荐的通用项目结构示例：</p><h4 id="1-目录树概览"><a href="#1-目录树概览" class="headerlink" title="1. 目录树概览"></a>1. 目录树概览</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">my_project/                  <span class="comment"># 项目根目录 (例如，Git 仓库的根)</span></span><br><span class="line">│</span><br><span class="line">├── my_package/              <span class="comment"># 主要的 Python 包 (你的应用或库的核心代码)</span></span><br><span class="line">│   ├── __init__.py          <span class="comment"># 将 'my_package' 标记为一个 Python 包，可包含包级别初始化代码</span></span><br><span class="line">│   ├── module1.py           <span class="comment"># 包内的模块文件</span></span><br><span class="line">│   ├── module2.py           <span class="comment"># 另一个模块文件</span></span><br><span class="line">│   ├── subpackage/          <span class="comment"># 包内可以有子包</span></span><br><span class="line">│   │   ├── __init__.py      <span class="comment"># 使 'subpackage' 成为一个子包</span></span><br><span class="line">│   │   └── submodule.py     <span class="comment"># 子包内的模块</span></span><br><span class="line">│   └── utils/               <span class="comment"># 常用的工具或辅助函数可以组织在子包中</span></span><br><span class="line">│       ├── __init__.py</span><br><span class="line">│       └── helpers.py       <span class="comment"># 辅助函数模块</span></span><br><span class="line">│</span><br><span class="line">├── tests/                   <span class="comment"># 存放所有测试代码的目录</span></span><br><span class="line">│   ├── __init__.py          <span class="comment"># 使 'tests' 成为一个包 (有些测试运行器需要)</span></span><br><span class="line">│   ├── test_module1.py      <span class="comment"># 针对 my_package.module1 的测试</span></span><br><span class="line">│   └── test_subpackage_submodule.py <span class="comment"># 针对子包模块的测试</span></span><br><span class="line">│</span><br><span class="line">├── docs/                    <span class="comment"># 项目文档 (例如使用 Sphinx 或 MkDocs 生成)</span></span><br><span class="line">│   ├── conf.py              <span class="comment"># Sphinx 配置文件 (如果使用 Sphinx)</span></span><br><span class="line">│   ├── index.rst            <span class="comment"># Sphinx 主文档文件 (或 index.md)</span></span><br><span class="line">│   └── api.rst              <span class="comment"># API 文档等</span></span><br><span class="line">│</span><br><span class="line">├── examples/                <span class="comment"># 如何使用你的包或库的示例代码</span></span><br><span class="line">│   └── usage_example.py</span><br><span class="line">│</span><br><span class="line">├── .gitignore               <span class="comment"># 指定 Git 应忽略的文件和目录</span></span><br><span class="line">├── LICENSE                  <span class="comment"># 项目的许可证文件 (例如 MIT, Apache 2.0)</span></span><br><span class="line">├── README.md                <span class="comment"># 项目的详细说明、安装指南、使用方法等 (Markdown 格式)</span></span><br><span class="line">├── requirements.txt         <span class="comment"># 列出项目运行所需的基本依赖包及其版本</span></span><br><span class="line">├── setup.py                 <span class="comment"># (传统方式) Python 项目的构建脚本 (用于打包、分发)</span></span><br><span class="line">├── pyproject.toml           <span class="comment"># (现代方式) 项目元数据和构建系统配置 (推荐与 setup.py/setup.cfg 结合或替代)</span></span><br><span class="line">└── tox.ini                  <span class="comment"># (可选) tox 配置文件，用于自动化测试不同 Python 环境</span></span><br></pre></td></tr></tbody></table></figure><h4 id="2-各部分详解"><a href="#2-各部分详解" class="headerlink" title="2. 各部分详解"></a>2. 各部分详解</h4><h5 id="a-my-project-项目根目录"><a href="#a-my-project-项目根目录" class="headerlink" title="a. my_project/ (项目根目录)"></a>a. <code>my_project/</code> (项目根目录)</h5><p>这是你项目的最顶层目录，通常对应你的版本控制系统（如 Git）的仓库根目录。</p><h5 id="b-my-package-主应用包"><a href="#b-my-package-主应用包" class="headerlink" title="b. my_package/ (主应用包)"></a>b. <code>my_package/</code> (主应用包)</h5><p>这是存放你项目核心 Python 代码的地方。它是一个 Python 包，意味着它包含一个 <code>__init__.py</code> 文件。</p><ul><li><p><strong><code>__init__.py</code></strong>:<br>这个文件可以为空，仅用于将目录标记为一个 Python 包，使得其中的模块可以使用点分路径导入 (例如 <code>from my_package import module1</code>)。<br>它也可以包含包级别的初始化代码、定义 <code>__all__</code> 变量来控制 <code>from my_package import *</code> 的行为，或者直接从子模块中导出常用的类和函数，以提供更简洁的包 API。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === my_package/__init__.py 示例 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> print_info <span class="comment"># 仅为演示打印，实际 __init__.py 通常不直接打印</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">"包 'my_package' 正在被初始化..."</span>)</span><br><span class="line"></span><br><span class="line">__version__: <span class="built_in">str</span> = <span class="string">"0.1.0"</span> <span class="comment"># 定义包版本</span></span><br><span class="line">APP_NAME: <span class="built_in">str</span> = <span class="string">"My Awesome Application"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从子模块导出，方便外部调用</span></span><br><span class="line"><span class="comment"># from .module1 import important_function</span></span><br><span class="line"><span class="comment"># from .subpackage.submodule import UsefulClass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># __all__ 控制 from my_package import * 的行为</span></span><br><span class="line"><span class="comment"># __all__ = ["important_function", "UsefulClass", "APP_NAME"]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">package_level_utility</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">"""一个包级别的辅助函数示例。"""</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"Utility from <span class="subst">{APP_NAME}</span> v<span class="subst">{__version__}</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print_info(f"  {package_level_utility()}")</span></span><br></pre></td></tr></tbody></table></figure></li><li><p><strong><code>moduleX.py</code></strong> (例如 <code>module1.py</code>, <code>module2.py</code>):<br>这些是包内的实际模块文件，包含相关的函数、类和变量。</p></li><li><p><strong><code>subpackage/</code></strong>:<br>大型包可以进一步组织为子包，每个子包同样包含一个 <code>__init__.py</code> 文件。</p></li><li><p><strong><code>utils/</code></strong> (例如 <code>helpers.py</code>):<br>通常用于存放项目中可复用的辅助函数、工具类等。</p></li></ul><h5 id="c-tests-测试目录"><a href="#c-tests-测试目录" class="headerlink" title="c. tests/ (测试目录)"></a>c. <code>tests/</code> (测试目录)</h5><p>存放单元测试、集成测试等所有测试代码。测试文件名通常以 <code>test_</code> 开头，或者测试类以 <code>Test</code> 开头，以便测试运行器（如 <code>pytest</code>, <code>unittest</code>) 能够自动发现和执行。</p><h5 id="d-docs-文档目录"><a href="#d-docs-文档目录" class="headerlink" title="d. docs/ (文档目录)"></a>d. <code>docs/</code> (文档目录)</h5><p>存放项目的用户文档、API 文档等。常用的工具有 Sphinx (配合 reStructuredText 或 MyST Markdown) 或 MkDocs (纯 Markdown)。</p><h5 id="e-examples-示例代码目录"><a href="#e-examples-示例代码目录" class="headerlink" title="e. examples/ (示例代码目录)"></a>e. <code>examples/</code> (示例代码目录)</h5><p>提供如何使用你的库或应用程序的简单、可运行的示例代码。</p><h5 id="f-gitignore"><a href="#f-gitignore" class="headerlink" title="f. .gitignore"></a>f. <code>.gitignore</code></h5><p>告知 Git哪些文件或目录不应被跟踪和提交 (例如 <code>__pycache__/</code>, <code>*.pyc</code>, 虚拟环境目录, IDE 配置文件等)。</p><h5 id="g-LICENSE"><a href="#g-LICENSE" class="headerlink" title="g. LICENSE"></a>g. <code>LICENSE</code></h5><p>包含项目的开源许可证文本，例如 MIT, Apache 2.0, GPL 等。明确许可证对于代码的分享和使用非常重要。</p><h5 id="h-README-md"><a href="#h-README-md" class="headerlink" title="h. README.md"></a>h. <code>README.md</code></h5><p>项目的入口点和门面。通常包含：</p><ul><li>项目名称和简短描述。</li><li>安装说明。</li><li>基本用法示例。</li><li>如何运行测试。</li><li>如何贡献。</li><li>许可证信息链接。</li></ul><h5 id="i-requirements-txt"><a href="#i-requirements-txt" class="headerlink" title="i. requirements.txt"></a>i. <code>requirements.txt</code></h5><p>列出项目运行所必需的第三方依赖包及其版本。通常由 <code>pip freeze &gt; requirements.txt</code> 生成，或者手动维护。更现代的项目可能会使用 <code>pyproject.toml</code> 中的 <code>[project.dependencies]</code>。</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># === requirements.txt 示例 ===</span><br><span class="line"># requests==2.28.1</span><br><span class="line"># numpy&gt;=1.20.0,&lt;2.0.0</span><br><span class="line"># pandas</span><br><span class="line"># loguru</span><br></pre></td></tr></tbody></table></figure><h5 id="j-setup-py-或-pyproject-toml-setup-cfg"><a href="#j-setup-py-或-pyproject-toml-setup-cfg" class="headerlink" title="j. setup.py (或 pyproject.toml + setup.cfg)"></a>j. <code>setup.py</code> (或 <code>pyproject.toml</code> + <code>setup.cfg</code>)</h5><p>用于构建、打包和分发 Python 项目的脚本。</p><ul><li><p><strong>传统 <code>setup.py</code></strong>:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === setup.py 示例 (传统方式) ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> print_info <span class="comment"># 仅为演示，setup.py 通常不应有副作用打印</span></span><br><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup, find_packages</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print_header("执行 setup.py") # 避免在导入时执行打印</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_long_description</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">"""读取 README.md 作为长描述。"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"README.md"</span>, <span class="string">"r"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">return</span> f.read()</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="comment"># print_warning("README.md 未找到，长描述将为空。")</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A fantastic Python package."</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    REQUIRED_PACKAGES: <span class="type">List</span>[<span class="built_in">str</span>] = [</span><br><span class="line">    <span class="string">"requests&gt;=2.25.1"</span>, <span class="comment"># 示例依赖，具体根据项目需求</span></span><br><span class="line">    <span class="string">"loguru~=0.7.0"</span></span><br><span class="line">    <span class="comment"># "pandas&gt;=1.3.0,&lt;2.0.0",</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">"my_super_package"</span>, <span class="comment"># 包的唯一名称 (PyPI 上)</span></span><br><span class="line">    version=<span class="string">"0.1.0"</span>,       <span class="comment"># 当前版本</span></span><br><span class="line">    author=<span class="string">"您的名字"</span>,</span><br><span class="line">    author_email=<span class="string">"your.email@example.com"</span>,</span><br><span class="line">    description=<span class="string">"这是一个关于我的超级包的简短描述。"</span>,</span><br><span class="line">    long_description=get_long_description(),</span><br><span class="line">    long_description_content_type=<span class="string">"text/markdown"</span>, <span class="comment"># 如果 long_description 是 Markdown</span></span><br><span class="line">    url=<span class="string">"https://github.com/yourusername/my_super_package"</span>, <span class="comment"># 项目主页</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># find_packages() 会自动查找所有包含 __init__.py 的目录作为包</span></span><br><span class="line">    <span class="comment"># exclude 参数可以排除特定目录 (如 tests)</span></span><br><span class="line">    packages=find_packages(exclude=(<span class="string">"tests*"</span>, <span class="string">"docs*"</span>, <span class="string">"examples*"</span>)),</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 指定包内需要包含的非代码文件 (例如模板、数据文件)</span></span><br><span class="line">    <span class="comment"># package_data={</span></span><br><span class="line">    <span class="comment">#     'my_package': ['data/*.json', 'templates/*.html'],</span></span><br><span class="line">    <span class="comment"># },</span></span><br><span class="line">    <span class="comment"># include_package_data=True, # 如果使用 MANIFEST.in</span></span><br><span class="line">    </span><br><span class="line">    python_requires=<span class="string">"&gt;=3.8"</span>, <span class="comment"># 项目兼容的 Python 最低版本</span></span><br><span class="line">    </span><br><span class="line">    install_requires=REQUIRED_PACKAGES, <span class="comment"># 项目的核心运行时依赖</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 可选：用于开发和测试的额外依赖</span></span><br><span class="line">    <span class="comment"># extras_require={</span></span><br><span class="line">    <span class="comment">#     "dev": ["pytest&gt;=6.0", "mypy&gt;=0.900", "flake8", "black"],</span></span><br><span class="line">    <span class="comment">#     "docs": ["sphinx", "sphinx-rtd-theme"],</span></span><br><span class="line">    <span class="comment"># },</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果你的包提供了命令行工具</span></span><br><span class="line">    <span class="comment"># entry_points={</span></span><br><span class="line">    <span class="comment">#     "console_scripts": [</span></span><br><span class="line">    <span class="comment">#         "my-tool=my_package.cli:main_cli_function",</span></span><br><span class="line">    <span class="comment">#     ],</span></span><br><span class="line">    <span class="comment"># },</span></span><br><span class="line">    </span><br><span class="line">    classifiers=[ <span class="comment"># PyPI 分类器，帮助用户发现你的包</span></span><br><span class="line">        <span class="string">"Development Status :: 3 - Alpha"</span>,</span><br><span class="line">        <span class="string">"Intended Audience :: Developers"</span>,</span><br><span class="line">        <span class="string">"License :: OSI Approved :: MIT License"</span>,</span><br><span class="line">        <span class="string">"Programming Language :: Python :: 3"</span>,</span><br><span class="line">        <span class="string">"Programming Language :: Python :: 3.8"</span>,</span><br><span class="line">        <span class="string">"Programming Language :: Python :: 3.9"</span>,</span><br><span class="line">        <span class="string">"Programming Language :: Python :: 3.10"</span>,</span><br><span class="line">        <span class="string">"Programming Language :: Python :: 3.11"</span>,</span><br><span class="line">        <span class="string">"Programming Language :: Python :: 3.12"</span>,</span><br><span class="line">        <span class="string">"Operating System :: OS Independent"</span>,</span><br><span class="line">        <span class="string">"Topic :: Software Development :: Libraries :: Python Modules"</span>,</span><br><span class="line">    ],</span><br><span class="line">    keywords=<span class="string">"python package example utility"</span>, <span class="comment"># 搜索关键词</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># print_success("setup.py 配置完成。")</span></span><br><span class="line">​```</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>现代 <code>pyproject.toml</code></strong>:<br>PEP 517 和 PEP 518 推荐使用 <code>pyproject.toml</code> 文件来声明构建依赖和项目元数据。<code>setuptools</code> 仍然可以作为构建后端。</p><figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === pyproject.toml 示例 ===</span></span><br><span class="line"><span class="comment"># [build-system]</span></span><br><span class="line"><span class="comment"># requires = ["setuptools&gt;=61.0", "wheel"]</span></span><br><span class="line"><span class="comment"># build-backend = "setuptools.build_meta"</span></span><br><span class="line"><span class="comment"># backend-path = ["."] # 可选，如果 setup.py 在子目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [project]</span></span><br><span class="line"><span class="comment"># name = "my_super_package"</span></span><br><span class="line"><span class="comment"># version = "0.1.0"</span></span><br><span class="line"><span class="comment"># description = "这是一个关于我的超级包的简短描述。"</span></span><br><span class="line"><span class="comment"># readme = "README.md"</span></span><br><span class="line"><span class="comment"># requires-python = "&gt;=3.8"</span></span><br><span class="line"><span class="comment"># license = {file = "LICENSE"}</span></span><br><span class="line"><span class="comment"># keywords = ["python", "package", "example"]</span></span><br><span class="line"><span class="comment"># authors = [</span></span><br><span class="line"><span class="comment">#   {name = "您的名字", email = "your.email@example.com" }</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"><span class="comment"># maintainers = [</span></span><br><span class="line"><span class="comment">#   {name = "您的名字", email = "your.email@example.com" }</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"><span class="comment"># classifiers = [</span></span><br><span class="line"><span class="comment">#     "Development Status :: 3 - Alpha",</span></span><br><span class="line"><span class="comment">#     "Programming Language :: Python :: 3",</span></span><br><span class="line"><span class="comment">#     # ... 其他分类器</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dependencies = [</span></span><br><span class="line"><span class="comment">#   "requests&gt;=2.25.1",</span></span><br><span class="line"><span class="comment">#   "loguru~=0.7.0",</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [project.urls]</span></span><br><span class="line"><span class="comment"># "Homepage" = "https://github.com/yourusername/my_super_package"</span></span><br><span class="line"><span class="comment"># "Bug Tracker" = "https://github.com/yourusername/my_super_package/issues"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [project.scripts]</span></span><br><span class="line"><span class="comment"># my-tool = "my_package.cli:main_cli_function"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [project.optional-dependencies]</span></span><br><span class="line"><span class="comment"># dev = [</span></span><br><span class="line"><span class="comment">#   "pytest&gt;=6.0",</span></span><br><span class="line"><span class="comment">#   "mypy",</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></tbody></table></figure><p>当使用 <code>pyproject.toml</code> 时，<code>setup.py</code> 可以非常简单，甚至在某些情况下不需要（如果所有元数据都在 <code>pyproject.toml</code> 且构建后端支持）。</p></li></ul><h3 id="二、代码质量与风格指南-PEP-8-核心实践"><a href="#二、代码质量与风格指南-PEP-8-核心实践" class="headerlink" title="二、代码质量与风格指南 (PEP 8 核心实践)"></a>二、代码质量与风格指南 (PEP 8 核心实践)</h3><p>PEP 8 是 Python 官方的代码风格指南，遵循它可以使代码更易读、更易于维护，并促进团队协作的一致性。除了 PEP 8，还有一些通用的最佳实践。</p><p>下面是一个演示这些规范的示例脚本</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># === 代码质量与 PEP 8 实践演示 ===</span></span><br><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># 标准库导入</span></span><br><span class="line"><span class="keyword">import</span> sys <span class="comment"># 标准库导入</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict <span class="comment"># 标准库导入，from ... import ...</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Tuple</span>, <span class="type">Any</span>, <span class="type">Optional</span>, <span class="type">Union</span>, <span class="type">Dict</span> <span class="comment"># 类型注解</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三方库导入 (示例)</span></span><br><span class="line"><span class="comment"># import numpy as np</span></span><br><span class="line"><span class="comment"># import pandas as pd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地应用/库导入 (示例)</span></span><br><span class="line"><span class="comment"># from my_package import my_module_example </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 0. 模块级别文档字符串与常量</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_header(<span class="string">"代码质量与 PEP 8 核心实践演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">本模块旨在演示 Python PEP 8 风格指南中的常见规则和一些编码最佳实践。</span></span><br><span class="line"><span class="string">PEP 8 官方文档: https://www.python.org/dev/peps/pep-0008/</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常量名应全部大写，单词间用下划线分隔</span></span><br><span class="line">MAX_RETRIES: <span class="built_in">int</span> = <span class="number">3</span></span><br><span class="line">DEFAULT_GREETING: <span class="built_in">str</span> = <span class="string">"Hello"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 1. 类定义与文档字符串</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 类定义与文档字符串"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SampleClass</span>:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    一个示例类，用于演示 PEP 8 规范和良好实践。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    这个类的主要目的是展示命名约定、文档字符串格式、</span></span><br><span class="line"><span class="string">    方法定义以及属性的组织方式。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Attributes:</span></span><br><span class="line"><span class="string">        name (str): 对象的名称。</span></span><br><span class="line"><span class="string">        value (Optional[int]): 一个可选的整数值。</span></span><br><span class="line"><span class="string">        _protected_member (str): 一个受保护的成员变量。</span></span><br><span class="line"><span class="string">        __private_member (float): 一个私有的成员变量。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    CLASS_LEVEL_CONSTANT: <span class="built_in">str</span> = <span class="string">"This is a class-level constant"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name: <span class="built_in">str</span>, value: <span class="type">Optional</span>[<span class="built_in">int</span>] = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        初始化 SampleClass 对象。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            name (str): 对象的名称。</span></span><br><span class="line"><span class="string">            value (Optional[int], optional): 一个可选的整数值。默认为 None。</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        print_info(<span class="string">f"  Initializing SampleClass(name='<span class="subst">{name}</span>', value=<span class="subst">{value}</span>)"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.name: <span class="built_in">str</span> = name</span><br><span class="line">        <span class="variable language_">self</span>.value: <span class="type">Optional</span>[<span class="built_in">int</span>] = value</span><br><span class="line">        <span class="variable language_">self</span>._protected_member: <span class="built_in">str</span> = <span class="string">"I am protected"</span> <span class="comment"># 受保护成员以下划线开头</span></span><br><span class="line">        <span class="variable language_">self</span>.__private_member: <span class="built_in">float</span> = <span class="number">3.14</span>          <span class="comment"># 私有成员以双下划线开头 (会被名称修饰)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_info</span>(<span class="params">self, prefix: <span class="built_in">str</span> = <span class="string">"Info"</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        显示对象的信息。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        如果参数列表过长，可以像下面这样换行和缩进：</span></span><br><span class="line"><span class="string">        def another_method(</span></span><br><span class="line"><span class="string">            self,</span></span><br><span class="line"><span class="string">            param1: type,</span></span><br><span class="line"><span class="string">            param2: type,</span></span><br><span class="line"><span class="string">            very_long_parameter_name: type = default_value</span></span><br><span class="line"><span class="string">        ) -&gt; ReturnType:</span></span><br><span class="line"><span class="string">            pass</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            prefix (str, optional): 信息输出的前缀。默认为 "Info"。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            str: 格式化后的信息字符串。</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 行长度通常建议不超过 79 个字符 (或团队约定的长度，如 88, 100, 120)</span></span><br><span class="line">        <span class="comment"># 长字符串或表达式可以分行，通常在操作符之后换行，并适当缩进</span></span><br><span class="line">        info_string: <span class="built_in">str</span> = (</span><br><span class="line">            <span class="string">f"<span class="subst">{prefix}</span>: Name='<span class="subst">{self.name}</span>', Value=<span class="subst">{self.value}</span>, "</span></span><br><span class="line">            <span class="string">f"Protected='<span class="subst">{self._protected_member}</span>', "</span></span><br><span class="line">            <span class="string">f"Private (mangled name access): <span class="subst">{self._SampleClass__private_member}</span>"</span> <span class="comment"># 访问被名称修饰的私有变量</span></span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># 在二元运算符之前或之后换行都是PEP 8允许的，但团队内应保持一致</span></span><br><span class="line">        <span class="comment"># calculation_example = (var1 + var2 + var3</span></span><br><span class="line">        <span class="comment">#                        - var4 - var5)</span></span><br><span class="line">        <span class="keyword">return</span> info_string</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name_uppercase</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">"""一个只读属性，返回大写的名称。"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.name.upper()</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 2. 函数定义与文档字符串</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 函数定义与文档字符串"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_sum_and_average</span>(<span class="params">numbers: <span class="type">List</span>[<span class="built_in">float</span>]</span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">float</span>, <span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    计算一个数字列表的总和与平均值。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        numbers (List[float]): 需要计算的浮点数列表。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        Tuple[float, float]: 一个包含总和与平均值的元组。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Raises:</span></span><br><span class="line"><span class="string">        ValueError: 如果输入列表为空。</span></span><br><span class="line"><span class="string">        TypeError: 如果列表中包含非数字类型的元素。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print_info(<span class="string">f"  Calculating sum and average for: <span class="subst">{numbers}</span>"</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> numbers:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"输入列表不能为空以计算平均值。"</span>)</span><br><span class="line">    </span><br><span class="line">    current_sum: <span class="built_in">float</span> = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> numbers:</span><br><span class="line">            current_sum += num <span class="comment"># 操作符两侧通常有空格</span></span><br><span class="line">    <span class="keyword">except</span> TypeError <span class="keyword">as</span> e: <span class="comment"># 捕获特定异常</span></span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">f"列表中的所有元素都必须是数字: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    count: <span class="built_in">int</span> = <span class="built_in">len</span>(numbers)</span><br><span class="line">    average: <span class="built_in">float</span> = current_sum / count</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 正确的空格使用示例:</span></span><br><span class="line">    <span class="comment"># x = 1 + 2  # 运算符两侧</span></span><br><span class="line">    <span class="comment"># my_func(arg1, arg2) # 逗号后，括号内侧通常无空格 (除非是元组只有一个元素 my_tuple = (1,))</span></span><br><span class="line">    <span class="comment"># my_list[0] # 索引/切片操作符内侧无空格</span></span><br><span class="line">    <span class="comment"># my_dict = {"key": "value"} # 冒号后有空格，前面无；花括号内侧通常无空格</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> current_sum, average</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 3. 条件语句与 Pythonic 表达</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. 条件语句与 Pythonic 表达"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_item_status</span>(<span class="params">item: <span class="type">Optional</span>[<span class="type">Any</span>], status_flags: <span class="built_in">int</span> = <span class="number">0</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">"""演示条件语句的推荐写法。"""</span></span><br><span class="line">    print_info(<span class="string">f"  Checking status for item: <span class="subst">{item}</span>, flags: <span class="subst">{status_flags}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查 None: 使用 `is None` 或 `is not None`</span></span><br><span class="line">    <span class="keyword">if</span> item <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"项目为 None。"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查布尔真值: 直接使用 `if item:` 或 `if not item:`</span></span><br><span class="line">    <span class="comment"># 而不是 `if item == True:` 或 `if item == []:`</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> item: <span class="comment"># 适用于空列表、空字符串、空字典、0、None 等</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"项目为空或具有布尔假值。"</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 复杂条件表达式，如果过长，可以分行并用括号括起来</span></span><br><span class="line">    <span class="comment"># (此处的 status_flags 仅为示例)</span></span><br><span class="line">    IS_ACTIVE_FLAG = <span class="number">1</span></span><br><span class="line">    IS_URGENT_FLAG = <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isinstance</span>(item, <span class="built_in">str</span>) <span class="keyword">and</span></span><br><span class="line">            <span class="built_in">len</span>(item) &gt; <span class="number">5</span> <span class="keyword">and</span></span><br><span class="line">            (status_flags &amp; IS_ACTIVE_FLAG) <span class="keyword">and</span> <span class="comment"># 位运算示例</span></span><br><span class="line">            <span class="keyword">not</span> (status_flags &amp; IS_URGENT_FLAG)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"项目 '<span class="subst">{item}</span>' 是一个长度大于5的活动字符串且不紧急。"</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"项目 '<span class="subst">{item}</span>' 具有其他状态。"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 4. 推导式与生成器表达式</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"4. 推导式与生成器表达式"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_comprehensions</span>(<span class="params">data: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">"""演示列表推导式和生成器表达式。"""</span></span><br><span class="line">    print_info(<span class="string">f"  Original data: <span class="subst">{data}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 列表推导式</span></span><br><span class="line">    squared_numbers: <span class="type">List</span>[<span class="built_in">int</span>] = [x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> data]</span><br><span class="line">    print_success(<span class="string">f"    Squared numbers (list comprehension): <span class="subst">{squared_numbers}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    even_squared_numbers: <span class="type">List</span>[<span class="built_in">int</span>] = [x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> data <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line">    print_success(<span class="string">f"    Even squared numbers (with condition): <span class="subst">{even_squared_numbers}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成器表达式 (更节省内存，按需生成)</span></span><br><span class="line">    sum_of_cubes: <span class="built_in">int</span> = <span class="built_in">sum</span>(x**<span class="number">3</span> <span class="keyword">for</span> x <span class="keyword">in</span> data) <span class="comment"># 生成器表达式在 sum() 中使用</span></span><br><span class="line">    print_success(<span class="string">f"    Sum of cubes (generator expression): <span class="subst">{sum_of_cubes}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 字典推导式</span></span><br><span class="line">    number_to_square_dict: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="built_in">int</span>] = {x: x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> data}</span><br><span class="line">    print_success(<span class="string">f"    Number to square dict: <span class="subst">{number_to_square_dict}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 避免过于复杂的嵌套推导式，如果可读性受损，应拆分为普通循环</span></span><br><span class="line">    <span class="comment"># matrix = [[1, 2], [3, 4]]</span></span><br><span class="line">    <span class="comment"># flattened = [element for row in matrix for element in row] # 尚可接受</span></span><br><span class="line">    <span class="comment"># print_info(f"    Flattened matrix: {flattened}")</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 5. 异常处理 (try-except-else-finally)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"5. 异常处理"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">perform_safe_operation</span>(<span class="params">value1: <span class="type">Any</span>, value2: <span class="type">Any</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">"""一个演示安全操作的函数，包含完整的异常处理。"""</span></span><br><span class="line">    print_info(<span class="string">f"  Attempting operation with <span class="subst">{value1}</span> and <span class="subst">{value2}</span>"</span>)</span><br><span class="line">    result: <span class="type">Optional</span>[<span class="built_in">float</span>] = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 假设这是一个可能抛出多种异常的操作</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="built_in">isinstance</span>(value1, (<span class="built_in">int</span>, <span class="built_in">float</span>)) <span class="keyword">and</span> <span class="built_in">isinstance</span>(value2, (<span class="built_in">int</span>, <span class="built_in">float</span>))):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"输入值必须是数字类型。"</span>)</span><br><span class="line">        <span class="keyword">if</span> value2 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"除数不能为零。"</span>) <span class="comment"># 自定义 ValueError 而非直接 ZeroDivisionError</span></span><br><span class="line">        result = <span class="built_in">float</span>(value1 / value2)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> ve: <span class="comment"># 捕获特定的、预期的异常</span></span><br><span class="line">        print_error(<span class="string">f"    操作失败 (ValueError): <span class="subst">{ve}</span>"</span>)</span><br><span class="line">        <span class="comment"># logger.error(f"ValueError during operation: {ve}", exc_info=True) # 实际项目中用日志</span></span><br><span class="line">    <span class="keyword">except</span> TypeError <span class="keyword">as</span> te:</span><br><span class="line">        print_error(<span class="string">f"    操作失败 (TypeError): <span class="subst">{te}</span>"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e: <span class="comment"># 捕获其他所有 Exception 子类的异常 (作为最后防线)</span></span><br><span class="line">        print_error(<span class="string">f"    发生未知错误: <span class="subst">{<span class="built_in">type</span>(e).__name__}</span> - <span class="subst">{e}</span>"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 如果 try 块中没有发生任何异常，则执行 else 块</span></span><br><span class="line">        print_success(<span class="string">f"    操作成功完成，结果: <span class="subst">{result}</span>"</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># 无论 try 块中是否发生异常，finally 块总会执行</span></span><br><span class="line">        <span class="comment"># 通常用于资源清理</span></span><br><span class="line">        print_info(<span class="string">"    操作尝试已结束 (finally 块执行)。"</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line"><span class="comment"># 6. 上下文管理器 (with 语句)</span></span><br><span class="line"><span class="comment"># =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"6. 上下文管理器 (with 语句)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_content_from_file_safely</span>(<span class="params">filepath: <span class="built_in">str</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">"""使用上下文管理器安全地读取文件内容。"""</span></span><br><span class="line">    print_info(<span class="string">f"  Attempting to read file: <span class="subst">{filepath}</span>"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 'with' 语句确保文件在操作完成后（即使发生异常）也会被正确关闭</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">"r"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> file_handle:</span><br><span class="line">            content: <span class="built_in">str</span> = file_handle.read()</span><br><span class="line">            print_success(<span class="string">f"    成功读取文件 '<span class="subst">{filepath}</span>'。"</span>)</span><br><span class="line">            <span class="keyword">return</span> content</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        print_error(<span class="string">f"    文件 '<span class="subst">{filepath}</span>' 未找到。"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        print_error(<span class="string">f"    读取文件 '<span class="subst">{filepath}</span>' 时发生 IO 错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 主程序块，用于调用演示函数</span></span><br><span class="line">    print_info(<span class="string">"--- 开始演示 SampleClass ---"</span>)</span><br><span class="line">    my_object = SampleClass(name=<span class="string">"ProriseInstance"</span>, value=<span class="number">100</span>)</span><br><span class="line">    print_success(my_object.display_info(prefix=<span class="string">"Object"</span>))</span><br><span class="line">    print_success(<span class="string">f"  Uppercase name: <span class="subst">{my_object.name_uppercase}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\n--- 开始演示 calculate_sum_and_average ---"</span>)</span><br><span class="line">    numbers_list: <span class="type">List</span>[<span class="built_in">float</span>] = [<span class="number">10.0</span>, <span class="number">15.5</span>, <span class="number">20.0</span>, <span class="number">5.5</span>]</span><br><span class="line">    total, avg = calculate_sum_and_average(numbers_list)</span><br><span class="line">    print_success(<span class="string">f"  对于列表 <span class="subst">{numbers_list}</span>，总和: <span class="subst">{total}</span>, 平均值: <span class="subst">{avg:<span class="number">.2</span>f}</span>"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        calculate_sum_and_average([])</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        print_warning(<span class="string">f"  捕获到预期错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\n--- 开始演示 check_item_status ---"</span>)</span><br><span class="line">    print_info(<span class="string">f"  <span class="subst">{check_item_status(<span class="literal">None</span>)}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  <span class="subst">{check_item_status(<span class="string">''</span>)}</span>"</span>)</span><br><span class="line">    print_info(<span class="string">f"  <span class="subst">{check_item_status(<span class="string">'A very long active string'</span>, status_flags=<span class="number">1</span>)}</span>"</span>) <span class="comment"># IS_ACTIVE_FLAG = 1</span></span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\n--- 开始演示 demonstrate_comprehensions ---"</span>)</span><br><span class="line">    demonstrate_comprehensions([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">    print_info(<span class="string">"\n--- 开始演示 perform_safe_operation ---"</span>)</span><br><span class="line">    perform_safe_operation(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">    perform_safe_operation(<span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line">    perform_safe_operation(<span class="string">"abc"</span>, <span class="number">2</span>)</span><br><span class="line">    perform_safe_operation(<span class="number">10</span>, <span class="string">"xyz"</span>)</span><br><span class="line">    </span><br><span class="line">    print_info(<span class="string">"\n--- 开始演示 read_content_from_file_safely ---"</span>)</span><br><span class="line">    <span class="comment"># 创建一个临时文件用于读取演示</span></span><br><span class="line">    temp_file_for_read = <span class="string">"temp_read_example.txt"</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(temp_file_for_read, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f_temp:</span><br><span class="line">        f_temp.write(<span class="string">"Hello from with statement example!\nSecond line."</span>)</span><br><span class="line">    </span><br><span class="line">    file_contents = read_content_from_file_safely(temp_file_for_read)</span><br><span class="line">    <span class="keyword">if</span> file_contents:</span><br><span class="line">        print_info(<span class="string">f"    文件内容 (前50字符): '<span class="subst">{file_contents[:<span class="number">50</span>]}</span>...'"</span>)</span><br><span class="line">    read_content_from_file_safely(<span class="string">"non_existent_file.txt"</span>) <span class="comment"># 测试文件不存在的情况</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> os.path.exists(temp_file_for_read): <span class="comment"># 清理临时文件</span></span><br><span class="line">        os.remove(temp_file_for_read)</span><br><span class="line">        print_info(<span class="string">f"  已删除临时读取文件: <span class="subst">{temp_file_for_read}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    print_header(<span class="string">"代码质量与 PEP 8 实践演示结束。"</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="三、总结与工具"><a href="#三、总结与工具" class="headerlink" title="三、总结与工具"></a>三、总结与工具</h3><p>遵循良好的项目结构和编码规范是开发高质量、可维护 Python 应用的关键。</p><ul><li><strong>项目结构</strong>：清晰的目录划分有助于分离关注点，使得代码、测试、文档和配置易于查找和管理。</li><li><strong>代码风格 (PEP 8)</strong>：一致的编码风格提高了代码的可读性，是团队协作的基础。</li><li><strong>文档与注释</strong>: 良好的文档字符串 (docstrings) 和必要的注释使代码更易于理解和使用。</li><li><strong>Pythonic 代码</strong>: 利用 Python 语言的特性（如推导式、上下文管理器）可以写出更简洁、更高效、更易读的代码。</li></ul><p><strong>辅助工具</strong>:</p><p>为了帮助开发者遵循最佳实践并保持代码质量，社区提供了许多优秀的工具：</p><ul><li><strong>Linters (代码风格和错误检查)</strong>:<ul><li><code>Flake8</code>: 结合了 PyFlakes (错误检查), PEP 8 (风格检查) 和 McCabe (复杂度检查)。</li><li><code>Pylint</code>: 功能更全面，提供更广泛的代码分析、错误检测、风格检查和重构建议。</li><li><code>Ruff</code>: 一个用 Rust 编写的极快的 Python linter 和 formatter，可以替代 Flake8, isort, pydocstyle 等多种工具。</li></ul></li><li><strong>Formatters (代码自动格式化)</strong>:<ul><li><code>Black</code>: 一个固执己见 (opinionated) 的代码格式化工具，能自动将代码格式化为符合 PEP 8 子集的一致风格。</li><li><code>Autopep8</code>: 自动将 Python 代码格式化为符合 PEP 8 风格。</li><li><code>Ruff Formatter</code>: <code>Ruff</code> 也包含了格式化功能。</li></ul></li><li><strong>Type Checkers (静态类型检查)</strong>:<ul><li><code>MyPy</code>: Python 官方的静态类型检查器。</li><li><code>Pyright</code>: 由微软开发，快速且功能强大的类型检查器，也是 VS Code 中 Pylance 插件的核心。</li><li><code>Pytype</code>: Google 开发的类型检查器，可以推断类型。</li></ul></li></ul><p>将这些工具集成到你的开发流程和持续集成 (CI) 系统中，可以有效地提升团队的整体代码质量和开发效率。</p><hr></div></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Prorise</div><div class="post-copyright__author_desc">这聒噪的世界让沉默的人显得另类</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://prorise-cool.github.io/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl(&quot;https://prorise-cool.github.io/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/&quot;)">Python教程：应用之巅</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://prorise-cool.github.io/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Python教程：应用之巅&amp;url=https://prorise-cool.github.io/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/&amp;pic=https://bu.dusays.com/2025/06/17/685113b7c7d81.webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Prorise-cool.github.io" target="_blank">格物致知</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Python/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>Python<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2025/06/17/685113b7c7d81.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2025/06/18/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%AD%E7%AF%87/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c5e0c.webp" onerror="onerror=null,src=&quot;/img/404.jpg&quot;" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python教程：深入其境</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/06/17/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E5%89%8D%E7%AF%87/" title="Python教程：Python知识点前篇速览"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-17</div><div class="title">Python教程：Python知识点前篇速览</div></div></a></div><div><a href="/2025/06/18/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%AD%E7%AF%87/" title="Python教程：深入其境"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c5e0c.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-18</div><div class="title">Python教程：深入其境</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" rel="external nofollow noreferrer">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/user/status.png" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.4;color:rgba(255,255,255,.9);text-align:center">🚀 全栈开发者，专注于构建优雅高效的数字解决方案<br><span style="color:#fff;font-weight:700">前端 · 后端 · 架构 · 优化</span><br>📚 分享实战经验，一起探索技术边界</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Prorise</h1><div class="author-info__desc">这聒噪的世界让沉默的人显得另类</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/361040115?spm_id_from=333.1387.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background:url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center/100% no-repeat"></div><div class="back face" style="background:url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center/100% no-repeat"></div></div></div></div><div class="card-widget card-latest-comments"><div class="item-headline"><i class="fas fa-comments"></i><span>最新评论</span></div><div class="item-content"><a href="/messages/" class="headline-right" title="查看更多"><i class="fas fa-angle-right"></i></a><div class="aside-list" id="latest-comments"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AB%E7%AB%A0-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">1.</span> <span class="toc-text">第十八章 单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#18-1-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%AE%80%E4%BB%8B%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">18.1 单元测试简介：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-2-Pytest-%E7%AE%80%E4%BB%8B%E4%B8%8E%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF"><span class="toc-number">1.2.</span> <span class="toc-text">18.2 Pytest 简介与核心优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-3-Pytest-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E6%A6%82%E8%A7%88"><span class="toc-number">1.3.</span> <span class="toc-text">18.3 Pytest 核心特性概览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-4-Pytest-%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.4.</span> <span class="toc-text">18.4 Pytest 基础实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#18-4-1-%E7%BC%96%E5%86%99%E7%AC%AC%E4%B8%80%E4%B8%AA-Pytest-%E6%B5%8B%E8%AF%95%EF%BC%9A%E6%B5%8B%E8%AF%95%E5%8A%A0%E6%B3%95%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.1.</span> <span class="toc-text">18.4.1 编写第一个 Pytest 测试：测试加法函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18-4-2-%E6%B5%8B%E8%AF%95%E5%BC%82%E5%B8%B8%EF%BC%9Apytest-raises"><span class="toc-number">1.4.2.</span> <span class="toc-text">18.4.2 测试异常：pytest.raises</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-5-Pytest-Fixtures%EF%BC%9A%E5%BC%BA%E5%A4%A7%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%B5%8B%E8%AF%95%E5%87%86%E5%A4%87"><span class="toc-number">1.5.</span> <span class="toc-text">18.5 Pytest Fixtures：强大的依赖注入与测试准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#18-5-1-Fixture-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%BA%94%E7%94%A8%EF%BC%9A-pytest-fixture"><span class="toc-number">1.5.1.</span> <span class="toc-text">18.5.1 Fixture 基本概念与应用：@pytest.fixture</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18-5-2-Fixture-%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F-Scope"><span class="toc-number">1.5.2.</span> <span class="toc-text">18.5.2 Fixture 的作用域 (Scope)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18-5-3-%E4%BD%BF%E7%94%A8-yield-%E5%AE%9E%E7%8E%B0-Fixture-%E7%9A%84-Teardown-%E6%B8%85%E7%90%86%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.3.</span> <span class="toc-text">18.5.3 使用 yield 实现 Fixture 的 Teardown (清理操作)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B9%9D%E7%AB%A0-%E6%A0%87%E5%87%86%E5%86%85%E7%BD%AE%E5%BA%93%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">第十九章 标准内置库详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.1.</span> <span class="toc-text">1、时间处理模块详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#time-%E6%A8%A1%E5%9D%97"><span class="toc-number">2.1.1.</span> <span class="toc-text">time 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#time-%E6%A8%A1%E5%9D%97%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">time 模块常用函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#struct-time-%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">struct_time 对象详解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#strftime-%E5%92%8C-strptime-%E5%B8%B8%E7%94%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%AC%A6%E5%8F%B7"><span class="toc-number">2.1.1.3.</span> <span class="toc-text">strftime 和 strptime 常用格式化符号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#time-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.1.1.4.</span> <span class="toc-text">time 模块代码示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#time-%E6%A8%A1%E5%9D%97%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E5%87%BD%E6%95%B0-%E5%9C%BA%E6%99%AF"><span class="toc-number">2.1.1.5.</span> <span class="toc-text">time 模块开箱即用函数/场景</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.1.1.5.1.</span> <span class="toc-text">a. 获取特定格式的当前时间字符串</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#b-%E6%B5%8B%E9%87%8F%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">2.1.1.5.2.</span> <span class="toc-text">b. 测量函数执行时间</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#c-%E6%97%B6%E9%97%B4%E6%88%B3%E4%B8%8E%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.1.1.5.3.</span> <span class="toc-text">c. 时间戳与格式化字符串之间的转换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#datetime-%E6%A8%A1%E5%9D%97"><span class="toc-number">2.1.2.</span> <span class="toc-text">datetime 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#datetime-%E6%A8%A1%E5%9D%97%E6%A0%B8%E5%BF%83%E7%B1%BB-%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">datetime 模块核心类/方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#datetime-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">datetime 模块代码示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#datetime-%E6%A8%A1%E5%9D%97%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E5%87%BD%E6%95%B0-%E5%9C%BA%E6%99%AF"><span class="toc-number">2.1.2.3.</span> <span class="toc-text">datetime 模块开箱即用函数/场景</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-%E8%8E%B7%E5%8F%96%E4%B8%8D%E5%90%8C%E7%B2%BE%E5%BA%A6%E7%9A%84%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4"><span class="toc-number">2.1.2.3.1.</span> <span class="toc-text">a. 获取不同精度的当前时间</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#b-%E8%AE%A1%E7%AE%97%E6%9C%AA%E6%9D%A5%E6%88%96%E8%BF%87%E5%8E%BB%E7%9A%84%E6%97%A5%E6%9C%9F"><span class="toc-number">2.1.2.3.2.</span> <span class="toc-text">b. 计算未来或过去的日期</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#c-%E5%AE%89%E5%85%A8%E5%9C%B0%E8%A7%A3%E6%9E%90%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.1.2.3.3.</span> <span class="toc-text">c. 安全地解析日期字符串</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#d-%E8%AE%A1%E7%AE%97%E4%B8%A4%E4%B8%AA%E6%97%A5%E6%9C%9F%E4%B9%8B%E9%97%B4%E7%9A%84%E5%A4%A9%E6%95%B0-%E5%B0%8F%E6%97%B6%E6%95%B0-%E5%88%86%E9%92%9F%E6%95%B0"><span class="toc-number">2.1.2.3.4.</span> <span class="toc-text">d. 计算两个日期之间的天数/小时数/分钟数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#time-%E4%B8%8E-datetime-%E6%A8%A1%E5%9D%97%E7%9A%84%E9%80%89%E6%8B%A9%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">2.1.3.</span> <span class="toc-text">time 与 datetime 模块的选择与注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%9A%8F%E6%9C%BA%E6%95%B0%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.2.</span> <span class="toc-text">2、随机数模块详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#random-%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.2.1.</span> <span class="toc-text">random 模块介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#random-%E6%A8%A1%E5%9D%97%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.</span> <span class="toc-text">random 模块常用函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#random-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.2.3.</span> <span class="toc-text">random 模块代码示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#random-%E6%A8%A1%E5%9D%97%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E5%87%BD%E6%95%B0-%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.4.</span> <span class="toc-text">random 模块开箱即用函数/场景</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a-%E7%94%9F%E6%88%90%E6%8C%87%E5%AE%9A%E9%95%BF%E5%BA%A6%E7%9A%84%E9%9A%8F%E6%9C%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88%E7%94%A8%E4%BA%8E%E9%9D%9E%E5%8A%A0%E5%AF%86%E5%9C%BA%E6%99%AF%EF%BC%89"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">a. 生成指定长度的随机字符串（用于非加密场景）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#b-%E6%A8%A1%E6%8B%9F%E5%A4%9A%E6%AC%A1%E6%8E%B7%E9%AA%B0%E5%AD%90%E5%B9%B6%E7%BB%9F%E8%AE%A1%E7%BB%93%E6%9E%9C"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">b. 模拟多次掷骰子并统计结果</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#c-%E4%BB%8E%E5%8A%A0%E6%9D%83%E5%88%97%E8%A1%A8%E4%B8%AD%E9%9A%8F%E6%9C%BA%E6%8A%BD%E5%8F%96%E5%A5%96%E5%8A%B1"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">c. 从加权列表中随机抽取奖励</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#d-%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E8%8C%83%E5%9B%B4%E5%86%85%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%97%A5%E6%9C%9F"><span class="toc-number">2.2.4.4.</span> <span class="toc-text">d. 生成一个范围内的随机日期</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BA%A4%E4%BA%92%E4%B8%8E%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.</span> <span class="toc-text">3、操作系统交互与文件处理模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#os-%E6%A8%A1%E5%9D%97%EF%BC%9A%E4%B8%8E%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BA%A4%E4%BA%92%E7%9A%84%E5%9F%BA%E7%A1%80%EF%BC%88%E6%A0%B8%E5%BF%83%EF%BC%89"><span class="toc-number">2.3.1.</span> <span class="toc-text">os 模块：与操作系统交互的基础（核心）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#os-%E5%8F%8A-os-path-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">os 及 os.path 常用功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#os-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">os 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shutil-%E6%A8%A1%E5%9D%97%EF%BC%9A%E9%AB%98%E7%BA%A7%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.2.</span> <span class="toc-text">shutil 模块：高级文件操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#shutil-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">shutil 常用函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shutil-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">shutil 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pathlib-%E6%A8%A1%E5%9D%97%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E8%B7%AF%E5%BE%84"><span class="toc-number">2.3.3.</span> <span class="toc-text">pathlib 模块：面向对象的文件系统路径</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pathlib-%E5%B8%B8%E7%94%A8%E7%B1%BB%E4%B8%8E%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">pathlib 常用类与方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pathlib-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">pathlib 模块代码示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pathlib-%E6%A8%A1%E5%9D%97%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.3.3.3.</span> <span class="toc-text">pathlib 模块开箱即用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-%E9%80%92%E5%BD%92%E6%9F%A5%E6%89%BE%E6%8C%87%E5%AE%9A%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%96%87%E4%BB%B6%E5%B9%B6%E5%A4%84%E7%90%86"><span class="toc-number">2.3.3.3.1.</span> <span class="toc-text">a. 递归查找指定类型的文件并处理</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#b-%E5%AE%89%E5%85%A8%E5%9C%B0%E5%88%9B%E5%BB%BA%E5%A4%9A%E7%BA%A7%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.3.3.3.2.</span> <span class="toc-text">b. 安全地创建多级目录结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zipfile-%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%A4%84%E7%90%86-ZIP-%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.4.</span> <span class="toc-text">zipfile 模块：处理 ZIP 压缩文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#zipfile-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD-%E5%9F%BA%E4%BA%8E-ZipFile-%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">zipfile 常用功能 (基于 ZipFile 对象)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#zipfile-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">zipfile 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tarfile-%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%A4%84%E7%90%86-TAR-%E5%BD%92%E6%A1%A3%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.5.</span> <span class="toc-text">tarfile 模块：处理 TAR 归档文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#tarfile-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD-%E5%9F%BA%E4%BA%8E-TarFile-%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">tarfile 常用功能 (基于 TarFile 对象)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tarfile-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.3.5.2.</span> <span class="toc-text">tarfile 模块代码示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%B3%BB%E7%BB%9F%E4%BA%A4%E4%BA%92%E4%B8%8E%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">2.4.</span> <span class="toc-text">4.系统交互与进程管理模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sys-%E6%A8%A1%E5%9D%97%EF%BC%9A%E4%B8%8E-Python-%E8%A7%A3%E9%87%8A%E5%99%A8%E6%B7%B1%E5%BA%A6%E4%BA%A4%E4%BA%92"><span class="toc-number">2.4.1.</span> <span class="toc-text">sys 模块：与 Python 解释器深度交互</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sys-%E6%A8%A1%E5%9D%97%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7%E5%92%8C%E5%87%BD%E6%95%B0"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">sys 模块常用属性和函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sys-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">sys 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#argparse-%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%BC%BA%E5%A4%A7%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90%EF%BC%88%E6%A0%B8%E5%BF%83%EF%BC%89"><span class="toc-number">2.4.2.</span> <span class="toc-text">argparse 模块：强大的命令行参数解析（核心）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#argparse-%E6%A8%A1%E5%9D%97%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">argparse 模块核心功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#argparse-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">argparse 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#subprocess-%E6%A8%A1%E5%9D%97%EF%BC%9A%E7%AE%A1%E7%90%86%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.4.3.</span> <span class="toc-text">subprocess 模块：管理子进程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#subprocess-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">subprocess 常用功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#subprocess-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.4.3.2.</span> <span class="toc-text">subprocess 模块代码示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%97%A5%E5%BF%97%E4%B8%8E%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">2.5.</span> <span class="toc-text">5.日志与配置管理模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#configparser-%E6%A8%A1%E5%9D%97%EF%BC%9A%E8%AF%BB%E5%86%99-INI-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.1.</span> <span class="toc-text">configparser 模块：读写 INI 配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#configparser-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.5.1.1.</span> <span class="toc-text">configparser 常用功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#configparser-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B-%E8%AF%BB%E5%8F%96%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%81%E5%88%9B%E5%BB%BA"><span class="toc-number">2.5.1.2.</span> <span class="toc-text">configparser 模块代码示例 (读取、修改、创建)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#postchat_postcontent"><span class="toc-number">2.5.1.3.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#logging-%E6%A8%A1%E5%9D%97%EF%BC%9APython%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E7%B3%BB%E7%BB%9F%EF%BC%88%E6%A0%B8%E5%BF%83%EF%BC%89"><span class="toc-number">2.5.2.</span> <span class="toc-text">logging 模块：Python的日志记录系统（核心）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#logging-%E6%A8%A1%E5%9D%97%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B8%8E%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">logging 模块基本使用与日志级别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#logging-%E6%A8%A1%E5%9D%97%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B-basicConfig"><span class="toc-number">2.5.2.2.</span> <span class="toc-text">logging 模块基础配置代码示例 (basicConfig)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#logging-%E6%A8%A1%E5%9D%97%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6-Loggers-Handlers-Formatters"><span class="toc-number">2.5.2.3.</span> <span class="toc-text">logging 模块核心组件 (Loggers, Handlers, Formatters)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#logging-%E6%A8%A1%E5%9D%97%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B-%E4%BD%BF%E7%94%A8%E5%AD%97%E5%85%B8%E9%85%8D%E7%BD%AE-dictConfig"><span class="toc-number">2.5.2.4.</span> <span class="toc-text">logging 模块高级配置代码示例 (使用字典配置 dictConfig)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#logging-%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE-ini-cfg"><span class="toc-number">2.5.2.5.</span> <span class="toc-text">logging 模块使用文件配置 (.ini/.cfg)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#logging-%E6%A8%A1%E5%9D%97%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.5.2.6.</span> <span class="toc-text">logging 模块开箱即用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-%E4%B8%BA%E8%84%9A%E6%9C%AC%E5%BF%AB%E9%80%9F%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E5%88%B0%E6%96%87%E4%BB%B6%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-number">2.5.2.6.1.</span> <span class="toc-text">a. 为脚本快速设置日志记录到文件和控制台</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Loguru-%E6%A8%A1%E5%9D%97%EF%BC%9A%E6%9B%B4%E7%AE%80%E5%8D%95%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">2.5.3.</span> <span class="toc-text">Loguru 模块：更简单的日志记录</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Loguru-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E4%B8%8E%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.5.3.1.</span> <span class="toc-text">Loguru 核心特性与常用功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Loguru-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.5.3.2.</span> <span class="toc-text">Loguru 模块代码示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Loguru-%E6%A8%A1%E5%9D%97%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.5.3.3.</span> <span class="toc-text">Loguru 模块开箱即用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-%E5%BF%AB%E9%80%9F%E4%B8%BA%E8%84%9A%E6%9C%AC%E8%AE%BE%E7%BD%AE%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%92%8C%E6%96%87%E4%BB%B6%E6%97%A5%E5%BF%97"><span class="toc-number">2.5.3.3.1.</span> <span class="toc-text">a. 快速为脚本设置控制台和文件日志</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E8%BE%83%E4%B8%BA%E4%B8%8D%E5%B8%B8%E7%94%A8%E5%AE%9E%E7%94%A8%E5%BA%93"><span class="toc-number">2.6.</span> <span class="toc-text">6.较为不常用实用库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#contextlib-%E6%A8%A1%E5%9D%97%EF%BC%9A%E7%AE%80%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">2.6.1.</span> <span class="toc-text">contextlib 模块：简化上下文管理器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#contextlib-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">contextlib 常用功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#contextlib-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">contextlib 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tempfile-%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%A4%84%E7%90%86%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95"><span class="toc-number">2.6.2.</span> <span class="toc-text">tempfile 模块：处理临时文件和目录</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#tempfile-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.6.2.1.</span> <span class="toc-text">tempfile 常用功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tempfile-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.6.2.2.</span> <span class="toc-text">tempfile 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#glob-%E6%A8%A1%E5%9D%97%EF%BC%9A%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E5%90%8D%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-number">2.6.3.</span> <span class="toc-text">glob 模块：文件路径名模式匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#glob-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.6.3.1.</span> <span class="toc-text">glob 常用功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#glob-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.6.3.2.</span> <span class="toc-text">glob 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#uuid-%E6%A8%A1%E5%9D%97%EF%BC%9A%E7%94%9F%E6%88%90%E9%80%9A%E7%94%A8%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="toc-number">2.6.4.</span> <span class="toc-text">uuid 模块：生成通用唯一标识符</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#uuid-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%89%88%E6%9C%AC"><span class="toc-number">2.6.4.1.</span> <span class="toc-text">uuid 常用功能与版本</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#uuid-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.6.4.2.</span> <span class="toc-text">uuid 模块代码示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%BA%95%E5%B1%82%E5%B7%A5%E5%85%B7%E5%BA%93"><span class="toc-number">2.7.</span> <span class="toc-text">7.底层工具库</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#typing-%E6%A8%A1%E5%9D%97%EF%BC%9A%E7%B1%BB%E5%9E%8B%E6%8F%90%E7%A4%BA%E6%94%AF%E6%8C%81"><span class="toc-number">2.7.0.1.</span> <span class="toc-text">typing 模块：类型提示支持</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#typing-%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%9E%8B%E4%B8%8E%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">2.7.0.1.1.</span> <span class="toc-text">typing 常用类型与构造器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#typing-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.7.0.1.2.</span> <span class="toc-text">typing 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#itertools-%E6%A8%A1%E5%9D%97%EF%BC%9A%E9%AB%98%E6%95%88%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7"><span class="toc-number">2.7.0.2.</span> <span class="toc-text">itertools 模块：高效的迭代器构建工具</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#itertools-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.7.0.2.1.</span> <span class="toc-text">itertools 常用功能</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#itertools-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.7.0.2.2.</span> <span class="toc-text">itertools 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#functools-%E6%A8%A1%E5%9D%97%EF%BC%9A%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0%E4%B8%8E%E5%8F%AF%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1%E5%B7%A5%E5%85%B7"><span class="toc-number">2.7.0.3.</span> <span class="toc-text">functools 模块：高阶函数与可调用对象工具</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#functools-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.7.0.3.1.</span> <span class="toc-text">functools 常用功能</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#functools-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.7.0.3.2.</span> <span class="toc-text">functools 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#copy-%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%B5%85%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="toc-number">2.7.0.4.</span> <span class="toc-text">copy 模块：对象的浅拷贝与深拷贝</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#copy-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.7.0.4.1.</span> <span class="toc-text">copy 常用功能</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pprint-%E6%A8%A1%E5%9D%97%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E7%BE%8E%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-number">2.7.0.5.</span> <span class="toc-text">pprint 模块：数据结构的美化输出</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#pprint-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.7.0.5.1.</span> <span class="toc-text">pprint 常用功能</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#pprint-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.7.0.5.2.</span> <span class="toc-text">pprint 模块代码示例</span></a></li></ol></li></ol></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E7%AB%A0%EF%BC%9APython-%E8%AF%AD%E6%B3%95%E6%96%B0%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93-3-8-3-13"><span class="toc-number">3.</span> <span class="toc-text">第二十章：Python 语法新特性总结 (3.8 ~ 3.13)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-3-8-%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="toc-number">3.1.</span> <span class="toc-text">Python 3.8 主要特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%B5%8B%E5%80%BC%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E6%B5%B7%E8%B1%A1%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.1.1.</span> <span class="toc-text">1. 赋值表达式 (海象操作符) :=</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BB%85%E4%BD%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.2.</span> <span class="toc-text">2. 仅位置参数 (/)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-f-string-%E5%A2%9E%E5%BC%BA-%E7%94%A8%E4%BA%8E%E8%B0%83%E8%AF%95"><span class="toc-number">3.1.3.</span> <span class="toc-text">3. f-string 增强 (=) 用于调试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-3-9-%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="toc-number">3.2.</span> <span class="toc-text">Python 3.9 主要特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AD%97%E5%85%B8%E5%90%88%E5%B9%B6%E4%B8%8E%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C%E7%AC%A6-%E5%92%8C"><span class="toc-number">3.2.1.</span> <span class="toc-text">1. 字典合并与更新操作符 (| 和 |=)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%B1%BB%E5%9E%8B%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%86%85%E7%BD%AE%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B-%E6%B3%9B%E5%9E%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">2. 类型注解的内置集合类型 (泛型)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%96%B9%E6%B3%95%EF%BC%9Aremoveprefix-%E5%92%8C-removesuffix"><span class="toc-number">3.2.3.</span> <span class="toc-text">3. 字符串方法：removeprefix() 和 removesuffix()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-3-10-%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="toc-number">3.3.</span> <span class="toc-text">Python 3.10 主要特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BB%93%E6%9E%84%E5%8C%96%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D-match-case"><span class="toc-number">3.3.1.</span> <span class="toc-text">1. 结构化模式匹配 (match/case)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%81%94%E5%90%88%E7%B1%BB%E5%9E%8B%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.3.2.</span> <span class="toc-text">2. 联合类型操作符 (|)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E6%94%B9%E8%BF%9B%EF%BC%9A%E6%8B%AC%E5%8F%B7%E5%86%85%E5%A4%9A%E4%B8%AA-with-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">3.3.3.</span> <span class="toc-text">3. 上下文管理器改进：括号内多个 with 表达式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-3-11-%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="toc-number">3.4.</span> <span class="toc-text">Python 3.11 主要特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%82%E5%B8%B8%E7%BB%84-ExceptionGroup-%E5%92%8C%E5%BC%82%E5%B8%B8%E6%B3%A8%E9%87%8A-add-note"><span class="toc-number">3.4.1.</span> <span class="toc-text">1. 异常组 (ExceptionGroup) 和异常注释 (add_note())</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Self-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.2.</span> <span class="toc-text">2. Self 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-LiteralString-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.3.</span> <span class="toc-text">3. LiteralString 类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-3-12-%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="toc-number">3.5.</span> <span class="toc-text">Python 3.12 主要特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E7%AE%80%E5%8C%96%E8%AF%AD%E6%B3%95-PEP-695"><span class="toc-number">3.5.1.</span> <span class="toc-text">1. 泛型类和函数的简化语法 (PEP 695)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%E4%B8%8E%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F%E8%AF%AD%E6%B3%95%E6%94%B9%E8%BF%9B-type-%E8%AF%AD%E5%8F%A5-PEP-695"><span class="toc-number">3.5.2.</span> <span class="toc-text">2. 类型别名与类型变量语法改进 (type 语句) (PEP 695)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-f-string-%E8%AF%AD%E6%B3%95%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%94%B9%E8%BF%9B-PEP-701"><span class="toc-number">3.5.3.</span> <span class="toc-text">3. f-string 语法进一步改进 (PEP 701)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-3-13-%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="toc-number">3.6.</span> <span class="toc-text">Python 3.13 主要特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-typing-override-%E8%A3%85%E9%A5%B0%E5%99%A8-PEP-698"><span class="toc-number">3.6.1.</span> <span class="toc-text">1. @typing.override 装饰器 (PEP 698)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%80%E7%AB%A0%EF%BC%9A%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E8%A7%84%E8%8C%83%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">4.</span> <span class="toc-text">第二十一章：项目结构规范与最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%8E%A8%E8%8D%90%E7%9A%84-Python-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">一、推荐的 Python 项目结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%9B%AE%E5%BD%95%E6%A0%91%E6%A6%82%E8%A7%88"><span class="toc-number">4.1.1.</span> <span class="toc-text">1. 目录树概览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%90%84%E9%83%A8%E5%88%86%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.1.2.</span> <span class="toc-text">2. 各部分详解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a-my-project-%E9%A1%B9%E7%9B%AE%E6%A0%B9%E7%9B%AE%E5%BD%95"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">a. my_project/ (项目根目录)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#b-my-package-%E4%B8%BB%E5%BA%94%E7%94%A8%E5%8C%85"><span class="toc-number">4.1.2.2.</span> <span class="toc-text">b. my_package/ (主应用包)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#c-tests-%E6%B5%8B%E8%AF%95%E7%9B%AE%E5%BD%95"><span class="toc-number">4.1.2.3.</span> <span class="toc-text">c. tests/ (测试目录)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#d-docs-%E6%96%87%E6%A1%A3%E7%9B%AE%E5%BD%95"><span class="toc-number">4.1.2.4.</span> <span class="toc-text">d. docs/ (文档目录)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#e-examples-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E7%9B%AE%E5%BD%95"><span class="toc-number">4.1.2.5.</span> <span class="toc-text">e. examples/ (示例代码目录)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#f-gitignore"><span class="toc-number">4.1.2.6.</span> <span class="toc-text">f. .gitignore</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#g-LICENSE"><span class="toc-number">4.1.2.7.</span> <span class="toc-text">g. LICENSE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#h-README-md"><span class="toc-number">4.1.2.8.</span> <span class="toc-text">h. README.md</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#i-requirements-txt"><span class="toc-number">4.1.2.9.</span> <span class="toc-text">i. requirements.txt</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#j-setup-py-%E6%88%96-pyproject-toml-setup-cfg"><span class="toc-number">4.1.2.10.</span> <span class="toc-text">j. setup.py (或 pyproject.toml + setup.cfg)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E4%B8%8E%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97-PEP-8-%E6%A0%B8%E5%BF%83%E5%AE%9E%E8%B7%B5"><span class="toc-number">4.2.</span> <span class="toc-text">二、代码质量与风格指南 (PEP 8 核心实践)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B7%A5%E5%85%B7"><span class="toc-number">4.3.</span> <span class="toc-text">三、总结与工具</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/" title="Python教程：应用之巅"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c7d81.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="Python教程：应用之巅"></a><div class="content"><a class="title" href="/2025/06/19/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%8B%E7%AF%87/" title="Python教程：应用之巅">Python教程：应用之巅</a><time datetime="2025-06-19T06:00:00.000Z" title="发表于 2025-06-19 14:00:00">2025-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/18/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%AD%E7%AF%87/" title="Python教程：深入其境"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c5e0c.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="Python教程：深入其境"></a><div class="content"><a class="title" href="/2025/06/18/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%AD%E7%AF%87/" title="Python教程：深入其境">Python教程：深入其境</a><time datetime="2025-06-18T02:00:00.000Z" title="发表于 2025-06-18 10:00:00">2025-06-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/17/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E5%89%8D%E7%AF%87/" title="Python教程：Python知识点前篇速览"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="Python教程：Python知识点前篇速览"></a><div class="content"><a class="title" href="/2025/06/17/Python%E7%9F%A5%E8%AF%86%E7%82%B9%E5%89%8D%E7%AF%87/" title="Python教程：Python知识点前篇速览">Python教程：Python知识点前篇速览</a><time datetime="2025-06-17T07:05:54.000Z" title="发表于 2025-06-17 15:05:54">2025-06-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:3381292732@qq.com" rel="external nofollow noreferrer" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://weibo.com/u/7484736298?tabtype=home" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f745b722d7.webp" size="50px"><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Prorise-cool" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://space.bilibili.com/361040115?spm_id_from=333.788.0.0" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="workboard"><div id="runtimeTextTip"></div></div><div class="footer_custom_text">这是我的个人博客，分享技术与生活点滴。</div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener external nofollow noreferrer" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.foreverblog.cn/">十年之约</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/docs/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" rel="external nofollow noreferrer" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="博客框架为Hexo7.0" title="博客框架为Hexo7.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo7.0"></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"></a><a class="github-badge" target="_blank" href="https://github.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站采用CC BY-NC-SA 4.0协议" title="本站采用CC BY-NC-SA 4.0协议"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用CC BY-NC-SA 4.0协议"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2025 By <a class="footer-bar-link" href="/about/" title="Prorise" target="_blank">Prorise</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗, 万物可爱, 人间值得, 未来可期.","愿你眼里的星星，永远亮晶晶。","愿我们每个人都能被世界温柔以待。"]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/typed.js/2.0.12/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Prorise-cool?tab=repositories" title="网站源码">网站源码</a><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/" title="湘ICP备23041-302号">湘ICP备23041-302号</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">2</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" rel="external nofollow noreferrer" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="后续项目..."><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="后续项目..."><span class="back-menu-item-text">后续项目...</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>个人</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fas fa-check-double faa-tada"></i><span> 代办清单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>预览</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?server=netease&amp;id=3117791189"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fas fa-comments faa-tada"></i><span> 评论总览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 即刻短文</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Python/" style="font-size:.88rem">Python<sup>3</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><button id="to_comment" type="button" title="直达评论" onclick="FixedCommentBtn()"><i class="anzhiyufont anzhiyu-icon-comments"></i></button><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" rel="external nofollow noreferrer" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="3117791189" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=3117791189&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>//- 从这里开始的所有JS代码，都必须有缩进（例如2个空格）
// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("06/10/2025 00:00:00"); // 此处读取您配置中的建站时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  
  // --- 已将您的专属LOGO和个人信息集成到这里 ---
  const ascll = [
    `欢迎访问 Prorise 的数字空间!`,
    `代码构建世界，思想驱动未来`,
    // 这里的反引号和所有ASCII art行，都必须有正确的缩进
    `
     ____                      _             
    |  _ \\  _ __   ___   _ __  (_) ___   ___  
    | |_) || '__| / _ \\ | '__| | |/ __| / _ \\ 
    |  __/ | |   | (_) || |    | |\\__ \\|  __/ 
    |_|    |_|    \\___/ |_|    |_||___/ \\___| 
                                             
    `,
    "已稳定运行",
    dnum,
    "天",
    `©2025 By Prorise 1.0.0`,
  ];
  
  const ascll2 = [`SYS-INFO`, `前置摄像头拍照成功`, `您的帅气脸庞为：`, `😎`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c${ascll[2]} \n%c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF; font-family:monospace;",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );

  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，朋友.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Created by Prorise %c 你正在访问 Prorise 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 注意，你的所有操作已被记录.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script async="">(function () {
  var grt = new Date("06/10/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.prorise666.site/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.prorise666.site/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  let initFn = window.walineFn || null

  const initWaline = (Fn) => {
    const waline = Fn(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline.prorise666.site',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
      imageUploader: true,
    }, null))

    const destroyWaline = () => {
      waline.destroy()
    }

    anzhiyu.addGlobalFn('pjax', destroyWaline, 'destroyWaline')
  }

  const loadWaline = async () => {
    if (initFn) initWaline(initFn)
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.css')
      if (true) await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline-meta.css')
      const { init } = await import('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.js')
      initFn = init || Waline.init
      initWaline(initFn)
      window.walineFn = initFn
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.prorise666.site/',
        region: 'ap-shanghai',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async="" data-pjax="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail=""</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="/js/load-on-demand.js"></script><script defer="" id="fluttering_ribbon" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="" mobile="false"></script><script src="//code.tidio.co//tk571vck0ua2wjoalfbp8wyrlsdaunmz.js" async=""></script><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    let isShow = false
    const close = () => {
      window.tidioChatApi.hide()
      isShow = false
      document.body.style.position = 'relative';
      document.documentElement.style.overflow = 'auto'
    }
    
    const open = () => {
      window.tidioChatApi.open()
      window.tidioChatApi.show()
      isShow = true
    }

    const onTidioChatApiReady = () => {
      window.tidioChatApi.hide()
      window.tidioChatApi.on("close", close)
    }
    if (window.tidioChatApi) {
      window.tidioChatApi.on("ready", onTidioChatApiReady)
    } else {
      document.addEventListener("tidioChat-ready", onTidioChatApiReady)
    }

    window.chatBtnFn = () => {
      if (!window.tidioChatApi) return
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        window.tidioChatApi && window.tidioChatApi.hide()
      },
      show: () => {
        window.tidioChatApi && window.tidioChatApi.show()
      }
    }
  }
})()</script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://npm.elemecdn.com/meting@2.0.1/dist/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '[object Object]', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div>
    <link rel="stylesheet" href="https://ai.tianli0.top/static/public/postChatUser_summary.min.css">
    <script>
        let tianliGPT_key = '';
        let tianliGPT_postSelector = '#post-container .post-content';
        let tianliGPT_Title = '✨ AI 文章摘要';
        let tianliGPT_postURL = '/^https?:\/\/[^\/]+\/[0-9]{4}\/[0-9]{2}\/[0-9]{2}\/';
        let tianliGPT_blacklist = '';
        let tianliGPT_wordLimit = '1000';
        let tianliGPT_typingAnimate = true;
        let tianliGPT_theme = 'default';
        var postChatConfig = {
          backgroundColor: "#4d648d",
          bottom: "76px",
          left: "16px",
          fill: "#FFFFFF",
          width: "50px",
          frameWidth: "380px",
          frameHeight: "600px",
          defaultInput: true,
          upLoadWeb: true,
          showInviteLink: true,
          userTitle: "💬 智能助手",
          userDesc: "我是 Prorise 博客的 AI 助手，有任何关于网站内容的问题都可以问我哦～",
          addButton: true,
          beginningText: "这篇文章介绍了",
          userIcon: "https://ai.tianli0.top/static/img/PostChat.webp",
          userMode: "magic",
          defaultChatQuestions: ["你好","你是谁"],
          defaultSearchQuestions: ["视频压缩","设计"]
        };
    </script>
    <script data-postchat_key="" src="https://ai.tianli0.top/static/public/tianli_gpt.min.js"></script>
  </body></html>