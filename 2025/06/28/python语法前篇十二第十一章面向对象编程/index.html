<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Python语法前篇（十二）：第十一章：面向对象编程 | 格物致知</title><meta name="keywords" content="Python-语法篇"><meta name="author" content="Prorise"><meta name="copyright" content="Prorise"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#cee8ff"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Python语法前篇（十二）：第十一章：面向对象编程"><meta name="application-name" content="Python语法前篇（十二）：第十一章：面向对象编程"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#cee8ff"><meta property="og:type" content="article"><meta property="og:title" content="Python语法前篇（十二）：第十一章：面向对象编程"><meta property="og:url" content="https://prorise-cool.github.io/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/index.html"><meta property="og:site_name" content="格物致知"><meta property="og:description" content="第十一章：面向对象编程对象的本质 对象本质上是一个 “容器”，用来存放数据和功能的集合体。面向对象编程的核心思想是将数据和操作数据的方法封装在一起，形成独立的实体。 为什么需要对象以开发 MOBA 游戏为例，每个英雄都有自己的属性（如攻击力、移动速度）和功能（如技能）。如果不使用对象，代码会变得非常"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp"><meta property="article:author" content="Prorise"><meta property="article:tag" content="全栈, Full Stack, 前端, 后端, Node.js, Vue, React, 数据库, Linux, Docker, 个人博客, 技术分享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp"><meta name="description" content="第十一章：面向对象编程对象的本质 对象本质上是一个 “容器”，用来存放数据和功能的集合体。面向对象编程的核心思想是将数据和操作数据的方法封装在一起，形成独立的实体。 为什么需要对象以开发 MOBA 游戏为例，每个英雄都有自己的属性（如攻击力、移动速度）和功能（如技能）。如果不使用对象，代码会变得非常"><link rel="shortcut icon" href="/img/icons/favicon.ico"><link rel="canonical" href="https://prorise-cool.github.io/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media=&quot;all&quot;"><script async="" src="https://www.googletagmanager.com/gtag/js?id=[object Object]"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","[object Object]")</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"Prorise","mode":"tianli","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"S-DNA1JM95BX2F9L0N","Referer":"https://xx.xx/"},
  diytitle: undefined,
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.prorise666.site/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"b39753735ed0ed5ffeb771bc108e3158","mailMd5":"ec3291d59a8d7d3675df8a0537fcbc979f0fa611c8df55841fb7f4fd162bd07a"},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤣 全栈开发工程师","🙂 前端架构设计师","🙃 后端服务构建者","🤩 移动端应用开发","🤯 数据库设计专家","🥳 DevOps运维实践者","🤭 技术栈多面手","😎 性能优化达人"]},
  algolia: {"appId":"K8Y7M0RMXQ","apiKey":"11fa7380e2694483a44b143044e69e6e","indexName":"prorise_blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":3,"position":"top","messagePrev":"距离上次更新已经过了","messageNext":"天，文章内容可能已经过时。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Prorise","link":"链接: ","source":"来源: 格物致知","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"格物致知",title:"Python语法前篇（十二）：第十一章：面向对象编程",postAI:"false",pageFillDescription:"第十一章：面向对象编程, 对象的本质, 为什么需要对象, __init__ 方法, 面向对象的三大特性, 1. 封装, 属性隐藏, 属性访问控制, 使用@property 装饰器, 2. 继承, 单继承和多继承, 方法重写和调用父类方法, 继承的属性查找顺序 (MRO), 菱形继承问题, MixIn 设计模式, 3. 多态, 鸭子类型, 抽象基类, 类方法与静态方法, 方法类型比较, 2. 类方法（@classmethod）, 3. 静态方法（@staticmethod）, 反射机制, 常用反射函数, 1. hasattr() — 检查对象是否有指定属性, 2. getattr() — 获取对象的属性, 3. setattr() — 设置对象的属性, 4. delattr() — 删除对象的属性, 5. dir() — 列出对象的所有属性, 6. type() — 获取对象的类型, 7. isinstance() — 检查对象是否为类的实例, 8. issubclass() — 检查类是否为另一个类的子类, 9. callable() — 检查对象是否可调用, 10. vars() — 获取对象的 __dict__, 反射示例, 通用枚举以及抽象接口定义, enum 模块：实现枚举类型, enum 常用功能, enum 模块代码示例, abc 模块：定义抽象基类 (Abstract Base Classes), abc 常用功能, abc 模块代码示例, 元类编程, 元类的核心方法, 使用 type 动态创建类, 自定义元类, 元类的 __new__ 方法, 元类的 __call__ 方法实例, 元类链和类创建过程, 内置的元类属性和方法表, Python 特殊方法（魔术方法）, 1. 对象创建与销毁, 实际应用场景：, 2. 对象表示, 实际应用场景：, 3. 集合类操作, 实际应用场景：自定义商品购物车, 4. 调用与比较操作, 实际应用场景：数据分析器, 5. 算术运算操作, 实际应用场景：向量运算, 6. 属性访问控制, 实际应用场景：属性验证与保护, 7. 上下文管理（with 语句）, 实际应用场景：数据库连接管理, 8. 描述符与属性装饰器, 描述符协议方法, 实际应用场景：数据验证描述符, 属性装饰器(@property)实际应用, 10. 常见特殊方法使用陷阱与最佳实践, 陷阱与注意事项, 11. 总结：特殊方法的选择指南, 对象与类的高级概念, 深入理解实例、类和元类关系, 属性查找的复杂情况, 内存管理与对象生命周期, 对象创建和销毁的完整过程, 引用计数和循环引用, 高级常用设计模式, 单例模式, 懒汉式单例模式的使用场景, 饿汉式单例模式的使用场景, 工厂模式, 观察者模式, 代理模式, 1.静态代理实现, 2.动态代理实现, 3.保护代理实现, 4.虚拟代理实现, SOLID 原则, SOLID 原则概述, 1. 单一职责原则 (SRP), 1.1 原则解析, 1.2 电商系统中的应用, 1.3 遵循 SRP 的实现, 2. 开放封闭原则 (OCP), 2.1 原则解析, 2.2 电商系统中的应用, 2.3 遵循 OCP 的实现, 3. 里氏替换原则 (LSP), 3.1 原则解析, 3.2 电商系统中的应用, 3.3 遵循 LSP 的实现, 4. 接口隔离原则 (ISP), 4.1 原则解析, 4.2 电商系统中的应用, 4.3 遵循 ISP 的实现, 5. 依赖倒置原则 (DIP), 5.1 原则解析, 5.2 电商系统中的应用, 5.3 遵循 DIP 的实现, Python 中的 __slots__, __slots__ 的工作原理与性能优势, __slots__ 的限制和继承行为第十一章面向对象编程对象的本质对象本质上是一个容器用来存放数据和功能的集合体面向对象编程的核心思想是将数据和操作数据的方法封装在一起形成独立的实体为什么需要对象以开发游戏为例每个英雄都有自己的属性如攻击力移动速度和功能如技能如果不使用对象代码会变得非常冗余不使用对象的方式盖伦我的名字是职业是攻击力是移动速度是第二个英雄后裔我的名字是职业是攻击力是移动速度是使用字典可以改进一些如下但这样还是有一些瑕疵因为函数是暴露在外面的最理想的状态是函数也存在在这个对象里我的名字是职业是攻击力是移动速度是盖伦在对象中还有类的这么一个概念比如说又新创建了一个艾希英雄他与后裔的差别无非就是与是不一致的但他们都同属于这个职业所以他们就可以存在在一个类里面在面向对象编程里面是先创建一个类再将对象创建出来所以类也算是一种容器他也可以被称作是对象我的名字是职业是攻击力是移动速度是在程序运行时类的子代码会被运行也就代表类在定义阶段就已经创建好了名称空间在里面类的名称空间中会默认创建一个的字典属性所以想要拿到类的属性实际上访问的是类名称空间中的字典属性提供了一个更简便的语法也就是通过类名属性名来访问的每次调用一个类就会产生一个对象此时这个对象里面的是空的需要添加值给对象添加属性亚瑟可是通过这种方式过于复杂也提供了简便的语法妲己后裔亚瑟妲己后裔方法为了减少代码冗余我们可以定义一个初始化方法在创建对象时自动设置属性我的名字是职业是攻击力是移动速度是在程序运行时类的子代码会被运行也就代表类在定义阶段就已经创建好了名称空间后裔程咬金妲己后裔程咬金妲己这还不够完美面向对象的核心思想就是整合两个字现在定义的这个函数和类是完全独立开的那有没有什么办法能把这个函数和前面定义的类进一步整合到一起呢最好是产生对象的时候就自动调用这个功能完成对象属性的初始化操作这时候拿到的对象就是有自己独有属性的对象我的名字是职业是攻击力是移动速度是在程序运行时类的子代码会被运行也就代表类在定义阶段就已经创建好了名称空间在我们调用类自动创建对象的时候内部会自动调用类下面的方法并传入一个空对象所以在实际传值时仅需要传入四个参数即可后裔空对象程咬金妲己后裔程咬金妲己我的名字是后裔职业是攻击力是移动速度是我的名字是程咬金职业是攻击力是移动速度是我的名字是妲己职业是攻击力是移动速度是进一步修改代码通过拿属性过于繁杂所以也可以用到类名属性名的方式来传值给函数并且在代码最后在打印函数的内存地址的时候会发现打印类里的函数是一个正常的函数而打印对象的函数方法则是一个绑定方法也就是说类的函数属性绑定给对象使用了之后就不再是一个普通函数我的名字是职业是攻击力是移动速度是在程序运行时类的子代码会被运行也就代表类在定义阶段就已经创建好了名称空间在我们调用类自动创建对象的时候内部会自动调用类下面的方法并传入一个空对象所以在实际传值时仅需要传入四个参数即可后裔空对象程咬金妲己绑定方法三个内存地址不一样并不代表代码就存了三份代码本身只存了一份因为类的作用就是为了减少计算机资源的浪费可以理解为类的属性绑定给对象之后这个函数的内存地址就会被包装成一个绑定方法或者也可以理解为是一个装饰器当通过对象访问这些函数的时候访问的也是这个绑定方法的内存地址而他在给函数传入值时也会像方法一样自动传入一个对象进去所以就能明白在我们实例化对象传入参数时他默认的第一个参数是一个对象这个对象就是对象他仅仅只是一个变量名在代码的规范角度来讲类里面的函数的第一个对象就是仅此而已通过这种方式只需要在方法下增添需要的绑定方法添加对应的函数功能就能够实现谁调用这个对象的函数方法就给谁增添对应的数据我的名字是职业是攻击力是移动速度是购买了后裔程咬金妲己屠龙宝刀屠龙宝刀面向对象的三大特性封装封装是将数据和方法包装在对象内部并向外界提供必要的接口同时隐藏实现细节的过程属性隐藏使用名称修饰实现属性隐藏即在属性名前加上双下划线私有属性私有方法购买了后裔无尽战刃但这只是名称修饰仍然可以通过修饰后的名称访问无尽战刃后裔购买了无尽战刃属性访问控制为了更好地控制属性访问可以使用和方法年龄必须为整数相当于的方法设置年龄为使用装饰器的装饰器提供了更优雅的属性访问方式这段代码展示了中的属性装饰器的使用它有以下意义封装性通过私有变量和属性装饰器实现了对数据的封装和保护数据验证在方法中可以对输入数据进行验证确保数据的有效性接口一致性虽然内部使用了方法但对外提供了类似直接访问属性的简洁接口控制访问可以分别控制属性的读取修改和删除行为获取年龄设置年龄年龄必须为整数删除年龄属性使用使用使用继承继承允许一个类子类继承另一个类父类的属性和方法单继承和多继承吃单继承汪汪叫飞翔多继承吃继承自汪汪叫吃继承自汪汪叫继承自飞翔继承自查看继承关系方法重写和调用父类方法子类可以重写父类的方法也可以通过调用父类方法我是今年岁了这里调用父类的方法我是我今年岁了我是属于品种的狗旺财哈士奇输出我是旺财今年岁了调用了父类的方法我是旺财我今年岁了我是属于哈士奇品种的狗重写了父类的方法继承的属性查找顺序使用算法计算方法解析顺序基类的方法第一个子类的方法第二个子类的方法输出先是自己再是第一个传入的类第二个传入的类最后是基类最后是按顺序查找菱形继承问题菱形继承钻石继承是指一个子类通过不同的路径继承了同一个基类菱形继承结构输出在中无论继承路径如何复杂每个类在中只会出现一次设计模式是一种设计模式用于为类添加功能而不使用传统继承关系多态多态是一种编程思想在中是没有多态这么一个技术的比如汽车这种事物他就有很多种形态奔驰宝马奥拓这就叫多态多态只是在继承下演化出来的一种概念而已而我们要知道的是为什么要有多态这个概念奔驰宝马奥拓这都是可以跑的对吧也就是说跑这个功能是汽车共有的功能那我就在他们的共同的父类里面定义一个方法开始跑奔驰跑起来好快哦宝马跑起来好稳哦奥拓跑起来好省油哦多态性示例同一方法调用不同行为鸭子类型多态性带来的好处统一了使用标准以不变应万变无论对象千变万化使用者都是使用同一种方式去调用需要注意的是不一定要继承父类的方法才算是一种多态引入推崇的一个鸭子模型的概念只要你长得像鸭子走路像鸭子那么你就是一只鸭子所以类只要内部定义的方法一样那么他们就同属于一种类别这也是一种解耦合的方法呱呱呱鸭子游泳人类模仿鸭叫人类游泳人类没有继承类但可以表现得像鸭子抽象基类如果你不想使用鸭子模型就想用父类来达到规范子类的效果可以引入一个抽象基类概念而这并不是推崇的推崇的永远是简洁至上这样限制只会让程序变得臃肿奔驰开始跑奔驰停止如果没有实现所有抽象方法会抛出类方法与静态方法方法类型比较方法类型装饰器第一参数使用场景实例方法无操作实例状态类方法操作类状态替代构造函数静态方法无特殊参数工具函数示例场景在实际的开发中实例方法通常用于操作与当前对象状态相关的行为比如我们定义一个类该类实例方法可以访问每个对象的名称和年龄并提供修改获取这些属性的功能创建实例并调用实例方法输出类方法常见示例场景替代构造函数类方法通常用于定义一个替代构造函数根据不同的输入创建对象比如可以根据不同的配置文件或环境变量来初始化对象操作类状态类方法通常用于修改与类相关的共享数据比如修改所有实例的共享配置连接数据库成功地址端口号从配置文件如模块或环境变量中读取和并实例化对象使用类方法来创建实例输出输出连接数据库成功地址端口号应用场景你可以在配置或环境变化时灵活地调整类的构造逻辑不需要每次都显式地提供参数这使得代码更加简洁并且易于扩展静态方法第一参数无特殊参数静态方法与类或实例无关不需要或参数访问实例变量静态方法无法访问实例或类的属性访问类变量静态方法只能做独立于实例和类的操作它通常用于工具函数或者处理与对象本身无关的逻辑常见示例场景静态方法通常用来封装一些独立的工具函数这些函数与类或实例的状态无关例如数学计算字符串处理等功能调用静态方法无需实例化类输出输出反射机制反射是指在程序运行时能够检查访问修改对象的属性和方法的能力在中反射允许我们在运行时动态地操作类和对象特别是在无法事先确定对象类型或者对象的属性和方法时反射提供了极大的灵活性常用反射函数函数描述示例检查对象是否有属性获取对象的属性设置对象的属性删除对象的属性列出对象的所有属性获取对象的类型检查对象是否为类的实例检查类是否为另一个类的子类检查对象是否可调用获取对象的检查对象是否有指定属性用于检查一个对象是否有指定名称的属性返回或示例检查对象是否有属性输出获取对象的属性用于获取对象的属性如果该属性存在返回其值如果不存在则返回指定的值如果没有提供当属性不存在时会抛出示例获取属性的值输出如果属性不存在使用默认值属性存在返回输出设置对象的属性用于给对象的指定属性设置新值如果该属性不存在则会动态创建一个新的属性示例动态设置新的属性输出删除对象的属性用于删除对象的指定属性删除属性后访问该属性会抛出示例删除属性会抛出列出对象的所有属性返回一个列表包含对象的所有属性和方法包括其继承的属性示例列出对象的所有属性获取对象的类型返回对象的类型即类示例输出检查对象是否为类的实例用于检查对象是否为类的实例或其子类的实例示例检查是否是类的实例是类的实例输出是类的实例检查类是否为另一个类的子类用于检查类是否是类的子类示例输出检查对象是否可调用用于检查对象是否可以调用即它是否是一个函数或具有方法的对象示例输出输出因为对象不可调用获取对象的返回一个字典包含对象的所有属性和对应的值这是访问对象的实例变量的一种方式示例输出反射示例检查和获取属性检查对象是否有属性获取属性的值输出设置新属性动态为对象设置属性输出删除属性删除属性如果取消注释会抛出动态调用方法检查方法是否可调用获取方法输出获取所有属性输出列出所有属性和方法通过字符串获取类检查类是否在全局命名空间中动态获取类使用动态获取的类实例化对象输出通用枚举以及抽象接口定义模块实现枚举类型模块引入提供了一种创建枚举的方法枚举是一组绑定的符号名称成员这些名称是常量并且具有唯一的通常是整数值使用枚举可以使代码更具可读性更易于维护并能有效防止因使用魔法数字或字符串而导致的错误常用功能类函数装饰器描述创建基本枚举类型的基类的子类其成员也是整数可以和整数直接比较的子类其成员可以使用位运算符的子类其成员也是整数并支持位运算在定义枚举成员时自动为其分配合适的值通常是递增的整数一个类装饰器确保枚举中没有重复值的成员访问枚举成员通过字符串名称访问枚举成员通过值获取枚举成员枚举成员属性获取成员的名称字符串枚举成员属性获取成员的值批注核心记忆功能模块继承或来定义自己的枚举使用自动分配值非常方便通过或来引用和获取枚举成员和是最常用的成员属性装饰器有助于保证值的唯一性模块代码示例用于类型注解模块演示准备模块功能演示基本枚举基本枚举如果没有这不会报错但可能不是期望的行为枚举成员的名称的值通过值获取成员通过名称获取成员遍历枚举使用自动分配值和确保值唯一使用和确保枚举成员的值是唯一的值通常从开始递增使用和的枚举整数枚举整数枚举成员可以直接与整数比较标志枚举和支持位运算标志枚举和成员的值通常是的幂通常定义一个无或空标志组合标志权限值为是否有权限是否有权限是否只有权限权限值为是否包含所有权限类似但其成员也是整数使用模块的常量通常是通常是通常是模式值为文件是否可读坑点与建议模块可读性与维护性使用枚举可以替代代码中散落的魔法数字或字符串常量使得代码意图更清晰更易于维护当需要修改某个状态的含义或值时只需在枚举定义处修改一处即可成员的唯一性默认情况下允许不同的成员名称指向相同的值别名使用类装饰器可以强制枚举中的所有成员值必须唯一如果存在重复值则会在定义时抛出成员的比较枚举成员是单例你可以使用或来比较两个枚举成员是否相同和的成员还可以直接与整数进行比较迭代与访问可以迭代枚举类的所有成员可以通过成员名方括号加成员名字符串或成员值来访问特定的枚举成员的行为会自动为枚举成员分配一个值默认情况下对于它从开始递增对于它会分配的幂你可以通过重写特殊方法来自定义的行为与位运算和类型的枚举成员支持位运算符非常适合表示权限状态组合等场景可以使用操作符来检查一个组合标志是否包含某个特定标志序列化默认情况下枚举成员在序列化时可能不会直接变成期望的字符串或整数你可能需要自定义序列化逻辑或者在序列化前获取成员的或属性模块定义抽象基类模块用于帮助定义和使用抽象基类抽象基类是一种不能被直接实例化的类它存在的目的是作为其他类的模板或接口约定子类如果继承了抽象基类就必须实现抽象基类中声明的所有抽象方法和抽象属性否则子类本身也会成为抽象类无法实例化这有助于强制执行接口规范实现多态并构建更健壮更松耦合的系统常用功能类装饰器描述一个辅助类用于通过继承来创建抽象基类一个装饰器用于声明一个抽象方法子类必须实现它一个装饰器用于声明一个抽象属性子类必须实现在旧版本中通常通过组合和实现声明抽象类方法声明抽象静态方法可以检查一个对象是否是某个抽象基类的实例即使是通过虚拟子类注册的类方法将注册为的虚拟子类即使没有显式继承批注核心记忆功能模块继承来定义抽象基类使用来标记那些必须在具体子类中被重写的方法抽象基类不能直接实例化它的主要目的是定义一个清晰的接口或契约供子类遵循模块代码示例假设可用用于类型注解模块演示准备模块抽象基类功能演示定义一个抽象基类定义抽象基类继承自表明这是一个抽象基类一个表示几何形状的抽象基类标记为抽象方法计算并返回形状的面积子类必须实现此方法抽象方法通常只有或标记为抽象方法计算并返回形状的周长子类必须实现此方法子类必须实现方法旧版本用返回形状的类型名称例如子类必须实现此属性这是一个具体方法子类可以直接继承或重写返回对形状的描述这是一个面积为周长为抽象基类已定义尝试实例化抽象基类会失败错误抽象基类被实例化了不应发生尝试实例化时捕获到预期的创建具体子类和创建具体子类和表示圆形的具体类半径必须为正数实现抽象方法实现抽象方法实现抽象属性圆形表示矩形的具体类宽度和高度必须为正数矩形具体子类和已定义实例化具体子类圆的描述矩形的描述演示未完全实现抽象方法的子类演示未完全实现抽象方法的子类应该也实现和故意不实现和不完整的正方形定义了一个未完全实现抽象方法的类错误不完整的抽象子类被实例化了不应发生如果能实例化这里调用会出错尝试实例化时捕获到预期的演示已在各节内进行模块演示结束坑点与建议模块强制接口实现模块的主要目的是强制子类实现特定的方法和属性从而确保它们都遵循一个共同的契约或接口这在大型项目或框架设计中非常有用可以提高代码的稳定性和可维护性实例化错误如果一个类继承了并有未被实现的抽象方法属性通过或标记那么尝试实例化这个类或其同样未完全实现的子类会在运行时抛出从开始可以直接使用在此之前定义抽象属性通常需要组合使用和虚拟子类除了通过继承你还可以使用将一个完全不相关的类注册为抽象基类的虚拟子类这意味着会返回但并不会真正从继承任何方法或属性也不会被强制实现抽象方法这种方式主要用于在不修改现有类继承关系的情况下将其归类到某个抽象接口下不仅仅是接口虽然抽象基类的作用与某些语言中的接口概念相似但的抽象基类可以包含具体的方法实现如示例中的方法子类可以直接继承这些实现何时使用当你希望定义一组类应该共同拥有的行为但具体实现方式因类而异时抽象基类是一个很好的选择例如定义一个通用的接口然后有等具体实现元类编程元类是创建类的类是的内置元类元类的核心方法方法描述调用时机创建类对象定义类时初始化类对象类创建后创建类的实例实例化类时使用动态创建类在我们使用定义关键字时其实是底层执行了以下四步操作为我们定义了一个类分别是定义类名定义基类执行类子代码产生名称空间调用元素定义类名定义基类执行子类代码产生名称空间你好我是今年岁函数语法要执行的代码字符串或代码对象可选参数指定代码执行时的全局命名空间默认为当前全局命名空间可选参数指定代码执行时的局部命名空间默认与相同这里传入三个参数包含类方法定义的代码字符串空字典作为全局命名空间避免访问外部全局变量作为局部命名空间执行后中定义的方法会存储在这个字典中这样做的目的是隔离执行环境并将执行结果类的方法定义收集到字典中之后可以将这个字典传给函数来动态创建类调用原类创建实例对象张三调用实例方法你好我是张三今年岁自定义元类对于元类来说最关键的步骤也就是在第四步在我们调用原类之前可以对这个类做一些自定义化操作如类名不能带特殊符号类必须写文档注释我们通过一个自定义类来实现这个功能类名不能包含下划线类必须有文档注释检查类属性名是否符合规范属性名必须全部小写检查是否有必要的方法类必须实现方法检查类的基类类必须继承至少一个父类人类的基本信息类如果没有这个注释会报错元类的方法在我们调用类产生一个空对象的时候在执行方法之前一定执行了其他方法我们都知道在中所有的类都默认继承自基类但在下述的例子当我们没有给自定义元类传入他报错了这是为什么呢本质上我们的也就指的是这个类对于来说他只是一个形参而已真正为我们继承父类的方法是方法检查类的基类类必须继承至少一个父类我们可以通过进一步剖析方法检查类的基类类必须继承至少一个父类通过调用父类的方法他会在底层帮我们继承对象存放属性等元类的方法实例当调用类如创建实例时实际上是调用元类的方法自定义此方法可以控制实例化过程控制类实例化过程创建的新实例正常的实例化过程创建实例并初始化返回的现有实例第一次调用创建新实例第二次调用返回现有实例参数被忽略仍然是验证是同一个实例元类链和类创建过程步骤描述涉及方法收集类定义信息解释器执行类体调用元类的创建类对象调用元类的初始化类对象返回创建的类类可以使用了元类创建类元类初始化类元类调用类创建实例调用类的初始化实例调用类的元类初始化实例类创建实例类初始化实例定义完成开始创建实例内置的元类属性和方法表属性方法描述示例指定类的元类方法解析顺序直接父类元组直接子类列表对象的类返回方法解析顺序特殊方法魔术方法的特殊方法也称为魔术方法或双下方法是面向对象编程中的核心概念它们允许自定义类行为以适应的语言特性这些方法以双下划线开始和结束如当特定操作发生时会被自动调用对象创建与销毁方法名描述触发方式使用场景初始化对象创建实例后调用设置实例属性创建对象实例化时调用比先自定义实例创建过程实现单例模式析构方法对象被销毁时调用释放资源关闭文件或连接实际应用场景类变量用于存储单例实例这里的也就是我们当前的类实现单例模式确保只创建一个数据库连接实例若我们的类里面的变量没有被初始化则创建一个新的实例调用父类的方法创建实例创建新的数据库连接实例打印日志返回单例实例如果类对象身上初始化完成数据库连接对象模拟数据库连接连接到数据库成功用户名密码连接成功对象销毁时关闭连接关闭数据库连接使用示例不会创建新实例判断两者是否为同一个实例连接到数据库对象表示方法名描述触发方式使用场景可读字符串表示在直接输出类时标准化的输出类上面的所有属性正式字符串表示为开发者提供详细信息理想情况下应返回可重新创建对象的代码实际应用场景返回用户友好的描述返回可重新创建此对象的代码使用示例苹果输出苹果输出苹果在调试中的价值苹果香蕉会显示完整的信息有助于调试输出的是一个友好易读的字符串适合用户查看输出的是一个更正式的字符串通常能够通过来重建该对象示例交互式环境中的在的交互式环境中比如直接在命令行输入当你打印一个对象时如果对象有方法通常会看到的返回值而不是在交互式环境中自动调用的目标的设计目标是让对象的字符串表示能够作为一种明确无歧义的代码表达式最好能够让开发者通过来重新构建该对象例如返回的字符串应该是如果你运行它应该能够重新创建出一个与相同的实例集合类操作方法名描述触发方式使用场景获取对象长度自定义集合的大小索引访问使对象可通过索引或键访问索引赋值允许通过索引设置值删除索引项允许通过索引删除项返回迭代器使对象可迭代返回下一个值实现迭代器协议成员检查自定义成员检查逻辑实际应用场景自定义商品购物车返回用户友好的描述返回可重新创建此对象的代码购物车类管理用户选择的商品及其数量初始化空购物车商品商品数量的映射增加商品到购物车参数要添加的商品添加的数量默认为如果商品已经在购物车中更新数量如果商品不在购物车中直接添加支持通过索引访问返回商品和数量的元组商品不在购物车中支持通过索引设置数量商品不在购物车中支持通过删除商品商品不在购物车中返回购物车中的商品种类数量使购物车可迭代返回商品和数量支持成员检查被调用计算购物车中所有商品的总价用户友好的购物车展示购物车为空购物车内容总计测试代码创建商品苹果香蕉橙子商品商品商品商品购物车基本操作空购物车添加商品测试添加商品添加已有商品测试添加已有商品现在应该有个苹果通过索引访问测试通过索引访问获取为的商品信息为的商品信息数量通过索引修改数量测试通过索引修改数量将香蕉的数量改为删除商品测试删除商品删除苹果长度测试购物车商品种类迭代购物车测试迭代购物车中的商品个成员检查测试成员检查香蕉在购物车中苹果在购物车中橙子在购物车中添加新商品测试添加新商品计算总价测试购物车总价错误处理测试错误处理测试尝试访问不存在的商品预期的错误调用与比较操作我们这里主要讲这个方法有利于我们理解为什么方法可以在对象实例化的时候调用当我们调用一个对象也就相当于被调用了张三被调用了张三那么就会自动调用中的方法同样的内的返回值也会传递给那么也就是说如果想把一个对象变成一个可以加括号调用的对象就在对象的类里面增添一个方法方法名描述触发方式使用场景使对象可调用创建可调用对象函数式编程相等比较自定义对象相等性小于比较自定义对象排序大于比较自定义对象排序小于等于自定义对象排序大于等于自定义对象排序计算哈希值允许对象作为字典键或集合元素实际应用场景数据分析器添加数据点数据必须是数字类型调用对象时可以添加新数据并返回分析结果比较两个分析器的数据是否相同根据数据平均值比较分析器只能与另一个比较无法比较空数据集允许对象作为字典键基于名称和数据的散列使用示例温度分析器通过调用对象获取分析结果输出分析结果函数式用法添加新数据并获取结果更新后的分析结果创建另一个分析器用于比较湿度分析器比较分析器的平均值低于的平均值高于或等于使用分析器作为字典键温度数据湿度数据字典中的分析器算术运算操作在我们通过内置的运算符需要频繁实现一些非常规四则运算时可以重写四则运算方法通过这样来快速的进行数学运算分析方法名描述触发方式使用场景加法自定义对象相加减法自定义对象相减乘法自定义对象相乘除法自定义对象相除实际应用场景向量运算向量加法支持向量与标量相加不支持的操作数类型向量减法不支持的操作数类型向量乘法点积或标量乘法向量点积向量与标量相乘不支持的操作数类型向量除法仅支持标量除法除数不能为零向量只能被标量除向量长度单位向量使用示例向量加法向量减法向量点积向量缩放向量除法向量长度和归一化的长度的单位向量单位向量的长度属性访问控制方法名描述触发方式使用场景获取不存在的属性不存在处理不存在的属性访问设置属性拦截所有属性赋值删除属性拦截属性删除实际应用场景属性验证与保护存储实际数据保护的属性列表当访问不存在的属性时调用记录未知属性访问并返回警告尝试访问不存在的属性拦截所有属性赋值允许设置内部属性是受保护的属性不能直接赋值验证并存储数据年龄必须是整数年龄必须在之间无效的电子邮件格式存储验证后的数据属性设置为拦截属性删除是受保护的属性不能删除已删除属性属性不存在无法删除使用示例设置属性经过验证通过验证通过验证三十类型错误错误尝试访问不存在的属性返回并显示警告尝试删除属性正常删除尝试删除受保护属性错误显示当前属性上下文管理语句方法名描述触发方式使用场景进入上下文资源获取连接建立等退出上下文块结束资源释放异常处理等实际应用场景数据库连接管理进入上下文时建立连接连接到数据库退出上下文时处理异常并关闭连接发生异常时回滚事务发生异常回滚事务异常信息没有异常时提交事务提交事务关闭数据库连接返回表示不抑制异常让异常继续传播返回表示抑制异常异常不会传播到语句之外不抑制异常数据库未连接开始事务数据库未连接执行模拟错误语法错误语法错误执行结果数据库未连接提交事务数据库未连接回滚事务使用示例正常情况正常执行自动提交事务并关闭连接使用示例异常情况有异常情况这会触发异常这一行不会执行由于异常这行不会执行捕获到异常描述符与属性装饰器描述符协议方法方法描述触发条件使用场景获取属性值访问属性时触发自定义属性访问行为设置属性值属性赋值时触发验证或转换属性值删除属性删除属性时触发自定义属性删除行为实际应用场景数据验证描述符使用示例创建有效的对象张三尝试设置无效的值李名字太短验证错误三十类型错误类型错误无效的邮箱格式验证错误设置有效值李四更新后属性装饰器实际应用属性装饰器是中实现属性的更简洁方式它允许我们用方法行为来定义属性以下是一个成绩管理系统的示例课程分数的映射日期出勤状态的映射学生姓名只读属性学生只读属性获取成绩副本防止外部直接修改添加或更新课程成绩成绩必须是数字成绩必须在到之间计算平均成绩计算绩点成绩到绩点的映射计算每门课的绩点记录出勤状态出勤状态必须是或计算出勤率默认迟到计为次出勤学生平均分使用示例王小明添加课程成绩数学物理化学语文记录出勤访问属性学生姓名学生课程成绩平均分出勤率尝试修改只读属性张三这会失败因为是只读属性错误显示所有课程及分数所有课程成绩常见特殊方法使用陷阱与最佳实践陷阱与注意事项陷阱混淆这两个方法的用途和调用顺序最佳实践除非实现元类或单例模式一般只需重写错误示例错误返回元组而非同类型的对象正确示例正确返回同类型对象和陷阱实现而不实现导致对象无法用作字典键最佳实践如果重写也应该重写或设置使对象不可哈希如果不实现对象将不可哈希选项使对象不可哈希选项实现兼容的哈希方法递归问题陷阱在特殊方法中无限递归调用自身最佳实践避免在特殊方法中使用可能触发同一方法的操作错误这会导致无限递归递归调用正确使用原始值和陷阱不了解这两个方法的优先级和用途最佳实践优先于对于集合类实现对于真假逻辑实现返回集合长度特殊逻辑即使长度为如果有特定标记也认为是反向方法失效陷阱忽略实现反向操作方法如最佳实践为算术操作同时实现普通方法和反向方法普通加法告诉尝试反向操作反向加法测试触发总结特殊方法的选择指南需求推荐实现的特殊方法注意事项初始化和配置对象保持简单仅做必要设置自定义对象创建谨慎使用主要用于元类和单例字符串表示应提供准确代表对象的信息集合或容器行为保持与内置类型一致的行为对象比较和哈希注意和的兼容性算术运算以及对应的反向方法对不兼容类型返回属性访问控制注意避免递归调用资源管理确保资源正确释放处理异常描述符协议用于创建可重用的属性行为对象与类的高级概念深入理解实例类和元类关系定义一个普通类创建类的实例打印并验证三个层次的关系三个层次的关系实例的类是类的类是元类是自己的元类打印并验证继承关系继承关系所有类都继承自也继承自打印并验证元类关系元类关系实例的类型是类的类型是的类型也是展示类型检查类型检查是的实例是的实例是自己的实例属性查找的复杂情况实现自定义元类并定义元类方法元类属性调用元方法父类属性调用父类方法子类属性调用子类方法对象属性查找子类属性首先在实例中查找然后是类然后是父类类属性查找子类属性首先在类中查找然后是父类然后是元类方法查找调用子类方法调用父类方法从父类继承元类方法调用元方法从元类获取删除子类属性回退到父类父类属性删除父类属性回退到元类元类属性内存管理与对象生命周期对象创建和销毁的完整过程阶段触发方法描述创建分配内存并创建实例初始化初始化实例属性表示定义对象的字符串表示使用各种操作符和方法对象的正常使用期销毁对象不再被引用时的清理分配内存初始化对象清理资源在销毁时仍未释放创建和使用对象调用调用使用资源使用资源两种清理方式显式释放推荐依赖垃圾回收不推荐删除引用触发垃圾回收引用计数和循环引用的内存管理主要依靠引用计数每个对象都有一个引用计数器记录有多少个引用指向该对象当引用计数降为时对象会被自动销毁内存被释放函数可以查看对象的引用计数创建节点删除节点创建节点创建循环引用循环引用创建弱引用或保存以便后续检查删除外部引用删除对节点的外部引用垃圾回收前检查对象是否还存在节点仍然存在于内存中手动触发垃圾回收强制运行垃圾回收垃圾回收后再次检查对象是否存在节点已被回收不可能进这个判断因为存在计数引用和循环引用问题高级常用设计模式单例模式或使用元类实现若没有实例化过则新建一个实例返回的实例或使用装饰器实现单例模式装饰器参数是被装饰的类当使用语法时解释器会自动将被装饰的类作为第一个参数传递给装饰器函数装饰器工作原理当使用装饰时实际上执行了函数接收作为参数返回函数该函数替代了原始的当我们调用时实际上调用的是函数内部可以访问因为它是一个闭包能够访问外部函数的变量用于存储每个类的单例实例如果该类的实例不存在则创建一个新实例返回该类的单例实例这里相当于懒汉式单例模式的使用场景我是单例的在模块级别创建实例其他文件中使用输出我是单例的懒汉式单例模式在以下情况特别适用资源密集型对象当创建实例需要消耗大量资源如数据库连接文件系统操作等懒汉式可以推迟实例化直到真正需要时才创建创建新的数据库连接初始化只在首次创建时执行连接到配置管理器应用程序的配置管理器通常是单例的且配置加载可能很耗时从文件加载配置模拟加载配置文件的耗时操作应用程序状态管理当需要全局访问应用状态但又不希望在程序启动时立即初始化时元类实现方式适合需要更灵活控制实例化过程的场景特别是需要根据参数动态决定实例化行为的情况日志管理器单例可以根据不同的日志级别创建不同配置的单例组合键针对每个日志级别创建唯一实例创建级别的日志记录器装饰器实现方式适合需要将现有类转换为单例而不修改其内部代码的场景第三方库类转换为单例将外部库中的类转换为单例饿汉式单例模式的使用场景饿汉式单例模式最适合以下场景必然会使用的核心服务如应用程序中必定会使用的服务组件初始化事件总线模块级别立即创建实例在其他文件中使用应用程序设置和常量包含应用配置的单例对象加载应用程序设置立即创建全局设置对象线程安全要求高的场景饿汉式单例天然线程安全适合多线程环境初始化线程池线程池初始化代码提交任务到线程池任务提交逻辑程序启动时即创建线程池工厂模式抽象产品具体产品工厂类使用工厂工厂模式在以下场景中特别有用插件架构当系统需要动态加载和使用不同的插件或扩展时主应用程序演示如何使用插件定义插件接口工厂方法模式的实现插件目录插件包初始化文件图片处理插件文本分析插件首先我们定义一个插件接口插件必须实现方法插件必须实现方法依照插件接口新建目录文件夹使目录成为一个包这允许我们使用的导入方式列出所有可用的插件模块名方便外部遍历图片处理插件处理图片数据实际项目中这里会有图片处理逻辑例如调整大小滤镜裁剪等已处理的图片图片处理插件文本处理插件分析文本共个单词实际项目中这里会有更复杂的文本分析逻辑例如情感分析关键词提取语法检查等文本分析插件重点在我们的插件创建者的抽象基类工厂方法模式的核心动态导入插件模块获取插件类约定插件类名为模块名首字母大写创建并返回插件实例这里直接导入具体类不再使用动态导入这里直接导入具体类不再使用动态导入工厂注册表用于根据名称获取对应的工厂插件工厂注册表如果没有具体工厂则使用动态加载工厂使用我们的插件工厂与插件主应用程序演示如何使用插件系统插件系统演示工厂方法模式存储已加载的插件列出所有可用插件可用插件列表使用工厂方法模式加载所有可用插件获取插件创建者获取插件信息创建插件实例已加载插件类型加载插件失败使用图片处理插件使用图片处理插件模拟图片数据处理结果图片处理插件未加载使用文本分析插件使用文本分析插件要分析的文本分析结果文本分析插件未加载演示自定义插件创建演示自定义插件创建直接使用特定的创建者通过具体工厂直接创建插件动态注册一个新工厂注册自定义工厂自定义工厂信息自定义插件创建失败演示完成跨平台应用程序根据不同操作系统创建适当的组件使用场景根据当前操作系统渲染适当的按钮数据库访问层根据配置选择不同的数据库实现使用场景从配置创建适当的数据库连接测试替身创建在测试环境中替换真实依赖项测试场景观察者模式观察者列表当前状态注册观察者注册成功注销观察者注销成功不在观察者列表中通知观察者定义和方法名称为的观察者收到的更新使用观察者模式观察者观察者注册观察者注册观察者状态通知观察者状态通知观察者观察者模式在以下场景中非常有效事件驱动的系统如应用程序响应用户操作主题被观察者添加观察者移除观察者通知所有观察者观察者接口观察者接收通知后执行的方法具体观察者登录处理器模拟用户数据库登录请输入用户名和密码登录成功欢迎登录成功欢迎回来用户名或密码错误登录失败用户名或密码错误创建应用程序登录示例创建中央部件和布局创建用户名和密码输入框用户名请输入用户名密码请输入密码创建状态标签请登录创建按钮登录创建主题创建观察者注册观察者连接按钮点击事件添加部件到布局设置中央部件显示窗口发布订阅系统多个组件需要对特定事件做出响应收到新闻使用场景新闻分发系统用户用户今天是个好日子所有订阅者都会收到通知数据变更监控当对象状态变化需要通知其他对象时图表更新为新值表格更新为新值使用场景架构中的数据更新自动通知所有视图更新系统监控监控系统状态变化并触发警报正常发送邮件警报服务器状态变为发送短信警报服务器状态变为使用场景服务器监控系统严重错误触发所有警报代理模式代理模式是一种结构型设计模式它为其他对象提供了一种代理以控制对这些对象的访问可以把代理模式理解为一个守门员在客户和真实对象之间充当中介控制请求的传递和处理就像你想看一部付费电影时需要先通过一个守门员确认你是否支付了费用这名守门员就是代理他会在你访问电影资源之前先做一些检查确保你有权利观看接下来我们通过代码展示如何在中实现一些常用的代理模式静态代理动态代理保护代理虚拟代理静态代理实现静态代理在编译时确定代理行为非常适合结构固定的场景真实对象请求被调用代理在真实对象之前检查权限代理控制访问代理在真实对象之后记录日志使用代理动态代理实现动态代理可以在运行时动态地为对象添加功能而不需要在编译时确定定义一个装饰器打印函数执行时间执行时间秒正在执行任务使用动态代理保护代理实现保护代理是一种常见的应用场景用于控制对对象的访问权限下面的例子展示了如何实现一个简单的保护代理访问执行敏感操作权限不足使用保护代理权限不足虚拟代理实现虚拟代理用于控制昂贵资源的延迟加载只有在真正需要时才创建对象加载大量数据资源已加载执行操作使用虚拟代理首次调用会加载数据第二次调用不会再次加载数据原则原则概述是面向对象设计的五个核心原则的首字母缩写由罗伯特马丁在世纪早期提出这些原则旨在帮助开发者创建易于维护和扩展的软件系统原则包括原则全称简述单一职责原则一个类应该只有一个引起它变化的原因开放封闭原则软件实体应该对扩展开放对修改关闭里氏替换原则子类必须能够替换其基类使用接口隔离原则不应强制客户依赖于它们不使用的接口依赖倒置原则依赖抽象而不是具体实现遵循这些原则可以创建出更加灵活可维护可扩展的代码减少系统的脆弱性和紧耦合性提高代码的复用性和可测试性接下来我们将通过电商系统的实例逐一深入解析这些原则单一职责原则原则解析定义一个类应该只有一个引起它变化的原因核心思想每个类或模块只负责一项职责将不同的职责分离到不同的类中优势提高代码的内聚性降低类的复杂度增强代码的可维护性降低变更引起的风险电商系统中的应用让我们看看电商系统中如何应用单一职责原则在许多不遵循的系统中我们可能会看到一个超级类包含了所有与订单相关的功能违反单一职责原则的示例添加商品移除商品计算总价处理支付发送确认邮件处理配送保存到数据库这个类违反了单一职责原则它同时承担了多项职责处理订单项目计算金额处理支付发送通知处理配送数据存储等遵循的实现按照单一职责原则我们应该将不同职责分离到不同的类中订单模型类只负责订单的基本属性和状态仅负责添加商品到订单仅负责从订单中移除商品仅负责计算订单总价支付处理类专门负责支付相关功能专门处理信用卡支付处理的信用卡支付专门处理支付宝支付处理的支付宝支付专门处理微信支付处理的微信支付通知服务类专门负责通知功能通知订单创建向发送订单创建通知通知订单发货向发送订单发货通知通知订单取消向发送订单取消通知订单仓储类专门负责数据存储专门负责订单持久化将订单保存到数据库专门负责查询订单从数据库查询订单通过这样的设计我们将不同的职责分离到不同的类中每个类只负责一个特定的功能符合单一职责原则开放封闭原则原则解析定义软件实体类模块函数等应该对扩展开放对修改封闭核心思想当需要添加新功能时应该通过扩展现有代码如添加新类新方法而不是修改现有代码优势提高系统稳定性减少现有代码的改动和破坏提高代码的可复用性降低维护成本电商系统中的应用考虑支付处理的场景如果没有遵循开放封闭原则我们可能会这样实现违反开放封闭原则的示例处理信用卡支付处理的信用卡支付处理支付宝支付处理的支付宝支付处理微信支付处理的微信支付不支持的支付方式这个设计违反了开放封闭原则因为每当我们想添加新的支付方式如都需要修改这个类的代码添加新的条件分支遵循的实现按照开放封闭原则我们应该通过抽象接口和多态来实现支付处理定义支付处理接口处理支付获取支付方式名称实现具体支付处理器处理的信用卡支付信用卡支付处理的支付宝支付支付宝支付处理的微信支付微信支付创建支付处理器工厂不支持的支付方式现在如果我们想添加新的支付方式如只需要创建一个新的类实现接口将其添加到的映射中无需修改现有代码只需扩展新功能完全符合开放封闭原则里氏替换原则原则解析定义子类型必须能够替换其基类型使用核心思想继承类应当能够替代其父类使用而不改变程序的正确性子类应当保持父类的行为约定优势确保类的层次结构设计合理增强代码的可复用性提高系统的健壮性保证面向对象设计的正确性电商系统中的应用考虑配送方式的实现如果违反里氏替换原则我们可能会遇到这样的情况违反里氏替换原则的示例计算标准运费获取估计送达天数快递费用比标准运费高快递比标准配送快免费配送不提供送达时间估计返回而不是整数违反了父类的行为约定在上面的例子中类违反了里氏替换原则因为它的方法返回了而不是整数这与父类的行为约定不一致如果有代码依赖于的返回值是整数那么使用时可能会导致错误遵循的实现以下是遵循里氏替换原则的配送方式实现计算运费获取预计配送天数标准配送快速配送免费配送仍然返回整数保持与父类一致的行为约定免费配送较慢免费配送现在所有的配送方式类都符合里氏替换原则它们都保持了父类的行为约定返回数值返回整数接口隔离原则原则解析定义客户端不应该被迫依赖于它们不使用的接口核心思想一个类不应该依赖于它不需要的接口接口应该是小而精的一个大而全的接口应该被拆分为多个小接口优势提高接口的聚合度减少冗余的接口实现提高系统的灵活性和可扩展性降低接口之间的耦合度电商系统中的应用考虑订单通知的场景违反接口隔离原则的设计可能如下违反接口隔离原则的示例通知订单创建通知订单配送通知订单取消发送短信通知发送邮件通知发送推送通知这个接口违反了接口隔离原则因为它强制所有实现类都必须实现所有方法例如一个邮件通知实现类可能不需要实现或推送通知的方法遵循的实现按照接口隔离原则我们应该将大接口拆分为多个小接口通知订单创建通知订单配送通知订单取消发送邮件发送短信发送推送通知然后实现类可以选择性地实现它们需要的接口向发送订单创建通知订单已创建您的订单已创建向发送订单配送通知订单已发货您的订单已发货向发送订单取消通知订单已取消您的订单已取消发送邮件到主题向手机号发送订单创建短信通知您的订单已创建向手机号发送订单配送短信通知您的订单已发货向手机号发送订单取消短信通知您的订单已取消发送短信到实际应用中应该从订单中获取电话号码通过这种方式每个实现类只需要实现它关心的接口符合接口隔离原则依赖倒置原则原则解析定义高层模块不应该依赖于低层模块两者都应该依赖于抽象抽象不应该依赖于细节细节应该依赖于抽象核心思想通过引入抽象层如接口抽象类来解耦高层和低层模块实现可扩展性和可维护性优势降低模块间的耦合度提高代码的可重用性方便系统的单元测试提高系统的可扩展性电商系统中的应用考虑订单服务与数据持久化的关系违反依赖倒置原则的设计可能如下违反依赖倒置原则的示例直接依赖具体的实现插入订单数据查询订单数据这个设计违反了依赖倒置原则高层模块直接依赖于低层模块如果我们想切换到其他数据库需要修改类的代码遵循的实现按照依赖倒置原则我们应该让高层和低层模块都依赖于抽象定义订单仓储接口抽象保存订单根据查找订单列出所有订单实现具体的订单仓储类具体的实现保存订单到将订单保存到数据库实际的操作从数据库查询订单实际的查询从数据库查询所有订单实际的查询修改订单服务依赖抽象接口依赖抽象接口而不是具体实现通过这种设计依赖于抽象接口和而不是具体实现这样我们可以轻松地替换具体实现例如从切换到只需要提供一个新的实现类而不需要修改的代码中的是一个特殊的类变量它可以限制类的实例能拥有的属性节省内存并提高性能的工作原理与性能优势不使用的普通类使用的类创建实例检查内存使用实例大小字节实例大小字节检查属性字典有有属性访问性能比较测量访问性能访问属性时间秒访问属性时间秒的限制和继承行为行为测试实例可以访问实例可以访问尝试设置未在中定义的属性无法设置属性检查实例字典有",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-06-17 17:51:07",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0F1C2E')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#cee8ff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/index_media.css" media="(max-width:0),screen and (prefers-reduced-motion:reduce)" onload="this.media=`screen`"><link rel="stylesheet" href="/css/post-ui.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="后续项目..."><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="后续项目..."><span class="back-menu-item-text">后续项目...</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">格物致知</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)" rel="external nofollow noreferrer">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>个人</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fas fa-check-double faa-tada"></i><span> 代办清单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>预览</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?server=netease&amp;id=3117791189"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fas fa-comments faa-tada"></i><span> 评论总览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 即刻短文</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="background-change-button"><a class="site-page" onclick="toggleWinbox()" title="切换背景" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-palette"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li></ul></div></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);" rel="external nofollow noreferrer"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url">后端技术</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Python/" itemprop="url">Python</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Python-%E8%AF%AD%E6%B3%95%E7%AF%87/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>Python-语法篇</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Python语法前篇（十二）：第十一章：面向对象编程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-28T08:13:45.000Z" title="发表于 2025-06-28 16:13:45">2025-06-28</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-06-17T09:51:07.164Z" title="更新于 2025-06-17 17:51:07">2025-06-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span data-flag-title="Python语法前篇（十二）：第十一章：面向对象编程"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为广东"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广东</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope="" itemtype="https://prorise-cool.github.io/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"><header><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url">后端技术</a><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Python/" itemprop="url">Python</a><a href="/tags/Python-%E8%AF%AD%E6%B3%95%E7%AF%87/" tabindex="-1" itemprop="url">Python-语法篇</a><h1 id="CrawlerTitle" itemprop="name headline">Python语法前篇（十二）：第十一章：面向对象编程</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">Prorise</span><time itemprop="dateCreated datePublished" datetime="2025-06-28T08:13:45.000Z" title="发表于 2025-06-28 16:13:45">2025-06-28</time><time itemprop="dateCreated datePublished" datetime="2025-06-17T09:51:07.164Z" title="更新于 2025-06-17 17:51:07">2025-06-17</time></header><div id="postchat_postcontent"><h2 id="第十一章：面向对象编程"><a href="#第十一章：面向对象编程" class="headerlink" title="第十一章：面向对象编程"></a>第十一章：面向对象编程</h2><h3 id="对象的本质"><a href="#对象的本质" class="headerlink" title="对象的本质"></a>对象的本质</h3><p><strong><span style="color:red">对象本质上是一个 “容器”，用来存放数据和功能的集合体。面向对象编程的核心思想是将数据和操作数据的方法封装在一起，形成独立的实体。</span></strong></p><h4 id="为什么需要对象"><a href="#为什么需要对象" class="headerlink" title="为什么需要对象"></a>为什么需要对象</h4><p>以开发 MOBA 游戏为例，每个英雄都有自己的属性（如攻击力、移动速度）和功能（如技能）。如果不使用对象，代码会变得非常冗余：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 不使用对象的方式</span></span><br><span class="line">hero_work = <span class="string">'soldier'</span></span><br><span class="line">hero_name = <span class="string">'盖伦'</span></span><br><span class="line">hero_atk = <span class="number">165</span></span><br><span class="line">hero_speed = <span class="number">475</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hero_info</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'我的名字是<span class="subst">{hero_name}</span>,职业是<span class="subst">{hero_work}</span>,攻击力是<span class="subst">{hero_atk}</span>,移动速度是<span class="subst">{hero_speed}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hero_atk_up</span>(<span class="params">atk</span>):</span><br><span class="line">    <span class="keyword">global</span> hero_atk</span><br><span class="line">    hero_atk += atk</span><br><span class="line"></span><br><span class="line"><span class="comment">## 第二个英雄</span></span><br><span class="line">hero_work2 = <span class="string">'ADC'</span></span><br><span class="line">hero_name2 = <span class="string">'后裔'</span></span><br><span class="line">hero_atk2 = <span class="number">150</span></span><br><span class="line">hero_speed2 = <span class="number">450</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hero_info2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'我的名字是<span class="subst">{hero_name2}</span>,职业是<span class="subst">{hero_work2}</span>,攻击力是<span class="subst">{hero_atk2}</span>,移动速度是<span class="subst">{hero_speed2}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hero_atk_up2</span>(<span class="params">atk</span>):</span><br><span class="line">    <span class="keyword">global</span> hero_atk2</span><br><span class="line">    hero_atk2 += atk</span><br></pre></td></tr></tbody></table></figure><p>使用字典可以改进一些，如下、但这样还是有一些瑕疵，因为函数是暴露在外面的，最理想的状态是函数也存在在 hero_obj 这个对象里</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hero_info</span>(<span class="params">hero_obj</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'我的名字是<span class="subst">{hero_obj[<span class="string">"name"</span>]}</span>,职业是<span class="subst">{hero_obj[<span class="string">"work"</span>]}</span>,攻击力是<span class="subst">{hero_obj[<span class="string">"atk"</span>]}</span>'</span></span><br><span class="line">          <span class="string">f',移动速度是<span class="subst">{hero_obj[<span class="string">"speed"</span>]}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hero_atk_up</span>(<span class="params">hero_obj, atk</span>):</span><br><span class="line">   hero_obj[<span class="string">"atk"</span>] += atk</span><br><span class="line"></span><br><span class="line">hero_obj = {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'盖伦'</span>,</span><br><span class="line">    <span class="string">'work'</span>: <span class="string">'soldier'</span>,</span><br><span class="line">    <span class="string">'atk'</span>: <span class="number">165</span>,</span><br><span class="line">    <span class="string">'speed'</span>: <span class="number">475</span>,</span><br><span class="line">    <span class="string">'info'</span>: hero_info,</span><br><span class="line">    <span class="string">'atk_up'</span>: hero_atk_up</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>在对象中，还有类的这么一个概念，比如说又新创建了一个“艾希”英雄，他与后裔的差别无非就是 ATK 与 Speed 是不一致的，但他们都同属于 ADC 这个职业，所以他们就可以存在在一个 ADC 类里面，在面向对象编程里面，是先创建一个类，再将对象创建出来，所以类也算是一种容器，他也可以被称作是对象</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hero</span>:</span><br><span class="line">    work = <span class="string">'ADC'</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_info</span>(<span class="params">hero_obj</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'我的名字是<span class="subst">{hero_obj[<span class="string">"name"</span>]}</span>,职业是<span class="subst">{hero_obj[<span class="string">"work"</span>]}</span>,攻击力是<span class="subst">{hero_obj[<span class="string">"atk"</span>]}</span>'</span></span><br><span class="line">              <span class="string">f',移动速度是<span class="subst">{hero_obj[<span class="string">"speed"</span>]}</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_atk_up</span>(<span class="params">hero_obj,atk</span>):</span><br><span class="line">       hero_obj[<span class="string">"atk"</span>] += atk</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'xxx'</span>) <span class="comment"># 在程序运行时，类的子代码会被运行，也就代表类在定义阶段就已经创建好了名称空间</span></span><br><span class="line"><span class="comment"># 在python里面类的名称空间中，会默认创建一个__dict__的字典属性</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(Hero.__dict__)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"><span class="comment"># {'__module__': '__main__', 'work': 'ADC', 'hero_info': &lt;function Hero.hero_info at 0x00000226DA7B8C10&gt;, 'hero_atk_up': &lt;function Hero.hero_atk_up at 0x00000226DA7B9820&gt;, '__dict__': &lt;attribute '__dict__' of 'Hero' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Hero' objects&gt;, '__doc__': None}</span></span><br><span class="line"><span class="comment"># 所以想要拿到类的属性，实际上访问的是类名称空间中的__dict__字典属性</span></span><br><span class="line"><span class="built_in">print</span>(Hero.__dict__[<span class="string">'work'</span>]) <span class="comment"># ADC</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># python提供了一个更简便的语法，也就是通过类名.属性名来访问的</span></span><br><span class="line"><span class="built_in">print</span>(Hero.work) <span class="comment"># ADC</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"><span class="comment"># 每次调用一个类就会产生一个对象，此时这个对象里面的Dict是空的，需要添加值</span></span><br><span class="line">hero_obj = Hero()</span><br><span class="line">hero_obj2 = Hero()</span><br><span class="line">hero_obj3 = Hero()</span><br><span class="line"><span class="built_in">print</span>(hero_obj.__dict__) <span class="comment"># {}</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(hero_obj2.__dict__) <span class="comment"># {}</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(hero_obj3.__dict__) <span class="comment"># {}</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"><span class="comment"># 给对象添加属性</span></span><br><span class="line">hero_obj.__dict__[<span class="string">'name'</span>] = <span class="string">'亚瑟'</span></span><br><span class="line">hero_obj.__dict__[<span class="string">'work'</span>] = <span class="string">'tank'</span></span><br><span class="line">hero_obj.__dict__[<span class="string">'atk'</span>] = <span class="number">100</span></span><br><span class="line">hero_obj.__dict__[<span class="string">'speed'</span>] = <span class="number">300</span></span><br><span class="line"><span class="comment"># 可是通过这种方式过于复杂，python也提供了简便的语法</span></span><br><span class="line">hero_obj2.name = <span class="string">'妲己'</span></span><br><span class="line">hero_obj2.work = <span class="string">'mage'</span></span><br><span class="line">hero_obj2.atk = <span class="number">120</span></span><br><span class="line">hero_obj2.speed = <span class="number">350</span></span><br><span class="line"></span><br><span class="line">hero_obj3.name = <span class="string">'后裔'</span></span><br><span class="line">hero_obj3.work = <span class="string">'ADC'</span></span><br><span class="line">hero_obj3.atk = <span class="number">150</span></span><br><span class="line">hero_obj3.speed = <span class="number">450</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(hero_obj.__dict__) <span class="comment"># {'name': '亚瑟', 'work': 'tank', 'atk': 100, 'speed': 300}</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(hero_obj2.__dict__) <span class="comment"># {'name': '妲己', 'work': 'mage', 'atk': 120, 'speed': 350}</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(hero_obj3.__dict__) <span class="comment"># {'name': '后裔', 'work': 'ADC', 'atk': 150, 'speed': 450}</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'='</span>*<span class="number">50</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="init-方法"><a href="#init-方法" class="headerlink" title="__init__ 方法"></a><code>__init__</code> 方法</h3><p>为了减少代码冗余，我们可以定义一个初始化方法，在创建对象时自动设置属性：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hero</span>:</span><br><span class="line">    work = <span class="string">'ADC'</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_info</span>(<span class="params">hero_obj</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'我的名字是<span class="subst">{hero_obj[<span class="string">"name"</span>]}</span>,职业是<span class="subst">{hero_obj[<span class="string">"work"</span>]}</span>,攻击力是<span class="subst">{hero_obj[<span class="string">"atk"</span>]}</span>'</span></span><br><span class="line">              <span class="string">f',移动速度是<span class="subst">{hero_obj[<span class="string">"speed"</span>]}</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_atk_up</span>(<span class="params">hero_obj,atk</span>):</span><br><span class="line">       hero_obj[<span class="string">"atk"</span>] += atk</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'xxx'</span>) <span class="comment"># 在程序运行时，类的子代码会被运行，也就代表类在定义阶段就已经创建好了名称空间</span></span><br><span class="line"></span><br><span class="line">hero1_obj = Hero()</span><br><span class="line">hero2_obj = Hero()</span><br><span class="line">hero3_obj = Hero()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">hero_obj,name,work,atk,speed</span>):</span><br><span class="line">    hero_obj.name = name</span><br><span class="line">    hero_obj.work = work</span><br><span class="line">    hero_obj.atk = atk</span><br><span class="line">    hero_obj.speed = speed</span><br><span class="line"></span><br><span class="line">init(hero1_obj,<span class="string">'后裔'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line">init(hero2_obj,<span class="string">'程咬金'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line">init(hero3_obj,<span class="string">'妲己'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(hero1_obj.__dict__) <span class="comment"># {'name': '后裔', 'work': 'ADC', 'atk': 150, 'speed': 450}</span></span><br><span class="line"><span class="built_in">print</span>(hero2_obj.__dict__) <span class="comment"># {'name': '程咬金', 'work': 'ADC', 'atk': 150, 'speed': 450}</span></span><br><span class="line"><span class="built_in">print</span>(hero3_obj.__dict__) <span class="comment"># {'name': '妲己', 'work': 'ADC', 'atk': 150, 'speed': 450}</span></span><br></pre></td></tr></tbody></table></figure><p>这还不够完美，面向对象的核心思想就是整合两个字，现在定义的这个函数和类是完全独立开的，那有没有什么办法能把这个 init 函数，和前面定义的类进一步整合到一起呢，最好是产生对象的时候，就自动调用 init 这个功能，完成对象属性的初始化操作，这时候拿到的对象就是有自己独有属性的对象</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hero</span>:</span><br><span class="line">    work = <span class="string">'ADC'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">hero_obj, name, work, atk, speed</span>):</span><br><span class="line">        hero_obj.name = name</span><br><span class="line">        hero_obj.work = work</span><br><span class="line">        hero_obj.atk = atk</span><br><span class="line">        hero_obj.speed = speed</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_info</span>(<span class="params">hero_obj</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'我的名字是<span class="subst">{hero_obj.__dict__[<span class="string">"name"</span>]}</span>,职业是<span class="subst">{hero_obj.__dict__[<span class="string">"work"</span>]}</span>,攻击力是<span class="subst">{hero_obj.__dict__[<span class="string">"atk"</span>]}</span>'</span></span><br><span class="line">              <span class="string">f',移动速度是<span class="subst">{hero_obj.__dict__[<span class="string">"speed"</span>]}</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_atk_up</span>(<span class="params">hero_obj,atk</span>):</span><br><span class="line">       hero_obj.__dict__[<span class="string">"atk"</span>] += atk</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'xxx'</span>) <span class="comment"># 在程序运行时，类的子代码会被运行，也就代表类在定义阶段就已经创建好了名称空间</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在我们调用类自动创建对象的时候,python内部会自动调用类下面的__init__方法并传入一个空对象，所以在实际传值时仅需要传入四个参数即可</span></span><br><span class="line">hero1_obj = Hero(<span class="string">'后裔'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>) <span class="comment"># Hero.__init__(空对象,name,work,atk,speed)</span></span><br><span class="line">hero2_obj = Hero(<span class="string">'程咬金'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line">hero3_obj = Hero(<span class="string">'妲己'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(hero1_obj.__dict__) <span class="comment"># {'name': '后裔', 'work': 'ADC', 'atk': 150, 'speed': 450}</span></span><br><span class="line"><span class="built_in">print</span>(hero2_obj.__dict__) <span class="comment"># {'name': '程咬金', 'work': 'ADC', 'atk': 150, 'speed': 450}</span></span><br><span class="line"><span class="built_in">print</span>(hero3_obj.__dict__) <span class="comment"># {'name': '妲己', 'work': 'ADC', 'atk': 150, 'speed': 450}</span></span><br><span class="line"></span><br><span class="line">hero1_obj.hero_info() <span class="comment"># 我的名字是后裔,职业是ADC,攻击力是150,移动速度是450</span></span><br><span class="line">hero2_obj.hero_info() <span class="comment"># 我的名字是程咬金,职业是ADC,攻击力是150,移动速度是450</span></span><br><span class="line">hero3_obj.hero_info() <span class="comment"># 我的名字是妲己,职业是ADC,攻击力是150,移动速度是450</span></span><br></pre></td></tr></tbody></table></figure><p>进一步修改代码，通过 dict [] 拿属性过于繁杂，所以也可以用到类名.属性名的方式来传值给函数，并且在代码最后，在打印函数的内存地址的时候会发现打印类里的函数是一个正常的函数，而打印对象的函数方法则是一个绑定方法，也就是说类的函数属性，<code>绑定给对象使用了之后，就不再是一个普通函数</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hero</span>:</span><br><span class="line">    work = <span class="string">'ADC'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">hero_obj, name, work, atk, speed</span>):</span><br><span class="line">        hero_obj.name = name</span><br><span class="line">        hero_obj.work = work</span><br><span class="line">        hero_obj.atk = atk</span><br><span class="line">        hero_obj.speed = speed</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_info</span>(<span class="params">hero_obj</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'我的名字是<span class="subst">{hero_obj.name}</span>,职业是<span class="subst">{hero_obj.work}</span>,攻击力是<span class="subst">{hero_obj.atk}</span>'</span></span><br><span class="line">              <span class="string">f',移动速度是<span class="subst">{hero_obj.speed}</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_atk_up</span>(<span class="params">hero_obj,atk</span>):</span><br><span class="line">       hero_obj.atk += atk</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'xxx'</span>) <span class="comment"># 在程序运行时，类的子代码会被运行，也就代表类在定义阶段就已经创建好了名称空间</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在我们调用类自动创建对象的时候,python内部会自动调用类下面的__init__方法并传入一个空对象，所以在实际传值时仅需要传入四个参数即可</span></span><br><span class="line">hero1_obj = Hero(<span class="string">'后裔'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>) <span class="comment"># Hero.__init__(空对象,name,work,atk,speed)</span></span><br><span class="line">hero2_obj = Hero(<span class="string">'程咬金'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line">hero3_obj = Hero(<span class="string">'妲己'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定方法</span></span><br><span class="line"><span class="built_in">print</span>(Hero.hero_info) <span class="comment"># &lt;function Hero.hero_info at 0x0000019021E39820&gt;</span></span><br><span class="line"><span class="built_in">print</span>(hero1_obj.hero_info)</span><br><span class="line"><span class="comment"># &lt;bound method Hero.hero_info of &lt;__main__.Hero object at 0x0000019021F13BE0&gt;&gt;</span></span><br><span class="line"><span class="built_in">print</span>(hero2_obj.hero_info)</span><br><span class="line"><span class="comment"># &lt;bound method Hero.hero_info of &lt;__main__.Hero object at 0x0000019021F13DC0&gt;&gt;</span></span><br><span class="line"><span class="built_in">print</span>(hero3_obj.hero_info)</span><br><span class="line"><span class="comment"># &lt;bound method Hero.hero_info of &lt;__main__.Hero object at 0x0000019021F4F940&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">hero1_obj.hero_atk_up(<span class="number">50000</span>)</span><br><span class="line">hero1_obj.hero_info()</span><br><span class="line">hero2_obj.hero_info()</span><br><span class="line">hero3_obj.hero_info()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 三个内存地址不一样并不代表代码就存了三份，代码本身只存了一份，因为类的作用就是为了减少计算机资源的浪费</span></span><br><span class="line"><span class="comment"># 可以理解为类的属性绑定给对象之后，这个函数的内存地址，就会被包装成一个绑定方法，或者也可以理解为</span></span><br><span class="line"><span class="comment"># 是一个装饰器，当通过对象访问这些函数的时候，访问的也是这个绑定方法的内存地址，而他在给函数传入值时</span></span><br><span class="line"><span class="comment"># 也会像init方法一样自动传入一个对象进去</span></span><br></pre></td></tr></tbody></table></figure><p>所以就能明白，在我们实例化对象传入参数时，他默认的第一个参数是一个对象，这个对象就是 self 对象，他仅仅只是一个变量名，在代码的规范角度来讲，类里面的函数的第一个对象就是 <code>self</code>，仅此而已</p><p>通过这种方式，只需要在 init 方法下增添需要的绑定方法，添加对应的函数功能，就能够实现谁调用这个对象的函数方法，就给谁增添对应的数据</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hero</span>:</span><br><span class="line">    work = <span class="string">'ADC'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, work, atk, speed</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.work = work</span><br><span class="line">        <span class="variable language_">self</span>.atk = atk</span><br><span class="line">        <span class="variable language_">self</span>.speed = speed</span><br><span class="line">        <span class="variable language_">self</span>.equipment = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'我的名字是<span class="subst">{self.name}</span>,职业是<span class="subst">{self.work}</span>,攻击力是<span class="subst">{self.atk}</span>'</span></span><br><span class="line">              <span class="string">f',移动速度是<span class="subst">{self.speed}</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hero_atk_up</span>(<span class="params">self,atk</span>):</span><br><span class="line">       <span class="variable language_">self</span>.atk += atk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">buy_equipment</span>(<span class="params">self,equipment</span>):</span><br><span class="line">        <span class="variable language_">self</span>.equipment.append(equipment)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'<span class="subst">{self.name}</span>购买了<span class="subst">{equipment}</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hero1_obj = Hero(<span class="string">'后裔'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line">hero2_obj = Hero(<span class="string">'程咬金'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line">hero3_obj = Hero(<span class="string">'妲己'</span>,<span class="string">'ADC'</span>,<span class="number">150</span>,<span class="number">450</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hero1_obj.buy_equipment(<span class="string">'屠龙宝刀966666'</span>)</span><br><span class="line">hero2_obj.buy_equipment(<span class="string">'屠龙宝刀966666'</span>)</span><br><span class="line"><span class="built_in">print</span>(hero3_obj.equipment) <span class="comment"># []</span></span><br></pre></td></tr></tbody></table></figure><h3 id="面向对象的三大特性"><a href="#面向对象的三大特性" class="headerlink" title="面向对象的三大特性"></a>面向对象的三大特性</h3><h4 id="1-封装"><a href="#1-封装" class="headerlink" title="1. 封装"></a>1. 封装</h4><p>封装是将数据和方法包装在对象内部，并向外界提供必要的接口，同时隐藏实现细节的过程。</p><h5 id="属性隐藏"><a href="#属性隐藏" class="headerlink" title="属性隐藏"></a>属性隐藏</h5><p>Python 使用名称修饰（name mangling）实现属性隐藏，即在属性名前加上双下划线：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hero</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, work, atk, speed</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">         <span class="variable language_">self</span>.work = work</span><br><span class="line">        <span class="variable language_">self</span>.__atk = atk  <span class="comment"># 私有属性</span></span><br><span class="line">        <span class="variable language_">self</span>.speed = speed</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__buy_equipment</span>(<span class="params">self, equipment</span>):  <span class="comment"># 私有方法</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'<span class="subst">{self.name}</span>购买了<span class="subst">{equipment}</span>'</span>)</span><br><span class="line">        </span><br><span class="line">hero = Hero(<span class="string">'后裔'</span>, <span class="string">'ADC'</span>, <span class="number">150</span>, <span class="number">450</span>)</span><br><span class="line"><span class="comment">## print(hero.__atk)  # AttributeError: 'Hero' object has no attribute '__atk'</span></span><br><span class="line"><span class="comment">## hero.__buy_equipment('无尽战刃')  # AttributeError</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 但这只是名称修饰，仍然可以通过修饰后的名称访问</span></span><br><span class="line"><span class="built_in">print</span>(hero._Hero__atk)  <span class="comment"># 150</span></span><br><span class="line">hero._Hero__buy_equipment(<span class="string">'无尽战刃'</span>)  <span class="comment"># 后裔购买了无尽战刃</span></span><br></pre></td></tr></tbody></table></figure><h5 id="属性访问控制"><a href="#属性访问控制" class="headerlink" title="属性访问控制"></a>属性访问控制</h5><p>为了更好地控制属性访问，可以使用 getter 和 setter 方法：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__name = name</span><br><span class="line">        <span class="variable language_">self</span>.__age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_age</span>(<span class="params">self, age</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(age, <span class="built_in">int</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'年龄必须为整数'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="variable language_">self</span>.__age = age</span><br><span class="line">    <span class="comment"># 相当于Java的toString()方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Person(name={}, age={})'</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>.__name, <span class="variable language_">self</span>.__age)</span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">'Alice'</span>, <span class="number">25</span>)</span><br><span class="line"><span class="built_in">print</span>(p.get_name()) <span class="comment"># Alice</span></span><br><span class="line"><span class="built_in">print</span>(p.get_age()) <span class="comment"># 25</span></span><br><span class="line">p.set_age(<span class="number">30</span>)  <span class="comment"># 设置年龄为 30</span></span><br><span class="line"><span class="built_in">print</span>(p.get_age()) <span class="comment"># 30</span></span><br></pre></td></tr></tbody></table></figure><h5 id="使用-property-装饰器"><a href="#使用-property-装饰器" class="headerlink" title="使用@property 装饰器"></a>使用@property 装饰器</h5><p>Python 的 <code>@property</code> 装饰器提供了更优雅的属性访问方式：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这段代码展示了Python中的属性装饰器(@property)的使用，它有以下意义：</span></span><br><span class="line"><span class="comment"># 1. 封装性：通过私有变量(__age)和属性装饰器，实现了对数据的封装和保护</span></span><br><span class="line"><span class="comment"># 2. 数据验证：在setter方法中可以对输入数据进行验证，确保数据的有效性</span></span><br><span class="line"><span class="comment"># 3. 接口一致性：虽然内部使用了方法，但对外提供了类似直接访问属性的简洁接口</span></span><br><span class="line"><span class="comment"># 4. 控制访问：可以分别控制属性的读取、修改和删除行为</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""获取年龄"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @age.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">age</span>(<span class="params">self, age</span>):</span><br><span class="line">        <span class="string">"""设置年龄"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(age, <span class="built_in">int</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'年龄必须为整数'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="variable language_">self</span>.__age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @age.deleter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""删除年龄属性"""</span></span><br><span class="line">        <span class="keyword">del</span> <span class="variable language_">self</span>.__age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">person = Person(<span class="number">25</span>)</span><br><span class="line"><span class="built_in">print</span>(person.age)  <span class="comment"># 使用getter</span></span><br><span class="line">person.age = <span class="number">30</span>  <span class="comment"># 使用setter</span></span><br><span class="line"><span class="keyword">del</span> person.age  <span class="comment"># 使用deleter</span></span><br></pre></td></tr></tbody></table></figure><h4 id="2-继承"><a href="#2-继承" class="headerlink" title="2. 继承"></a>2. 继承</h4><p>继承允许一个类（子类）继承另一个类（父类）的属性和方法。</p><h5 id="单继承和多继承"><a href="#单继承和多继承" class="headerlink" title="单继承和多继承"></a>单继承和多继承</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"吃"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):  <span class="comment"># 单继承</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bark</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"汪汪叫"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fly</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"飞翔"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyingDog</span>(Dog, Bird):  <span class="comment"># 多继承</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">dog = Dog()</span><br><span class="line">dog.eat()  <span class="comment"># 吃 (继承自Animal)</span></span><br><span class="line">dog.bark()  <span class="comment"># 汪汪叫</span></span><br><span class="line"></span><br><span class="line">flying_dog = FlyingDog()</span><br><span class="line">flying_dog.eat()    <span class="comment"># 吃 (继承自Animal)</span></span><br><span class="line">flying_dog.bark()   <span class="comment"># 汪汪叫 (继承自Dog)</span></span><br><span class="line">flying_dog.fly()    <span class="comment"># 飞翔 (继承自Bird)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看继承关系</span></span><br><span class="line"><span class="built_in">print</span>(Dog.__bases__)  <span class="comment"># (&lt;class '__main__.Animal'&gt;,)</span></span><br><span class="line"><span class="built_in">print</span>(FlyingDog.__bases__)  <span class="comment"># (&lt;class '__main__.Dog'&gt;, &lt;class '__main__.Bird'&gt;)</span></span><br></pre></td></tr></tbody></table></figure><h5 id="方法重写和调用父类方法"><a href="#方法重写和调用父类方法" class="headerlink" title="方法重写和调用父类方法"></a>方法重写和调用父类方法</h5><p>子类可以重写父类的方法，也可以通过 super()调用父类方法：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name,age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"我是<span class="subst">{self.name}</span>，今年<span class="subst">{self.age}</span>岁了"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name,age,breed</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name,age)</span><br><span class="line">        <span class="variable language_">self</span>.breed = breed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().info() <span class="comment"># 这里调用父类的info方法</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"我是<span class="subst">{self.name}</span>，我今年<span class="subst">{self.age}</span>岁了，我是属于<span class="subst">{self.breed}</span>品种的狗"</span>)</span><br><span class="line"></span><br><span class="line">dog = Dog(<span class="string">"旺财"</span>,<span class="number">2</span>,<span class="string">"哈士奇"</span>)</span><br><span class="line">dog.info()</span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># 我是旺财，今年2岁了 # 调用了父类的info方法</span></span><br><span class="line"><span class="comment"># 我是旺财，我今年2岁了，我是属于哈士奇品种的狗 # 重写了父类的info方法</span></span><br></pre></td></tr></tbody></table></figure><h5 id="继承的属性查找顺序-MRO"><a href="#继承的属性查找顺序-MRO" class="headerlink" title="继承的属性查找顺序 (MRO)"></a>继承的属性查找顺序 (MRO)</h5><p>Python 使用 C3 算法计算方法解析顺序(MRO)：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"基类的Info方法"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FirstChild</span>(<span class="title class_ inherited__">BaseClass</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"第一个子类的info方法"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecondChild</span>(<span class="title class_ inherited__">BaseClass</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"第二个子类的info方法"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MultipleInheritance</span>(FirstChild, SecondChild):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(MultipleInheritance.mro())</span><br><span class="line"><span class="comment">## 输出: [&lt;class '__main__.MultipleInheritance'&gt;, &lt;class '__main__.FirstChild'&gt;, &lt;class '__main__.SecondChild'&gt;, &lt;class '__main__.BaseClass'&gt;, &lt;class 'object'&gt;]</span></span><br><span class="line"><span class="comment"># 先是自己=&gt;再是第一个传入的类，第二个传入的类，最后是基类，最后是object</span></span><br><span class="line">instance = MultipleInheritance()</span><br><span class="line">instance.display_info()  <span class="comment"># FirstChild.display_info (按MRO顺序查找)</span></span><br></pre></td></tr></tbody></table></figure><h5 id="菱形继承问题"><a href="#菱形继承问题" class="headerlink" title="菱形继承问题"></a>菱形继承问题</h5><p>菱形继承（钻石继承）是指一个子类通过不同的路径继承了同一个基类：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Animal.make_sound"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Dog.make_sound"</span>)</span><br><span class="line">        <span class="built_in">super</span>().make_sound()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Cat.make_sound"</span>)</span><br><span class="line">        <span class="built_in">super</span>().make_sound()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CatDog</span>(Dog, Cat):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"CatDog.make_sound"</span>)</span><br><span class="line">        <span class="built_in">super</span>().make_sound()</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 菱形继承结构:</span></span><br><span class="line"><span class="comment">#       Animal</span></span><br><span class="line"><span class="comment">#      /      \</span></span><br><span class="line"><span class="comment">#    Dog      Cat</span></span><br><span class="line"><span class="comment">#      \      /</span></span><br><span class="line"><span class="comment">#       CatDog</span></span><br><span class="line"></span><br><span class="line">catdog = CatDog()</span><br><span class="line">catdog.make_sound()</span><br><span class="line"><span class="comment">## 输出:</span></span><br><span class="line"><span class="comment">## CatDog.make_sound</span></span><br><span class="line"><span class="comment">## Dog.make_sound</span></span><br><span class="line"><span class="comment">## Cat.make_sound</span></span><br><span class="line"><span class="comment">## Animal.make_sound</span></span><br></pre></td></tr></tbody></table></figure><p>在 Python 3 中，无论继承路径如何复杂，每个类在 MRO 中只会出现一次。</p><h5 id="MixIn-设计模式"><a href="#MixIn-设计模式" class="headerlink" title="MixIn 设计模式"></a>MixIn 设计模式</h5><p>MixIn 是一种设计模式，用于为类添加功能，而不使用传统继承关系：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SwimMixin</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">swim</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"I can swim"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyMixin</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fly</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"I can fly"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"I can eat"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span>(Animal, SwimMixin, FlyMixin):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">duck = Duck()</span><br><span class="line">duck.eat()   <span class="comment"># I can eat</span></span><br><span class="line">duck.swim()  <span class="comment"># I can swim</span></span><br><span class="line">duck.fly()   <span class="comment"># I can fly</span></span><br></pre></td></tr></tbody></table></figure><h4 id="3-多态"><a href="#3-多态" class="headerlink" title="3. 多态"></a>3. 多态</h4><p>多态是一种编程思想，在 python 中是没有多态这么一个技术的，比如汽车这种事物，他就有很多种形态，奔驰、宝马、奥拓这就叫多态、多态只是在继承下演化出来的一种概念而已，而我们要知道的是，为什么要有多态这个概念，奔驰宝马奥拓这都是可以跑的对吧，也就是说跑这个功能是汽车共有的功能，那我就在他们的共同的父类里面定义一个 run 方法</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'开始跑'</span>, end=<span class="string">' '</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Benz</span>(<span class="title class_ inherited__">Car</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().run()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'奔驰跑起来好快哦!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BMW</span>(<span class="title class_ inherited__">Car</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().run()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'宝马跑起来好稳哦!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Auto</span>(<span class="title class_ inherited__">Car</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().run()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'奥拓跑起来好省油哦!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 多态性示例</span></span><br><span class="line">cars = [Benz(), BMW(), Auto()]</span><br><span class="line"><span class="keyword">for</span> car <span class="keyword">in</span> cars:</span><br><span class="line">    car.run()  <span class="comment"># 同一方法调用，不同行为</span></span><br></pre></td></tr></tbody></table></figure><h5 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h5><p><strong>多态性带来的好处</strong>：统一了使用标准，以不变应万变，无论对象千变万化，使用者都是使用同一种方式去调用，需要注意的是：不一定要继承父类的 run 方法才算是一种多态，引入 python 推崇的一个鸭子模型的概念，只要你长得像鸭子，走路像鸭子，那么你就是一只鸭子，所以类只要内部定义的方法一样，那么他们就同属于一种类别，这也是一种解耦合的方法</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">quack</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"呱呱呱!"</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">swim</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"鸭子游泳!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">quack</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"人类模仿鸭叫!"</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">swim</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"人类游泳!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_it_quack_and_swim</span>(<span class="params">thing</span>):</span><br><span class="line">    thing.quack()</span><br><span class="line">    thing.swim()</span><br><span class="line"></span><br><span class="line">duck = Duck()</span><br><span class="line">person = Person()</span><br><span class="line"></span><br><span class="line">make_it_quack_and_swim(duck)</span><br><span class="line">make_it_quack_and_swim(person)  <span class="comment"># 人类没有继承Duck类，但可以表现得像鸭子</span></span><br></pre></td></tr></tbody></table></figure><h5 id="抽象基类"><a href="#抽象基类" class="headerlink" title="抽象基类"></a>抽象基类</h5><p>如果你不想使用鸭子模型，就想用父类来达到规范子类的效果，可以引入一个抽象基类概念，而这并不是 python 推崇的，python 推崇的永远是简洁至上，这样限制只会让程序变得臃肿</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>(metaclass=abc.ABCMeta):</span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Benz</span>(<span class="title class_ inherited__">Car</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"奔驰开始跑"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"奔驰停止"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment">## benz = Benz()  # 如果没有实现所有抽象方法，会抛出TypeError</span></span><br></pre></td></tr></tbody></table></figure><h3 id="类方法与静态方法"><a href="#类方法与静态方法" class="headerlink" title="类方法与静态方法"></a>类方法与静态方法</h3><h4 id="方法类型比较"><a href="#方法类型比较" class="headerlink" title="方法类型比较"></a>方法类型比较</h4><table><thead><tr><th>方法类型</th><th>装饰器</th><th>第一参数</th><th>使用场景</th></tr></thead><tbody><tr><td>实例方法</td><td>无</td><td>self</td><td>操作实例状态</td></tr><tr><td>类方法</td><td>@classmethod</td><td>cls</td><td>操作类状态，替代构造函数</td></tr><tr><td>静态方法</td><td>@staticmethod</td><td>无特殊参数</td><td>工具函数</td></tr></tbody></table><p><strong>示例场景</strong>：</p><ul><li>在实际的开发中，实例方法通常用于操作与当前对象状态相关的行为。比如，我们定义一个 <code>Person</code> 类，该类实例方法可以访问每个对象的名称和年龄，并提供修改、获取这些属性的功能。</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Hello, my name is <span class="subst">{self.name}</span> and I am <span class="subst">{self.age}</span> years old."</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建实例并调用实例方法</span></span><br><span class="line">person = Person(<span class="string">"Alice"</span>, <span class="number">30</span>)</span><br><span class="line">person.greet()  <span class="comment"># 输出：Hello, my name is Alice and I am 30 years old.</span></span><br></pre></td></tr></tbody></table></figure><h4 id="2-类方法（-classmethod）"><a href="#2-类方法（-classmethod）" class="headerlink" title="2. 类方法（@classmethod）"></a>2. <strong>类方法</strong>（@classmethod）</h4><p><strong>常见示例场景</strong>：</p><ul><li><strong>替代构造函数</strong>: 类方法通常用于定义一个替代构造函数，根据不同的输入创建对象。比如可以根据不同的配置文件或环境变量来初始化对象。</li><li><strong>操作类状态</strong>: 类方法通常用于修改与类相关的共享数据，比如修改所有实例的共享配置。</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataBase</span>:</span><br><span class="line">    IP = <span class="string">"127.0.0.1"</span></span><br><span class="line">    PORT = <span class="number">8080</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, ip, port</span>):</span><br><span class="line">        <span class="variable language_">self</span>.ip = ip</span><br><span class="line">        <span class="variable language_">self</span>.port = port</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">connect</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"连接数据库成功！IP地址：<span class="subst">{self.ip}</span>, 端口号：<span class="subst">{self.port}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">instance_from_setting</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="comment"># 从配置文件（如setting模块）或环境变量中读取IP和PORT并实例化对象</span></span><br><span class="line">        obj = cls(cls.IP, cls.PORT)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用类方法来创建实例</span></span><br><span class="line">db = DataBase.instance_from_setting()  </span><br><span class="line"><span class="built_in">print</span>(db.__dict__)  <span class="comment"># 输出：{'ip': '127.0.0.1', 'port': 8080}</span></span><br><span class="line">db.connect()  <span class="comment"># 输出：连接数据库成功！IP地址：127.0.0.1, 端口号：8080</span></span><br></pre></td></tr></tbody></table></figure><p><strong>应用场景</strong>：</p><ul><li>你可以在配置或环境变化时灵活地调整类的构造逻辑，不需要每次都显式地提供参数。这使得代码更加简洁，并且易于扩展。</li></ul><h4 id="3-静态方法（-staticmethod）"><a href="#3-静态方法（-staticmethod）" class="headerlink" title="3. 静态方法（@staticmethod）"></a>3. <strong>静态方法</strong>（@staticmethod）</h4><ul><li><strong>第一参数</strong>: 无特殊参数。静态方法与类或实例无关，不需要 <code>self</code> 或 <code>cls</code> 参数。</li><li><strong>访问实例变量</strong>: 静态方法无法访问实例或类的属性。</li><li><strong>访问类变量</strong>: 静态方法只能做独立于实例和类的操作。它通常用于工具函数，或者处理与对象本身无关的逻辑。</li></ul><p><strong>常见示例场景</strong>：</p><ul><li>静态方法通常用来封装一些独立的工具函数，这些函数与类或实例的状态无关。例如，数学计算、字符串处理等功能。</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MathTools</span>:</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用静态方法，无需实例化类</span></span><br><span class="line"><span class="built_in">print</span>(MathTools.add(<span class="number">5</span>, <span class="number">3</span>))  <span class="comment"># 输出：8</span></span><br><span class="line"><span class="built_in">print</span>(MathTools.multiply(<span class="number">4</span>, <span class="number">2</span>))  <span class="comment"># 输出：8</span></span><br></pre></td></tr></tbody></table></figure><h3 id="反射机制"><a href="#反射机制" class="headerlink" title="反射机制"></a>反射机制</h3><p>反射（Reflection）是指在程序运行时，能够检查、访问、修改对象的属性和方法的能力。在 Python 中，反射允许我们在运行时动态地操作类和对象，<strong>特别是在无法事先确定对象类型或者对象的属性和方法时</strong>，反射提供了极大的灵活性。</p><h4 id="常用反射函数"><a href="#常用反射函数" class="headerlink" title="常用反射函数"></a>常用反射函数</h4><table><thead><tr><th>函数</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td><code>hasattr(obj, name)</code></td><td>检查对象是否有属性</td><td><code>hasattr(obj, 'age')</code></td></tr><tr><td><code>getattr(obj, name, default)</code></td><td>获取对象的属性</td><td><code>getattr(obj, 'age', 0)</code></td></tr><tr><td><code>setattr(obj, name, value)</code></td><td>设置对象的属性</td><td><code>setattr(obj, 'age', 25)</code></td></tr><tr><td><code>delattr(obj, name)</code></td><td>删除对象的属性</td><td><code>delattr(obj, 'age')</code></td></tr><tr><td><code>dir(obj)</code></td><td>列出对象的所有属性</td><td><code>dir(obj)</code></td></tr><tr><td><code>type(obj)</code></td><td>获取对象的类型</td><td><code>type(obj)</code></td></tr><tr><td><code>isinstance(obj, cls)</code></td><td>检查对象是否为类的实例</td><td><code>isinstance(obj, Person)</code></td></tr><tr><td><code>issubclass(cls, parent)</code></td><td>检查类是否为另一个类的子类</td><td><code>issubclass(Dog, Animal)</code></td></tr><tr><td><code>callable(obj)</code></td><td>检查对象是否可调用</td><td><code>callable(obj.method)</code></td></tr><tr><td><code>vars(obj)</code></td><td>获取对象的 <code>__dict__</code></td><td><code>vars(obj)</code></td></tr></tbody></table><h4 id="1-hasattr-—-检查对象是否有指定属性"><a href="#1-hasattr-—-检查对象是否有指定属性" class="headerlink" title="1. hasattr() — 检查对象是否有指定属性"></a>1. <strong><code>hasattr()</code></strong> — 检查对象是否有指定属性</h4><p><code>hasattr(obj, name)</code> 用于检查一个对象 <code>obj</code> 是否有指定名称的属性 <code>name</code>，返回 <code>True</code> 或 <code>False</code>。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">hasattr</span>(p, <span class="string">'name'</span>):  <span class="comment"># 检查 Person 对象是否有 'name' 属性</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">getattr</span>(p, <span class="string">'name'</span>))  <span class="comment"># 输出: Alice</span></span><br></pre></td></tr></tbody></table></figure><h4 id="2-getattr-—-获取对象的属性"><a href="#2-getattr-—-获取对象的属性" class="headerlink" title="2. getattr() — 获取对象的属性"></a>2. <strong><code>getattr()</code></strong> — 获取对象的属性</h4><p><code>getattr(obj, name, default)</code> 用于获取对象的属性。如果该属性存在，返回其值；如果不存在，则返回指定的 <code>default</code> 值。如果没有提供 <code>default</code>，当属性不存在时会抛出 <code>AttributeError</code>。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="built_in">getattr</span>(p, <span class="string">'name'</span>)  <span class="comment"># 获取属性 'name' 的值</span></span><br><span class="line"><span class="built_in">print</span>(name)  <span class="comment"># 输出: Alice</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果属性不存在，使用默认值</span></span><br><span class="line">age = <span class="built_in">getattr</span>(p, <span class="string">'age'</span>, <span class="number">0</span>)  <span class="comment"># 属性 'age' 存在，返回 30</span></span><br><span class="line"><span class="built_in">print</span>(age)  <span class="comment"># 输出: 30</span></span><br></pre></td></tr></tbody></table></figure><h4 id="3-setattr-—-设置对象的属性"><a href="#3-setattr-—-设置对象的属性" class="headerlink" title="3. setattr() — 设置对象的属性"></a>3. <strong><code>setattr()</code></strong> — 设置对象的属性</h4><p><code>setattr(obj, name, value)</code> 用于给对象的指定属性 <code>name</code> 设置新值 <code>value</code>。如果该属性不存在，则会动态创建一个新的属性。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setattr</span>(p, <span class="string">'city'</span>, <span class="string">'New York'</span>)  <span class="comment"># 动态设置新的属性 'city'</span></span><br><span class="line"><span class="built_in">print</span>(p.city)  <span class="comment"># 输出: New York</span></span><br></pre></td></tr></tbody></table></figure><h4 id="4-delattr-—-删除对象的属性"><a href="#4-delattr-—-删除对象的属性" class="headerlink" title="4. delattr() — 删除对象的属性"></a>4. <strong><code>delattr()</code></strong> — 删除对象的属性</h4><p><code>delattr(obj, name)</code> 用于删除对象的指定属性。删除属性后，访问该属性会抛出 <code>AttributeError</code>。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">delattr</span>(p, <span class="string">'city'</span>)  <span class="comment"># 删除属性 'city'</span></span><br><span class="line"><span class="comment"># print(p.city)  # 会抛出 AttributeError: 'Person' object has no attribute 'city'</span></span><br></pre></td></tr></tbody></table></figure><h4 id="5-dir-—-列出对象的所有属性"><a href="#5-dir-—-列出对象的所有属性" class="headerlink" title="5. dir() — 列出对象的所有属性"></a>5. <strong><code>dir()</code></strong> — 列出对象的所有属性</h4><p><code>dir(obj)</code> 返回一个列表，包含对象 <code>obj</code> 的所有属性和方法（包括其继承的属性）。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(p))  <span class="comment"># 列出 Person 对象的所有属性</span></span><br></pre></td></tr></tbody></table></figure><h4 id="6-type-—-获取对象的类型"><a href="#6-type-—-获取对象的类型" class="headerlink" title="6. type() — 获取对象的类型"></a>6. <strong><code>type()</code></strong> — 获取对象的类型</h4><p><code>type(obj)</code> 返回对象 <code>obj</code> 的类型（即类）。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(p))  <span class="comment"># 输出: &lt;class '__main__.Person'&gt;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="7-isinstance-—-检查对象是否为类的实例"><a href="#7-isinstance-—-检查对象是否为类的实例" class="headerlink" title="7. isinstance() — 检查对象是否为类的实例"></a>7. <strong><code>isinstance()</code></strong> — 检查对象是否为类的实例</h4><p><code>isinstance(obj, cls)</code> 用于检查对象 <code>obj</code> 是否为类 <code>cls</code> 的实例或其子类的实例。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(p, Person):  <span class="comment"># 检查 p 是否是 Person 类的实例</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"p 是 Person 类的实例"</span>)  <span class="comment"># 输出: p 是 Person 类的实例</span></span><br></pre></td></tr></tbody></table></figure><h4 id="8-issubclass-—-检查类是否为另一个类的子类"><a href="#8-issubclass-—-检查类是否为另一个类的子类" class="headerlink" title="8. issubclass() — 检查类是否为另一个类的子类"></a>8. <strong><code>issubclass()</code></strong> — 检查类是否为另一个类的子类</h4><p><code>issubclass(cls, parent)</code> 用于检查类 <code>cls</code> 是否是类 <code>parent</code> 的子类。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">issubclass</span>(Dog, Animal))  <span class="comment"># 输出: True</span></span><br></pre></td></tr></tbody></table></figure><h4 id="9-callable-—-检查对象是否可调用"><a href="#9-callable-—-检查对象是否可调用" class="headerlink" title="9. callable() — 检查对象是否可调用"></a>9. <strong><code>callable()</code></strong> — 检查对象是否可调用</h4><p><code>callable(obj)</code> 用于检查对象 <code>obj</code> 是否可以调用，即它是否是一个函数或具有 <code>__call__()</code> 方法的对象。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">callable</span>(greet))  <span class="comment"># 输出: True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">callable</span>(p))      <span class="comment"># 输出: False，因为 Person 对象不可调用</span></span><br></pre></td></tr></tbody></table></figure><h4 id="10-vars-—-获取对象的-dict"><a href="#10-vars-—-获取对象的-dict" class="headerlink" title="10. vars() — 获取对象的 __dict__"></a>10. <strong><code>vars()</code></strong> — 获取对象的 <code>__dict__</code></h4><p><code>vars(obj)</code> 返回一个字典，包含对象 <code>obj</code> 的所有属性和对应的值。这是访问对象的实例变量的一种方式。</p><p><strong>示例</strong>：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">vars</span>(p))  <span class="comment"># 输出: {'name': 'Alice', 'age': 30}</span></span><br></pre></td></tr></tbody></table></figure><h4 id="反射示例"><a href="#反射示例" class="headerlink" title="反射示例"></a>反射示例</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Hello, I'm <span class="subst">{self.name}</span>"</span></span><br><span class="line">        </span><br><span class="line">p = Person(<span class="string">"Alice"</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查和获取属性</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">hasattr</span>(p, <span class="string">'name'</span>):  <span class="comment"># 检查 p 对象是否有 'name' 属性</span></span><br><span class="line">    name = <span class="built_in">getattr</span>(p, <span class="string">'name'</span>)  <span class="comment"># 获取 'name' 属性的值</span></span><br><span class="line">    <span class="built_in">print</span>(name)  <span class="comment"># 输出: Alice</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">## 设置新属性</span></span><br><span class="line"><span class="built_in">setattr</span>(p, <span class="string">'city'</span>, <span class="string">'New York'</span>)  <span class="comment"># 动态为 p 对象设置 'city' 属性</span></span><br><span class="line"><span class="built_in">print</span>(p.city)  <span class="comment"># 输出: New York</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除属性</span></span><br><span class="line"><span class="built_in">delattr</span>(p, <span class="string">'city'</span>)  <span class="comment"># 删除 'city' 属性</span></span><br><span class="line"><span class="comment"># print(p.city)  # 如果取消注释，会抛出 AttributeError: 'Person' object has no attribute 'city'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 动态调用方法</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">hasattr</span>(p, <span class="string">'greet'</span>) <span class="keyword">and</span> <span class="built_in">callable</span>(<span class="built_in">getattr</span>(p, <span class="string">'greet'</span>)):  <span class="comment"># 检查 greet 方法是否可调用</span></span><br><span class="line">    method = <span class="built_in">getattr</span>(p, <span class="string">'greet'</span>)  <span class="comment"># 获取 greet 方法</span></span><br><span class="line">    <span class="built_in">print</span>(method())  <span class="comment"># 输出: Hello, I'm Alice</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 获取所有属性</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(p))  <span class="comment"># 输出：['name', 'age', 'greet', ...]，列出所有属性和方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 通过字符串获取类</span></span><br><span class="line">class_name = <span class="string">'Person'</span></span><br><span class="line"><span class="keyword">if</span> class_name <span class="keyword">in</span> <span class="built_in">globals</span>():  <span class="comment"># 检查 Person 类是否在全局命名空间中</span></span><br><span class="line">    cls = <span class="built_in">globals</span>()[class_name]  <span class="comment"># 动态获取 Person 类</span></span><br><span class="line">    new_person = cls(<span class="string">'Bob'</span>, <span class="number">25</span>)  <span class="comment"># 使用动态获取的类实例化对象</span></span><br><span class="line">    <span class="built_in">print</span>(new_person.name)  <span class="comment"># 输出: Bob</span></span><br></pre></td></tr></tbody></table></figure><h3 id="通用枚举以及抽象接口定义"><a href="#通用枚举以及抽象接口定义" class="headerlink" title="通用枚举以及抽象接口定义"></a>通用枚举以及抽象接口定义</h3><h5 id="enum-模块：实现枚举类型"><a href="#enum-模块：实现枚举类型" class="headerlink" title="enum 模块：实现枚举类型"></a><code>enum</code> 模块：实现枚举类型</h5><p><code>enum</code> 模块 (Python 3.4+引入) 提供了一种创建枚举（Enumerations）的方法。枚举是一组绑定的符号名称（成员），这些名称是常量，并且具有唯一的（通常是整数）值。使用枚举可以使代码更具可读性、更易于维护，并能有效防止因使用魔法数字或字符串而导致的错误。</p><h6 id="enum-常用功能"><a href="#enum-常用功能" class="headerlink" title="enum 常用功能"></a><code>enum</code> 常用功能</h6><table><thead><tr><th>类/函数/装饰器</th><th>描述</th></tr></thead><tbody><tr><td><code>enum.Enum</code></td><td>创建基本枚举类型的基类。</td></tr><tr><td><code>enum.IntEnum</code></td><td><code>Enum</code> 的子类，其成员也是整数，可以和整数直接比较。</td></tr><tr><td><code>enum.Flag</code></td><td><code>Enum</code> 的子类，其成员可以使用位运算符 (`</td></tr><tr><td><code>enum.IntFlag</code></td><td><code>Flag</code> 的子类，其成员也是整数，并支持位运算。</td></tr><tr><td><code>enum.auto()</code></td><td>在定义枚举成员时，自动为其分配合适的值 (通常是递增的整数)。</td></tr><tr><td><code>@enum.unique</code></td><td>一个类装饰器，确保枚举中没有重复值的成员。</td></tr><tr><td><code>MyEnum.MEMBER_NAME</code></td><td>访问枚举成员。</td></tr><tr><td><code>MyEnum['MEMBER_NAME']</code></td><td>通过字符串名称访问枚举成员。</td></tr><tr><td><code>MyEnum(value)</code></td><td>通过值获取枚举成员。</td></tr><tr><td><code>member.name</code></td><td>(枚举成员属性) 获取成员的名称 (字符串)。</td></tr><tr><td><code>member.value</code></td><td>(枚举成员属性) 获取成员的值。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>enum</code> 模块)</strong></p><ul><li>继承 <code>enum.Enum</code> (或 <code>IntEnum</code>, <code>Flag</code>) 来定义自己的枚举。</li><li>使用 <code>enum.auto()</code> 自动分配值，非常方便。</li><li>通过 <code>MyEnum.MEMBER_NAME</code> 或 <code>MyEnum(value)</code> 来引用和获取枚举成员。</li><li><code>member.name</code> 和 <code>member.value</code> 是最常用的成员属性。</li><li><code>@unique</code> 装饰器有助于保证值的唯一性。</li></ul></blockquote><h6 id="enum-模块代码示例"><a href="#enum-模块代码示例" class="headerlink" title="enum 模块代码示例"></a><code>enum</code> 模块代码示例</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, IntEnum, Flag, auto, unique</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span> <span class="comment"># 用于类型注解</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 0. enum 模块演示准备</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_header(<span class="string">"enum 模块功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 1. 基本枚举 (Enum)</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 基本枚举 (Enum)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Color</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    RED = <span class="number">1</span></span><br><span class="line">    GREEN = <span class="number">2</span></span><br><span class="line">    BLUE = <span class="number">3</span></span><br><span class="line"><span class="comment">#    # YELLOW = 1 # 如果没有 @unique，这不会报错，但可能不是期望的行为</span></span><br><span class="line">    </span><br><span class="line">print_info(<span class="string">f"枚举成员 Color.RED: <span class="subst">{Color.RED}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  Color.RED 的名称 (name): '<span class="subst">{Color.RED.name}</span>'"</span>)</span><br><span class="line">print_info(<span class="string">f"  Color.RED 的值 (value): <span class="subst">{Color.RED.value}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  通过值获取成员 Color(2): <span class="subst">{Color(<span class="number">2</span>)}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  通过名称获取成员 Color['GREEN']: <span class="subst">{Color[<span class="string">'GREEN'</span>]}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  Color.RED is Color.GREEN: <span class="subst">{Color.RED <span class="keyword">is</span> Color.GREEN}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  Color.RED == Color(1): <span class="subst">{Color.RED == Color(<span class="number">1</span>)}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  遍历枚举 Color:"</span>)</span><br><span class="line"><span class="keyword">for</span> color_member <span class="keyword">in</span> Color:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"    - <span class="subst">{color_member.name}</span> -&gt; <span class="subst">{color_member.value}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 2. 使用 auto() 自动分配值 和 @unique 确保值唯一</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 使用 auto() 和 @unique"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@unique </span><span class="comment"># 确保枚举成员的值是唯一的</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Weekday</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    MONDAY = auto()    <span class="comment"># 值通常从 1 开始递增</span></span><br><span class="line">    TUESDAY = auto()</span><br><span class="line">    WEDNESDAY = auto()</span><br><span class="line">    THURSDAY = auto()</span><br><span class="line">    FRIDAY = auto()</span><br><span class="line">    SATURDAY = auto()</span><br><span class="line">    SUNDAY = auto()</span><br><span class="line"></span><br><span class="line">print_info(<span class="string">"使用 auto() 和 @unique 的 Weekday 枚举:"</span>)</span><br><span class="line"><span class="keyword">for</span> day <span class="keyword">in</span> Weekday:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  - <span class="subst">{day.name}</span>: <span class="subst">{day.value}</span>"</span>)</span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"Weekday['MONDAY'].value: <span class="subst">{Weekday.MONDAY.value}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 3. 整数枚举 (IntEnum)</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. 整数枚举 (IntEnum)"</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorCode</span>(<span class="title class_ inherited__">IntEnum</span>): <span class="comment"># 成员可以直接与整数比较</span></span><br><span class="line">    OK = <span class="number">0</span></span><br><span class="line">    NOT_FOUND = <span class="number">404</span></span><br><span class="line">    SERVER_ERROR = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"ErrorCode.NOT_FOUND: <span class="subst">{ErrorCode.NOT_FOUND}</span>"</span>)</span><br><span class="line">print_info(<span class="string">f"  ErrorCode.NOT_FOUND == 404: <span class="subst">{ErrorCode.NOT_FOUND == <span class="number">404</span>}</span>"</span>) <span class="comment"># True</span></span><br><span class="line">print_info(<span class="string">f"  ErrorCode.OK &lt; ErrorCode.SERVER_ERROR: <span class="subst">{ErrorCode.OK &lt; ErrorCode.SERVER_ERROR}</span>"</span>) <span class="comment"># True</span></span><br><span class="line">print_info(<span class="string">f"  int(ErrorCode.SERVER_ERROR): <span class="subst">{<span class="built_in">int</span>(ErrorCode.SERVER_ERROR)}</span>"</span>) <span class="comment"># 500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 4. 标志枚举 (Flag 和 IntFlag) - 支持位运算</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"4. 标志枚举 (Flag 和 IntFlag)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Permissions</span>(<span class="title class_ inherited__">Flag</span>): <span class="comment"># Flag 成员的值通常是 2 的幂</span></span><br><span class="line">    NONE = <span class="number">0</span> <span class="comment"># 通常定义一个 "无" 或 "空" 标志</span></span><br><span class="line">    READ = auto()    <span class="comment"># 1</span></span><br><span class="line">    WRITE = auto()   <span class="comment"># 2</span></span><br><span class="line">    EXECUTE = auto() <span class="comment"># 4</span></span><br><span class="line">    READ_WRITE = READ | WRITE <span class="comment"># 组合标志</span></span><br><span class="line">    ALL = READ | WRITE | EXECUTE</span><br><span class="line"></span><br><span class="line">user1_perms: Permissions = Permissions.READ | Permissions.WRITE</span><br><span class="line">user2_perms: Permissions = Permissions.READ</span><br><span class="line">admin_perms: Permissions = Permissions.ALL</span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"User1 权限 (READ | WRITE): <span class="subst">{user1_perms}</span> (值为: <span class="subst">{user1_perms.value}</span>)"</span>)</span><br><span class="line">print_info(<span class="string">f"  User1 是否有 READ 权限: <span class="subst">{Permissions.READ <span class="keyword">in</span> user1_perms}</span>"</span>)   <span class="comment"># True</span></span><br><span class="line">print_info(<span class="string">f"  User1 是否有 EXECUTE 权限: <span class="subst">{Permissions.EXECUTE <span class="keyword">in</span> user1_perms}</span>"</span>) <span class="comment"># False</span></span><br><span class="line">print_info(<span class="string">f"  User1 是否只有 READ_WRITE 权限: <span class="subst">{user1_perms == Permissions.READ_WRITE}</span>"</span>) <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">f"Admin 权限 (ALL): <span class="subst">{admin_perms}</span> (值为: <span class="subst">{admin_perms.value}</span>)"</span>)</span><br><span class="line">print_info(<span class="string">f"  Admin 是否包含所有权限 (READ|WRITE|EXECUTE): <span class="subst">{admin_perms == (Permissions.READ | Permissions.WRITE | Permissions.EXECUTE)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## IntFlag 类似，但其成员也是整数</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileAccess</span>(<span class="title class_ inherited__">IntFlag</span>):</span><br><span class="line">    R_OK = os.R_OK <span class="comment"># 使用 os 模块的常量 (通常是 4)</span></span><br><span class="line">    W_OK = os.W_OK <span class="comment"># (通常是 2)</span></span><br><span class="line">    X_OK = os.X_OK <span class="comment"># (通常是 1)</span></span><br><span class="line">    RW_OK = R_OK | W_OK</span><br><span class="line"></span><br><span class="line">file_mode: FileAccess = FileAccess.R_OK | FileAccess.W_OK</span><br><span class="line">print_info(<span class="string">f"\nFileAccess 模式 (R_OK | W_OK): <span class="subst">{file_mode}</span> (值为: <span class="subst">{file_mode.value}</span>)"</span>)</span><br><span class="line">print_info(<span class="string">f"  文件是否可读 (R_OK in file_mode): <span class="subst">{FileAccess.R_OK <span class="keyword">in</span> file_mode}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>enum</code> 模块)</strong>:</p><ul><li><strong>可读性与维护性</strong>: 使用枚举可以替代代码中散落的魔法数字或字符串常量，使得代码意图更清晰，更易于维护。当需要修改某个状态的含义或值时，只需在枚举定义处修改一处即可。</li><li><strong>成员的唯一性</strong>:<ul><li>默认情况下，<code>Enum</code> 允许不同的成员名称指向相同的值（别名）。</li><li>使用 <code>@unique</code> 类装饰器可以强制枚举中的所有成员值必须唯一，如果存在重复值则会在定义时抛出 <code>ValueError</code>。</li></ul></li><li><strong>成员的比较</strong>: 枚举成员是单例。你可以使用 <code>is</code> 或 <code>==</code> 来比较两个枚举成员是否相同。<code>IntEnum</code> 和 <code>IntFlag</code> 的成员还可以直接与整数进行比较。</li><li><strong>迭代与访问</strong>: 可以迭代枚举类的所有成员。可以通过成员名 (<code>MyEnum.MEMBER</code>)、方括号加成员名字符串 (<code>MyEnum['MEMBER']</code>) 或成员值 (<code>MyEnum(value)</code>) 来访问特定的枚举成员。</li><li><strong><code>auto()</code> 的行为</strong>: <code>enum.auto()</code> 会自动为枚举成员分配一个值。默认情况下，对于 <code>Enum</code>，它从1开始递增。对于 <code>Flag</code>，它会分配2的幂 (1, 2, 4, 8, …)。你可以通过重写 <code>_generate_next_value_</code> 特殊方法来自定义 <code>auto()</code> 的行为。</li><li><strong><code>Flag</code> 与位运算</strong>: <code>Flag</code> 和 <code>IntFlag</code> 类型的枚举成员支持位运算符 (<code>|</code>, <code>&amp;</code>, <code>^</code>, <code>~</code>)，非常适合表示权限、状态组合等场景。可以使用 <code>in</code> 操作符来检查一个组合标志是否包含某个特定标志。</li><li><strong>JSON 序列化</strong>: 默认情况下，枚举成员在 JSON 序列化时可能不会直接变成期望的字符串或整数。你可能需要自定义序列化逻辑，或者在序列化前获取成员的 <code>.name</code> 或 <code>.value</code> 属性。</li></ul></blockquote><h5 id="abc-模块：定义抽象基类-Abstract-Base-Classes"><a href="#abc-模块：定义抽象基类-Abstract-Base-Classes" class="headerlink" title="abc 模块：定义抽象基类 (Abstract Base Classes)"></a><code>abc</code> 模块：定义抽象基类 (Abstract Base Classes)</h5><p><code>abc</code> 模块 (Abstract Base Classes) 用于帮助定义和使用抽象基类。抽象基类是一种不能被直接实例化的类，它存在的目的是作为其他类的“模板”或“接口约定”。子类如果继承了抽象基类，就必须实现抽象基类中声明的所有抽象方法和抽象属性，否则子类本身也会成为抽象类，无法实例化。</p><p>这有助于强制执行接口规范，实现多态，并构建更健壮、更松耦合的系统。</p><h6 id="abc-常用功能"><a href="#abc-常用功能" class="headerlink" title="abc 常用功能"></a><code>abc</code> 常用功能</h6><table><thead><tr><th>类/装饰器</th><th>描述</th></tr></thead><tbody><tr><td><code>abc.ABC</code></td><td>一个辅助类，用于通过继承来创建抽象基类。</td></tr><tr><td><code>@abc.abstractmethod</code></td><td>一个装饰器，用于声明一个抽象方法，子类必须实现它。</td></tr><tr><td><code>@abc.abstractproperty</code></td><td>(Python 3.3+) 一个装饰器，用于声明一个抽象属性 (getter, setter, deleter)，子类必须实现。在旧版本中，通常通过组合 <code>@property</code> 和 <code>@abstractmethod</code> 实现。</td></tr><tr><td><code>@abc.abstractclassmethod</code></td><td>(Python 3.3+) 声明抽象类方法。</td></tr><tr><td><code>@abc.abstractstaticmethod</code></td><td>(Python 3.3+) 声明抽象静态方法。</td></tr><tr><td><code>isinstance(obj, MyABC)</code></td><td>可以检查一个对象 <code>obj</code> 是否是某个抽象基类 <code>MyABC</code> 的实例 (即使是通过虚拟子类注册的)。</td></tr><tr><td><code>MyABC.register(MyClass)</code></td><td>(类方法) 将 <code>MyClass</code> 注册为 <code>MyABC</code> 的虚拟子类，即使 <code>MyClass</code> 没有显式继承 <code>MyABC</code>。</td></tr></tbody></table><blockquote><p><strong>批注：核心记忆功能 (<code>abc</code> 模块)</strong></p><ul><li>继承 <code>ABC</code> 来定义抽象基类。</li><li>使用 <code>@abstractmethod</code> 来标记那些必须在具体子类中被重写的方法。</li><li>抽象基类不能直接实例化。</li><li>它的主要目的是定义一个清晰的接口或契约，供子类遵循。</li></ul></blockquote><h6 id="abc-模块代码示例"><a href="#abc-模块代码示例" class="headerlink" title="abc 模块代码示例"></a><code>abc</code> 模块代码示例</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> print_utils <span class="keyword">import</span> * <span class="comment"># 假设 print_utils.py 可用</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod, abstractproperty <span class="comment"># Python 3.3+ for abstractproperty</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Tuple</span>, <span class="type">Type</span>, <span class="type">Any</span> <span class="comment"># 用于类型注解</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 0. abc 模块演示准备</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_header(<span class="string">"abc 模块 (抽象基类) 功能演示"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 1. 定义一个抽象基类 Shape</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"1. 定义抽象基类 Shape"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>(<span class="title class_ inherited__">ABC</span>): <span class="comment"># 继承自 ABC，表明这是一个抽象基类</span></span><br><span class="line">    <span class="string">"""一个表示几何形状的抽象基类。"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod </span><span class="comment"># 标记 area() 为抽象方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="string">"""计算并返回形状的面积。子类必须实现此方法。"""</span></span><br><span class="line">        <span class="keyword">pass</span> <span class="comment"># 抽象方法通常只有 pass 或 raise NotImplementedError()</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod </span><span class="comment"># 标记 perimeter() 为抽象方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="string">"""计算并返回形状的周长。子类必须实现此方法。"""</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">"子类必须实现 perimeter 方法"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractproperty </span><span class="comment"># Python 3.3+ (旧版本用 @property + @abstractmethod)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">shape_type</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">"""返回形状的类型名称 (例如 'Circle', 'Rectangle')。子类必须实现此属性。"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#    # 这是一个具体方法，子类可以直接继承或重写</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">describe</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">"""返回对形状的描述。"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"这是一个 '<span class="subst">{self.shape_type}</span>'，面积为 <span class="subst">{self.area():<span class="number">.2</span>f}</span>，周长为 <span class="subst">{self.perimeter():<span class="number">.2</span>f}</span>。"</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">"抽象基类 Shape 已定义。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 尝试实例化抽象基类 (会失败)</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    s = Shape()</span><br><span class="line">    print_error(<span class="string">"错误：抽象基类 Shape 被实例化了！(不应发生)"</span>)</span><br><span class="line"><span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">    print_success(<span class="string">f"尝试实例化 Shape 时捕获到预期的 TypeError: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 2. 创建具体子类 Circle 和 Rectangle</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"2. 创建具体子类 Circle 和 Rectangle"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="string">"""表示圆形的具体类。"""</span></span><br><span class="line">    PI: <span class="built_in">float</span> = <span class="number">3.1415926535</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, radius: <span class="built_in">float</span></span>):</span><br><span class="line">        <span class="keyword">if</span> radius &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"半径必须为正数。"</span>)</span><br><span class="line">        <span class="variable language_">self</span>._radius: <span class="built_in">float</span> = radius</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>: <span class="comment"># 实现抽象方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.PI * (<span class="variable language_">self</span>._radius ** <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>: <span class="comment"># 实现抽象方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * <span class="variable language_">self</span>.PI * <span class="variable language_">self</span>._radius</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property </span><span class="comment"># 实现抽象属性</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">shape_type</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"圆形"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="string">"""表示矩形的具体类。"""</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, width: <span class="built_in">float</span>, height: <span class="built_in">float</span></span>):</span><br><span class="line">        <span class="keyword">if</span> width &lt;= <span class="number">0</span> <span class="keyword">or</span> height &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"宽度和高度必须为正数。"</span>)</span><br><span class="line">        <span class="variable language_">self</span>._width: <span class="built_in">float</span> = width</span><br><span class="line">        <span class="variable language_">self</span>._height: <span class="built_in">float</span> = height</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._width * <span class="variable language_">self</span>._height</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * (<span class="variable language_">self</span>._width + <span class="variable language_">self</span>._height)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">shape_type</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"矩形"</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">"具体子类 Circle 和 Rectangle 已定义。"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 实例化具体子类</span></span><br><span class="line">circle_instance = Circle(radius=<span class="number">5.0</span>)</span><br><span class="line">rectangle_instance = Rectangle(width=<span class="number">4.0</span>, height=<span class="number">6.0</span>)</span><br><span class="line"></span><br><span class="line">print_success(<span class="string">f"圆的描述: <span class="subst">{circle_instance.describe()}</span>"</span>)</span><br><span class="line">print_success(<span class="string">f"矩形的描述: <span class="subst">{rectangle_instance.describe()}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line"><span class="comment">## 3. 演示未完全实现抽象方法的子类</span></span><br><span class="line"><span class="comment">## =============================================================</span></span><br><span class="line">print_subheader(<span class="string">"3. 演示未完全实现抽象方法的子类"</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IncompleteSquare</span>(<span class="title class_ inherited__">Shape</span>): <span class="comment"># Square 应该也实现 perimeter 和 shape_type</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, side: <span class="built_in">float</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>._side: <span class="built_in">float</span> = side</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._side ** <span class="number">2</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#    # 故意不实现 perimeter 和 shape_type</span></span><br><span class="line"><span class="comment">#    # @property</span></span><br><span class="line"><span class="comment">#    # def shape_type(self) -&gt; str:</span></span><br><span class="line"><span class="comment">#    #     return "不完整的正方形"</span></span><br><span class="line"></span><br><span class="line">print_info(<span class="string">"定义了一个未完全实现抽象方法的 IncompleteSquare 类。"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    incomplete_sq = IncompleteSquare(side=<span class="number">3</span>)</span><br><span class="line">    print_error(<span class="string">"错误：不完整的抽象子类 IncompleteSquare 被实例化了！(不应发生)"</span>)</span><br><span class="line"><span class="comment">#    # incomplete_sq.describe() # 如果能实例化，这里调用 perimeter() 会出错</span></span><br><span class="line"><span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">    print_success(<span class="string">f"尝试实例化 IncompleteSquare 时捕获到预期的 TypeError: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">pass</span> <span class="comment"># 演示已在各节内进行</span></span><br><span class="line">print_header(<span class="string">"abc 模块演示结束。"</span>)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>坑点与建议 (<code>abc</code> 模块)</strong>:</p><ul><li><strong>强制接口实现</strong>: <code>abc</code> 模块的主要目的是强制子类实现特定的方法和属性，从而确保它们都遵循一个共同的“契约”或“接口”。这在大型项目或框架设计中非常有用，可以提高代码的稳定性和可维护性。</li><li><strong>实例化错误</strong>: 如果一个类继承了 <code>ABC</code> 并有未被实现的抽象方法/属性（通过 <code>@abstractmethod</code> 或 <code>@abstractproperty</code> 标记），那么尝试实例化这个类（或其同样未完全实现的子类）会在运行时抛出 <code>TypeError</code>。</li><li><strong><code>@abstractproperty</code></strong>: 从 Python 3.3 开始，可以直接使用 <code>@abstractproperty</code>。在此之前，定义抽象属性通常需要组合使用 <code>@property</code> 和 <code>@abstractmethod</code>：<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="meta">@abstractmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_abstract_prop</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure></li><li><strong>虚拟子类 (<code>register</code>)</strong>: 除了通过继承，你还可以使用 <code>MyABC.register(AnotherClass)</code> 将一个完全不相关的类 <code>AnotherClass</code> 注册为抽象基类 <code>MyABC</code> 的“虚拟子类”。这意味着 <code>isinstance(obj_of_another_class, MyABC)</code> 会返回 <code>True</code>，但 <code>AnotherClass</code> 并不会真正从 <code>MyABC</code> 继承任何方法或属性，也不会被强制实现抽象方法。这种方式主要用于在不修改现有类继承关系的情况下，将其归类到某个抽象接口下。</li><li><strong>不仅仅是“接口”</strong>: 虽然抽象基类的作用与某些语言中的“接口”概念相似，但 Python 的抽象基类可以包含具体的方法实现（如示例中的 <code>describe()</code> 方法），子类可以直接继承这些实现。</li><li><strong>何时使用</strong>: 当你希望定义一组类应该共同拥有的行为，但具体实现方式因类而异时，抽象基类是一个很好的选择。例如，定义一个通用的 <code>DataStorage</code> 接口，然后有 <code>DatabaseStorage</code>, <code>FileStorage</code>, <code>InMemoryStorage</code> 等具体实现。</li></ul></blockquote><h3 id="元类编程"><a href="#元类编程" class="headerlink" title="元类编程"></a>元类编程</h3><p>元类是创建类的类，<code>type</code> 是 Python 的内置元类。</p><h4 id="元类的核心方法"><a href="#元类的核心方法" class="headerlink" title="元类的核心方法"></a>元类的核心方法</h4><table><thead><tr><th>方法</th><th>描述</th><th>调用时机</th></tr></thead><tbody><tr><td><code>__new__(mcs, name, bases, attrs)</code></td><td>创建类对象</td><td>定义类时</td></tr><tr><td><code>__init__(cls, name, bases, attrs)</code></td><td>初始化类对象</td><td>类创建后</td></tr><tr><td><code>__call__(cls, *args, **kwargs)</code></td><td>创建类的实例</td><td>实例化类时</td></tr></tbody></table><h4 id="使用-type-动态创建类"><a href="#使用-type-动态创建类" class="headerlink" title="使用 type 动态创建类"></a>使用 type 动态创建类</h4><p>在我们使用 class 定义关键字时，其实是 Python 底层执行了以下四步操作为我们定义了一个类，分别是：</p><ul><li>1.定义类名</li><li>2.定义基类</li><li>3.执行类子代码，产生名称空间</li><li>4.调用元素</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1.定义类名</span></span><br><span class="line">class_name = <span class="string">"Human"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.定义基类</span></span><br><span class="line">class_bases = (<span class="built_in">object</span>,)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.执行子类代码，产生名称空间</span></span><br><span class="line">class_dic = {}</span><br><span class="line">class_body = <span class="string">"""</span></span><br><span class="line"><span class="string">def __init__(self, name, age):</span></span><br><span class="line"><span class="string">    self.name = name</span></span><br><span class="line"><span class="string">    self.age = age</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def say_hello(self):</span></span><br><span class="line"><span class="string">    print(f"你好，我是{self.name}，今年{self.age}岁")</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># exec函数语法：exec(object[, globals[, locals]])</span></span><br><span class="line"><span class="comment"># object: 要执行的Python代码字符串或代码对象</span></span><br><span class="line"><span class="comment"># globals: 可选参数，指定代码执行时的全局命名空间，默认为当前全局命名空间</span></span><br><span class="line"><span class="comment"># locals: 可选参数，指定代码执行时的局部命名空间，默认与globals相同</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里传入三个参数：</span></span><br><span class="line"><span class="comment"># 1. class_body: 包含类方法定义的Python代码字符串</span></span><br><span class="line"><span class="comment"># 2. {}: 空字典作为全局命名空间，避免访问外部全局变量</span></span><br><span class="line"><span class="comment"># 3. class_dic: 作为局部命名空间，执行后class_body中定义的方法会存储在这个字典中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这样做的目的是隔离执行环境，并将执行结果(类的方法定义)收集到class_dic字典中，</span></span><br><span class="line"><span class="comment"># 之后可以将这个字典传给type函数来动态创建类</span></span><br><span class="line"><span class="built_in">exec</span>(class_body, {}, class_dic)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.调用原类</span></span><br><span class="line">Human = <span class="built_in">type</span>(class_name,class_bases,class_dic)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 创建实例对象</span></span><br><span class="line">person = Human(<span class="string">"张三"</span>, <span class="number">25</span>)</span><br><span class="line"><span class="comment"># 6. 调用实例方法</span></span><br><span class="line">person.say_hello() <span class="comment"># 你好，我是张三，今年25岁</span></span><br></pre></td></tr></tbody></table></figure><h4 id="自定义元类"><a href="#自定义元类" class="headerlink" title="自定义元类"></a>自定义元类</h4><p>对于元类来说，最关键的步骤也就是在第四步，在我们调用原类之前可以对这个类做一些自定义化操作，如 <code>类名不能带特殊符号，类必须写文档注释......</code> 我们通过一个自定义类来实现这个功能</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyType</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, class_name, class_bases, class_attrs</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"_"</span> <span class="keyword">in</span> class_name:</span><br><span class="line">            <span class="keyword">raise</span> NameError(<span class="string">"类名不能包含下划线"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> class_attrs.get(<span class="string">"__doc__"</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"类必须有文档注释"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查类属性名是否符合规范</span></span><br><span class="line">        <span class="keyword">for</span> attr_name <span class="keyword">in</span> class_attrs:</span><br><span class="line">            <span class="keyword">if</span> attr_name.startswith(<span class="string">"__"</span>) <span class="keyword">and</span> attr_name.endswith(<span class="string">"__"</span>):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> attr_name.islower():</span><br><span class="line">                <span class="keyword">raise</span> NameError(<span class="string">"属性名必须全部小写"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否有必要的方法</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"info"</span> <span class="keyword">not</span> <span class="keyword">in</span> class_attrs:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"类必须实现info方法"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查类的基类</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> class_bases:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"类必须继承至少一个父类"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span>(<span class="built_in">object</span>, metaclass=MyType):</span><br><span class="line">    <span class="string">"""人类的基本信息类，如果没有这个注释会报错"""</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"name:<span class="subst">{self.name}</span>,age:<span class="subst">{self.age}</span>"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="元类的-new-方法"><a href="#元类的-new-方法" class="headerlink" title="元类的 __new__ 方法"></a>元类的 <code>__new__</code> 方法</h4><p>在我们调用类产生一个空对象的时候，在执行 <code>__init__</code> 方法之前一定执行了其他方法，我们都知道在 Python 中，所有的类都默认继承自 <code>object</code> 基类，但在下述的例子，当我们没有给自定义元类传入 object，他报错了，这是为什么呢？</p><p>本质上我们的 self，也就指的是 <code>Human</code> 这个类，对于 class_bases 来说，他只是一个形参而已，真正为我们继承父类的方法是 <code>__new__</code> 方法</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyType</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, class_name, class_bases, class_attrs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.__bases__) <span class="comment"># (&lt;class 'object'&gt;,)</span></span><br><span class="line">        <span class="comment"># 检查类的基类</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> class_bases:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"类必须继承至少一个父类"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span>(metaclass=MyType):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"name:<span class="subst">{self.name}</span>,age:<span class="subst">{self.age}</span>"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>我们可以通过进一步剖析 <code>__new__</code> 方法</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyType</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, class_name, class_bases, class_attrs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.__bases__)  <span class="comment"># (&lt;class 'object'&gt;,)</span></span><br><span class="line">        <span class="comment"># 检查类的基类</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> class_bases:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"类必须继承至少一个父类"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"cls==========&gt;"</span>, cls) <span class="comment"># &lt;class '__main__.MyType'&gt;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"args=========&gt;"</span>, args)  <span class="comment"># ('Human', (), {'__module__': '__main__', '__qualname__': 'Human', '__init__': &lt;function Human.__init__ at 0x000001D726C02CA0&gt;, 'info': &lt;function Human.info at 0x000001D726B9BEE0&gt;})</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"kwargs=========&gt;"</span>, kwargs)  <span class="comment"># {}</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__new__(cls, *args, **kwargs) <span class="comment"># 通过调用父类的__new__方法,他会在底层帮我们继承object对象,存放__()__属性等</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span>(metaclass=MyType):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"name:<span class="subst">{self.name}</span>,age:<span class="subst">{self.age}</span>"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="元类的-call-方法实例"><a href="#元类的-call-方法实例" class="headerlink" title="元类的 __call__ 方法实例"></a>元类的 <code>__call__</code> 方法实例</h4><p>当调用类（如 <code>Person()</code>）创建实例时，实际上是调用元类的 <code>__call__</code> 方法。自定义此方法可以控制实例化过程：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    _instances = {}</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">"""控制类实例化过程"""</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> cls._instances:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"创建 <span class="subst">{cls.__name__}</span> 的新实例"</span>)</span><br><span class="line">            <span class="comment"># 正常的实例化过程：创建实例并初始化</span></span><br><span class="line">            instance = <span class="built_in">super</span>().__call__(*args, **kwargs)</span><br><span class="line">            cls._instances[cls] = instance</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"返回 <span class="subst">{cls.__name__}</span> 的现有实例"</span>)</span><br><span class="line">        <span class="keyword">return</span> cls._instances[cls]</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Database</span>(metaclass=SingletonMeta):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host, port</span>):</span><br><span class="line">        <span class="variable language_">self</span>.host = host</span><br><span class="line">        <span class="variable language_">self</span>.port = port</span><br><span class="line">        </span><br><span class="line"><span class="comment">## 第一次调用，创建新实例</span></span><br><span class="line">db1 = Database(<span class="string">"localhost"</span>, <span class="number">5432</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"DB1: <span class="subst">{db1.host}</span>:<span class="subst">{db1.port}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 第二次调用，返回现有实例</span></span><br><span class="line">db2 = Database(<span class="string">"example.com"</span>, <span class="number">8080</span>)  <span class="comment"># 参数被忽略！</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"DB2: <span class="subst">{db2.host}</span>:<span class="subst">{db2.port}</span>"</span>)  <span class="comment"># 仍然是localhost:5432</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 验证是同一个实例</span></span><br><span class="line"><span class="built_in">print</span>(db1 <span class="keyword">is</span> db2)  <span class="comment"># True</span></span><br></pre></td></tr></tbody></table></figure><h4 id="元类链和类创建过程"><a href="#元类链和类创建过程" class="headerlink" title="元类链和类创建过程"></a>元类链和类创建过程</h4><table><thead><tr><th>步骤</th><th>描述</th><th>涉及方法</th></tr></thead><tbody><tr><td>1</td><td>收集类定义信息</td><td>Python 解释器执行类体</td></tr><tr><td>2</td><td>调用元类的 <code>__new__</code></td><td>创建类对象</td></tr><tr><td>3</td><td>调用元类的 <code>__init__</code></td><td>初始化类对象</td></tr><tr><td>4</td><td>返回创建的类</td><td>类可以使用了</td></tr></tbody></table><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TraceMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">mcs, name, bases, attrs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[元类__new__] 创建类 <span class="subst">{name}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__new__(mcs, name, bases, attrs)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">cls, name, bases, attrs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[元类__init__] 初始化类 <span class="subst">{name}</span>"</span>)</span><br><span class="line">        <span class="built_in">super</span>().__init__(name, bases, attrs)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[元类__call__] 调用类 <span class="subst">{cls.__name__}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 创建实例（调用类的__new__）</span></span><br><span class="line">        instance = cls.__new__(cls, *args, **kwargs)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 初始化实例（调用类的__init__）</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(instance, cls):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"[元类__call__] 初始化 <span class="subst">{cls.__name__}</span> 实例"</span>)</span><br><span class="line">            cls.__init__(instance, *args, **kwargs)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>(metaclass=TraceMeta):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[类__new__] 创建 <span class="subst">{cls.__name__}</span> 实例"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[类__init__] 初始化 <span class="subst">{self.__class__.__name__}</span> 实例，x=<span class="subst">{x}</span>"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(<span class="string">"定义完成，开始创建实例..."</span>)</span><br><span class="line">obj = MyClass(<span class="number">42</span>)</span><br></pre></td></tr></tbody></table></figure><h4 id="内置的元类属性和方法表"><a href="#内置的元类属性和方法表" class="headerlink" title="内置的元类属性和方法表"></a>内置的元类属性和方法表</h4><table><thead><tr><th>属性/方法</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td><code>__metaclass__</code></td><td>指定类的元类</td><td><code>class A(metaclass=MyMeta):</code></td></tr><tr><td><code>__mro__</code></td><td>方法解析顺序</td><td><code>A.__mro__</code></td></tr><tr><td><code>__bases__</code></td><td>直接父类元组</td><td><code>A.__bases__</code></td></tr><tr><td><code>__subclasses__()</code></td><td>直接子类列表</td><td><code>A.__subclasses__()</code></td></tr><tr><td><code>__class__</code></td><td>对象的类</td><td><code>obj.__class__</code></td></tr><tr><td><code>mro()</code></td><td>返回方法解析顺序</td><td><code>A.mro()</code></td></tr></tbody></table><h3 id="Python-特殊方法（魔术方法）"><a href="#Python-特殊方法（魔术方法）" class="headerlink" title="Python 特殊方法（魔术方法）"></a>Python 特殊方法（魔术方法）</h3><p>Python 的特殊方法（也称为魔术方法或双下方法）是 Python 面向对象编程中的核心概念，它们允许自定义类行为以适应 Python 的语言特性。这些方法以双下划线开始和结束（如 <code>__init__</code>），当特定操作发生时会被自动调用</p><h5 id="1-对象创建与销毁"><a href="#1-对象创建与销毁" class="headerlink" title="1. 对象创建与销毁"></a>1. 对象创建与销毁</h5><table><thead><tr><th>方法名</th><th>描述</th><th>触发方式</th><th>使用场景</th></tr></thead><tbody><tr><td><code>__init__(self, ...)</code></td><td>初始化对象</td><td>创建实例后调用</td><td>设置实例属性</td></tr><tr><td><code>__new__(cls, ...)</code></td><td>创建对象</td><td>实例化时调用（比 init 先）</td><td>自定义实例创建过程，实现单例模式</td></tr><tr><td><code>__del__(self)</code></td><td>析构方法</td><td>对象被销毁时调用</td><td>释放资源，关闭文件或连接</td></tr></tbody></table><h6 id="实际应用场景："><a href="#实际应用场景：" class="headerlink" title="实际应用场景："></a>实际应用场景：</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseConnection</span>:</span><br><span class="line">    _instance = <span class="literal">None</span>  <span class="comment"># 类变量用于存储单例实例</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):  <span class="comment"># 这里的cls，也就是我们当前的类DatabaseConnection</span></span><br><span class="line">        <span class="comment"># 实现单例模式，确保只创建一个数据库连接实例</span></span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 若我们的类里面的_instance变量没有被初始化，则创建一个新的实例</span></span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)  <span class="comment"># 调用父类的__new__方法，创建实例</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"创建新的数据库连接实例"</span>)  <span class="comment"># 打印日志</span></span><br><span class="line">        <span class="keyword">return</span> cls._instance  <span class="comment"># 返回单例实例</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host, user, password</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>,<span class="string">"initialized"</span>): <span class="comment"># 如果类对象身上</span></span><br><span class="line">            <span class="variable language_">self</span>.host = host</span><br><span class="line">            <span class="variable language_">self</span>.user = user</span><br><span class="line">            <span class="variable language_">self</span>.password = password</span><br><span class="line">            <span class="variable language_">self</span>.initialized = <span class="literal">True</span>  <span class="comment"># 初始化完成</span></span><br><span class="line">            <span class="variable language_">self</span>.connection = <span class="literal">None</span>  <span class="comment"># 数据库连接对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">connect</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 模拟数据库连接</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.connection:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"连接到数据库<span class="subst">{self.host}</span> 成功 \n 用户名：<span class="subst">{self.user}</span> \n 密码：<span class="subst">{self.password}</span>"</span>)</span><br><span class="line">            <span class="variable language_">self</span>.connection = <span class="literal">True</span>  <span class="comment"># 连接成功</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.connection</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 对象销毁时关闭连接</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.connection:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"关闭数据库连接：<span class="subst">{self.host}</span>"</span>)</span><br><span class="line">            <span class="variable language_">self</span>.connection = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">db1 = DatabaseConnection(<span class="string">"localhost"</span>, <span class="string">"admin"</span>, <span class="string">"password"</span>)</span><br><span class="line">db2 = DatabaseConnection(<span class="string">"localhost"</span>, <span class="string">"admin"</span>, <span class="string">"newpassword"</span>)  <span class="comment"># 不会创建新实例</span></span><br><span class="line"><span class="comment"># 判断两者是否为同一个实例</span></span><br><span class="line"><span class="built_in">print</span>(db1 <span class="keyword">is</span> db2)  <span class="comment"># True</span></span><br><span class="line">db1.connect()  <span class="comment"># 连接到数据库</span></span><br></pre></td></tr></tbody></table></figure><h5 id="2-对象表示"><a href="#2-对象表示" class="headerlink" title="2. 对象表示"></a>2. 对象表示</h5><table><thead><tr><th>方法名</th><th>描述</th><th>触发方式</th><th>使用场景</th></tr></thead><tbody><tr><td><code>__str__(self)</code></td><td>可读字符串表示</td><td><code>str(obj)</code>, <code>print(obj)</code></td><td>在直接输出类时标准化的输出类上面的所有属性</td></tr><tr><td><code>__repr__(self)</code></td><td>正式字符串表示</td><td><code>repr(obj)</code></td><td>为开发者提供详细信息，理想情况下应返回可重新创建对象的代码</td></tr></tbody></table><h6 id="实际应用场景：-1"><a href="#实际应用场景：-1" class="headerlink" title="实际应用场景："></a>实际应用场景：</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, <span class="built_in">id</span>, name, price</span>):</span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.price = price</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 返回用户友好的描述</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"<span class="subst">{self.name}</span> (¥<span class="subst">{self.price:<span class="number">.2</span>f}</span>)"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 返回可重新创建此对象的代码</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Product(id=<span class="subst">{self.<span class="built_in">id</span>!r}</span>, name=<span class="subst">{self.name!r}</span>, price=<span class="subst">{self.price!r}</span>)"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">apple = Product(<span class="number">1</span>, <span class="string">"苹果"</span>, <span class="number">5.99</span>)</span><br><span class="line"><span class="built_in">print</span>(apple)  <span class="comment"># 输出: 苹果 (¥5.99)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(apple))  <span class="comment"># 输出: Product(id=1, name='苹果', price=5.99)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在调试中的价值</span></span><br><span class="line">products = [</span><br><span class="line">    Product(<span class="number">1</span>, <span class="string">"苹果"</span>, <span class="number">5.99</span>),</span><br><span class="line">    Product(<span class="number">2</span>, <span class="string">"香蕉"</span>, <span class="number">3.50</span>)</span><br><span class="line">]</span><br><span class="line"><span class="built_in">print</span>(products)  <span class="comment"># 会显示完整的repr信息，有助于调试</span></span><br></pre></td></tr></tbody></table></figure><ul><li><p><code>__str__</code> 输出的是一个友好易读的字符串，适合用户查看。</p></li><li><p><code>__repr__</code> 输出的是一个更正式的字符串，通常能够通过 <code>eval()</code> 来重建该对象。</p></li><li><p><strong>示例 2：交互式环境中的 <code>__repr__</code></strong></p><p>在 Python 的交互式环境中（比如直接在命令行输入 <code>python</code>），当你打印一个对象时，如果对象有 <code>__repr__</code> 方法，通常会看到 <code>__repr__</code> 的返回值，而不是 <code>__str__</code>。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obj = MyClass(<span class="string">"Bob"</span>, <span class="number">25</span>)</span><br><span class="line">obj  <span class="comment"># 在交互式环境中，自动调用 __repr__</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyClass('Bob', 25)</span><br></pre></td></tr></tbody></table></figure></li></ul><ol start="3"><li><p><strong><code>__repr__</code> 的目标</strong></p><p><code>__repr__</code> 的设计目标是让对象的字符串表示能够作为一种明确、无歧义的代码表达式，最好能够让开发者通过 <code>eval()</code> 来重新构建该对象。例如，<code>__repr__</code> 返回的字符串应该是：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyClass(<span class="string">'Bob'</span>, <span class="number">25</span>)</span><br></pre></td></tr></tbody></table></figure><p>如果你运行 <code>eval("MyClass('Bob', 25)")</code>，它应该能够重新创建出一个与 <code>obj</code> 相同的 <code>MyClass</code> 实例。</p></li></ol><hr><h5 id="3-集合类操作"><a href="#3-集合类操作" class="headerlink" title="3. 集合类操作"></a>3. 集合类操作</h5><table><thead><tr><th>方法名</th><th>描述</th><th>触发方式</th><th>使用场景</th></tr></thead><tbody><tr><td><code>__len__(self)</code></td><td>获取对象长度</td><td><code>len(obj)</code></td><td>自定义集合的大小</td></tr><tr><td><code>__getitem__(self, key)</code></td><td>索引访问</td><td><code>obj[key]</code></td><td>使对象可通过索引或键访问</td></tr><tr><td><code>__setitem__(self, key, value)</code></td><td>索引赋值</td><td><code>obj[key] = value</code></td><td>允许通过索引设置值</td></tr><tr><td><code>__delitem__(self, key)</code></td><td>删除索引项</td><td><code>del obj[key]</code></td><td>允许通过索引删除项</td></tr><tr><td><code>__iter__(self)</code></td><td>返回迭代器</td><td><code>for x in obj</code></td><td>使对象可迭代</td></tr><tr><td><code>__next__(self)</code></td><td>返回下一个值</td><td><code>next(obj)</code></td><td>实现迭代器协议</td></tr><tr><td><code>__contains__(self, item)</code></td><td>成员检查</td><td><code>item in obj</code></td><td>自定义成员检查逻辑</td></tr></tbody></table><h6 id="实际应用场景：自定义商品购物车"><a href="#实际应用场景：自定义商品购物车" class="headerlink" title="实际应用场景：自定义商品购物车"></a>实际应用场景：自定义商品购物车</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, <span class="built_in">id</span>, name, price</span>):</span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.price = price</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""返回用户友好的描述"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"<span class="subst">{self.name}</span> (¥<span class="subst">{self.price:<span class="number">.2</span>f}</span>)"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""返回可重新创建此对象的代码"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Product(id=<span class="subst">{self.<span class="built_in">id</span>!r}</span>, name=<span class="subst">{self.name!r}</span>, price=<span class="subst">{self.price!r}</span>)"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span>:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    购物车类：管理用户选择的商品及其数量</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""初始化空购物车"""</span></span><br><span class="line">        <span class="variable language_">self</span>.items = {}  <span class="comment"># 商品ID -&gt; (商品, 数量)的映射</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">self, product, quantity=<span class="number">1</span></span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        增加商品到购物车</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        参数:</span></span><br><span class="line"><span class="string">            product (Product): 要添加的商品</span></span><br><span class="line"><span class="string">            quantity (int): 添加的数量，默认为1</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> product.<span class="built_in">id</span> <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="comment"># 如果商品已经在购物车中，更新数量</span></span><br><span class="line">            <span class="variable language_">self</span>.items[product.<span class="built_in">id</span>] = (product, <span class="variable language_">self</span>.items[product.<span class="built_in">id</span>][<span class="number">1</span>] + quantity)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果商品不在购物车中，直接添加</span></span><br><span class="line">            <span class="variable language_">self</span>.items[product.<span class="built_in">id</span>] = (product, quantity)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, product_id</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        支持通过索引访问: cart[product_id]</span></span><br><span class="line"><span class="string">        返回商品和数量的元组</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> product_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">raise</span> KeyError(<span class="string">f"商品ID <span class="subst">{product_id}</span> 不在购物车中"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.items[product_id]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, product_id, quantity</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        支持通过索引设置数量: cart[product_id] = quantity</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> product_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">raise</span> KeyError(<span class="string">f"商品ID <span class="subst">{product_id}</span> 不在购物车中"</span>)</span><br><span class="line">        product = <span class="variable language_">self</span>.items[product_id][<span class="number">0</span>]</span><br><span class="line">        <span class="variable language_">self</span>.items[product_id] = (product, quantity)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delitem__</span>(<span class="params">self, product_id</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        支持通过del删除商品: del cart[product_id]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> product_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">raise</span> KeyError(<span class="string">f"商品ID <span class="subst">{product_id}</span> 不在购物车中"</span>)</span><br><span class="line">        <span class="keyword">del</span> <span class="variable language_">self</span>.items[product_id]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""返回购物车中的商品种类数量"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.items)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""使购物车可迭代，返回商品和数量"""</span></span><br><span class="line">        <span class="keyword">for</span> product_id <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">yield</span> <span class="variable language_">self</span>.items[product_id]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__contains__</span>(<span class="params">self, product_id</span>):</span><br><span class="line">        <span class="string">"""支持成员检查: product_id in cart"""</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"__contains__被调用"</span>)</span><br><span class="line">        <span class="keyword">return</span> product_id <span class="keyword">in</span> <span class="variable language_">self</span>.items</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">total_price</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""计算购物车中所有商品的总价"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(product.price * quantity <span class="keyword">for</span> product, quantity <span class="keyword">in</span> <span class="variable language_">self</span>.items.values())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""用户友好的购物车展示"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"购物车为空"</span></span><br><span class="line"></span><br><span class="line">        cart_str = <span class="string">"购物车内容:\n"</span></span><br><span class="line">        <span class="keyword">for</span> product, quantity <span class="keyword">in</span> <span class="variable language_">self</span>.items.values():</span><br><span class="line">            cart_str += <span class="string">f"  <span class="subst">{product.name}</span> x <span class="subst">{quantity}</span>: ¥<span class="subst">{product.price * quantity:<span class="number">.2</span>f}</span>\n"</span></span><br><span class="line">        cart_str += <span class="string">f"总计: ¥<span class="subst">{self.total_price():<span class="number">.2</span>f}</span>"</span></span><br><span class="line">        <span class="keyword">return</span> cart_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 测试代码 =====</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"===== 创建商品 ====="</span>)</span><br><span class="line">apple = Product(<span class="number">1</span>, <span class="string">"苹果"</span>, <span class="number">5.99</span>)</span><br><span class="line">banana = Product(<span class="number">2</span>, <span class="string">"香蕉"</span>, <span class="number">3.50</span>)</span><br><span class="line">orange = Product(<span class="number">3</span>, <span class="string">"橙子"</span>, <span class="number">4.25</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"商品1: <span class="subst">{apple}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"商品2: <span class="subst">{banana}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"商品3: <span class="subst">{orange}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"商品repr: <span class="subst">{<span class="built_in">repr</span>(apple)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n===== 购物车基本操作 ====="</span>)</span><br><span class="line">cart = ShoppingCart()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"空购物车:"</span>, cart)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加商品测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n添加商品:"</span>)</span><br><span class="line">cart.add_item(apple, <span class="number">3</span>)</span><br><span class="line">cart.add_item(banana, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(cart)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加已有商品测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n添加已有商品:"</span>)</span><br><span class="line">cart.add_item(apple, <span class="number">2</span>)  <span class="comment"># 现在应该有5个苹果</span></span><br><span class="line"><span class="built_in">print</span>(cart)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过索引访问测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n通过索引访问:"</span>)</span><br><span class="line">apple_info = cart[<span class="number">1</span>]  <span class="comment"># 获取ID为1的商品信息</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"ID为1的商品信息: <span class="subst">{apple_info[<span class="number">0</span>].name}</span>, 数量: <span class="subst">{apple_info[<span class="number">1</span>]}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过索引修改数量测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n通过索引修改数量:"</span>)</span><br><span class="line">cart[<span class="number">2</span>] = <span class="number">4</span>  <span class="comment"># 将香蕉的数量改为4</span></span><br><span class="line"><span class="built_in">print</span>(cart)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除商品测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n删除商品:"</span>)</span><br><span class="line"><span class="keyword">del</span> cart[<span class="number">1</span>]  <span class="comment"># 删除苹果</span></span><br><span class="line"><span class="built_in">print</span>(cart)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 长度测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n购物车商品种类:"</span>, <span class="built_in">len</span>(cart))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 迭代购物车测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n迭代购物车中的商品:"</span>)</span><br><span class="line"><span class="keyword">for</span> product, quantity <span class="keyword">in</span> cart:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  <span class="subst">{product.name}</span>: <span class="subst">{quantity}</span>个"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 成员检查测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n成员检查:"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"香蕉在购物车中? <span class="subst">{<span class="number">2</span> <span class="keyword">in</span> cart}</span>"</span>)  <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"苹果在购物车中? <span class="subst">{<span class="number">1</span> <span class="keyword">in</span> cart}</span>"</span>)  <span class="comment"># False</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"橙子在购物车中? <span class="subst">{<span class="number">3</span> <span class="keyword">in</span> cart}</span>"</span>)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加新商品测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n添加新商品:"</span>)</span><br><span class="line">cart.add_item(orange, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(cart)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算总价测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n购物车总价: ¥{:.2f}"</span>.<span class="built_in">format</span>(cart.total_price()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误处理测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n===== 错误处理测试 ====="</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cart[<span class="number">4</span>]  <span class="comment"># 尝试访问不存在的商品</span></span><br><span class="line"><span class="keyword">except</span> KeyError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"预期的错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h5 id="4-调用与比较操作"><a href="#4-调用与比较操作" class="headerlink" title="4. 调用与比较操作"></a>4. 调用与比较操作</h5><p>我们这里主要讲 <code>__call__</code> 这个方法，有利于我们理解为什么 <code>__new__</code> 方法可以在对象实例化的时候调用</p><p>当我们调用一个对象，也就相当于 ↓</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name,age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"__call__ 被调用了"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.name, <span class="variable language_">self</span>.age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">"张三"</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p()) <span class="comment"># __call__ 被调用了    ('张三', 20)</span></span><br></pre></td></tr></tbody></table></figure><p>那么 Python 就会自动调用 obj 中的 <code>__call__</code> 方法，同样的，<code>__call__</code> 内的返回值也会传递给 obj</p><p>那么也就是说，如果想把一个对象变成一个可以加括号调用的对象，就在对象的类里面增添一个 <code>__call__</code> 方法</p><table><thead><tr><th>方法名</th><th>描述</th><th>触发方式</th><th>使用场景</th></tr></thead><tbody><tr><td><code>__call__(self, ...)</code></td><td>使对象可调用</td><td><code>obj()</code></td><td>创建可调用对象，函数式编程</td></tr><tr><td><code>__eq__(self, other)</code></td><td>相等比较</td><td><code>obj1 == obj2</code></td><td>自定义对象相等性</td></tr><tr><td><code>__lt__(self, other)</code></td><td>小于比较</td><td><code>obj1 &lt; obj2</code></td><td>自定义对象排序</td></tr><tr><td><code>__gt__(self, other)</code></td><td>大于比较</td><td><code>obj1 &gt; obj2</code></td><td>自定义对象排序</td></tr><tr><td><code>__le__(self, other)</code></td><td>小于等于</td><td><code>obj1 &lt;= obj2</code></td><td>自定义对象排序</td></tr><tr><td><code>__ge__(self, other)</code></td><td>大于等于</td><td><code>obj1 &gt;= obj2</code></td><td>自定义对象排序</td></tr><tr><td><code>__hash__(self)</code></td><td>计算哈希值</td><td><code>hash(obj)</code></td><td>允许对象作为字典键或集合元素</td></tr></tbody></table><h5 id="实际应用场景：数据分析器"><a href="#实际应用场景：数据分析器" class="headerlink" title="实际应用场景：数据分析器"></a>实际应用场景：数据分析器</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataAnalyzer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.data = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_data</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="comment"># 添加数据点</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"数据必须是数字类型"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.data.append(value)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, new_data=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="comment"># 调用对象时可以添加新数据并返回分析结果</span></span><br><span class="line">        <span class="keyword">if</span> new_data <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(new_data, <span class="built_in">list</span>):</span><br><span class="line">                <span class="keyword">for</span> value <span class="keyword">in</span> new_data:</span><br><span class="line">                    <span class="variable language_">self</span>.add_data(value)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="variable language_">self</span>.add_data(new_data)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.data:</span><br><span class="line">            <span class="keyword">return</span> {<span class="string">"count"</span>: <span class="number">0</span>, <span class="string">"sum"</span>: <span class="number">0</span>, <span class="string">"avg"</span>: <span class="number">0</span>, <span class="string">"min"</span>: <span class="literal">None</span>, <span class="string">"max"</span>: <span class="literal">None</span>}</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">"count"</span>: <span class="built_in">len</span>(<span class="variable language_">self</span>.data),</span><br><span class="line">            <span class="string">"sum"</span>: <span class="built_in">sum</span>(<span class="variable language_">self</span>.data),</span><br><span class="line">            <span class="string">"avg"</span>: <span class="built_in">sum</span>(<span class="variable language_">self</span>.data) / <span class="built_in">len</span>(<span class="variable language_">self</span>.data),</span><br><span class="line">            <span class="string">"min"</span>: <span class="built_in">min</span>(<span class="variable language_">self</span>.data),</span><br><span class="line">            <span class="string">"max"</span>: <span class="built_in">max</span>(<span class="variable language_">self</span>.data)</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 比较两个分析器的数据是否相同</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(other, DataAnalyzer):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.data == other.data</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__lt__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 根据数据平均值比较分析器</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(other, DataAnalyzer):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"只能与另一个DataAnalyzer比较"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.data <span class="keyword">or</span> <span class="keyword">not</span> other.data:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"无法比较空数据集"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(<span class="variable language_">self</span>.data)/<span class="built_in">len</span>(<span class="variable language_">self</span>.data) &lt; <span class="built_in">sum</span>(other.data)/<span class="built_in">len</span>(other.data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__hash__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 允许对象作为字典键，基于名称和数据的散列</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hash</span>((<span class="variable language_">self</span>.name, <span class="built_in">tuple</span>(<span class="variable language_">self</span>.data)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">analyzer1 = DataAnalyzer(<span class="string">"温度分析器"</span>)</span><br><span class="line">analyzer1.add_data(<span class="number">22.5</span>)</span><br><span class="line">analyzer1.add_data(<span class="number">23.1</span>)</span><br><span class="line">analyzer1.add_data(<span class="number">21.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过调用对象获取分析结果</span></span><br><span class="line"><span class="built_in">print</span>(analyzer1())  <span class="comment"># 输出分析结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数式用法 - 添加新数据并获取结果</span></span><br><span class="line">result = analyzer1([<span class="number">24.2</span>, <span class="number">22.9</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"更新后的分析结果: <span class="subst">{result}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建另一个分析器用于比较</span></span><br><span class="line">analyzer2 = DataAnalyzer(<span class="string">"湿度分析器"</span>)</span><br><span class="line">analyzer2([<span class="number">45</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">47</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较分析器</span></span><br><span class="line"><span class="keyword">if</span> analyzer1 &lt; analyzer2:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"<span class="subst">{analyzer1.name}</span>的平均值低于<span class="subst">{analyzer2.name}</span>"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"<span class="subst">{analyzer1.name}</span>的平均值高于或等于<span class="subst">{analyzer2.name}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用分析器作为字典键</span></span><br><span class="line">analyzers = {</span><br><span class="line">    analyzer1: <span class="string">"温度数据"</span>,</span><br><span class="line">    analyzer2: <span class="string">"湿度数据"</span></span><br><span class="line">}</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"字典中的分析器: <span class="subst">{<span class="built_in">list</span>(analyzers.values())}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h5 id="5-算术运算操作"><a href="#5-算术运算操作" class="headerlink" title="5. 算术运算操作"></a>5. 算术运算操作</h5><p>在我们通过内置的运算符需要频繁实现一些非常规四则运算时，可以重写四则运算方法，通过这样来快速的进行数学运算分析</p><table><thead><tr><th>方法名</th><th>描述</th><th>触发方式</th><th>使用场景</th></tr></thead><tbody><tr><td><code>__add__(self, other)</code></td><td>加法</td><td><code>obj1 + obj2</code></td><td>自定义对象相加</td></tr><tr><td><code>__sub__(self, other)</code></td><td>减法</td><td><code>obj1 - obj2</code></td><td>自定义对象相减</td></tr><tr><td><code>__mul__(self, other)</code></td><td>乘法</td><td><code>obj1 * obj2</code></td><td>自定义对象相乘</td></tr><tr><td><code>__truediv__(self, other)</code></td><td>除法</td><td><code>obj1 / obj2</code></td><td>自定义对象相除</td></tr></tbody></table><h6 id="实际应用场景：向量运算"><a href="#实际应用场景：向量运算" class="headerlink" title="实际应用场景：向量运算"></a>实际应用场景：向量运算</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vector2D</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x=<span class="number">0</span>, y=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 向量加法</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, Vector2D):</span><br><span class="line">            <span class="keyword">return</span> Vector2D(<span class="variable language_">self</span>.x + other.x, <span class="variable language_">self</span>.y + other.y)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(other, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="comment"># 支持向量与标量相加</span></span><br><span class="line">            <span class="keyword">return</span> Vector2D(<span class="variable language_">self</span>.x + other, <span class="variable language_">self</span>.y + other)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"不支持的操作数类型"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__sub__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 向量减法</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, Vector2D):</span><br><span class="line">            <span class="keyword">return</span> Vector2D(<span class="variable language_">self</span>.x - other.x, <span class="variable language_">self</span>.y - other.y)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(other, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="keyword">return</span> Vector2D(<span class="variable language_">self</span>.x - other, <span class="variable language_">self</span>.y - other)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"不支持的操作数类型"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 向量乘法(点积或标量乘法)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, Vector2D):</span><br><span class="line">            <span class="comment"># 向量点积</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.x * other.x + <span class="variable language_">self</span>.y * other.y</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(other, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="comment"># 向量与标量相乘</span></span><br><span class="line">            <span class="keyword">return</span> Vector2D(<span class="variable language_">self</span>.x * other, <span class="variable language_">self</span>.y * other)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"不支持的操作数类型"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__truediv__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 向量除法(仅支持标量除法)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="keyword">if</span> other == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> ZeroDivisionError(<span class="string">"除数不能为零"</span>)</span><br><span class="line">            <span class="keyword">return</span> Vector2D(<span class="variable language_">self</span>.x / other, <span class="variable language_">self</span>.y / other)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"向量只能被标量除"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">magnitude</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 向量长度</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">self</span>.x ** <span class="number">2</span> + <span class="variable language_">self</span>.y ** <span class="number">2</span>) ** <span class="number">0.5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">normalize</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 单位向量</span></span><br><span class="line">        mag = <span class="variable language_">self</span>.magnitude()</span><br><span class="line">        <span class="keyword">if</span> mag == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> Vector2D(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span> / mag</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Vector2D(<span class="subst">{self.x}</span>, <span class="subst">{self.y}</span>)"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Vector2D(x=<span class="subst">{self.x}</span>, y=<span class="subst">{self.y}</span>)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">v1 = Vector2D(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">v2 = Vector2D(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量加法</span></span><br><span class="line">v3 = v1 + v2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"v1 + v2 = <span class="subst">{v3}</span>"</span>)  <span class="comment"># Vector2D(4, 6)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量减法</span></span><br><span class="line">v4 = v1 - v2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"v1 - v2 = <span class="subst">{v4}</span>"</span>)  <span class="comment"># Vector2D(2, 2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量点积</span></span><br><span class="line">dot_product = v1 * v2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"v1 · v2 = <span class="subst">{dot_product}</span>"</span>)  <span class="comment"># 11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量缩放</span></span><br><span class="line">v5 = v1 * <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"v1 * 2 = <span class="subst">{v5}</span>"</span>)  <span class="comment"># Vector2D(6, 8)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量除法</span></span><br><span class="line">v6 = v1 / <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"v1 / 2 = <span class="subst">{v6}</span>"</span>)  <span class="comment"># Vector2D(1.5, 2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量长度和归一化</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"v1的长度: <span class="subst">{v1.magnitude()}</span>"</span>)  <span class="comment"># 5.0</span></span><br><span class="line">v7 = v1.normalize()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"v1的单位向量: <span class="subst">{v7}</span>"</span>)  <span class="comment"># Vector2D(0.6, 0.8)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"单位向量的长度: <span class="subst">{v7.magnitude()}</span>"</span>)  <span class="comment"># 1.0</span></span><br></pre></td></tr></tbody></table></figure><h5 id="6-属性访问控制"><a href="#6-属性访问控制" class="headerlink" title="6. 属性访问控制"></a>6. 属性访问控制</h5><table><thead><tr><th>方法名</th><th>描述</th><th>触发方式</th><th>使用场景</th></tr></thead><tbody><tr><td><code>__getattr__(self, name)</code></td><td>获取不存在的属性</td><td><code>obj.name</code> (name 不存在)</td><td>处理不存在的属性访问</td></tr><tr><td><code>__setattr__(self, name, value)</code></td><td>设置属性</td><td><code>obj.name = value</code></td><td>拦截所有属性赋值</td></tr><tr><td><code>__delattr__(self, name)</code></td><td>删除属性</td><td><code>del obj.name</code></td><td>拦截属性删除</td></tr></tbody></table><h6 id="实际应用场景：属性验证与保护"><a href="#实际应用场景：属性验证与保护" class="headerlink" title="实际应用场景：属性验证与保护"></a>实际应用场景：属性验证与保护</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProtectedObject</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._data = {}  <span class="comment"># 存储实际数据</span></span><br><span class="line">        <span class="variable language_">self</span>._protected = [<span class="string">'_data'</span>, <span class="string">'_protected'</span>]  <span class="comment"># 保护的属性列表</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getattr__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="comment"># 当访问不存在的属性时调用</span></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> <span class="variable language_">self</span>._data:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>._data[name]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录未知属性访问并返回None</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"警告: 尝试访问不存在的属性 '<span class="subst">{name}</span>'"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setattr__</span>(<span class="params">self, name, value</span>):</span><br><span class="line">        <span class="comment"># 拦截所有属性赋值</span></span><br><span class="line">        <span class="keyword">if</span> name.startswith(<span class="string">'_'</span>):</span><br><span class="line">            <span class="comment"># 允许设置内部属性</span></span><br><span class="line">            <span class="built_in">super</span>().__setattr__(name, value)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> <span class="variable language_">self</span>._protected:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">f"'<span class="subst">{name}</span>' 是受保护的属性，不能直接赋值"</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 验证并存储数据</span></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'age'</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">int</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"年龄必须是整数"</span>)</span><br><span class="line">        <span class="keyword">elif</span> name == <span class="string">'age'</span> <span class="keyword">and</span> (value &lt; <span class="number">0</span> <span class="keyword">or</span> value &gt; <span class="number">150</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"年龄必须在0-150之间"</span>)</span><br><span class="line">        <span class="keyword">elif</span> name == <span class="string">'email'</span> <span class="keyword">and</span> <span class="string">'@'</span> <span class="keyword">not</span> <span class="keyword">in</span> value:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"无效的电子邮件格式"</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 存储验证后的数据</span></span><br><span class="line">        <span class="variable language_">self</span>._data[name] = value</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"属性 '<span class="subst">{name}</span>' 设置为 <span class="subst">{value}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delattr__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="comment"># 拦截属性删除</span></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> <span class="variable language_">self</span>._protected:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">f"'<span class="subst">{name}</span>' 是受保护的属性，不能删除"</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> <span class="variable language_">self</span>._data:</span><br><span class="line">            <span class="keyword">del</span> <span class="variable language_">self</span>._data[name]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"已删除属性 '<span class="subst">{name}</span>'"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">f"'<span class="subst">{name}</span>' 属性不存在，无法删除"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"ProtectedObject(attributes=<span class="subst">{<span class="built_in">list</span>(self._data.keys())}</span>)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">person = ProtectedObject()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置属性(经过验证)</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">    person.age = <span class="number">30</span>  <span class="comment"># 通过验证</span></span><br><span class="line">    person.email = <span class="string">"zhangsan@example.com"</span>  <span class="comment"># 通过验证</span></span><br><span class="line">   </span><br><span class="line">    person.age = <span class="string">"三十"</span>  <span class="comment"># 类型错误</span></span><br><span class="line"><span class="keyword">except</span> (TypeError, ValueError) <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试访问不存在的属性</span></span><br><span class="line"><span class="built_in">print</span>(person.address)  <span class="comment"># 返回None并显示警告</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试删除属性</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">del</span> person.name  <span class="comment"># 正常删除</span></span><br><span class="line">    <span class="keyword">del</span> person._data  <span class="comment"># 尝试删除受保护属性</span></span><br><span class="line"><span class="keyword">except</span> AttributeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(person)  <span class="comment"># 显示当前属性</span></span><br></pre></td></tr></tbody></table></figure><h5 id="7-上下文管理（with-语句）"><a href="#7-上下文管理（with-语句）" class="headerlink" title="7. 上下文管理（with 语句）"></a>7. 上下文管理（with 语句）</h5><table><thead><tr><th>方法名</th><th>描述</th><th>触发方式</th><th>使用场景</th></tr></thead><tbody><tr><td><code>__enter__(self)</code></td><td>进入上下文</td><td><code>with obj as x:</code></td><td>资源获取，连接建立等</td></tr><tr><td><code>__exit__(self, exc_type, exc_val, exc_tb)</code></td><td>退出上下文</td><td><code>with</code> 块结束</td><td>资源释放，异常处理等</td></tr></tbody></table><h6 id="实际应用场景：数据库连接管理"><a href="#实际应用场景：数据库连接管理" class="headerlink" title="实际应用场景：数据库连接管理"></a>实际应用场景：数据库连接管理</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseConnection</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host, user, password, database</span>):</span><br><span class="line">        <span class="variable language_">self</span>.host = host</span><br><span class="line">        <span class="variable language_">self</span>.user = user</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line">        <span class="variable language_">self</span>.database = database</span><br><span class="line">        <span class="variable language_">self</span>.connection = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.transaction_active = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 进入上下文时建立连接</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"连接到数据库 <span class="subst">{self.host}</span>/<span class="subst">{self.database}</span>..."</span>)</span><br><span class="line">        <span class="variable language_">self</span>.connection = <span class="string">f"Connection to <span class="subst">{self.host}</span>/<span class="subst">{self.database}</span> as <span class="subst">{self.user}</span>"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="comment"># 退出上下文时处理异常并关闭连接</span></span><br><span class="line">        <span class="keyword">if</span> exc_type <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 发生异常时回滚事务</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.transaction_active:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"发生异常: <span class="subst">{exc_val}</span>，回滚事务"</span>)</span><br><span class="line">                <span class="variable language_">self</span>.rollback()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"异常信息: <span class="subst">{exc_type.__name__}</span>: <span class="subst">{exc_val}</span>"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 没有异常时提交事务</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.transaction_active:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"提交事务"</span>)</span><br><span class="line">                <span class="variable language_">self</span>.commit()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"关闭数据库连接: <span class="subst">{self.host}</span>"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.connection = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 返回False表示不抑制异常，让异常继续传播</span></span><br><span class="line">        <span class="comment"># 返回True表示抑制异常，异常不会传播到with语句之外</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># 不抑制异常</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">begin_transaction</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.connection:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">"数据库未连接"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"开始事务"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.transaction_active = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, sql</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.connection:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">"数据库未连接"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"执行SQL: <span class="subst">{sql}</span>"</span>)</span><br><span class="line">        <span class="comment"># 模拟SQL错误</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"ERROR"</span> <span class="keyword">in</span> sql:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"SQL语法错误"</span>)</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"SQL语法错误"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"执行结果: <span class="subst">{sql}</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">commit</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.connection:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">"数据库未连接"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"提交事务"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.transaction_active = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rollback</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.connection:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">"数据库未连接"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"回滚事务"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.transaction_active = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例 - 正常情况</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"=== 正常执行 ==="</span>)</span><br><span class="line"><span class="keyword">with</span> DatabaseConnection(<span class="string">"localhost"</span>, <span class="string">"admin"</span>, <span class="string">"password"</span>, <span class="string">"mydb"</span>) <span class="keyword">as</span> db:</span><br><span class="line">    db.begin_transaction()</span><br><span class="line">    db.execute(<span class="string">"SELECT * FROM users"</span>)</span><br><span class="line">    db.execute(<span class="string">"UPDATE users SET active = TRUE"</span>)</span><br><span class="line">    <span class="comment"># 自动提交事务并关闭连接</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例 - 异常情况</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n=== 有异常情况 ==="</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> DatabaseConnection(<span class="string">"localhost"</span>, <span class="string">"admin"</span>, <span class="string">"password"</span>, <span class="string">"mydb"</span>) <span class="keyword">as</span> db:</span><br><span class="line">        db.begin_transaction()</span><br><span class="line">        db.execute(<span class="string">"SELECT * FROM users"</span>)</span><br><span class="line">        db.execute(<span class="string">"UPDATE users SET ERROR = TRUE"</span>)  <span class="comment"># 这会触发异常</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"这一行不会执行"</span>)  <span class="comment"># 由于异常，这行不会执行</span></span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"捕获到异常: <span class="subst">{e}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h5 id="8-描述符与属性装饰器"><a href="#8-描述符与属性装饰器" class="headerlink" title="8. 描述符与属性装饰器"></a>8. 描述符与属性装饰器</h5><h6 id="描述符协议方法"><a href="#描述符协议方法" class="headerlink" title="描述符协议方法"></a>描述符协议方法</h6><table><thead><tr><th>方法</th><th>描述</th><th>触发条件</th><th>使用场景</th></tr></thead><tbody><tr><td><code>__get__(self, instance, owner)</code></td><td>获取属性值</td><td>访问属性时触发</td><td>自定义属性访问行为</td></tr><tr><td><code>__set__(self, instance, value)</code></td><td>设置属性值</td><td>属性赋值时触发</td><td>验证或转换属性值</td></tr><tr><td><code>__delete__(self, instance)</code></td><td>删除属性</td><td>删除属性时触发</td><td>自定义属性删除行为</td></tr></tbody></table><h6 id="实际应用场景：数据验证描述符"><a href="#实际应用场景：数据验证描述符" class="headerlink" title="实际应用场景：数据验证描述符"></a>实际应用场景：数据验证描述符</h6><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    name = StringValidator(min_length=<span class="number">2</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    age = NumberValidator(min_value=<span class="number">0</span>, max_value=<span class="number">150</span>, type_=<span class="built_in">int</span>)</span><br><span class="line">    email = StringValidator(pattern=<span class="string">r'^[\w.-]+@[\w.-]+\.\w+$'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, email</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">        <span class="variable language_">self</span>.email = email</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Person(name='<span class="subst">{self.name}</span>', age=<span class="subst">{self.age}</span>, email='<span class="subst">{self.email}</span>')"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 创建有效的Person对象</span></span><br><span class="line">    p1 = Person(<span class="string">"张三"</span>, <span class="number">30</span>, <span class="string">"zhangsan@example.com"</span>)</span><br><span class="line">    <span class="built_in">print</span>(p1)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试设置无效的值</span></span><br><span class="line">    p1.name = <span class="string">"李"</span>  <span class="comment"># 名字太短</span></span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"验证错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    p1.age = <span class="string">"三十"</span>  <span class="comment"># 类型错误</span></span><br><span class="line"><span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"类型错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    p1.email = <span class="string">"invalid-email"</span>  <span class="comment"># 无效的邮箱格式</span></span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"验证错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置有效值</span></span><br><span class="line">p1.name = <span class="string">"李四"</span></span><br><span class="line">p1.age = <span class="number">25</span></span><br><span class="line">p1.email = <span class="string">"lisi@example.com"</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"更新后: <span class="subst">{p1}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><h6 id="属性装饰器-property-实际应用"><a href="#属性装饰器-property-实际应用" class="headerlink" title="属性装饰器(@property)实际应用"></a>属性装饰器(@property)实际应用</h6><p>属性装饰器是 Python 中实现属性的更简洁方式，它允许我们用方法行为来定义属性。以下是一个成绩管理系统的示例：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, student_id</span>):</span><br><span class="line">        <span class="variable language_">self</span>._name = name</span><br><span class="line">        <span class="variable language_">self</span>._student_id = student_id</span><br><span class="line">        <span class="variable language_">self</span>._scores = {}  <span class="comment"># 课程 -&gt; 分数的映射</span></span><br><span class="line">        <span class="variable language_">self</span>._attendance = {}  <span class="comment"># 日期 -&gt; 出勤状态的映射</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""学生姓名，只读属性"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._name</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">student_id</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""学生ID，只读属性"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._student_id</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">scores</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""获取成绩副本，防止外部直接修改"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._scores.copy()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_score</span>(<span class="params">self, course, score</span>):</span><br><span class="line">        <span class="string">"""添加或更新课程成绩"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(score, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"成绩必须是数字"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= score &lt;= <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"成绩必须在0到100之间"</span>)</span><br><span class="line">        <span class="variable language_">self</span>._scores[course] = score</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">average_score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""计算平均成绩"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._scores:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(<span class="variable language_">self</span>._scores.values()) / <span class="built_in">len</span>(<span class="variable language_">self</span>._scores)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">grade_point</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""计算绩点(GPA)"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._scores:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 成绩到绩点的映射</span></span><br><span class="line">        grade_map = {</span><br><span class="line">            <span class="string">'A'</span>: <span class="number">4.0</span>,  <span class="comment"># 90-100</span></span><br><span class="line">            <span class="string">'B'</span>: <span class="number">3.0</span>,  <span class="comment"># 80-89</span></span><br><span class="line">            <span class="string">'C'</span>: <span class="number">2.0</span>,  <span class="comment"># 70-79</span></span><br><span class="line">            <span class="string">'D'</span>: <span class="number">1.0</span>,  <span class="comment"># 60-69</span></span><br><span class="line">            <span class="string">'F'</span>: <span class="number">0.0</span>   <span class="comment"># 0-59</span></span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算每门课的绩点</span></span><br><span class="line">        points = []</span><br><span class="line">        <span class="keyword">for</span> score <span class="keyword">in</span> <span class="variable language_">self</span>._scores.values():</span><br><span class="line">            <span class="keyword">if</span> score &gt;= <span class="number">90</span>:</span><br><span class="line">                points.append(grade_map[<span class="string">'A'</span>])</span><br><span class="line">            <span class="keyword">elif</span> score &gt;= <span class="number">80</span>:</span><br><span class="line">                points.append(grade_map[<span class="string">'B'</span>])</span><br><span class="line">            <span class="keyword">elif</span> score &gt;= <span class="number">70</span>:</span><br><span class="line">                points.append(grade_map[<span class="string">'C'</span>])</span><br><span class="line">            <span class="keyword">elif</span> score &gt;= <span class="number">60</span>:</span><br><span class="line">                points.append(grade_map[<span class="string">'D'</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                points.append(grade_map[<span class="string">'F'</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(points) / <span class="built_in">len</span>(points)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">record_attendance</span>(<span class="params">self, date, status</span>):</span><br><span class="line">        <span class="string">"""记录出勤状态"""</span></span><br><span class="line">        <span class="keyword">if</span> status <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'present'</span>, <span class="string">'absent'</span>, <span class="string">'late'</span>]:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"出勤状态必须是 'present', 'absent' 或 'late'"</span>)</span><br><span class="line">        <span class="variable language_">self</span>._attendance[date] = status</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attendance_rate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""计算出勤率"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._attendance:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1.0</span>  <span class="comment"># 默认100%</span></span><br><span class="line">            </span><br><span class="line">        present_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> status <span class="keyword">in</span> <span class="variable language_">self</span>._attendance.values() <span class="keyword">if</span> status == <span class="string">'present'</span>)</span><br><span class="line">        late_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> status <span class="keyword">in</span> <span class="variable language_">self</span>._attendance.values() <span class="keyword">if</span> status == <span class="string">'late'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 迟到计为0.5次出勤</span></span><br><span class="line">        <span class="keyword">return</span> (present_count + <span class="number">0.5</span> * late_count) / <span class="built_in">len</span>(<span class="variable language_">self</span>._attendance)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"学生: <span class="subst">{self._name}</span> (ID: <span class="subst">{self._student_id}</span>), 平均分: <span class="subst">{self.average_score:<span class="number">.1</span>f}</span>, GPA: <span class="subst">{self.grade_point:<span class="number">.2</span>f}</span>"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">student = Student(<span class="string">"王小明"</span>, <span class="string">"S12345"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加课程成绩</span></span><br><span class="line">student.add_score(<span class="string">"数学"</span>, <span class="number">92</span>)</span><br><span class="line">student.add_score(<span class="string">"物理"</span>, <span class="number">85</span>)</span><br><span class="line">student.add_score(<span class="string">"化学"</span>, <span class="number">78</span>)</span><br><span class="line">student.add_score(<span class="string">"语文"</span>, <span class="number">88</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录出勤</span></span><br><span class="line">student.record_attendance(<span class="string">"2025-04-01"</span>, <span class="string">"present"</span>)</span><br><span class="line">student.record_attendance(<span class="string">"2025-04-02"</span>, <span class="string">"present"</span>)</span><br><span class="line">student.record_attendance(<span class="string">"2025-04-03"</span>, <span class="string">"late"</span>)</span><br><span class="line">student.record_attendance(<span class="string">"2025-04-04"</span>, <span class="string">"absent"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问属性</span></span><br><span class="line"><span class="built_in">print</span>(student)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"学生姓名: <span class="subst">{student.name}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"学生ID: <span class="subst">{student.student_id}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"课程成绩: <span class="subst">{student.scores}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"平均分: <span class="subst">{student.average_score:<span class="number">.1</span>f}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"GPA: <span class="subst">{student.grade_point:<span class="number">.2</span>f}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"出勤率: <span class="subst">{student.attendance_rate:<span class="number">.1</span>%}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试修改只读属性</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    student.name = <span class="string">"张三"</span>  <span class="comment"># 这会失败，因为name是只读属性</span></span><br><span class="line"><span class="keyword">except</span> AttributeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有课程及分数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n所有课程成绩:"</span>)</span><br><span class="line"><span class="keyword">for</span> course, score <span class="keyword">in</span> student.scores.items():</span><br><span class="line">    grade = <span class="string">""</span></span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">90</span>: grade = <span class="string">"A"</span></span><br><span class="line">    <span class="keyword">elif</span> score &gt;= <span class="number">80</span>: grade = <span class="string">"B"</span></span><br><span class="line">    <span class="keyword">elif</span> score &gt;= <span class="number">70</span>: grade = <span class="string">"C"</span></span><br><span class="line">    <span class="keyword">elif</span> score &gt;= <span class="number">60</span>: grade = <span class="string">"D"</span></span><br><span class="line">    <span class="keyword">else</span>: grade = <span class="string">"F"</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"  <span class="subst">{course}</span>: <span class="subst">{score}</span> (<span class="subst">{grade}</span>)"</span>)</span><br></pre></td></tr></tbody></table></figure><h5 id="10-常见特殊方法使用陷阱与最佳实践"><a href="#10-常见特殊方法使用陷阱与最佳实践" class="headerlink" title="10. 常见特殊方法使用陷阱与最佳实践"></a>10. 常见特殊方法使用陷阱与最佳实践</h5><h6 id="陷阱与注意事项"><a href="#陷阱与注意事项" class="headerlink" title="陷阱与注意事项"></a>陷阱与注意事项</h6><ol><li><strong><code>__init__</code> vs <code>__new__</code></strong>：<ul><li><strong>陷阱</strong>：混淆这两个方法的用途和调用顺序。</li><li><strong>最佳实践</strong>：除非实现元类或单例模式，一般只需重写 <code>__init__</code>。</li></ul></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 错误示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BadVector</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 错误：返回元组而非同类型的对象</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">self</span>.x + other.x, <span class="variable language_">self</span>.y + other.y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodVector</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 正确：返回同类型对象</span></span><br><span class="line">        <span class="keyword">return</span> GoodVector(<span class="variable language_">self</span>.x + other.x, <span class="variable language_">self</span>.y + other.y)</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong><code>__eq__</code> 和 <code>__hash__</code></strong>：<ul><li><strong>陷阱</strong>：实现 <code>__eq__</code> 而不实现 <code>__hash__</code>，导致对象无法用作字典键。</li><li><strong>最佳实践</strong>：如果重写 <code>__eq__</code>，也应该重写 <code>__hash__</code> 或设置 <code>__hash__ = None</code> 使对象不可哈希。</li></ul></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(other, Person):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.name == other.name <span class="keyword">and</span> <span class="variable language_">self</span>.age == other.age</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果不实现__hash__，对象将不可哈希</span></span><br><span class="line">    <span class="comment"># 选项1：使对象不可哈希</span></span><br><span class="line">    __hash__ = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 选项2：实现兼容的哈希方法</span></span><br><span class="line">    <span class="comment"># def __hash__(self):</span></span><br><span class="line">    <span class="comment">#     return hash((self.name, self.age))</span></span><br></pre></td></tr></tbody></table></figure><ol start="4"><li><strong>递归问题</strong>：<ul><li><strong>陷阱</strong>：在特殊方法中无限递归调用自身。</li><li><strong>最佳实践</strong>：避免在特殊方法中使用可能触发同一方法的操作。</li></ul></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BadString</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 错误：这会导致无限递归</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"BadString: <span class="subst">{self}</span>"</span>  <span class="comment"># 递归调用__str__</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodString</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 正确：使用原始值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"GoodString: <span class="subst">{self.value}</span>"</span></span><br></pre></td></tr></tbody></table></figure><ol start="5"><li><strong><code>__bool__</code> 和 <code>__len__</code></strong>：<ul><li><strong>陷阱</strong>：不了解这两个方法的优先级和用途。</li><li><strong>最佳实践</strong>：<code>__bool__</code> 优先于 <code>__len__</code>；对于集合类，实现 <code>__len__</code>；对于真假逻辑，实现 <code>__bool__</code>。</li></ul></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataCollection</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.data = data <span class="keyword">or</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 返回集合长度</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__bool__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 特殊逻辑：即使长度为0，如果有特定标记也认为是True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bool</span>(<span class="variable language_">self</span>.data) <span class="keyword">or</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>, <span class="string">'special_flag'</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="6"><li><strong>反向方法失效</strong>：<ul><li><strong>陷阱</strong>：忽略实现反向操作方法（如 <code>__radd__</code>）。</li><li><strong>最佳实践</strong>：为算术操作同时实现普通方法和反向方法。</li></ul></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SafeNumber</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 普通加法: self + other</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="keyword">return</span> SafeNumber(<span class="variable language_">self</span>.value + other)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, SafeNumber):</span><br><span class="line">            <span class="keyword">return</span> SafeNumber(<span class="variable language_">self</span>.value + other.value)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span>  <span class="comment"># 告诉Python尝试反向操作</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__radd__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="comment"># 反向加法: other + self</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="keyword">return</span> SafeNumber(other + <span class="variable language_">self</span>.value)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"SafeNumber(<span class="subst">{self.value}</span>)"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">num = SafeNumber(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(num + <span class="number">3</span>)       <span class="comment"># SafeNumber + int</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">3</span> + num)       <span class="comment"># int + SafeNumber (触发__radd__)</span></span><br></pre></td></tr></tbody></table></figure><h5 id="11-总结：特殊方法的选择指南"><a href="#11-总结：特殊方法的选择指南" class="headerlink" title="11. 总结：特殊方法的选择指南"></a>11. 总结：特殊方法的选择指南</h5><table><thead><tr><th>需求</th><th>推荐实现的特殊方法</th><th>注意事项</th></tr></thead><tbody><tr><td>初始化和配置对象</td><td><code>__init__</code></td><td>保持简单，仅做必要设置</td></tr><tr><td>自定义对象创建</td><td><code>__new__</code></td><td>谨慎使用，主要用于元类和单例</td></tr><tr><td>字符串表示</td><td><code>__str__</code>, <code>__repr__</code></td><td><code>__repr__</code> 应提供准确代表对象的信息</td></tr><tr><td>集合或容器行为</td><td><code>__len__</code>, <code>__getitem__</code>, <code>__setitem__</code>, <code>__delitem__</code>, <code>__iter__</code></td><td>保持与 Python 内置类型一致的行为</td></tr><tr><td>对象比较和哈希</td><td><code>__eq__</code>, <code>__lt__</code>, <code>__gt__</code>, <code>__hash__</code></td><td>注意 <code>__eq__</code> 和 <code>__hash__</code> 的兼容性</td></tr><tr><td>算术运算</td><td><code>__add__</code>, <code>__sub__</code>, <code>__mul__</code>, 以及对应的反向方法</td><td>对不兼容类型返回 <code>NotImplemented</code></td></tr><tr><td>属性访问控制</td><td><code>__getattr__</code>, <code>__setattr__</code>, <code>__getattribute__</code></td><td>注意避免递归调用</td></tr><tr><td>资源管理</td><td><code>__enter__</code>, <code>__exit__</code></td><td>确保资源正确释放，处理异常</td></tr><tr><td>描述符协议</td><td><code>__get__</code>, <code>__set__</code>, <code>__delete__</code></td><td>用于创建可重用的属性行为</td></tr></tbody></table><h3 id="对象与类的高级概念"><a href="#对象与类的高级概念" class="headerlink" title="对象与类的高级概念"></a>对象与类的高级概念</h3><h4 id="深入理解实例、类和元类关系"><a href="#深入理解实例、类和元类关系" class="headerlink" title="深入理解实例、类和元类关系"></a>深入理解实例、类和元类关系</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个普通类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Value: <span class="subst">{self.value}</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建类的实例</span></span><br><span class="line">obj = MyClass(<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印并验证三个层次的关系</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"=== 三个层次的关系 ==="</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"obj.__class__ is MyClass: <span class="subst">{obj.__class__ <span class="keyword">is</span> MyClass}</span>"</span>)  <span class="comment"># True - 实例的类是MyClass</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"MyClass.__class__ is type: <span class="subst">{MyClass.__class__ <span class="keyword">is</span> <span class="built_in">type</span>}</span>"</span>)  <span class="comment"># True - 类的类是type(元类)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"type.__class__ is type: <span class="subst">{<span class="built_in">type</span>.__class__ <span class="keyword">is</span> <span class="built_in">type</span>}</span>"</span>)  <span class="comment"># True - type是自己的元类</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印并验证继承关系</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n=== 继承关系 ==="</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"issubclass(MyClass, object): <span class="subst">{<span class="built_in">issubclass</span>(MyClass, <span class="built_in">object</span>)}</span>"</span>)  <span class="comment"># True - 所有类都继承自object</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"issubclass(type, object): <span class="subst">{<span class="built_in">issubclass</span>(<span class="built_in">type</span>, <span class="built_in">object</span>)}</span>"</span>)  <span class="comment"># True - type也继承自object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印并验证元类关系</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n=== 元类关系 ==="</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"type(obj) is MyClass: <span class="subst">{<span class="built_in">type</span>(obj) <span class="keyword">is</span> MyClass}</span>"</span>)  <span class="comment"># True - 实例的类型是MyClass</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"type(MyClass) is type: <span class="subst">{<span class="built_in">type</span>(MyClass) <span class="keyword">is</span> <span class="built_in">type</span>}</span>"</span>)  <span class="comment"># True - 类的类型是type</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"type(type) is type: <span class="subst">{<span class="built_in">type</span>(<span class="built_in">type</span>) <span class="keyword">is</span> <span class="built_in">type</span>}</span>"</span>)  <span class="comment"># True - type的类型也是type</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 展示类型检查</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n=== 类型检查 ==="</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"isinstance(obj, MyClass): <span class="subst">{<span class="built_in">isinstance</span>(obj, MyClass)}</span>"</span>)  <span class="comment"># True - obj是MyClass的实例</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"isinstance(MyClass, type): <span class="subst">{<span class="built_in">isinstance</span>(MyClass, <span class="built_in">type</span>)}</span>"</span>)  <span class="comment"># True - MyClass是type的实例</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"isinstance(type, type): <span class="subst">{<span class="built_in">isinstance</span>(<span class="built_in">type</span>, <span class="built_in">type</span>)}</span>"</span>)  <span class="comment"># True - type是自己的实例</span></span><br></pre></td></tr></tbody></table></figure><h4 id="属性查找的复杂情况"><a href="#属性查找的复杂情况" class="headerlink" title="属性查找的复杂情况"></a>属性查找的复杂情况</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Mytype</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="string">'''实现自定义元类，并定义元类方法'''</span></span><br><span class="line">    attr = <span class="string">'元类属性'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">meta_method</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"调用元方法 "</span> + cls.__name__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>:</span><br><span class="line">    attr = <span class="string">'父类属性'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parent_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"调用父类方法"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span>(Parent, metaclass=Mytype):</span><br><span class="line">    attr = <span class="string">'子类属性'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">child_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"调用子类方法"</span></span><br><span class="line"></span><br><span class="line">obj = Child()</span><br><span class="line"><span class="comment">## 对象属性查找:</span></span><br><span class="line"><span class="built_in">print</span>(obj.attr)  <span class="comment"># '子类属性'（首先在实例中查找，然后是类，然后是父类）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 类属性查找:</span></span><br><span class="line"><span class="built_in">print</span>(Child.attr)  <span class="comment"># '子类属性'（首先在类中查找，然后是父类，然后是元类）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法查找:</span></span><br><span class="line"><span class="built_in">print</span>(obj.child_method())  <span class="comment"># '调用子类方法'</span></span><br><span class="line"><span class="built_in">print</span>(obj.parent_method())  <span class="comment"># '调用父类方法'（从父类继承）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 元类方法：</span></span><br><span class="line"><span class="built_in">print</span>(Child.meta_method())  <span class="comment"># '调用元方法 Child'（从元类获取）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除子类属性，回退到父类:</span></span><br><span class="line"><span class="keyword">del</span> Child.attr</span><br><span class="line"><span class="built_in">print</span>(Child.attr)  <span class="comment"># '父类属性'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除父类属性，回退到元类:</span></span><br><span class="line"><span class="keyword">del</span> Parent.attr</span><br><span class="line"><span class="built_in">print</span>(Child.attr)  <span class="comment"># '元类属性'</span></span><br></pre></td></tr></tbody></table></figure><h3 id="内存管理与对象生命周期"><a href="#内存管理与对象生命周期" class="headerlink" title="内存管理与对象生命周期"></a>内存管理与对象生命周期</h3><h4 id="对象创建和销毁的完整过程"><a href="#对象创建和销毁的完整过程" class="headerlink" title="对象创建和销毁的完整过程"></a>对象创建和销毁的完整过程</h4><table><thead><tr><th>阶段</th><th>触发方法</th><th>描述</th></tr></thead><tbody><tr><td>创建</td><td><code>__new__</code></td><td>分配内存并创建实例</td></tr><tr><td>初始化</td><td><code>__init__</code></td><td>初始化实例属性</td></tr><tr><td>表示</td><td><code>__repr__</code>, <code>__str__</code></td><td>定义对象的字符串表示</td></tr><tr><td>使用</td><td>各种操作符和方法</td><td>对象的正常使用期</td></tr><tr><td>销毁</td><td><code>__del__</code></td><td>对象不再被引用时的清理</td></tr></tbody></table><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ResourceManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"1. __new__: 分配内存"</span>)</span><br><span class="line">        instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"2. __init__: 初始化对象"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">        <span class="variable language_">self</span>._resource = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"ResourceManager(name='<span class="subst">{self.name}</span>', value=<span class="subst">{self.value}</span>)"</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Resource '<span class="subst">{self.name}</span>' with value <span class="subst">{self.value}</span>"</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">acquire</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Acquiring resource: <span class="subst">{self.name}</span>"</span>)</span><br><span class="line">        <span class="variable language_">self</span>._resource = <span class="string">f"RESOURCE_<span class="subst">{self.name}</span>_<span class="subst">{<span class="built_in">id</span>(self)}</span>"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._resource</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">release</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._resource:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"Explicitly releasing: <span class="subst">{self._resource}</span>"</span>)</span><br><span class="line">            <span class="variable language_">self</span>._resource = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"3. __del__: 清理 '<span class="subst">{self.name}</span>'"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._resource:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"Warning: 资源 <span class="subst">{self._resource}</span> 在销毁时仍未释放"</span>)</span><br><span class="line">            <span class="variable language_">self</span>.release()</span><br><span class="line">            </span><br><span class="line"><span class="comment">## 创建和使用对象</span></span><br><span class="line">rm = ResourceManager(<span class="string">"db_connection"</span>, <span class="number">42</span>)</span><br><span class="line"><span class="built_in">print</span>(rm)  <span class="comment"># 调用__str__</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(rm))  <span class="comment"># 调用__repr__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用资源</span></span><br><span class="line">res = rm.acquire()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"使用资源: <span class="subst">{res}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 两种清理方式:</span></span><br><span class="line"><span class="comment">## 1. 显式释放 (推荐)</span></span><br><span class="line">rm.release()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2. 依赖垃圾回收 (不推荐)</span></span><br><span class="line"><span class="comment">## rm = None  # 删除引用，触发垃圾回收</span></span><br></pre></td></tr></tbody></table></figure><h4 id="引用计数和循环引用"><a href="#引用计数和循环引用" class="headerlink" title="引用计数和循环引用"></a>引用计数和循环引用</h4><p>Python 的内存管理主要依靠引用计数</p><ul><li>每个对象都有一个引用计数器，记录有多少个引用指向该对象</li><li>当引用计数降为 0 时，对象会被自动销毁，内存被释放</li><li><code>sys.getrefcount()</code> 函数可以查看对象的引用计数</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> gc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.children = []</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"创建节点: <span class="subst">{name}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_child</span>(<span class="params">self, child</span>):</span><br><span class="line">        <span class="variable language_">self</span>.children.append(child)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"删除节点: <span class="subst">{self.name}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建节点</span></span><br><span class="line">node1 = Node(<span class="string">"A"</span>)</span><br><span class="line">node2 = Node(<span class="string">"B"</span>)</span><br><span class="line">node3 = Node(<span class="string">"C"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建循环引用</span></span><br><span class="line">node1.add_child(node2)</span><br><span class="line">node2.add_child(node3)</span><br><span class="line">node3.add_child(node1)  <span class="comment"># 循环引用!</span></span><br><span class="line"><span class="comment">#     +-------+</span></span><br><span class="line"><span class="comment">#     |       v</span></span><br><span class="line"><span class="comment"># node1(A) → node2(B)</span></span><br><span class="line"><span class="comment">#     ^       |</span></span><br><span class="line"><span class="comment">#     |       v</span></span><br><span class="line"><span class="comment">#     +--- node3(C)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建弱引用或保存ID以便后续检查</span></span><br><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line"></span><br><span class="line">node_refs = [weakref.ref(node1), weakref.ref(node2), weakref.ref(node3)]</span><br><span class="line">node_ids = [<span class="built_in">id</span>(node1), <span class="built_in">id</span>(node2), <span class="built_in">id</span>(node3)]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除外部引用</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"删除对节点的外部引用..."</span>)</span><br><span class="line"><span class="keyword">del</span> node1</span><br><span class="line"><span class="keyword">del</span> node2</span><br><span class="line"><span class="keyword">del</span> node3</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"垃圾回收前..."</span>)</span><br><span class="line"><span class="comment"># 检查对象是否还存在</span></span><br><span class="line"><span class="keyword">for</span> i, ref <span class="keyword">in</span> <span class="built_in">enumerate</span>(node_refs):</span><br><span class="line">    obj = ref()</span><br><span class="line">    <span class="keyword">if</span> obj <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"节点<span class="subst">{<span class="built_in">chr</span>(<span class="number">65</span> + i)}</span>仍然存在于内存中"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"手动触发垃圾回收..."</span>)</span><br><span class="line">gc.collect()  <span class="comment"># 强制运行垃圾回收</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"垃圾回收后..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次检查对象是否存在</span></span><br><span class="line"><span class="keyword">for</span> i, ref <span class="keyword">in</span> <span class="built_in">enumerate</span>(node_refs):</span><br><span class="line">    obj = ref()</span><br><span class="line">    <span class="keyword">if</span> obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"节点<span class="subst">{<span class="built_in">chr</span>(<span class="number">65</span> + i)}</span>已被回收"</span>) <span class="comment"># 不可能进这个判断，因为存在计数引用和循环引用问题</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="高级常用设计模式"><a href="#高级常用设计模式" class="headerlink" title="高级常用设计模式"></a>高级常用设计模式</h3><h4 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line">        </span><br><span class="line"><span class="comment">## ======================================或使用元类实现========================================================</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    _instance = {}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> cls._instance: <span class="comment"># 若cls没有实例化过，则新建一个实例</span></span><br><span class="line">            cls._instance[cls] = <span class="built_in">super</span>().__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._instance[cls] <span class="comment"># 返回cls的实例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Database</span>(metaclass=SingletonMeta):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connection_string=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> connection_string:</span><br><span class="line">            <span class="variable language_">self</span>.connection_string = connection_string</span><br><span class="line"></span><br><span class="line">db1 = Database(<span class="string">'mysql://user:password@localhost/database'</span>)</span><br><span class="line">db2 = Database(<span class="string">'sqlite:///database.db'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(db1 <span class="keyword">is</span> db2) <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## ======================================或使用装饰器实现========================================================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Singleton</span>(<span class="params">cls</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    单例模式装饰器</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    参数 cls 是被装饰的类，当使用 @Singleton 语法时，Python 解释器会自动将</span></span><br><span class="line"><span class="string">    被装饰的类作为第一个参数传递给装饰器函数。</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    装饰器工作原理：</span></span><br><span class="line"><span class="string">    1. 当使用 @Singleton 装饰 MyClass 时，Python 实际上执行了 MyClass = Singleton(MyClass)</span></span><br><span class="line"><span class="string">    2. Singleton 函数接收 MyClass 作为 cls 参数</span></span><br><span class="line"><span class="string">    3. Singleton 返回 get_instance 函数，该函数替代了原始的 MyClass</span></span><br><span class="line"><span class="string">    4. 当我们调用 MyClass() 时，实际上调用的是 get_instance()</span></span><br><span class="line"><span class="string">    5. get_instance 函数内部可以访问 cls，因为它是一个闭包，能够访问外部函数的变量</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    _instance = {}  <span class="comment"># 用于存储每个类的单例实例</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_instance</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> _instance:</span><br><span class="line">            <span class="comment"># 如果该类的实例不存在，则创建一个新实例</span></span><br><span class="line">            _instance[cls] = cls(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 返回该类的单例实例</span></span><br><span class="line">        <span class="keyword">return</span> _instance[cls]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> get_instance</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton </span><span class="comment"># 这里相当于 MyClass = Singleton(MyClass)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class1 = MyClass(<span class="string">"John"</span>)</span><br><span class="line">class2 = MyClass(<span class="string">"Mary"</span>)</span><br><span class="line"><span class="built_in">print</span>(class1.name)  <span class="comment"># John</span></span><br><span class="line"><span class="built_in">print</span>(class2.name)  <span class="comment"># John</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h5 id="懒汉式单例模式的使用场景"><a href="#懒汉式单例模式的使用场景" class="headerlink" title="懒汉式单例模式的使用场景"></a>懒汉式单例模式的使用场景</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># singleton.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = <span class="string">"我是单例的"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在模块级别创建实例</span></span><br><span class="line">instance = Singleton()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他文件中使用</span></span><br><span class="line"><span class="keyword">from</span> singleton <span class="keyword">import</span> instance</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(instance.some_method())  <span class="comment"># 输出: 我是单例的</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>懒汉式单例模式在以下情况特别适用：</p><ol><li><strong>资源密集型对象</strong>：当创建实例需要消耗大量资源（如数据库连接、文件系统操作等），懒汉式可以推迟实例化，直到真正需要时才创建。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseConnection</span>:</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"创建新的数据库连接..."</span>)</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connection_string=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="comment"># 初始化只在首次创建时执行</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>, <span class="string">'initialized'</span>):</span><br><span class="line">            <span class="variable language_">self</span>.connection_string = connection_string</span><br><span class="line">            <span class="variable language_">self</span>.initialized = <span class="literal">True</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"连接到: <span class="subst">{connection_string}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>配置管理器</strong>：应用程序的配置管理器通常是单例的，且配置加载可能很耗时。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigManager</span>:</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">            cls._instance.load_config()</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_config</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"从文件加载配置..."</span>)</span><br><span class="line">        <span class="comment"># 模拟加载配置文件的耗时操作</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>应用程序状态管理</strong>：当需要全局访问应用状态但又不希望在程序启动时立即初始化时。</li></ol><p>元类实现方式适合需要更灵活控制实例化过程的场景，特别是需要根据参数动态决定实例化行为的情况：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 日志管理器单例，可以根据不同的日志级别创建不同配置的单例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggerMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    _instances = {}</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">cls, log_level=<span class="literal">None</span></span>):</span><br><span class="line">        key = (cls, log_level)  <span class="comment"># 组合键，针对每个日志级别创建唯一实例</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> cls._instances:</span><br><span class="line">            cls._instances[key] = <span class="built_in">super</span>().__call__(log_level)</span><br><span class="line">        <span class="keyword">return</span> cls._instances[key]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span>(metaclass=LoggerMeta):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, log_level</span>):</span><br><span class="line">        <span class="variable language_">self</span>.log_level = log_level</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"创建<span class="subst">{log_level}</span>级别的日志记录器"</span>)</span><br></pre></td></tr></tbody></table></figure><p>装饰器实现方式适合需要将现有类转换为单例而不修改其内部代码的场景：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第三方库类转换为单例</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">singleton</span>(<span class="params">cls</span>):</span><br><span class="line">    instances = {}</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_instance</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances:</span><br><span class="line">            instances[cls] = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> instances[cls]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> get_instance</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将外部库中的类转换为单例</span></span><br><span class="line"><span class="meta">@singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThirdPartyClass</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure><h5 id="饿汉式单例模式的使用场景"><a href="#饿汉式单例模式的使用场景" class="headerlink" title="饿汉式单例模式的使用场景"></a>饿汉式单例模式的使用场景</h5><p>饿汉式单例模式最适合以下场景：</p><ol><li><strong>必然会使用的核心服务</strong>：如应用程序中必定会使用的服务组件。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app_services.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventBus</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"初始化事件总线..."</span>)</span><br><span class="line">        <span class="variable language_">self</span>.listeners = {}</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">subscribe</span>(<span class="params">self, event, callback</span>):</span><br><span class="line">        <span class="keyword">if</span> event <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.listeners:</span><br><span class="line">            <span class="variable language_">self</span>.listeners[event] = []</span><br><span class="line">        <span class="variable language_">self</span>.listeners[event].append(callback)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">publish</span>(<span class="params">self, event, data</span>):</span><br><span class="line">        <span class="keyword">if</span> event <span class="keyword">in</span> <span class="variable language_">self</span>.listeners:</span><br><span class="line">            <span class="keyword">for</span> callback <span class="keyword">in</span> <span class="variable language_">self</span>.listeners[event]:</span><br><span class="line">                callback(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模块级别立即创建实例</span></span><br><span class="line">event_bus = EventBus()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在其他文件中使用</span></span><br><span class="line"><span class="keyword">from</span> app_services <span class="keyword">import</span> event_bus</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>应用程序设置和常量</strong>：包含应用配置的单例对象。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppSettings</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"加载应用程序设置..."</span>)</span><br><span class="line">        <span class="variable language_">self</span>.debug_mode = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.api_url = <span class="string">"https://api.example.com"</span></span><br><span class="line">        <span class="variable language_">self</span>.max_connections = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 立即创建全局设置对象</span></span><br><span class="line">settings = AppSettings()</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>线程安全要求高的场景</strong>：饿汉式单例天然线程安全，适合多线程环境。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># thread_pool.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPoolManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"初始化线程池..."</span>)</span><br><span class="line">        <span class="variable language_">self</span>.max_workers = <span class="number">10</span></span><br><span class="line">        <span class="comment"># 线程池初始化代码</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">submit_task</span>(<span class="params">self, task</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"提交任务到线程池: <span class="subst">{task}</span>"</span>)</span><br><span class="line">        <span class="comment"># 任务提交逻辑</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序启动时即创建线程池</span></span><br><span class="line">thread_pool = ThreadPoolManager()</span><br></pre></td></tr></tbody></table></figure><h4 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 抽象产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 具体产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Woof!"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Meow!"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Quack!"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 工厂类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnimalFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_animal</span>(<span class="params">animal_type</span>):</span><br><span class="line">        <span class="keyword">match</span> animal_type.lower():</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"dog"</span>:</span><br><span class="line">                <span class="keyword">return</span> Dog()</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"cat"</span>:</span><br><span class="line">                <span class="keyword">return</span> Cat()</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"duck"</span>:</span><br><span class="line">                <span class="keyword">return</span> Duck()</span><br><span class="line">            <span class="keyword">case</span> _:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f"Invalid animal type: <span class="subst">{animal_type}</span>"</span>)</span><br><span class="line"><span class="comment">## 使用工厂</span></span><br><span class="line">factory = AnimalFactory()</span><br><span class="line">animals = [</span><br><span class="line">    factory.create_animal(<span class="string">"dog"</span>),</span><br><span class="line">    factory.create_animal(<span class="string">"cat"</span>),</span><br><span class="line">    factory.create_animal(<span class="string">"duck"</span>)</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> animal <span class="keyword">in</span> animals:</span><br><span class="line">    <span class="built_in">print</span>(animal.speak()) <span class="comment"># Output: Woof! Meow! Quack!</span></span><br></pre></td></tr></tbody></table></figure><p>工厂模式在以下场景中特别有用：</p><ol><li><strong>插件架构</strong>：当系统需要动态加载和使用不同的插件或扩展时。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── app.py                 <span class="comment"># 主应用程序，演示如何使用插件</span></span><br><span class="line">├── plugin_interface.py    <span class="comment"># 定义插件接口</span></span><br><span class="line">├── plugin_factory.py      <span class="comment"># 工厂方法模式的实现</span></span><br><span class="line">├── plugins/               <span class="comment"># 插件目录</span></span><br><span class="line">│   ├── __init__.py        <span class="comment"># 插件包初始化文件</span></span><br><span class="line">│   ├── image_processor.py <span class="comment"># 图片处理插件</span></span><br><span class="line">│   └── text_analyzer.py   <span class="comment"># 文本分析插件</span></span><br></pre></td></tr></tbody></table></figure><p>首先我们定义一个插件接口 <code>plugin_interface.py</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PluginInterface</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">"插件必须实现process方法"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">"插件必须实现get_name方法"</span>) </span><br></pre></td></tr></tbody></table></figure><p>依照插件接口新建目录文件夹 <code>plugins</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使plugins目录成为一个Python包</span></span><br><span class="line"><span class="comment"># 这允许我们使用 from plugins import xxx 的导入方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有可用的插件模块名，方便外部遍历</span></span><br><span class="line">available_plugins = [</span><br><span class="line">    <span class="string">"image_processor"</span>,</span><br><span class="line">    <span class="string">"text_analyzer"</span></span><br><span class="line">] </span><br></pre></td></tr></tbody></table></figure><p>图片处理插件 <code>image_processor</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> plugin_interface <span class="keyword">import</span> PluginInterface</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImageProcessorPlugin</span>(<span class="title class_ inherited__">PluginInterface</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">self, image_data</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理图片数据: <span class="subst">{image_data[:<span class="number">30</span>]}</span>..."</span>)</span><br><span class="line">        <span class="comment"># 实际项目中这里会有图片处理逻辑</span></span><br><span class="line">        <span class="comment"># 例如：调整大小、滤镜、裁剪等</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"已处理的图片: <span class="subst">{image_data[:<span class="number">10</span>]}</span>..."</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"图片处理插件"</span> </span><br></pre></td></tr></tbody></table></figure><p>文本处理插件 <code>text_analyzer</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> plugin_interface <span class="keyword">import</span> PluginInterface</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextAnalyzerPlugin</span>(<span class="title class_ inherited__">PluginInterface</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">self, text</span>):</span><br><span class="line">        word_count = <span class="built_in">len</span>(text.split())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"分析文本: 共<span class="subst">{word_count}</span>个单词"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 实际项目中这里会有更复杂的文本分析逻辑</span></span><br><span class="line">        <span class="comment"># 例如：情感分析、关键词提取、语法检查等</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">"word_count"</span>: word_count,</span><br><span class="line">            <span class="string">"sentiment"</span>: <span class="string">"positive"</span> <span class="keyword">if</span> <span class="string">"good"</span> <span class="keyword">in</span> text.lower() <span class="keyword">else</span> <span class="string">"neutral"</span>,</span><br><span class="line">            <span class="string">"characters"</span>: <span class="built_in">len</span>(text),</span><br><span class="line">            <span class="string">"has_question"</span>: <span class="string">"?"</span> <span class="keyword">in</span> text</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"文本分析插件"</span></span><br></pre></td></tr></tbody></table></figure><p>重点在我们的 <code>plugin_factory.py</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> plugin_interface <span class="keyword">import</span> PluginInterface</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PluginCreator</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    插件创建者的抽象基类 - 工厂方法模式的核心</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_plugin</span>(<span class="params">self</span>) -&gt; PluginInterface:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_plugin_info</span>(<span class="params">self</span>):</span><br><span class="line">        plugin = <span class="variable language_">self</span>.create_plugin()</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">"name"</span>: plugin.get_name(),</span><br><span class="line">            <span class="string">"type"</span>: <span class="variable language_">self</span>.__class__.__name__</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DynamicPluginCreator</span>(<span class="title class_ inherited__">PluginCreator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, plugin_name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.plugin_name = plugin_name</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_plugin</span>(<span class="params">self</span>) -&gt; PluginInterface:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 动态导入插件模块</span></span><br><span class="line">            module = <span class="built_in">__import__</span>(<span class="string">f"plugins.<span class="subst">{self.plugin_name}</span>"</span>, fromlist=[<span class="string">"plugins"</span>])</span><br><span class="line">            <span class="comment"># 获取插件类（约定：插件类名为模块名首字母大写+Plugin）</span></span><br><span class="line">            plugin_class_name = <span class="string">f"<span class="subst">{self.plugin_name.capitalize()}</span>Plugin"</span></span><br><span class="line">            plugin_class = <span class="built_in">getattr</span>(module, plugin_class_name)</span><br><span class="line">            <span class="comment"># 创建并返回插件实例</span></span><br><span class="line">            <span class="keyword">return</span> plugin_class()</span><br><span class="line">        <span class="keyword">except</span> (ImportError, AttributeError) <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f"Plugin <span class="subst">{self.plugin_name}</span> not found: <span class="subst">{<span class="built_in">str</span>(e)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImagePluginCreator</span>(<span class="title class_ inherited__">PluginCreator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_plugin</span>(<span class="params">self</span>) -&gt; PluginInterface:</span><br><span class="line">        <span class="comment"># 这里直接导入具体类，不再使用动态导入</span></span><br><span class="line">        <span class="keyword">from</span> plugins.image_processor <span class="keyword">import</span> ImageProcessorPlugin</span><br><span class="line">        <span class="keyword">return</span> ImageProcessorPlugin()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextPluginCreator</span>(<span class="title class_ inherited__">PluginCreator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_plugin</span>(<span class="params">self</span>) -&gt; PluginInterface:</span><br><span class="line">        <span class="comment"># 这里直接导入具体类，不再使用动态导入</span></span><br><span class="line">        <span class="keyword">from</span> plugins.text_analyzer <span class="keyword">import</span> TextAnalyzerPlugin</span><br><span class="line">        <span class="keyword">return</span> TextAnalyzerPlugin()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 工厂注册表，用于根据名称获取对应的工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PluginFactory</span>:</span><br><span class="line">    <span class="comment"># 插件工厂注册表</span></span><br><span class="line">    _factories = {</span><br><span class="line">        <span class="string">"image_processor"</span>: ImagePluginCreator,</span><br><span class="line">        <span class="string">"text_analyzer"</span>: TextPluginCreator</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_factory</span>(<span class="params">cls, plugin_name</span>):</span><br><span class="line">        <span class="keyword">if</span> plugin_name <span class="keyword">in</span> cls._factories:</span><br><span class="line">            <span class="keyword">return</span> cls._factories[plugin_name]()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果没有具体工厂，则使用动态加载工厂</span></span><br><span class="line">            <span class="keyword">return</span> DynamicPluginCreator(plugin_name)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_factory</span>(<span class="params">cls, plugin_name, factory_class</span>):</span><br><span class="line">        cls._factories[plugin_name] = factory_class </span><br></pre></td></tr></tbody></table></figure><p>使用我们的插件工厂与插件 <code>app.py</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> plugin_factory <span class="keyword">import</span> PluginFactory</span><br><span class="line"><span class="keyword">from</span> plugins <span class="keyword">import</span> available_plugins</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    主应用程序，演示如何使用插件系统</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 插件系统演示 - 工厂方法模式 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 存储已加载的插件</span></span><br><span class="line">    loaded_plugins = {}</span><br><span class="line">    plugin_infos = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 列出所有可用插件</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n可用插件列表: <span class="subst">{available_plugins}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用工厂方法模式加载所有可用插件</span></span><br><span class="line">    <span class="keyword">for</span> plugin_name <span class="keyword">in</span> available_plugins:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 获取插件创建者</span></span><br><span class="line">            plugin_creator = PluginFactory.get_factory(plugin_name)</span><br><span class="line">            <span class="comment"># 获取插件信息</span></span><br><span class="line">            plugin_info = plugin_creator.get_plugin_info()</span><br><span class="line">            plugin_infos.append(plugin_info)</span><br><span class="line">            <span class="comment"># 创建插件实例</span></span><br><span class="line">            plugin = plugin_creator.create_plugin()</span><br><span class="line">            loaded_plugins[plugin_name] = plugin</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"已加载插件: <span class="subst">{plugin.get_name()}</span> (类型: <span class="subst">{plugin_info[<span class="string">'type'</span>]}</span>)"</span>)</span><br><span class="line">        <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"加载插件 <span class="subst">{plugin_name}</span> 失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n=== 使用图片处理插件 ==="</span>)</span><br><span class="line">    <span class="comment"># 使用图片处理插件</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"image_processor"</span> <span class="keyword">in</span> loaded_plugins:</span><br><span class="line">        image_plugin = loaded_plugins[<span class="string">"image_processor"</span>]</span><br><span class="line">        <span class="comment"># 模拟图片数据</span></span><br><span class="line">        image_data = <span class="string">"iVBORw0KGgoAAAANSUhEUgAA..."</span>  </span><br><span class="line">        result = image_plugin.process(image_data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理结果: <span class="subst">{result}</span>"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"图片处理插件未加载"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n=== 使用文本分析插件 ==="</span>)</span><br><span class="line">    <span class="comment"># 使用文本分析插件</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"text_analyzer"</span> <span class="keyword">in</span> loaded_plugins:</span><br><span class="line">        text_plugin = loaded_plugins[<span class="string">"text_analyzer"</span>]</span><br><span class="line">        <span class="comment"># 要分析的文本</span></span><br><span class="line">        text_data = <span class="string">"This is a good example of factory method pattern. Isn't it?"</span></span><br><span class="line">        result = text_plugin.process(text_data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"分析结果:"</span>)</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> result.items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"  - <span class="subst">{key}</span>: <span class="subst">{value}</span>"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"文本分析插件未加载"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n=== 演示自定义插件创建 ==="</span>)</span><br><span class="line">    <span class="comment"># 演示自定义插件创建</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 直接使用特定的创建者</span></span><br><span class="line">        <span class="keyword">from</span> plugin_factory <span class="keyword">import</span> TextPluginCreator</span><br><span class="line">        text_creator = TextPluginCreator()</span><br><span class="line">        custom_text_plugin = text_creator.create_plugin()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"通过具体工厂直接创建插件: <span class="subst">{custom_text_plugin.get_name()}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 动态注册一个新工厂</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">CustomPluginCreator</span>(<span class="title class_ inherited__">TextPluginCreator</span>):</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">get_plugin_info</span>(<span class="params">self</span>):</span><br><span class="line">                info = <span class="built_in">super</span>().get_plugin_info()</span><br><span class="line">                info[<span class="string">"custom"</span>] = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">return</span> info</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 注册自定义工厂</span></span><br><span class="line">        PluginFactory.register_factory(<span class="string">"custom_text"</span>, CustomPluginCreator)</span><br><span class="line">        custom_creator = PluginFactory.get_factory(<span class="string">"custom_text"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"自定义工厂信息: <span class="subst">{custom_creator.get_plugin_info()}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"自定义插件创建失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n=== 演示完成 ==="</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main() </span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>跨平台应用程序</strong>：根据不同操作系统创建适当的组件。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UIFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_button</span>(<span class="params">label</span>):</span><br><span class="line">        system = platform.system()</span><br><span class="line">        <span class="keyword">if</span> system == <span class="string">"Windows"</span>:</span><br><span class="line">            <span class="keyword">return</span> WindowsButton(label)</span><br><span class="line">        <span class="keyword">elif</span> system == <span class="string">"Darwin"</span>:  <span class="comment"># macOS</span></span><br><span class="line">            <span class="keyword">return</span> MacButton(label)</span><br><span class="line">        <span class="keyword">elif</span> system == <span class="string">"Linux"</span>:</span><br><span class="line">            <span class="keyword">return</span> LinuxButton(label)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> GenericButton(label)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用场景</span></span><br><span class="line">login_button = UIFactory.create_button(<span class="string">"Login"</span>)</span><br><span class="line">login_button.render()  <span class="comment"># 根据当前操作系统渲染适当的按钮</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>数据库访问层</strong>：根据配置选择不同的数据库实现。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_database</span>(<span class="params">db_type, connection_string</span>):</span><br><span class="line">        <span class="keyword">if</span> db_type.lower() == <span class="string">"mysql"</span>:</span><br><span class="line">            <span class="keyword">return</span> MySQLDatabase(connection_string)</span><br><span class="line">        <span class="keyword">elif</span> db_type.lower() == <span class="string">"postgresql"</span>:</span><br><span class="line">            <span class="keyword">return</span> PostgreSQLDatabase(connection_string)</span><br><span class="line">        <span class="keyword">elif</span> db_type.lower() == <span class="string">"mongodb"</span>:</span><br><span class="line">            <span class="keyword">return</span> MongoDBDatabase(connection_string)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f"Unsupported database type: <span class="subst">{db_type}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用场景 - 从配置创建适当的数据库连接</span></span><br><span class="line">config = {<span class="string">"db_type"</span>: <span class="string">"postgresql"</span>, <span class="string">"connection"</span>: <span class="string">"postgresql://user:pass@localhost/mydb"</span>}</span><br><span class="line">db = DatabaseFactory.get_database(config[<span class="string">"db_type"</span>], config[<span class="string">"connection"</span>])</span><br><span class="line">users = db.query(<span class="string">"SELECT * FROM users"</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li><strong>测试替身创建</strong>：在测试环境中替换真实依赖项。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentProcessorFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">environment=<span class="string">"production"</span></span>):</span><br><span class="line">        <span class="keyword">if</span> environment == <span class="string">"production"</span>:</span><br><span class="line">            <span class="keyword">return</span> StripePaymentProcessor()</span><br><span class="line">        <span class="keyword">elif</span> environment == <span class="string">"sandbox"</span>:</span><br><span class="line">            <span class="keyword">return</span> SandboxPaymentProcessor()</span><br><span class="line">        <span class="keyword">elif</span> environment == <span class="string">"test"</span>:</span><br><span class="line">            <span class="keyword">return</span> MockPaymentProcessor()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f"Unknown environment: <span class="subst">{environment}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试场景</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_payment_flow</span>():</span><br><span class="line">    processor = PaymentProcessorFactory.create(<span class="string">"test"</span>)</span><br><span class="line">    result = processor.process_payment(<span class="number">100.00</span>, <span class="string">"4242424242424242"</span>)</span><br><span class="line">    <span class="keyword">assert</span> result.success == <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure><h4 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._observers = [] <span class="comment"># 观察者列表</span></span><br><span class="line">        <span class="variable language_">self</span>._state = <span class="literal">None</span> <span class="comment"># 当前状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self,observer</span>):</span><br><span class="line">        <span class="string">""" 注册观察者 """</span></span><br><span class="line">        <span class="keyword">if</span> observer <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>._observers:</span><br><span class="line">            <span class="variable language_">self</span>._observers.append(observer)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"<span class="subst">{observer}</span> 注册成功"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self,observer</span>):</span><br><span class="line">        <span class="string">""" 注销观察者 """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>._observers.remove(observer)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"<span class="subst">{observer}</span> 注销成功"</span>)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"<span class="subst">{observer}</span> 不在观察者列表中"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">""" 通知观察者 """</span></span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>._observers:</span><br><span class="line">            observer.update(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义Getter和Setter方法</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._state</span><br><span class="line"></span><br><span class="line"><span class="meta">    @state.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">state</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>._state = value</span><br><span class="line">        <span class="variable language_">self</span>.notify()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self,subject</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"名称为<span class="subst">{self.name}</span>的观察者收到<span class="subst">{subject.state}</span>的更新"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用观察者模式</span></span><br><span class="line">subject = Subject()</span><br><span class="line">observer1 = Observer(<span class="string">"观察者1"</span>)</span><br><span class="line">observer2 = Observer(<span class="string">"观察者2"</span>) </span><br><span class="line">subject.attach(observer1) <span class="comment"># 注册观察者</span></span><br><span class="line">subject.attach(observer2) <span class="comment"># 注册观察者</span></span><br><span class="line">subject.state = <span class="string">"状态1"</span> <span class="comment"># 通知观察者</span></span><br><span class="line">subject.state = <span class="string">"状态2"</span> <span class="comment"># 通知观察者</span></span><br><span class="line">subject.detach(observer1)</span><br></pre></td></tr></tbody></table></figure><p>观察者模式在以下场景中非常有效：</p><ol><li><strong>事件驱动的系统</strong>：如 GUI 应用程序，响应用户操作。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QApplication, QMainWindow, QPushButton, QVBoxLayout, QWidget, QLabel, QLineEdit, QMessageBox</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主题(Subject) - 被观察者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ButtonSubject</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._observers = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="string">"""添加观察者"""</span></span><br><span class="line">        <span class="keyword">if</span> observer <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>._observers:</span><br><span class="line">            <span class="variable language_">self</span>._observers.append(observer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="string">"""移除观察者"""</span></span><br><span class="line">        <span class="keyword">if</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>._observers:</span><br><span class="line">            <span class="variable language_">self</span>._observers.remove(observer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self, button, username=<span class="literal">None</span>, password=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">"""通知所有观察者"""</span></span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>._observers:</span><br><span class="line">            observer.update(button, username, password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 观察者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, button, username=<span class="literal">None</span>, password=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">"""观察者接收通知后执行的方法"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体观察者 - 登录处理器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginHandler</span>(<span class="title class_ inherited__">Observer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, status_label</span>):</span><br><span class="line">        <span class="variable language_">self</span>.status_label = status_label</span><br><span class="line">        <span class="comment"># 模拟用户数据库</span></span><br><span class="line">        <span class="variable language_">self</span>.users = {</span><br><span class="line">            <span class="string">"admin"</span>: <span class="string">"admin123"</span>,</span><br><span class="line">            <span class="string">"user"</span>: <span class="string">"password"</span></span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, button, username=<span class="literal">None</span>, password=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> button.text() == <span class="string">"登录"</span>:</span><br><span class="line">            <span class="variable language_">self</span>.process_login(username, password)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_login</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            <span class="variable language_">self</span>.status_label.setText(<span class="string">"请输入用户名和密码"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> <span class="variable language_">self</span>.users <span class="keyword">and</span> <span class="variable language_">self</span>.users[username] == password:</span><br><span class="line">            <span class="variable language_">self</span>.status_label.setText(<span class="string">f"登录成功，欢迎 <span class="subst">{username}</span>!"</span>)</span><br><span class="line">            QMessageBox.information(<span class="literal">None</span>, <span class="string">"登录成功"</span>, <span class="string">f"欢迎回来，<span class="subst">{username}</span>!"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.status_label.setText(<span class="string">"用户名或密码错误"</span>)</span><br><span class="line">            QMessageBox.warning(<span class="literal">None</span>, <span class="string">"登录失败"</span>, <span class="string">"用户名或密码错误"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建PyQt应用程序</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_observer_pattern_demo</span>():</span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line">    window = QMainWindow()</span><br><span class="line">    window.setWindowTitle(<span class="string">"登录示例"</span>)</span><br><span class="line">    window.setGeometry(<span class="number">100</span>, <span class="number">100</span>, <span class="number">400</span>, <span class="number">250</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建中央部件和布局</span></span><br><span class="line">    central_widget = QWidget()</span><br><span class="line">    layout = QVBoxLayout(central_widget)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建用户名和密码输入框</span></span><br><span class="line">    username_label = QLabel(<span class="string">"用户名:"</span>)</span><br><span class="line">    username_input = QLineEdit()</span><br><span class="line">    username_input.setPlaceholderText(<span class="string">"请输入用户名"</span>)</span><br><span class="line">    </span><br><span class="line">    password_label = QLabel(<span class="string">"密码:"</span>)</span><br><span class="line">    password_input = QLineEdit()</span><br><span class="line">    password_input.setPlaceholderText(<span class="string">"请输入密码"</span>)</span><br><span class="line">    password_input.setEchoMode(QLineEdit.Password)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建状态标签</span></span><br><span class="line">    status_label = QLabel(<span class="string">"请登录..."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建按钮</span></span><br><span class="line">    login_button = QPushButton(<span class="string">"登录"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建主题</span></span><br><span class="line">    button_subject = ButtonSubject()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建观察者</span></span><br><span class="line">    login_handler = LoginHandler(status_label)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注册观察者</span></span><br><span class="line">    button_subject.attach(login_handler)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接按钮点击事件</span></span><br><span class="line">    login_button.clicked.connect(</span><br><span class="line">        <span class="keyword">lambda</span>: button_subject.notify(</span><br><span class="line">            login_button, </span><br><span class="line">            username_input.text(), </span><br><span class="line">            password_input.text()</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加部件到布局</span></span><br><span class="line">    layout.addWidget(username_label)</span><br><span class="line">    layout.addWidget(username_input)</span><br><span class="line">    layout.addWidget(password_label)</span><br><span class="line">    layout.addWidget(password_input)</span><br><span class="line">    layout.addWidget(login_button)</span><br><span class="line">    layout.addWidget(status_label)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置中央部件</span></span><br><span class="line">    window.setCentralWidget(central_widget)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 显示窗口</span></span><br><span class="line">    window.show()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app, window, button_subject</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app, window, subject = create_observer_pattern_demo()</span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>发布-订阅系统</strong>：多个组件需要对特定事件做出响应。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NewsPublisher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._subscribers = []</span><br><span class="line">        <span class="variable language_">self</span>._latest_news = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self, subscriber</span>):</span><br><span class="line">        <span class="keyword">if</span> subscriber <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>._subscribers:</span><br><span class="line">            <span class="variable language_">self</span>._subscribers.append(subscriber)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self, subscriber</span>):</span><br><span class="line">        <span class="keyword">if</span> subscriber <span class="keyword">in</span> <span class="variable language_">self</span>._subscribers:</span><br><span class="line">            <span class="variable language_">self</span>._subscribers.remove(subscriber)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> subscriber <span class="keyword">in</span> <span class="variable language_">self</span>._subscribers:</span><br><span class="line">            subscriber.update(<span class="variable language_">self</span>._latest_news)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_news</span>(<span class="params">self, news</span>):</span><br><span class="line">        <span class="variable language_">self</span>._latest_news = news</span><br><span class="line">        <span class="variable language_">self</span>.notify()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewsSubscriber</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, news</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{self.name}</span> 收到新闻: <span class="subst">{news}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用场景 - 新闻分发系统</span></span><br><span class="line">publisher = NewsPublisher()</span><br><span class="line"></span><br><span class="line">subscriber1 = NewsSubscriber(<span class="string">"用户1"</span>)</span><br><span class="line">subscriber2 = NewsSubscriber(<span class="string">"用户2"</span>)</span><br><span class="line"></span><br><span class="line">publisher.attach(subscriber1)</span><br><span class="line">publisher.attach(subscriber2)</span><br><span class="line"></span><br><span class="line">publisher.add_news(<span class="string">"今天是个好日子!"</span>)  <span class="comment"># 所有订阅者都会收到通知</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>数据变更监控</strong>：当对象状态变化需要通知其他对象时。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataModel</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>._observers = []</span><br><span class="line">        <span class="variable language_">self</span>._value = value</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_observer</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="variable language_">self</span>._observers.append(observer)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_observers</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>._observers:</span><br><span class="line">            observer.update(<span class="variable language_">self</span>)</span><br><span class="line">            </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">value</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._value</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @value.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">value</span>(<span class="params">self, new_value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._value != new_value:</span><br><span class="line">            <span class="variable language_">self</span>._value = new_value</span><br><span class="line">            <span class="variable language_">self</span>.notify_observers()</span><br><span class="line">            </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChartView</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, model</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"图表更新为新值: <span class="subst">{model.value}</span>"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TableView</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, model</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"表格更新为新值: <span class="subst">{model.value}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用场景 - MVC架构中的数据更新</span></span><br><span class="line">model = DataModel(<span class="number">10</span>)</span><br><span class="line">chart = ChartView()</span><br><span class="line">table = TableView()</span><br><span class="line"></span><br><span class="line">model.register_observer(chart)</span><br><span class="line">model.register_observer(table)</span><br><span class="line"></span><br><span class="line">model.value = <span class="number">20</span>  <span class="comment"># 自动通知所有视图更新</span></span><br></pre></td></tr></tbody></table></figure><ol start="4"><li><strong>系统监控</strong>：监控系统状态变化并触发警报。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ServerMonitor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._observers = []</span><br><span class="line">        <span class="variable language_">self</span>._status = <span class="string">"正常"</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_observer</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="variable language_">self</span>._observers.append(observer)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_status</span>(<span class="params">self, status</span>):</span><br><span class="line">        old_status = <span class="variable language_">self</span>._status</span><br><span class="line">        <span class="variable language_">self</span>._status = status</span><br><span class="line">        <span class="keyword">if</span> old_status != status:</span><br><span class="line">            <span class="variable language_">self</span>.notify_observers()</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_observers</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>._observers:</span><br><span class="line">            observer.update(<span class="variable language_">self</span>._status)</span><br><span class="line">            </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailAlert</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, status</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"发送邮件警报: 服务器状态变为 <span class="subst">{status}</span>"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SMSAlert</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, status</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"发送短信警报: 服务器状态变为 <span class="subst">{status}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用场景 - 服务器监控系统</span></span><br><span class="line">monitor = ServerMonitor()</span><br><span class="line">email_alert = EmailAlert()</span><br><span class="line">sms_alert = SMSAlert()</span><br><span class="line"></span><br><span class="line">monitor.add_observer(email_alert)</span><br><span class="line">monitor.add_observer(sms_alert)</span><br><span class="line"></span><br><span class="line">monitor.set_status(<span class="string">"严重错误"</span>)  <span class="comment"># 触发所有警报</span></span><br></pre></td></tr></tbody></table></figure><h4 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h4><p>代理模式是一种结构型设计模式，它为其他对象提供了一种代理以控制对这些对象的访问；可以把代理模式理解为一个“守门员”，在客户（Client）和真实对象（RealSubject）之间充当中介，控制请求的传递和处理—— 就像你想看一部付费电影时，需要先通过一个“守门员”确认你是否支付了费用，这名守门员就是代理，他会在你访问电影资源之前先做一些检查，确保你有权利观看。</p><p>接下来，我们通过代码展示如何在 Python 中实现一些常用的代理模式——静态代理、动态代理、保护代理、虚拟代理。</p><h5 id="1-静态代理实现"><a href="#1-静态代理实现" class="headerlink" title="1.静态代理实现"></a>1.静态代理实现</h5><p>静态代理在编译时确定代理行为，非常适合结构固定的场景。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RealSubject</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"真实对象，请求被调用"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Proxy</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,real_subject:RealSubject</span>):</span><br><span class="line">        <span class="variable language_">self</span>.real_subject = real_subject</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"代理:在真实对象之前检查权限"</span>)</span><br><span class="line">        <span class="comment"># 代理控制访问</span></span><br><span class="line">        <span class="variable language_">self</span>.real_subject.request()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"代理：在真实对象之后记录日志"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用代理</span></span><br><span class="line">real_subject = RealSubject()</span><br><span class="line">proxy = Proxy(real_subject)</span><br><span class="line">proxy.request()</span><br></pre></td></tr></tbody></table></figure><h5 id="2-动态代理实现"><a href="#2-动态代理实现" class="headerlink" title="2.动态代理实现"></a>2.动态代理实现</h5><p>动态代理可以在运行时动态地为对象添加功能，而不需要在编译时确定：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timing_proxy</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="string">'''定义一个装饰器，打印函数执行时间'''</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{func.__name__}</span> 执行时间：<span class="subst">{end_time - start_time:<span class="number">.4</span>f}</span> 秒。"</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeService</span>:</span><br><span class="line"><span class="meta">    @timing_proxy</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perform_task</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"正在执行任务..."</span>)</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 使用动态代理</span></span><br><span class="line">service = SomeService()</span><br><span class="line">service.perform_task()</span><br></pre></td></tr></tbody></table></figure><h5 id="3-保护代理实现"><a href="#3-保护代理实现" class="headerlink" title="3.保护代理实现"></a>3.保护代理实现</h5><p>保护代理是一种常见的应用场景，用于控制对对象的访问权限，下面的例子展示了如何实现一个简单的保护代理：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RealSubject</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self,user_role</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{user_role}</span> 访问 执行敏感操作"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProtectionProxy</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,real_subject:RealSubject</span>):</span><br><span class="line">        <span class="variable language_">self</span>.real_subject = real_subject</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self,user_role</span>):</span><br><span class="line">        <span class="keyword">if</span> user_role == <span class="string">"admin"</span>:</span><br><span class="line">            <span class="variable language_">self</span>.real_subject.request(user_role)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"权限不足"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用保护代理</span></span><br><span class="line">real_subject = RealSubject()</span><br><span class="line">proxy = ProtectionProxy(real_subject)</span><br><span class="line">proxy.request(<span class="string">"admin"</span>)</span><br><span class="line">proxy.request(<span class="string">"user"</span>) <span class="comment"># 权限不足</span></span><br></pre></td></tr></tbody></table></figure><h5 id="4-虚拟代理实现"><a href="#4-虚拟代理实现" class="headerlink" title="4.虚拟代理实现"></a>4.虚拟代理实现</h5><p>虚拟代理用于控制昂贵资源的延迟加载，只有在真正需要时才创建对象：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HeavyResource</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"加载大量数据..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VirtualProxy</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._real_resource = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._real_resource <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="variable language_">self</span>._real_resource = HeavyResource()</span><br><span class="line">            <span class="variable language_">self</span>._real_resource.load()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"资源已加载，执行操作。"</span>)</span><br><span class="line"><span class="comment"># 使用虚拟代理</span></span><br><span class="line">proxy = VirtualProxy()</span><br><span class="line">proxy.request()  <span class="comment"># 首次调用会加载数据</span></span><br><span class="line">proxy.request()  <span class="comment"># 第二次调用不会再次加载数据</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="SOLID-原则"><a href="#SOLID-原则" class="headerlink" title="SOLID 原则"></a>SOLID 原则</h3><h4 id="SOLID-原则概述"><a href="#SOLID-原则概述" class="headerlink" title="SOLID 原则概述"></a>SOLID 原则概述</h4><p>SOLID 是面向对象设计的五个核心原则的首字母缩写，由罗伯特·C·马丁（Robert C. Martin）在 21 世纪早期提出。这些原则旨在帮助开发者创建易于维护和扩展的软件系统。SOLID 原则包括：</p><table><thead><tr><th>原则</th><th>全称</th><th>简述</th></tr></thead><tbody><tr><td>S</td><td>单一职责原则 (Single Responsibility Principle)</td><td>一个类应该只有一个引起它变化的原因</td></tr><tr><td>O</td><td>开放封闭原则 (Open-Closed Principle)</td><td>软件实体应该对扩展开放，对修改关闭</td></tr><tr><td>L</td><td>里氏替换原则 (Liskov Substitution Principle)</td><td>子类必须能够替换其基类使用</td></tr><tr><td>I</td><td>接口隔离原则 (Interface Segregation Principle)</td><td>不应强制客户依赖于它们不使用的接口</td></tr><tr><td>D</td><td>依赖倒置原则 (Dependency Inversion Principle)</td><td>依赖抽象而不是具体实现</td></tr></tbody></table><p>遵循这些原则可以创建出更加灵活、可维护、可扩展的代码，减少系统的脆弱性和紧耦合性，提高代码的复用性和可测试性。接下来，我们将通过电商系统的实例，逐一深入解析这些原则。</p><h4 id="1-单一职责原则-SRP"><a href="#1-单一职责原则-SRP" class="headerlink" title="1. 单一职责原则 (SRP)"></a>1. 单一职责原则 (SRP)</h4><h5 id="1-1-原则解析"><a href="#1-1-原则解析" class="headerlink" title="1.1 原则解析"></a>1.1 原则解析</h5><p><strong>定义</strong>：一个类应该只有一个引起它变化的原因。</p><p><strong>核心思想</strong>：每个类或模块只负责一项职责，将不同的职责分离到不同的类中。</p><p><strong>优势</strong>：</p><ul><li>提高代码的内聚性</li><li>降低类的复杂度</li><li>增强代码的可维护性</li><li>降低变更引起的风险</li></ul><h5 id="1-2-电商系统中的应用"><a href="#1-2-电商系统中的应用" class="headerlink" title="1.2 电商系统中的应用"></a>1.2 电商系统中的应用</h5><p>让我们看看电商系统中如何应用单一职责原则。在许多不遵循 SRP 的系统中，我们可能会看到一个 “超级类” 包含了所有与订单相关的功能：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 违反单一职责原则的示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, order_id, customer_info</span>):</span><br><span class="line">        <span class="variable language_">self</span>.order_id = order_id</span><br><span class="line">        <span class="variable language_">self</span>.customer_info = customer_info</span><br><span class="line">        <span class="variable language_">self</span>.items = []</span><br><span class="line">        <span class="variable language_">self</span>.status = <span class="string">"created"</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">self, product, quantity</span>):</span><br><span class="line">        <span class="comment"># 添加商品</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove_item</span>(<span class="params">self, product</span>):</span><br><span class="line">        <span class="comment"># 移除商品</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_total</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 计算总价</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, payment_method, payment_details</span>):</span><br><span class="line">        <span class="comment"># 处理支付</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_confirmation_email</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 发送确认邮件</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ship_order</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 处理配送</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_to_database</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 保存到数据库</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure><p>这个类违反了单一职责原则，它同时承担了多项职责：处理订单项目、计算金额、处理支付、发送通知、处理配送、数据存储等。</p><h5 id="1-3-遵循-SRP-的实现"><a href="#1-3-遵循-SRP-的实现" class="headerlink" title="1.3 遵循 SRP 的实现"></a>1.3 遵循 SRP 的实现</h5><p>按照单一职责原则，我们应该将不同职责分离到不同的类中：</p><ol><li><strong>订单模型类</strong>：只负责订单的基本属性和状态</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### models/order.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, order_id, customer_email</span>):</span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">id</span> = order_id</span><br><span class="line">        <span class="variable language_">self</span>.customer_email = customer_email</span><br><span class="line">        <span class="variable language_">self</span>.items = []</span><br><span class="line">        <span class="variable language_">self</span>.status = <span class="string">"created"</span></span><br><span class="line">        <span class="variable language_">self</span>.shipping_address = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">self, product, quantity</span>):</span><br><span class="line">        <span class="comment"># 仅负责添加商品到订单</span></span><br><span class="line">        <span class="variable language_">self</span>.items.append({</span><br><span class="line">            <span class="string">"product"</span>: product,</span><br><span class="line">            <span class="string">"quantity"</span>: quantity,</span><br><span class="line">            <span class="string">"price"</span>: product.price</span><br><span class="line">        })</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove_item</span>(<span class="params">self, product</span>):</span><br><span class="line">        <span class="comment"># 仅负责从订单中移除商品</span></span><br><span class="line">        original_length = <span class="built_in">len</span>(<span class="variable language_">self</span>.items)</span><br><span class="line">        <span class="variable language_">self</span>.items = [item <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.items <span class="keyword">if</span> item[<span class="string">"product"</span>].<span class="built_in">id</span> != product.<span class="built_in">id</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.items) &lt; original_length</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_total</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 仅负责计算订单总价</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(item[<span class="string">"price"</span>] * item[<span class="string">"quantity"</span>] <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.items)</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>支付处理类</strong>：专门负责支付相关功能</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### models/payment.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardProcessor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, amount, payment_data</span>):</span><br><span class="line">        <span class="comment"># 专门处理信用卡支付</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的信用卡支付"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlipayProcessor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, amount, payment_data</span>):</span><br><span class="line">        <span class="comment"># 专门处理支付宝支付</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的支付宝支付"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WechatPayProcessor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, amount, payment_data</span>):</span><br><span class="line">        <span class="comment"># 专门处理微信支付</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的微信支付"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>通知服务类</strong>：专门负责通知功能</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### services/notification.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailOrderNotifier</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_creation</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="comment"># 通知订单创建</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向 <span class="subst">{order.customer_email}</span> 发送订单创建通知"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_shipping</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="comment"># 通知订单发货</span></span><br><span class="line">        delivery_date = order.get_estimated_delivery()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向 <span class="subst">{order.customer_email}</span> 发送订单发货通知"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_cancellation</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="comment"># 通知订单取消</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向 <span class="subst">{order.customer_email}</span> 发送订单取消通知"</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li><strong>订单仓储类</strong>：专门负责数据存储</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### repositories/order_repository.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SqliteOrderRepository</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="comment"># 专门负责订单持久化</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"将订单 <span class="subst">{order.<span class="built_in">id</span>}</span> 保存到SQLite数据库"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_by_id</span>(<span class="params">self, order_id</span>):</span><br><span class="line">        <span class="comment"># 专门负责查询订单</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"从SQLite数据库查询订单 <span class="subst">{order_id}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><p>通过这样的设计，我们将不同的职责分离到不同的类中，每个类只负责一个特定的功能，符合单一职责原则。</p><h4 id="2-开放封闭原则-OCP"><a href="#2-开放封闭原则-OCP" class="headerlink" title="2. 开放封闭原则 (OCP)"></a>2. 开放封闭原则 (OCP)</h4><h5 id="2-1-原则解析"><a href="#2-1-原则解析" class="headerlink" title="2.1 原则解析"></a>2.1 原则解析</h5><p><strong>定义</strong>：软件实体（类、模块、函数等）应该对扩展开放，对修改封闭。</p><p><strong>核心思想</strong>：当需要添加新功能时，应该通过扩展现有代码（如添加新类、新方法）而不是修改现有代码。</p><p><strong>优势</strong>：</p><ul><li>提高系统稳定性</li><li>减少现有代码的改动和破坏</li><li>提高代码的可复用性</li><li>降低维护成本</li></ul><h5 id="2-2-电商系统中的应用"><a href="#2-2-电商系统中的应用" class="headerlink" title="2.2 电商系统中的应用"></a>2.2 电商系统中的应用</h5><p>考虑支付处理的场景。如果没有遵循开放封闭原则，我们可能会这样实现：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 违反开放封闭原则的示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentProcessor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, amount, payment_method, payment_data</span>):</span><br><span class="line">        <span class="keyword">if</span> payment_method == <span class="string">"credit_card"</span>:</span><br><span class="line">            <span class="comment"># 处理信用卡支付</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的信用卡支付"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> payment_method == <span class="string">"alipay"</span>:</span><br><span class="line">            <span class="comment"># 处理支付宝支付</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的支付宝支付"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> payment_method == <span class="string">"wechat"</span>:</span><br><span class="line">            <span class="comment"># 处理微信支付</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的微信支付"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f"不支持的支付方式: <span class="subst">{payment_method}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><p>这个设计违反了开放封闭原则，因为每当我们想添加新的支付方式（如 PayPal），都需要修改这个类的代码，添加新的条件分支。</p><h5 id="2-3-遵循-OCP-的实现"><a href="#2-3-遵循-OCP-的实现" class="headerlink" title="2.3 遵循 OCP 的实现"></a>2.3 遵循 OCP 的实现</h5><p>按照开放封闭原则，我们应该通过抽象接口和多态来实现支付处理：</p><ol><li><strong>定义支付处理接口</strong></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### interfaces/payment.py</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentProcessor</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, amount, payment_data</span>):</span><br><span class="line">        <span class="string">"""处理支付"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_payment_method_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""获取支付方式名称"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>实现具体支付处理器</strong></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### models/payment.py</span></span><br><span class="line"><span class="keyword">from</span> ecommerce.interfaces.payment <span class="keyword">import</span> PaymentProcessor</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardProcessor</span>(<span class="title class_ inherited__">PaymentProcessor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, amount, payment_data</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的信用卡支付"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_payment_method_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"信用卡支付"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlipayProcessor</span>(<span class="title class_ inherited__">PaymentProcessor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, amount, payment_data</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的支付宝支付"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_payment_method_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"支付宝支付"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WechatPayProcessor</span>(<span class="title class_ inherited__">PaymentProcessor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_payment</span>(<span class="params">self, amount, payment_data</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理 ¥<span class="subst">{amount:<span class="number">.2</span>f}</span> 的微信支付"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_payment_method_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"微信支付"</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>创建支付处理器工厂</strong></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### models/payment.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentProcessorFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_processor</span>(<span class="params">payment_method</span>):</span><br><span class="line">        processors = {</span><br><span class="line">            <span class="string">"credit_card"</span>: CreditCardProcessor(),</span><br><span class="line">            <span class="string">"alipay"</span>: AlipayProcessor(),</span><br><span class="line">            <span class="string">"wechat"</span>: WechatPayProcessor()</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> payment_method <span class="keyword">not</span> <span class="keyword">in</span> processors:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f"不支持的支付方式: <span class="subst">{payment_method}</span>"</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> processors[payment_method]</span><br></pre></td></tr></tbody></table></figure><p>现在，如果我们想添加新的支付方式（如 PayPal），只需要：</p><ol><li>创建一个新的 <code>PayPalProcessor</code> 类实现 <code>PaymentProcessor</code> 接口</li><li>将其添加到 <code>PaymentProcessorFactory</code> 的映射中</li></ol><p>无需修改现有代码，只需扩展新功能，完全符合开放封闭原则。</p><h4 id="3-里氏替换原则-LSP"><a href="#3-里氏替换原则-LSP" class="headerlink" title="3. 里氏替换原则 (LSP)"></a>3. 里氏替换原则 (LSP)</h4><h5 id="3-1-原则解析"><a href="#3-1-原则解析" class="headerlink" title="3.1 原则解析"></a>3.1 原则解析</h5><p><strong>定义</strong>：子类型必须能够替换其基类型使用。</p><p><strong>核心思想</strong>：继承类应当能够替代其父类使用，而不改变程序的正确性。子类应当保持父类的行为约定。</p><p><strong>优势</strong>：</p><ul><li>确保类的层次结构设计合理</li><li>增强代码的可复用性</li><li>提高系统的健壮性</li><li>保证面向对象设计的正确性</li></ul><h5 id="3-2-电商系统中的应用"><a href="#3-2-电商系统中的应用" class="headerlink" title="3.2 电商系统中的应用"></a>3.2 电商系统中的应用</h5><p>考虑配送方式的实现。如果违反里氏替换原则，我们可能会遇到这样的情况：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 违反里氏替换原则的示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShippingMethod</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_cost</span>(<span class="params">self, weight, distance</span>):</span><br><span class="line">        <span class="comment"># 计算标准运费</span></span><br><span class="line">        <span class="keyword">return</span> weight * <span class="number">0.5</span> + distance * <span class="number">0.1</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_estimated_days</span>(<span class="params">self, distance</span>):</span><br><span class="line">        <span class="comment"># 获取估计送达天数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">int</span>(distance / <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExpressShipping</span>(<span class="title class_ inherited__">ShippingMethod</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_cost</span>(<span class="params">self, weight, distance</span>):</span><br><span class="line">        <span class="comment"># 快递费用比标准运费高</span></span><br><span class="line">        <span class="keyword">return</span> weight * <span class="number">1.0</span> + distance * <span class="number">0.2</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_estimated_days</span>(<span class="params">self, distance</span>):</span><br><span class="line">        <span class="comment"># 快递比标准配送快</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">int</span>(distance / <span class="number">200</span>))</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FreeShipping</span>(<span class="title class_ inherited__">ShippingMethod</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_cost</span>(<span class="params">self, weight, distance</span>):</span><br><span class="line">        <span class="comment"># 免费配送</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_estimated_days</span>(<span class="params">self, distance</span>):</span><br><span class="line">        <span class="comment"># 不提供送达时间估计，返回None而不是整数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># 违反了父类的行为约定</span></span><br></pre></td></tr></tbody></table></figure><p>在上面的例子中，<code>FreeShipping</code> 类违反了里氏替换原则，因为它的 <code>get_estimated_days</code> 方法返回了 <code>None</code> 而不是整数，这与父类的行为约定不一致。如果有代码依赖于 <code>ShippingMethod</code> 的返回值是整数，那么使用 <code>FreeShipping</code> 时可能会导致错误。</p><h5 id="3-3-遵循-LSP-的实现"><a href="#3-3-遵循-LSP-的实现" class="headerlink" title="3.3 遵循 LSP 的实现"></a>3.3 遵循 LSP 的实现</h5><p>以下是遵循里氏替换原则的配送方式实现：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### interfaces/shipping.py</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShippingMethod</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_cost</span>(<span class="params">self, weight, distance</span>):</span><br><span class="line">        <span class="string">"""计算运费"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_estimated_days</span>(<span class="params">self, distance</span>):</span><br><span class="line">        <span class="string">"""获取预计配送天数"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### models/shipping.py</span></span><br><span class="line"><span class="keyword">from</span> ecommerce.interfaces.shipping <span class="keyword">import</span> ShippingMethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StandardShipping</span>(<span class="title class_ inherited__">ShippingMethod</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_cost</span>(<span class="params">self, weight, distance</span>):</span><br><span class="line">        <span class="keyword">return</span> weight * <span class="number">0.5</span> + distance * <span class="number">0.1</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_estimated_days</span>(<span class="params">self, distance</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">int</span>(distance / <span class="number">100</span>))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"标准配送"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExpressShipping</span>(<span class="title class_ inherited__">ShippingMethod</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_cost</span>(<span class="params">self, weight, distance</span>):</span><br><span class="line">        <span class="keyword">return</span> weight * <span class="number">1.0</span> + distance * <span class="number">0.2</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_estimated_days</span>(<span class="params">self, distance</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">int</span>(distance / <span class="number">200</span>))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"快速配送"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FreeShipping</span>(<span class="title class_ inherited__">ShippingMethod</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_cost</span>(<span class="params">self, weight, distance</span>):</span><br><span class="line">        <span class="comment"># 免费配送</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_estimated_days</span>(<span class="params">self, distance</span>):</span><br><span class="line">        <span class="comment"># 仍然返回整数，保持与父类一致的行为约定</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(<span class="number">5</span>, <span class="built_in">int</span>(distance / <span class="number">50</span>))  <span class="comment"># 免费配送较慢</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"免费配送"</span></span><br></pre></td></tr></tbody></table></figure><p>现在，所有的配送方式类都符合里氏替换原则，它们都保持了父类的行为约定：<code>calculate_cost</code> 返回数值，<code>get_estimated_days</code> 返回整数。</p><h4 id="4-接口隔离原则-ISP"><a href="#4-接口隔离原则-ISP" class="headerlink" title="4. 接口隔离原则 (ISP)"></a>4. 接口隔离原则 (ISP)</h4><h5 id="4-1-原则解析"><a href="#4-1-原则解析" class="headerlink" title="4.1 原则解析"></a>4.1 原则解析</h5><p><strong>定义</strong>：客户端不应该被迫依赖于它们不使用的接口。</p><p><strong>核心思想</strong>：一个类不应该依赖于它不需要的接口。接口应该是小而精的，一个大而全的接口应该被拆分为多个小接口。</p><p><strong>优势</strong>：</p><ul><li>提高接口的聚合度</li><li>减少冗余的接口实现</li><li>提高系统的灵活性和可扩展性</li><li>降低接口之间的耦合度</li></ul><h5 id="4-2-电商系统中的应用"><a href="#4-2-电商系统中的应用" class="headerlink" title="4.2 电商系统中的应用"></a>4.2 电商系统中的应用</h5><p>考虑订单通知的场景。违反接口隔离原则的设计可能如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 违反接口隔离原则的示例</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderNotifier</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_creation</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="string">"""通知订单创建"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_shipping</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="string">"""通知订单配送"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_cancellation</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="string">"""通知订单取消"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_sms</span>(<span class="params">self, phone_number, message</span>):</span><br><span class="line">        <span class="string">"""发送短信通知"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">self, email, subject, message</span>):</span><br><span class="line">        <span class="string">"""发送邮件通知"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_push_notification</span>(<span class="params">self, device_id, message</span>):</span><br><span class="line">        <span class="string">"""发送推送通知"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure><p>这个接口违反了接口隔离原则，因为它强制所有实现类都必须实现所有方法。例如，一个邮件通知实现类可能不需要实现 SMS 或推送通知的方法。</p><h5 id="4-3-遵循-ISP-的实现"><a href="#4-3-遵循-ISP-的实现" class="headerlink" title="4.3 遵循 ISP 的实现"></a>4.3 遵循 ISP 的实现</h5><p>按照接口隔离原则，我们应该将大接口拆分为多个小接口：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### interfaces/notification.py</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderNotifier</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_creation</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="string">"""通知订单创建"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_shipping</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="string">"""通知订单配送"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_cancellation</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="string">"""通知订单取消"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailNotifier</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">self, email, subject, message</span>):</span><br><span class="line">        <span class="string">"""发送邮件"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SMSNotifier</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_sms</span>(<span class="params">self, phone_number, message</span>):</span><br><span class="line">        <span class="string">"""发送短信"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PushNotifier</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_push_notification</span>(<span class="params">self, device_id, message</span>):</span><br><span class="line">        <span class="string">"""发送推送通知"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure><p>然后，实现类可以选择性地实现它们需要的接口：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### services/notification.py</span></span><br><span class="line"><span class="keyword">from</span> ecommerce.interfaces.notification <span class="keyword">import</span> OrderNotifier, EmailNotifier</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailOrderNotifier</span>(OrderNotifier, EmailNotifier):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_creation</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向 <span class="subst">{order.customer_email}</span> 发送订单创建通知"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_email(order.customer_email, <span class="string">"订单已创建"</span>, <span class="string">f"您的订单 <span class="subst">{order.<span class="built_in">id</span>}</span> 已创建"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_shipping</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向 <span class="subst">{order.customer_email}</span> 发送订单配送通知"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_email(order.customer_email, <span class="string">"订单已发货"</span>, <span class="string">f"您的订单 <span class="subst">{order.<span class="built_in">id</span>}</span> 已发货"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_cancellation</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向 <span class="subst">{order.customer_email}</span> 发送订单取消通知"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_email(order.customer_email, <span class="string">"订单已取消"</span>, <span class="string">f"您的订单 <span class="subst">{order.<span class="built_in">id</span>}</span> 已取消"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">self, email, subject, message</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"发送邮件到 <span class="subst">{email}</span>，主题: <span class="subst">{subject}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### services/notification.py</span></span><br><span class="line"><span class="keyword">from</span> ecommerce.interfaces.notification <span class="keyword">import</span> OrderNotifier, SMSNotifier</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SMSOrderNotifier</span>(OrderNotifier, SMSNotifier):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_creation</span>(<span class="params">self, order</span>):</span><br><span class="line">        phone = <span class="variable language_">self</span>._get_phone_from_order(order)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向手机号 <span class="subst">{phone}</span> 发送订单创建短信通知"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_sms(phone, <span class="string">f"您的订单 <span class="subst">{order.<span class="built_in">id</span>}</span> 已创建"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_shipping</span>(<span class="params">self, order</span>):</span><br><span class="line">        phone = <span class="variable language_">self</span>._get_phone_from_order(order)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向手机号 <span class="subst">{phone}</span> 发送订单配送短信通知"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_sms(phone, <span class="string">f"您的订单 <span class="subst">{order.<span class="built_in">id</span>}</span> 已发货"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_cancellation</span>(<span class="params">self, order</span>):</span><br><span class="line">        phone = <span class="variable language_">self</span>._get_phone_from_order(order)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"向手机号 <span class="subst">{phone}</span> 发送订单取消短信通知"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.send_sms(phone, <span class="string">f"您的订单 <span class="subst">{order.<span class="built_in">id</span>}</span> 已取消"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_sms</span>(<span class="params">self, phone_number, message</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"发送短信到 <span class="subst">{phone_number}</span>: <span class="subst">{message}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_phone_from_order</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="comment"># 实际应用中应该从订单中获取电话号码</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"1234567890"</span></span><br></pre></td></tr></tbody></table></figure><p>通过这种方式，每个实现类只需要实现它关心的接口，符合接口隔离原则。</p><h4 id="5-依赖倒置原则-DIP"><a href="#5-依赖倒置原则-DIP" class="headerlink" title="5. 依赖倒置原则 (DIP)"></a>5. 依赖倒置原则 (DIP)</h4><h5 id="5-1-原则解析"><a href="#5-1-原则解析" class="headerlink" title="5.1 原则解析"></a>5.1 原则解析</h5><p><strong>定义</strong>：高层模块不应该依赖于低层模块，两者都应该依赖于抽象。抽象不应该依赖于细节，细节应该依赖于抽象。</p><p><strong>核心思想</strong>：通过引入抽象层（如接口、抽象类）来解耦高层和低层模块，实现可扩展性和可维护性。</p><p><strong>优势</strong>：</p><ul><li>降低模块间的耦合度</li><li>提高代码的可重用性</li><li>方便系统的单元测试</li><li>提高系统的可扩展性</li></ul><h5 id="5-2-电商系统中的应用"><a href="#5-2-电商系统中的应用" class="headerlink" title="5.2 电商系统中的应用"></a>5.2 电商系统中的应用</h5><p>考虑订单服务与数据持久化的关系。违反依赖倒置原则的设计可能如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 违反依赖倒置原则的示例</span></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderService</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 直接依赖具体的SQLite实现</span></span><br><span class="line">        <span class="variable language_">self</span>.connection = sqlite3.connect(<span class="string">'orders.db'</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_order</span>(<span class="params">self, order_data</span>):</span><br><span class="line">        cursor = <span class="variable language_">self</span>.connection.cursor()</span><br><span class="line">        <span class="comment"># 插入订单数据</span></span><br><span class="line">        cursor.execute(</span><br><span class="line">            <span class="string">"INSERT INTO orders (id, customer_email, status) VALUES (?, ?, ?)"</span>,</span><br><span class="line">            (order_data[<span class="string">'id'</span>], order_data[<span class="string">'email'</span>], <span class="string">'created'</span>)</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.connection.commit()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_order</span>(<span class="params">self, order_id</span>):</span><br><span class="line">        cursor = <span class="variable language_">self</span>.connection.cursor()</span><br><span class="line">        <span class="comment"># 查询订单数据</span></span><br><span class="line">        cursor.execute(<span class="string">"SELECT * FROM orders WHERE id = ?"</span>, (order_id,))</span><br><span class="line">        <span class="keyword">return</span> cursor.fetchone()</span><br></pre></td></tr></tbody></table></figure><p>这个设计违反了依赖倒置原则，高层模块 <code>OrderService</code> 直接依赖于低层模块 <code>sqlite3</code>。如果我们想切换到其他数据库，需要修改 <code>OrderService</code> 类的代码。</p><h5 id="5-3-遵循-DIP-的实现"><a href="#5-3-遵循-DIP-的实现" class="headerlink" title="5.3 遵循 DIP 的实现"></a>5.3 遵循 DIP 的实现</h5><p>按照依赖倒置原则，我们应该让高层和低层模块都依赖于抽象：</p><ol><li><strong>定义订单仓储接口（抽象）</strong></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### interfaces/repository.py</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderRepository</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="string">"""保存订单"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_by_id</span>(<span class="params">self, order_id</span>):</span><br><span class="line">        <span class="string">"""根据ID查找订单"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_orders</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""列出所有订单"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>实现具体的订单仓储类</strong></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### repositories/order_repository.py</span></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">from</span> ecommerce.interfaces.repository <span class="keyword">import</span> OrderRepository</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SqliteOrderRepository</span>(<span class="title class_ inherited__">OrderRepository</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 具体的SQLite实现</span></span><br><span class="line">        <span class="variable language_">self</span>.connection = sqlite3.connect(<span class="string">'orders.db'</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, order</span>):</span><br><span class="line">        cursor = <span class="variable language_">self</span>.connection.cursor()</span><br><span class="line">        <span class="comment"># 保存订单到SQLite</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"将订单 <span class="subst">{order.<span class="built_in">id</span>}</span> 保存到SQLite数据库"</span>)</span><br><span class="line">        <span class="comment"># 实际的SQL操作...</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_by_id</span>(<span class="params">self, order_id</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"从SQLite数据库查询订单 <span class="subst">{order_id}</span>"</span>)</span><br><span class="line">        <span class="comment"># 实际的SQL查询...</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list_orders</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"从SQLite数据库查询所有订单"</span>)</span><br><span class="line">        <span class="comment"># 实际的SQL查询...</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>修改订单服务，依赖抽象接口</strong></li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### services/order.py</span></span><br><span class="line"><span class="keyword">from</span> ecommerce.interfaces.repository <span class="keyword">import</span> OrderRepository</span><br><span class="line"><span class="keyword">from</span> ecommerce.interfaces.notification <span class="keyword">import</span> OrderNotifier</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderService</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, repository: OrderRepository, notifier: OrderNotifier</span>):</span><br><span class="line">        <span class="comment"># 依赖抽象接口，而不是具体实现</span></span><br><span class="line">        <span class="variable language_">self</span>._repository = repository</span><br><span class="line">        <span class="variable language_">self</span>._notifier = notifier</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_order</span>(<span class="params">self, order</span>):</span><br><span class="line">        <span class="variable language_">self</span>._repository.save(order)</span><br><span class="line">        <span class="variable language_">self</span>._notifier.notify_creation(order)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_order</span>(<span class="params">self, order_id</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._repository.find_by_id(order_id)</span><br></pre></td></tr></tbody></table></figure><p>通过这种设计，<code>OrderService</code> 依赖于抽象接口 <code>OrderRepository</code> 和 <code>OrderNotifier</code>，而不是具体实现。这样我们可以轻松地替换具体实现，例如从 SQLite 切换到 MySQL，只需要提供一个新的实现类，而不需要修改 <code>OrderService</code> 的代码。</p><h3 id="Python-中的-slots"><a href="#Python-中的-slots" class="headerlink" title="Python 中的 __slots__"></a>Python 中的 <code>__slots__</code></h3><p><code>__slots__</code> 是一个特殊的类变量，它可以限制类的实例能拥有的属性，节省内存并提高性能：</p><h4 id="slots-的工作原理与性能优势"><a href="#slots-的工作原理与性能优势" class="headerlink" title="__slots__ 的工作原理与性能优势"></a><code>__slots__</code> 的工作原理与性能优势</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment">## 不使用__slots__的普通类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用__slots__的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonWithSlots</span>:</span><br><span class="line">    __slots__ = [<span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建实例</span></span><br><span class="line">p1 = Person(<span class="string">"Alice"</span>, <span class="number">30</span>)</span><br><span class="line">p2 = PersonWithSlots(<span class="string">"Bob"</span>, <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查内存使用</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Person实例大小: <span class="subst">{sys.getsizeof(p1)}</span> 字节"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"PersonWithSlots实例大小: <span class="subst">{sys.getsizeof(p2)}</span> 字节"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查属性字典</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Person有__dict__: <span class="subst">{<span class="built_in">hasattr</span>(p1, <span class="string">'__dict__'</span>)}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"PersonWithSlots有__dict__: <span class="subst">{<span class="built_in">hasattr</span>(p2, <span class="string">'__dict__'</span>)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 属性访问性能比较</span></span><br><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">access_person</span>():</span><br><span class="line">    p = Person(<span class="string">"Alice"</span>, <span class="number">30</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        x = p.name</span><br><span class="line">        y = p.age</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">access_person_with_slots</span>():</span><br><span class="line">    p = PersonWithSlots(<span class="string">"Alice"</span>, <span class="number">30</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        x = p.name</span><br><span class="line">        y = p.age</span><br><span class="line"></span><br><span class="line"><span class="comment">## 测量访问性能</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"访问Person属性时间: <span class="subst">{timeit.timeit(access_person, number=<span class="number">5</span>):<span class="number">.4</span>f}</span>秒"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"访问PersonWithSlots属性时间: <span class="subst">{timeit.timeit(access_person_with_slots, number=<span class="number">5</span>):<span class="number">.4</span>f}</span>秒"</span>)</span><br></pre></td></tr></tbody></table></figure><h4 id="slots-的限制和继承行为"><a href="#slots-的限制和继承行为" class="headerlink" title="__slots__ 的限制和继承行为"></a><code>__slots__</code> 的限制和继承行为</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>:</span><br><span class="line">    __slots__ = [<span class="string">'x'</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    __slots__ = [<span class="string">'y'</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(x)</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line"></span><br><span class="line"><span class="comment">## 行为测试</span></span><br><span class="line">c = Child(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Child实例可以访问x: <span class="subst">{c.x}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Child实例可以访问y: <span class="subst">{c.y}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    c.z = <span class="number">3</span>  <span class="comment"># 尝试设置未在__slots__中定义的属性</span></span><br><span class="line"><span class="keyword">except</span> AttributeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"无法设置z属性: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查实例字典</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Child有__dict__: <span class="subst">{<span class="built_in">hasattr</span>(c, <span class="string">'__dict__'</span>)}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure></div></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Prorise</div><div class="post-copyright__author_desc">这聒噪的世界让沉默的人显得另类</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://prorise-cool.github.io/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl(&quot;https://prorise-cool.github.io/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/&quot;)">Python语法前篇（十二）：第十一章：面向对象编程</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://prorise-cool.github.io/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Python语法前篇（十二）：第十一章：面向对象编程&amp;url=https://prorise-cool.github.io/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/&amp;pic=https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Prorise-cool.github.io" target="_blank">格物致知</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Python-%E8%AF%AD%E6%B3%95%E7%AF%87/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>Python-语法篇<span class="tagsPageCount">15</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/06/27/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%B8%80%E7%AC%AC%E5%8D%81%E7%AB%A0-%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" onerror="onerror=null,src=&quot;/img/404.jpg&quot;" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python语法前篇（十一）：第十章： 模块与包</div></div></a></div><div class="next-post pull-right"><a href="/2025/06/29/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%B8%89%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" onerror="onerror=null,src=&quot;/img/404.jpg&quot;" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python语法前篇（十三）：第十二章： 异常处理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/06/17/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E4%B8%80python-%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7/" title="Python语法前篇（一）：Python 语言特性"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-17</div><div class="title">Python语法前篇（一）：Python 语言特性</div></div></a></div><div><a href="/2025/06/19/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E4%B8%89%E7%AC%AC%E4%BA%8C%E7%AB%A0%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6/" title="Python语法前篇（三）：第二章：转义字符"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-19</div><div class="title">Python语法前篇（三）：第二章：转义字符</div></div></a></div><div><a href="/2025/06/18/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E4%BA%8C%E7%AC%AC%E4%B8%80%E7%AB%A0%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%89%93%E5%8D%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8Epycharm%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F/" title="Python语法前篇（二）：第一章：字符串打印格式化与PyCharm模板变量"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-18</div><div class="title">Python语法前篇（二）：第一章：字符串打印格式化与PyCharm模板变量</div></div></a></div><div><a href="/2025/06/23/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E4%B8%83%E7%AC%AC%E5%85%AD%E7%AB%A0%E6%9D%A1%E4%BB%B6%E5%BE%AA%E7%8E%AF%E5%88%86%E6%94%AF/" title="Python语法前篇（七）：第六章：条件循环分支"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-23</div><div class="title">Python语法前篇（七）：第六章：条件循环分支</div></div></a></div><div><a href="/2025/06/24/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%85%AB%E7%AC%AC%E4%B8%83%E7%AB%A0-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/" title="Python语法前篇（八）：第七章： 文件操作"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-24</div><div class="title">Python语法前篇（八）：第七章： 文件操作</div></div></a></div><div><a href="/2025/06/21/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E4%BA%94%E7%AC%AC%E5%9B%9B%E7%AB%A0%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E8%AF%A6%E8%A7%A3/" title="Python语法前篇（五）：第四章：类型转换详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-21</div><div class="title">Python语法前篇（五）：第四章：类型转换详解</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" rel="external nofollow noreferrer">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/user/status.png" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.4;color:rgba(255,255,255,.9);text-align:center">🚀 全栈开发者，专注于构建优雅高效的数字解决方案<br><span style="color:#fff;font-weight:700">前端 · 后端 · 架构 · 优化</span><br>📚 分享实战经验，一起探索技术边界</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Prorise</h1><div class="author-info__desc">这聒噪的世界让沉默的人显得另类</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/361040115?spm_id_from=333.1387.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background:url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center/100% no-repeat"></div><div class="back face" style="background:url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center/100% no-repeat"></div></div></div></div><div class="card-widget card-latest-comments"><div class="item-headline"><i class="fas fa-comments"></i><span>最新评论</span></div><div class="item-content"><a href="/messages/" class="headline-right" title="查看更多"><i class="fas fa-angle-right"></i></a><div class="aside-list" id="latest-comments"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">第十一章：面向对象编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="toc-number">1.1.</span> <span class="toc-text">对象的本质</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.1.1.</span> <span class="toc-text">为什么需要对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#init-%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">__init__ 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.3.</span> <span class="toc-text">面向对象的三大特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%B0%81%E8%A3%85"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. 封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E9%9A%90%E8%97%8F"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">属性隐藏</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">属性访问控制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-property-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">使用@property 装饰器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BB%A7%E6%89%BF"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. 继承</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E7%BB%A7%E6%89%BF%E5%92%8C%E5%A4%9A%E7%BB%A7%E6%89%BF"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">单继承和多继承</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E9%87%8D%E5%86%99%E5%92%8C%E8%B0%83%E7%94%A8%E7%88%B6%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">方法重写和调用父类方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E7%9A%84%E5%B1%9E%E6%80%A7%E6%9F%A5%E6%89%BE%E9%A1%BA%E5%BA%8F-MRO"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">继承的属性查找顺序 (MRO)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8F%B1%E5%BD%A2%E7%BB%A7%E6%89%BF%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">菱形继承问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MixIn-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">MixIn 设计模式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%A4%9A%E6%80%81"><span class="toc-number">1.3.3.</span> <span class="toc-text">3. 多态</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">鸭子类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%9F%BA%E7%B1%BB"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">抽象基类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95%E4%B8%8E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">类方法与静态方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83"><span class="toc-number">1.4.1.</span> <span class="toc-text">方法类型比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%B1%BB%E6%96%B9%E6%B3%95%EF%BC%88-classmethod%EF%BC%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. 类方法（@classmethod）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%EF%BC%88-staticmethod%EF%BC%89"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. 静态方法（@staticmethod）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6"><span class="toc-number">1.5.</span> <span class="toc-text">反射机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8F%8D%E5%B0%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">常用反射函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-hasattr-%E2%80%94-%E6%A3%80%E6%9F%A5%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E6%9C%89%E6%8C%87%E5%AE%9A%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.2.</span> <span class="toc-text">1. hasattr() — 检查对象是否有指定属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-getattr-%E2%80%94-%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.3.</span> <span class="toc-text">2. getattr() — 获取对象的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-setattr-%E2%80%94-%E8%AE%BE%E7%BD%AE%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.4.</span> <span class="toc-text">3. setattr() — 设置对象的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-delattr-%E2%80%94-%E5%88%A0%E9%99%A4%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.5.</span> <span class="toc-text">4. delattr() — 删除对象的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-dir-%E2%80%94-%E5%88%97%E5%87%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%89%80%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.6.</span> <span class="toc-text">5. dir() — 列出对象的所有属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-type-%E2%80%94-%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.7.</span> <span class="toc-text">6. type() — 获取对象的类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-isinstance-%E2%80%94-%E6%A3%80%E6%9F%A5%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E4%B8%BA%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.5.8.</span> <span class="toc-text">7. isinstance() — 检查对象是否为类的实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-issubclass-%E2%80%94-%E6%A3%80%E6%9F%A5%E7%B1%BB%E6%98%AF%E5%90%A6%E4%B8%BA%E5%8F%A6%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%AD%90%E7%B1%BB"><span class="toc-number">1.5.9.</span> <span class="toc-text">8. issubclass() — 检查类是否为另一个类的子类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-callable-%E2%80%94-%E6%A3%80%E6%9F%A5%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E5%8F%AF%E8%B0%83%E7%94%A8"><span class="toc-number">1.5.10.</span> <span class="toc-text">9. callable() — 检查对象是否可调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-vars-%E2%80%94-%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E7%9A%84-dict"><span class="toc-number">1.5.11.</span> <span class="toc-text">10. vars() — 获取对象的 __dict__</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.12.</span> <span class="toc-text">反射示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E6%9E%9A%E4%B8%BE%E4%BB%A5%E5%8F%8A%E6%8A%BD%E8%B1%A1%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">1.6.</span> <span class="toc-text">通用枚举以及抽象接口定义</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#enum-%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%AE%9E%E7%8E%B0%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.0.1.</span> <span class="toc-text">enum 模块：实现枚举类型</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#enum-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">1.6.0.1.1.</span> <span class="toc-text">enum 常用功能</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#enum-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.0.1.2.</span> <span class="toc-text">enum 模块代码示例</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#abc-%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%AE%9A%E4%B9%89%E6%8A%BD%E8%B1%A1%E5%9F%BA%E7%B1%BB-Abstract-Base-Classes"><span class="toc-number">1.6.0.2.</span> <span class="toc-text">abc 模块：定义抽象基类 (Abstract Base Classes)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#abc-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">1.6.0.2.1.</span> <span class="toc-text">abc 常用功能</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#abc-%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.0.2.2.</span> <span class="toc-text">abc 模块代码示例</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E7%B1%BB%E7%BC%96%E7%A8%8B"><span class="toc-number">1.7.</span> <span class="toc-text">元类编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%B1%BB%E7%9A%84%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95"><span class="toc-number">1.7.1.</span> <span class="toc-text">元类的核心方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-type-%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E7%B1%BB"><span class="toc-number">1.7.2.</span> <span class="toc-text">使用 type 动态创建类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B1%BB"><span class="toc-number">1.7.3.</span> <span class="toc-text">自定义元类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%B1%BB%E7%9A%84-new-%E6%96%B9%E6%B3%95"><span class="toc-number">1.7.4.</span> <span class="toc-text">元类的 __new__ 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%B1%BB%E7%9A%84-call-%E6%96%B9%E6%B3%95%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.7.5.</span> <span class="toc-text">元类的 __call__ 方法实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%B1%BB%E9%93%BE%E5%92%8C%E7%B1%BB%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.7.6.</span> <span class="toc-text">元类链和类创建过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%9A%84%E5%85%83%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E8%A1%A8"><span class="toc-number">1.7.7.</span> <span class="toc-text">内置的元类属性和方法表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95%EF%BC%88%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">1.8.</span> <span class="toc-text">Python 特殊方法（魔术方法）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%94%80%E6%AF%81"><span class="toc-number">1.8.0.1.</span> <span class="toc-text">1. 对象创建与销毁</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">1.8.0.1.1.</span> <span class="toc-text">实际应用场景：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%AF%B9%E8%B1%A1%E8%A1%A8%E7%A4%BA"><span class="toc-number">1.8.0.2.</span> <span class="toc-text">2. 对象表示</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A-1"><span class="toc-number">1.8.0.2.1.</span> <span class="toc-text">实际应用场景：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%9B%86%E5%90%88%E7%B1%BB%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.0.3.</span> <span class="toc-text">3. 集合类操作</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%95%86%E5%93%81%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">1.8.0.3.1.</span> <span class="toc-text">实际应用场景：自定义商品购物车</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E8%B0%83%E7%94%A8%E4%B8%8E%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.0.4.</span> <span class="toc-text">4. 调用与比较操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%99%A8"><span class="toc-number">1.8.0.5.</span> <span class="toc-text">实际应用场景：数据分析器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.0.6.</span> <span class="toc-text">5. 算术运算操作</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A%E5%90%91%E9%87%8F%E8%BF%90%E7%AE%97"><span class="toc-number">1.8.0.6.1.</span> <span class="toc-text">实际应用场景：向量运算</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">1.8.0.7.</span> <span class="toc-text">6. 属性访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A%E5%B1%9E%E6%80%A7%E9%AA%8C%E8%AF%81%E4%B8%8E%E4%BF%9D%E6%8A%A4"><span class="toc-number">1.8.0.7.1.</span> <span class="toc-text">实际应用场景：属性验证与保护</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%EF%BC%88with-%E8%AF%AD%E5%8F%A5%EF%BC%89"><span class="toc-number">1.8.0.8.</span> <span class="toc-text">7. 上下文管理（with 语句）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="toc-number">1.8.0.8.1.</span> <span class="toc-text">实际应用场景：数据库连接管理</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E5%B1%9E%E6%80%A7%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">1.8.0.9.</span> <span class="toc-text">8. 描述符与属性装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%8D%8F%E8%AE%AE%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.0.9.1.</span> <span class="toc-text">描述符协议方法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">1.8.0.9.2.</span> <span class="toc-text">实际应用场景：数据验证描述符</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%A3%85%E9%A5%B0%E5%99%A8-property-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="toc-number">1.8.0.9.3.</span> <span class="toc-text">属性装饰器(@property)实际应用</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-%E5%B8%B8%E8%A7%81%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95%E4%BD%BF%E7%94%A8%E9%99%B7%E9%98%B1%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.8.0.10.</span> <span class="toc-text">10. 常见特殊方法使用陷阱与最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%99%B7%E9%98%B1%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.8.0.10.1.</span> <span class="toc-text">陷阱与注意事项</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11-%E6%80%BB%E7%BB%93%EF%BC%9A%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%89%E6%8B%A9%E6%8C%87%E5%8D%97"><span class="toc-number">1.8.0.11.</span> <span class="toc-text">11. 总结：特殊方法的选择指南</span></a></li></ol></li></ol><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E4%B8%8E%E7%B1%BB%E7%9A%84%E9%AB%98%E7%BA%A7%E6%A6%82%E5%BF%B5"><span class="toc-number">1.9.</span> <span class="toc-text">对象与类的高级概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%AE%9E%E4%BE%8B%E3%80%81%E7%B1%BB%E5%92%8C%E5%85%83%E7%B1%BB%E5%85%B3%E7%B3%BB"><span class="toc-number">1.9.1.</span> <span class="toc-text">深入理解实例、类和元类关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E6%9F%A5%E6%89%BE%E7%9A%84%E5%A4%8D%E6%9D%82%E6%83%85%E5%86%B5"><span class="toc-number">1.9.2.</span> <span class="toc-text">属性查找的复杂情况</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E4%B8%8E%E5%AF%B9%E8%B1%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.10.</span> <span class="toc-text">内存管理与对象生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E7%9A%84%E5%AE%8C%E6%95%B4%E8%BF%87%E7%A8%8B"><span class="toc-number">1.10.1.</span> <span class="toc-text">对象创建和销毁的完整过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E5%92%8C%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8"><span class="toc-number">1.10.2.</span> <span class="toc-text">引用计数和循环引用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.11.</span> <span class="toc-text">高级常用设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.11.1.</span> <span class="toc-text">单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.11.1.1.</span> <span class="toc-text">懒汉式单例模式的使用场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.11.1.2.</span> <span class="toc-text">饿汉式单例模式的使用场景</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.11.2.</span> <span class="toc-text">工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.11.3.</span> <span class="toc-text">观察者模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.11.4.</span> <span class="toc-text">代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">1.静态代理实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">2.动态代理实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%BF%9D%E6%8A%A4%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.11.4.3.</span> <span class="toc-text">3.保护代理实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E8%99%9A%E6%8B%9F%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.11.4.4.</span> <span class="toc-text">4.虚拟代理实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SOLID-%E5%8E%9F%E5%88%99"><span class="toc-number">1.12.</span> <span class="toc-text">SOLID 原则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SOLID-%E5%8E%9F%E5%88%99%E6%A6%82%E8%BF%B0"><span class="toc-number">1.12.1.</span> <span class="toc-text">SOLID 原则概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99-SRP"><span class="toc-number">1.12.2.</span> <span class="toc-text">1. 单一职责原则 (SRP)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E5%8E%9F%E5%88%99%E8%A7%A3%E6%9E%90"><span class="toc-number">1.12.2.1.</span> <span class="toc-text">1.1 原则解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.12.2.2.</span> <span class="toc-text">1.2 电商系统中的应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-%E9%81%B5%E5%BE%AA-SRP-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.12.2.3.</span> <span class="toc-text">1.3 遵循 SRP 的实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%BC%80%E6%94%BE%E5%B0%81%E9%97%AD%E5%8E%9F%E5%88%99-OCP"><span class="toc-number">1.12.3.</span> <span class="toc-text">2. 开放封闭原则 (OCP)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E5%8E%9F%E5%88%99%E8%A7%A3%E6%9E%90"><span class="toc-number">1.12.3.1.</span> <span class="toc-text">2.1 原则解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.12.3.2.</span> <span class="toc-text">2.2 电商系统中的应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E9%81%B5%E5%BE%AA-OCP-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.12.3.3.</span> <span class="toc-text">2.3 遵循 OCP 的实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%87%8C%E6%B0%8F%E6%9B%BF%E6%8D%A2%E5%8E%9F%E5%88%99-LSP"><span class="toc-number">1.12.4.</span> <span class="toc-text">3. 里氏替换原则 (LSP)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E5%8E%9F%E5%88%99%E8%A7%A3%E6%9E%90"><span class="toc-number">1.12.4.1.</span> <span class="toc-text">3.1 原则解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.12.4.2.</span> <span class="toc-text">3.2 电商系统中的应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-%E9%81%B5%E5%BE%AA-LSP-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.12.4.3.</span> <span class="toc-text">3.3 遵循 LSP 的实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99-ISP"><span class="toc-number">1.12.5.</span> <span class="toc-text">4. 接口隔离原则 (ISP)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-%E5%8E%9F%E5%88%99%E8%A7%A3%E6%9E%90"><span class="toc-number">1.12.5.1.</span> <span class="toc-text">4.1 原则解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.12.5.2.</span> <span class="toc-text">4.2 电商系统中的应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-%E9%81%B5%E5%BE%AA-ISP-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.12.5.3.</span> <span class="toc-text">4.3 遵循 ISP 的实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99-DIP"><span class="toc-number">1.12.6.</span> <span class="toc-text">5. 依赖倒置原则 (DIP)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-%E5%8E%9F%E5%88%99%E8%A7%A3%E6%9E%90"><span class="toc-number">1.12.6.1.</span> <span class="toc-text">5.1 原则解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.12.6.2.</span> <span class="toc-text">5.2 电商系统中的应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-%E9%81%B5%E5%BE%AA-DIP-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.12.6.3.</span> <span class="toc-text">5.3 遵循 DIP 的实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E4%B8%AD%E7%9A%84-slots"><span class="toc-number">1.13.</span> <span class="toc-text">Python 中的 __slots__</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#slots-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8A%BF"><span class="toc-number">1.13.1.</span> <span class="toc-text">__slots__ 的工作原理与性能优势</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slots-%E7%9A%84%E9%99%90%E5%88%B6%E5%92%8C%E7%BB%A7%E6%89%BF%E8%A1%8C%E4%B8%BA"><span class="toc-number">1.13.2.</span> <span class="toc-text">__slots__ 的限制和继承行为</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/01/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%94%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" title="Python语法前篇（十五）：第十四章：深入解析并发编程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="Python语法前篇（十五）：第十四章：深入解析并发编程"></a><div class="content"><a class="title" href="/2025/07/01/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%94%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" title="Python语法前篇（十五）：第十四章：深入解析并发编程">Python语法前篇（十五）：第十四章：深入解析并发编程</a><time datetime="2025-07-01T08:13:45.000Z" title="发表于 2025-07-01 16:13:45">2025-07-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/30/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E5%9B%9B%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" title="Python语法前篇（十四）：第十三章： 高级数据处理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="Python语法前篇（十四）：第十三章： 高级数据处理"></a><div class="content"><a class="title" href="/2025/06/30/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E5%9B%9B%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" title="Python语法前篇（十四）：第十三章： 高级数据处理">Python语法前篇（十四）：第十三章： 高级数据处理</a><time datetime="2025-06-30T08:13:45.000Z" title="发表于 2025-06-30 16:13:45">2025-06-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/29/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%B8%89%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" title="Python语法前篇（十三）：第十二章： 异常处理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="Python语法前篇（十三）：第十二章： 异常处理"></a><div class="content"><a class="title" href="/2025/06/29/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%B8%89%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" title="Python语法前篇（十三）：第十二章： 异常处理">Python语法前篇（十三）：第十二章： 异常处理</a><time datetime="2025-06-29T08:13:45.000Z" title="发表于 2025-06-29 16:13:45">2025-06-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/" title="Python语法前篇（十二）：第十一章：面向对象编程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="Python语法前篇（十二）：第十一章：面向对象编程"></a><div class="content"><a class="title" href="/2025/06/28/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%BA%8C%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/" title="Python语法前篇（十二）：第十一章：面向对象编程">Python语法前篇（十二）：第十一章：面向对象编程</a><time datetime="2025-06-28T08:13:45.000Z" title="发表于 2025-06-28 16:13:45">2025-06-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/27/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%B8%80%E7%AC%AC%E5%8D%81%E7%AB%A0-%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85/" title="Python语法前篇（十一）：第十章： 模块与包"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/17/685113b7c39b1.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="Python语法前篇（十一）：第十章： 模块与包"></a><div class="content"><a class="title" href="/2025/06/27/python%E8%AF%AD%E6%B3%95%E5%89%8D%E7%AF%87%E5%8D%81%E4%B8%80%E7%AC%AC%E5%8D%81%E7%AB%A0-%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85/" title="Python语法前篇（十一）：第十章： 模块与包">Python语法前篇（十一）：第十章： 模块与包</a><time datetime="2025-06-27T08:13:45.000Z" title="发表于 2025-06-27 16:13:45">2025-06-27</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:3381292732@qq.com" rel="external nofollow noreferrer" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://weibo.com/u/7484736298?tabtype=home" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f745b722d7.webp" size="50px"><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Prorise-cool" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://space.bilibili.com/361040115?spm_id_from=333.788.0.0" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="workboard"><div id="runtimeTextTip"></div></div><div class="footer_custom_text">这是我的个人博客，分享技术与生活点滴。</div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener external nofollow noreferrer" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.foreverblog.cn/">十年之约</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/docs/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" rel="external nofollow noreferrer" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="博客框架为Hexo7.0" title="博客框架为Hexo7.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo7.0"></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"></a><a class="github-badge" target="_blank" href="https://github.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站采用CC BY-NC-SA 4.0协议" title="本站采用CC BY-NC-SA 4.0协议"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用CC BY-NC-SA 4.0协议"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2025 By <a class="footer-bar-link" href="/about/" title="Prorise" target="_blank">Prorise</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗, 万物可爱, 人间值得, 未来可期.","愿你眼里的星星，永远亮晶晶。","愿我们每个人都能被世界温柔以待。"]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/typed.js/2.0.12/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Prorise-cool?tab=repositories" title="网站源码">网站源码</a><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/" title="湘ICP备23041-302号">湘ICP备23041-302号</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">2</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" rel="external nofollow noreferrer" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="后续项目..."><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="后续项目..."><span class="back-menu-item-text">后续项目...</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>个人</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fas fa-check-double faa-tada"></i><span> 代办清单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>预览</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?server=netease&amp;id=3117791189"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fas fa-comments faa-tada"></i><span> 评论总览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 即刻短文</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Python-%E8%AF%AD%E6%B3%95%E7%AF%87/" style="font-size:.88rem">Python-语法篇<sup>15</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><button id="to_comment" type="button" title="直达评论" onclick="FixedCommentBtn()"><i class="anzhiyufont anzhiyu-icon-comments"></i></button><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" rel="external nofollow noreferrer" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="3117791189" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=3117791189&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>//- 从这里开始的所有JS代码，都必须有缩进（例如2个空格）
// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("06/10/2025 00:00:00"); // 此处读取您配置中的建站时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  
  // --- 已将您的专属LOGO和个人信息集成到这里 ---
  const ascll = [
    `欢迎访问 Prorise 的数字空间!`,
    `代码构建世界，思想驱动未来`,
    // 这里的反引号和所有ASCII art行，都必须有正确的缩进
    `
     ____                      _             
    |  _ \\  _ __   ___   _ __  (_) ___   ___  
    | |_) || '__| / _ \\ | '__| | |/ __| / _ \\ 
    |  __/ | |   | (_) || |    | |\\__ \\|  __/ 
    |_|    |_|    \\___/ |_|    |_||___/ \\___| 
                                             
    `,
    "已稳定运行",
    dnum,
    "天",
    `©2025 By Prorise 1.0.0`,
  ];
  
  const ascll2 = [`SYS-INFO`, `前置摄像头拍照成功`, `您的帅气脸庞为：`, `😎`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c${ascll[2]} \n%c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF; font-family:monospace;",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );

  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，朋友.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Created by Prorise %c 你正在访问 Prorise 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 注意，你的所有操作已被记录.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script async="">(function () {
  var grt = new Date("06/10/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.prorise666.site/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.prorise666.site/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  let initFn = window.walineFn || null

  const initWaline = (Fn) => {
    const waline = Fn(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline.prorise666.site',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
      imageUploader: true,
    }, null))

    const destroyWaline = () => {
      waline.destroy()
    }

    anzhiyu.addGlobalFn('pjax', destroyWaline, 'destroyWaline')
  }

  const loadWaline = async () => {
    if (initFn) initWaline(initFn)
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.css')
      if (true) await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline-meta.css')
      const { init } = await import('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.js')
      initFn = init || Waline.init
      initWaline(initFn)
      window.walineFn = initFn
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.prorise666.site/',
        region: 'ap-shanghai',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async="" data-pjax="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail=""</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="/js/load-on-demand.js"></script><script defer="" id="fluttering_ribbon" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="" mobile="false"></script><script src="//code.tidio.co//tk571vck0ua2wjoalfbp8wyrlsdaunmz.js" async=""></script><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    let isShow = false
    const close = () => {
      window.tidioChatApi.hide()
      isShow = false
      document.body.style.position = 'relative';
      document.documentElement.style.overflow = 'auto'
    }
    
    const open = () => {
      window.tidioChatApi.open()
      window.tidioChatApi.show()
      isShow = true
    }

    const onTidioChatApiReady = () => {
      window.tidioChatApi.hide()
      window.tidioChatApi.on("close", close)
    }
    if (window.tidioChatApi) {
      window.tidioChatApi.on("ready", onTidioChatApiReady)
    } else {
      document.addEventListener("tidioChat-ready", onTidioChatApiReady)
    }

    window.chatBtnFn = () => {
      if (!window.tidioChatApi) return
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        window.tidioChatApi && window.tidioChatApi.hide()
      },
      show: () => {
        window.tidioChatApi && window.tidioChatApi.show()
      }
    }
  }
})()</script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://npm.elemecdn.com/meting@2.0.1/dist/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '[object Object]', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div>
    <link rel="stylesheet" href="https://ai.tianli0.top/static/public/postChatUser_summary.min.css">
    <script>
        let tianliGPT_key = '';
        let tianliGPT_postSelector = '#post-container .post-content';
        let tianliGPT_Title = '✨ AI 文章摘要';
        let tianliGPT_postURL = '/^https?:\/\/[^\/]+\/[0-9]{4}\/[0-9]{2}\/[0-9]{2}\/';
        let tianliGPT_blacklist = '';
        let tianliGPT_wordLimit = '1000';
        let tianliGPT_typingAnimate = true;
        let tianliGPT_theme = 'default';
        var postChatConfig = {
          backgroundColor: "#4d648d",
          bottom: "76px",
          left: "16px",
          fill: "#FFFFFF",
          width: "50px",
          frameWidth: "380px",
          frameHeight: "600px",
          defaultInput: true,
          upLoadWeb: true,
          showInviteLink: true,
          userTitle: "💬 智能助手",
          userDesc: "我是 Prorise 博客的 AI 助手，有任何关于网站内容的问题都可以问我哦～",
          addButton: true,
          beginningText: "这篇文章介绍了",
          userIcon: "https://ai.tianli0.top/static/img/PostChat.webp",
          userMode: "magic",
          defaultChatQuestions: ["你好","你是谁"],
          defaultSearchQuestions: ["视频压缩","设计"]
        };
    </script>
    <script data-postchat_key="" src="https://ai.tianli0.top/static/public/tianli_gpt.min.js"></script>
  </body></html>