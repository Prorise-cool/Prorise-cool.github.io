<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>4. 深入 Prompt 工程 | 格物致知</title><meta name="keywords" content="Java微服务-AI篇"><meta name="author" content="Prorise"><meta name="copyright" content="Prorise"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#cee8ff"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="4. 深入 Prompt 工程"><meta name="application-name" content="4. 深入 Prompt 工程"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#cee8ff"><meta property="og:type" content="article"><meta property="og:title" content="4. 深入 Prompt 工程"><meta property="og:url" content="https://prorise-cool.github.io/posts/25888.html"><meta property="og:site_name" content="格物致知"><meta property="og:description" content="4. 深入 Prompt 工程如果说 ChatClient 是连接你和 AI 的电话线，那么 Prompt 就是你在这条电话线上说的话。你说得是否清晰、准确、有技巧，直接决定了电话那头的 AI 能否理解你的意图并给出满意的答复。Prompt 工程（Prompt Engineering）就是一门研究如"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2025/06/19/68535b23089d0.webp"><meta property="article:author" content="Prorise"><meta property="article:tag" content="全栈, Full Stack, 前端, 后端, Node.js, Vue, React, 数据库, Linux, Docker, 个人博客, 技术分享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2025/06/19/68535b23089d0.webp"><meta name="description" content="4. 深入 Prompt 工程如果说 ChatClient 是连接你和 AI 的电话线，那么 Prompt 就是你在这条电话线上说的话。你说得是否清晰、准确、有技巧，直接决定了电话那头的 AI 能否理解你的意图并给出满意的答复。Prompt 工程（Prompt Engineering）就是一门研究如"><link rel="shortcut icon" href="/img/icons/favicon.ico"><link rel="canonical" href="https://prorise-cool.github.io/posts/25888.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media=&quot;all&quot;"><script async="" src="https://www.googletagmanager.com/gtag/js?id=[object Object]"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","[object Object]")</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"Prorise","mode":"tianli","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"S-DNA1JM95BX2F9L0N","Referer":"https://xx.xx/"},
  diytitle: undefined,
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.prorise666.site/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":10000,"accessToken":"b39753735ed0ed5ffeb771bc108e3158","mailMd5":"ec3291d59a8d7d3675df8a0537fcbc979f0fa611c8df55841fb7f4fd162bd07a"},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤣 全栈开发工程师","🙂 前端架构设计师","🙃 后端服务构建者","🤩 移动端应用开发","🤯 数据库设计专家","🥳 DevOps运维实践者","🤭 技术栈多面手","😎 性能优化达人"]},
  algolia: {"appId":"K8Y7M0RMXQ","apiKey":"11fa7380e2694483a44b143044e69e6e","indexName":"prorise_blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":3,"position":"top","messagePrev":"距离上次更新已经过了","messageNext":"天，文章内容可能已经过时。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Prorise","link":"链接: ","source":"来源: 格物致知","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"格物致知",title:"4. 深入 Prompt 工程",postAI:"false",pageFillDescription:"4. 深入 Prompt 工程, 4.1 Prompt 的重要性与基本原则, 4.2 Prompt 类详解, 4.2.1 角色扮演与指令设定 (SystemMessage), 4.2.2. 提供上下文与对话历史 (AssistantMessage), 4.2.3 请求级选项覆盖 (PromptOptions), 4.3 Message 与角色, 4.4 PromptTemplate：让 Prompt 动起来, 4.4.1 简单示例：个性化问候, 4.5 结构化输出：将 AI 响应映射为 POJO, 4.5.1 BeanOutputConverter 简单提取Json文本数据, 4.5.2 ListOutputParser 提取为字符串列表, 4.5.3 MapOutputParser 提取为键值对 Map深入工程如果说是连接你和的电话线那么就是你在这条电话线上说的话你说得是否清晰准确有技巧直接决定了电话那头的能否理解你的意图并给出满意的答复工程就是一门研究如何与高效沟通的艺术与科学在本章我将带你从理论到实践彻底掌握它的重要性与基本原则在与大语言模型交互时我们很容易犯一个错误把模型想象成一个无所不知能够完美揣测我们心思的人类但实际上它是一个基于海量数据训练出来的概率模型你给它的输入越模糊它输出的结果就越可能偏离你的预期是与沟通的就像调用一个软件需要遵循其定义的参数和格式一样与沟通也需要遵循一定的范式才能获得稳定可控的输出以下是编写高效的几个基本原则清晰具体避免使用模糊的词语不要说给我写点关于狗的东西而要说为一位岁的小学生写一段字左右的短文介绍金毛寻回犬的性格特点和历史起源提供上下文如果你的问题需要背景知识请在中明确提供例如在分析一段用户评论前先告诉模型你是一个电商平台的客服主管请分析以下用户评论的情感倾向设定角色这是最有效的技巧之一让扮演一个角色可以极大地约束它的行为和语言风格例如你是一位资深的技术专家你是一位风趣幽默的脱口秀演员施加约束明确告诉模型你不想要什么或者输出必须遵循的格式例如不要使用任何技术术语请以格式输出包含和两个字段回答不要超过个字提供示例如果需要模型遵循特定的输出格式或风格最好的方法就是给它一两个例子这比用语言描述格式要有效得多类详解在中类是所有与交互的载体它不仅仅是一个简单的字符串包装器而是一个结构化的对象用于封装发送给模型的完整指令集它的构造函数主要有两种这是最简单的形式将一个字符串包装成一个这是更通用和强大的形式允许你传入一个由不同角色组成的列表构建复杂的多轮对话或带有系统指令的请求简单形式等同于创建一个只包含单个的你好复杂形式构建一个包含系统指令和用户提问的你是一个专业的翻译家只将用户输入翻译成英文我爱编程对象还允许你附加用于在单次调用中覆盖全局的模型参数如等这为动态调整行为提供了极大的灵活性在我们之前的代码中是如下编写的可以把理解为一次新的对话的发起或启动信号流式内容调用返回纯文本内容的响应流用户的提问一个包含文本内容片段的流那么既然有这么便捷的方式为什么还要设计一个看起来有些繁琐的类呢答案是只是一个快捷方式而类才是与进行一切复杂有深度有上下文交互的官方语言和标准容器您可以把它们的关系想象成寄快递就像是寄一个最简单的信封您只需把信塞进去写上地址它就能寄出非常快捷但功能有限类这是一个可定制的坚固的快递包裹您不仅可以放入用户的信件还可以放入各种附件和特殊说明来指挥收件人如何处理这份包裹能那么简单是因为它处理的是最基础的信封场景但一旦需求变得复杂类的威力就体现出来了以下是这种简单形式无法做到而必须使用类才能实现的核心功能角色扮演与指令设定我们经常需要扮演一个特定的角色或遵循特定的规则这通过系统消息来实现而必须被包裹在对象中您的示例代码正是完美的说明流式内容调用返回纯文本内容的响应流用户的提问一个包含文本内容片段的流你是一个擅长翻译的大语言模型会吧用户说的中文都翻译为英文快捷方式无法单独传递这种系统级的人设指令提供上下文与对话历史这是实现多轮对话的核心为了让记住之前的对话我们需要把历史聊天记录一起发送给它这些历史记录就包含了之前的和的回答场景示例用户年世界杯谁赢了阿根廷队赢得了年世界杯用户他们的队长是谁如果只发送这个问题无法理解他们是谁要让正确回答我们必须构建一个包含历史记录的年世界杯谁赢了阿根廷队赢得了年世界杯他们的队长是谁当前问题发送这个携带了完整上下文的才能知道他们指的是阿根廷队会回答利昂内尔梅西是他们的队长的工作原理本质上就是在后台自动帮我们组装这个包含历史记录的并创建对象请求级选项覆盖有时我们可能希望某一次特定的调用使用不同的模型或参数比如更高的来增加创意而不想修改全局配置类允许我们在创建时附加一个对象假设全局配置的模型是是但这次我想要更有创意的回答本次调用临时切换到大幅提高温度写一首关于机器人在雨中哭泣的诗与角色是构成的基本单位定义了四种核心的类型它们分别对应了与模型对话中不同的角色理解并善用它们是实现高级可控的人工智能交互的关键下表详细说明了每种消息类型的作用和典型应用场景消息类型核心作用典型应用场景与示例系统消息用于设定的角色行为准则个性目标和任何高级指令它就像是给的出厂设置或后台指令通常在对话开始时发送并对整个对话过程持续生效是优先级最高的指令为赋予人格或限定其能力范围用户消息代表最终用户的输入它就是用户的提问指令或对话内容在一次请求中这通常是消息列表的最后一条用户向发起的每一次具体的提问助手消息代表自己之前的回复它是构建多轮对话历史让记住上下文的关键部分在实现对话记忆功能时将历史记录中的每一条回复封装起来重新传回给模型函数消息用于函数工具调用场景当决定调用一个外部工具后应用需要将该工具的执行结果通过返回给以便它能根据结果生成最终的自然语言回答需要获取实时信息或执行操作时让动起来在实际应用中我们的很少是完全静态的通常需要根据用户的输入查询的数据库结果或其他动态信息来构建手动拼接字符串不仅繁琐易错而且难以维护正是为此而生允许你定义一个包含占位符变量的模板字符串然后用一个来填充这些变量最终渲染出一个完整的对象简单示例个性化问候文件路径新方法使用实现动态翻译功能要翻译的目标语言英文日文法文要翻译的原文翻译后的文本内容流定义包含占位符的系统指令模板你是一个专业的精通多种语言的翻译家请将用户接下来发送的所有内容都翻译成不要添加任何与翻译结果无关的解释或寒暄使用流式的高级形式直接传入模板和变量来构建设置模板字符串绑定模板中的变量用户输入原文结构化输出将响应映射为我们经常需要返回的不仅仅是一段自由文本而是一个结构化的数据比如传统的做法是让生成字符串然后在代码中手动解析它这种方式非常脆弱因为可能返回一个格式不正确的导致解析失败是提供的利器它能将模型的文本输出自动安全地转换为指定的对象简单提取文本数据假设我们希望从一段简历描述中提取出候选人的姓名工作年限和技能列表并封装到一个中第一步定义数据模型在这之前我们讲解两个核心的知识点是引入的一个重要特性它被称为局部变量类型推断传统方式没有在处理复杂的泛型类型时代码会显得非常冗长和重复左边写了一长串类型右边又写了一遍使用的现代方式编译器会帮我们自动推断类型代码变得极其简洁使用的关键字可以极大地简化代码让我们通过一个类的例子来直观地感受一下带来的巨大便利在没有之前传统方式我们需要写下面这么多代码才能创建一个功能完备不可变的数据类保证不可继承保证不可变有了之后现代方式现在使用关键字我们可以用一行代码实现与上面完全相同的功能现在我们在包下创建一个新的包并在其中定义我们的数据传输对象文件路径候选者名称工作经验技能第二步创建解析服务接下来在包中创建一个新服务该服务封装了调用进行信息提取的核心逻辑文件路径创建一个实例传入目标的获取格式化指令这会生成一段文本指导如何格式化其输出将格式化指令整合到我们的中从下面的简历文本中提取信息简历文本渲染传入简历文本和格式化指令调用并直接使用解析响应是一个便捷方法它会调用并自动使用我们提供的解析器代码优化点在最新版本的中我们可以使用更简洁的链式调用它等同于您笔记中的后再手动但代码更具可读性第三步创建端点为了能通过请求使用我们的解析服务我们在包中创建一个新的控制器文件路径第四步运行与测试启动您的应用使用或任何测试工具向端点发送一个请求命令示例张三是一名资深软件工程师拥有超过年的开发经验他精通和技术预期响应您将会收到一个由自动序列化后的结构清晰的对象张三的价值它不仅仅是解析器它在和解析之间建立了一座桥梁通过在中注入格式指令极大地提高了模型输出结构化数据的可靠性和稳定性这是构建生产级可依赖的应用不可或缺的一环除了还提供了将输出解析为和将输出解析为以适应不同的场景需求提取为字符串列表当您只需要从文本中提取一个简单的列表时例如所有的技能所有的城市名是最便捷的选择第一步在中添加新方法我们将添加一个方法它只提取技能列表在中添加此方法新增新增其他已有代码需要一个我们使用默认的即可它的格式化指令非常简单会告诉返回一个逗号分隔的列表从下面的文本中只列出提到的所有技术技能文本第二步在中添加新端点在中添加此方法新增其他已有代码第三步测试使用测试新端点张三是一名资深软件工程师拥有超过年的开发经验他精通和技术预期响应提取为键值对当您需要提取一组不固定的键值对或者不想为此专门创建一个类时非常有用第一步在中添加新方法我们将添加一个方法用于提取关于一个主题的几个关键事实在中添加此方法新增其他已有代码请提供关于的三个有趣的事实必须以中文回复第二步在中添加新端点在中添加此方法其他已有代码第三步测试使用命令测试新端点程序员笑话预期响应内容可能不同程序员最喜欢的节日是程序员节因为在计算机中是的次方象征着程序员的世界有一个经典的笑话为什么程序员总是分不清万圣节和圣诞节因为八进制等于十进制程序员最讨厌的动物是因为它们总是在最不合适的时候出现而且很难彻底清除通过这三个解析器的实战我们已经掌握了让以可预测可靠的结构化格式返回数据的核心技巧这是构建生产级应用不可或缺的一环掌握了本章的内容你已经从一个只会简单提问的用户成长为一名懂得如何通过精心设计的来指挥和驾驭的工程师这是从使用到构建应用的关键一步",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-06-21 21:53:35",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0F1C2E')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#cee8ff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/index_media.css" media="(max-width:0),screen and (prefers-reduced-motion:reduce)" onload="this.media=`screen`"><link rel="stylesheet" href="/css/post-ui.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="后续项目..."><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="后续项目..."><span class="back-menu-item-text">后续项目...</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">格物致知</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)" rel="external nofollow noreferrer">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>个人</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fas fa-check-double faa-tada"></i><span> 代办清单</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/awesome-links/"><i class="fas fa-link faa-tada"></i><span> 实用网站</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>预览</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?server=netease&amp;id=3117791189"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fas fa-comments faa-tada"></i><span> 评论总览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 即刻短文</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="background-change-button"><a class="site-page" onclick="toggleWinbox()" title="切换背景" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-palette"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li></ul></div></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);" rel="external nofollow noreferrer"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url">后端技术</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Java/" itemprop="url">Java</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1-AI%E7%AF%87/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>Java微服务-AI篇</span></a></span></div></div><h1 class="post-title" itemprop="name headline">4. 深入 Prompt 工程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-15T11:13:45.000Z" title="发表于 2025-06-15 19:13:45">2025-06-15</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-06-21T13:53:35.198Z" title="更新于 2025-06-21 21:53:35">2025-06-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span data-flag-title="4. 深入 Prompt 工程"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为广东"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广东</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/25888.html#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope="" itemtype="https://prorise-cool.github.io/posts/25888.html"><header><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url">后端技术</a><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Java/" itemprop="url">Java</a><a href="/tags/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1-AI%E7%AF%87/" tabindex="-1" itemprop="url">Java微服务-AI篇</a><h1 id="CrawlerTitle" itemprop="name headline">4. 深入 Prompt 工程</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">Prorise</span><time itemprop="dateCreated datePublished" datetime="2025-06-15T11:13:45.000Z" title="发表于 2025-06-15 19:13:45">2025-06-15</time><time itemprop="dateCreated datePublished" datetime="2025-06-21T13:53:35.198Z" title="更新于 2025-06-21 21:53:35">2025-06-21</time></header><div id="postchat_postcontent"><h2 id="4-深入-Prompt-工程"><a href="#4-深入-Prompt-工程" class="headerlink" title="4. 深入 Prompt 工程"></a>4. 深入 Prompt 工程</h2><p>如果说 <code>ChatClient</code> 是连接你和 AI 的电话线，那么 <strong>Prompt 就是你在这条电话线上说的话</strong>。你说得是否清晰、准确、有技巧，直接决定了电话那头的 AI 能否理解你的意图并给出满意的答复。Prompt 工程（Prompt Engineering）就是一门研究如何与 AI 高效沟通的艺术与科学。在本章，我将带你从理论到实践，彻底掌握它。</p><h4 id="4-1-Prompt-的重要性与基本原则"><a href="#4-1-Prompt-的重要性与基本原则" class="headerlink" title="4.1 Prompt 的重要性与基本原则"></a>4.1 Prompt 的重要性与基本原则</h4><p>在与大语言模型交互时，我们很容易犯一个错误：把模型想象成一个无所不知、能够完美揣测我们心思的人类。但实际上，它是一个基于海量数据训练出来的概率模型。你给它的输入（Prompt）越模糊，它输出的结果就越可能偏离你的预期。</p><blockquote><p><strong>Prompt 是与 AI 沟通的 API</strong>。就像调用一个软件 API 需要遵循其定义的参数和格式一样，与 AI 沟通也需要遵循一定的范式，才能获得稳定、可控的输出。</p></blockquote><p>以下是编写高效 Prompt 的几个基本原则：</p><ol><li><strong>清晰具体</strong>：避免使用模糊的词语。不要说“给我写点关于狗的东西”，而要说“为一位10岁的小学生，写一段150字左右的短文，介绍金毛寻回犬的性格特点和历史起源”。</li><li><strong>提供上下文</strong>：如果你的问题需要背景知识，请在 Prompt 中明确提供。例如，在分析一段用户评论前，先告诉模型：“你是一个电商平台的客服主管，请分析以下用户评论的情感倾向”。</li><li><strong>设定角色</strong>：这是最有效的技巧之一。让 AI 扮演一个角色，可以极大地约束它的行为和语言风格。例如，“你是一位资深的 Java 技术专家…”、“你是一位风趣幽默的脱口秀演员…”。</li><li><strong>施加约束</strong>：明确告诉模型你<strong>不</strong>想要什么，或者输出必须遵循的格式。例如，“…不要使用任何技术术语”、“…请以 JSON 格式输出，包含 name 和 email 两个字段”、“…回答不要超过100个字”。</li><li><strong>提供示例</strong>：如果需要模型遵循特定的输出格式或风格，最好的方法就是给它一两个例子。这比用语言描述格式要有效得多。</li></ol><h4 id="4-2-Prompt-类详解"><a href="#4-2-Prompt-类详解" class="headerlink" title="4.2 Prompt 类详解"></a>4.2 <code>Prompt</code> 类详解</h4><p>在 Spring AI 中，<code>org.springframework.ai.chat.prompt.Prompt</code> 类是所有与 <code>ChatClient</code> 交互的载体。它不仅仅是一个简单的字符串包装器，而是一个结构化的对象，用于封装发送给模型的完整指令集。</p><p>它的构造函数主要有两种：</p><ol><li><code>Prompt(String contents)</code>: 这是最简单的形式，将一个字符串包装成一个 <code>UserMessage</code>。</li><li><code>Prompt(List&lt;Message&gt; messages)</code>: 这是更通用和强大的形式，允许你传入一个由不同角色组成的 <code>Message</code> 列表，构建复杂的多轮对话或带有系统指令的请求。</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单形式：等同于创建一个只包含单个 UserMessage 的 Prompt</span></span><br><span class="line"><span class="type">Prompt</span> <span class="variable">simplePrompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(<span class="string">"你好，AI！"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复杂形式：构建一个包含系统指令和用户提问的 Prompt</span></span><br><span class="line">List&lt;Message&gt; messages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">messages.add(<span class="keyword">new</span> <span class="title class_">SystemMessage</span>(<span class="string">"你是一个专业的翻译家，只将用户输入翻译成英文。"</span>));</span><br><span class="line">messages.add(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(<span class="string">"我爱编程。"</span>));</span><br><span class="line"><span class="type">Prompt</span> <span class="variable">structuredPrompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(messages);</span><br></pre></td></tr></tbody></table></figure><p><code>Prompt</code> 对象还允许你附加 <code>PromptOptions</code>，用于在单次调用中覆盖全局的模型参数（如 <code>model</code>, <code>temperature</code> 等），这为动态调整 AI 行为提供了极大的灵活性。</p><p>在我们之前的代码中是如下编写的，可以把 <code>chatClient.prompt()</code> 理解为<strong>一次新的对话的“发起”或“启动信号”</strong>。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 流式内容调用：返回纯文本内容的响应流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> message 用户的提问</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 一个包含文本内容片段的 Flux 流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">getStreamContent</span><span class="params">(String message)</span> {</span><br><span class="line">    <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .user(message)</span><br><span class="line">            .stream()</span><br><span class="line">            .content();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>那么，既然有这么便捷的方式，为什么 Spring AI 还要设计一个看起来有些“繁琐”的 <code>Prompt</code> 类呢？</p><p><strong>答案是：<code>.user(message)</code> 只是一个快捷方式。而 <code>Prompt</code> 类，才是与AI进行一切复杂、有深度、有上下文交互的“官方语言”和标准容器。</strong></p><p>您可以把它们的关系想象成寄快递：</p><ul><li><strong><code>.user(message)</code></strong>：就像是寄一个最简单的**“信封”**。您只需把信（<code>message</code>）塞进去，写上地址，它就能寄出。非常快捷，但功能有限。</li><li><strong><code>Prompt</code> 类</strong>：这是一个可定制的、坚固的**“快递包裹”**。您不仅可以放入用户的信件，还可以放入各种“附件”和“特殊说明”，来指挥收件人（AI）如何处理这份包裹。</li></ul><p><code>ChatService</code> 能那么简单，是因为它处理的是最基础的“信封”场景。但一旦需求变得复杂，<code>Prompt</code> 类的威力就体现出来了。</p><p>以下是 <code>.user(message)</code> 这种简单形式<strong>无法做到</strong>，而必须使用 <code>Prompt</code> 类才能实现的核心功能：</p><h5 id="4-2-1-角色扮演与指令设定-SystemMessage"><a href="#4-2-1-角色扮演与指令设定-SystemMessage" class="headerlink" title="4.2.1 角色扮演与指令设定 (SystemMessage)"></a><strong>4.2.1 角色扮演与指令设定 (<code>SystemMessage</code>)</strong></h5><p>我们经常需要AI扮演一个特定的角色或遵循特定的规则。这通过 <code>SystemMessage</code>（系统消息）来实现，而 <code>SystemMessage</code> 必须被包裹在 <code>Prompt</code> 对象中。</p><p><strong>您的示例代码正是完美的说明：</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 流式内容调用：返回纯文本内容的响应流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> message 用户的提问</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 一个包含文本内容片段的 Flux 流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">getStreamContent</span><span class="params">(String message)</span> {</span><br><span class="line">    <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .system(<span class="string">"你是一个擅长翻译的大语言模型,会吧用户说的中文都翻译为英文"</span>)</span><br><span class="line">            .user(message)</span><br><span class="line">            .stream()</span><br><span class="line">            .content();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>.user()</code> 快捷方式无法单独传递这种系统级的“人设”指令。</p><h5 id="4-2-2-提供上下文与对话历史-AssistantMessage"><a href="#4-2-2-提供上下文与对话历史-AssistantMessage" class="headerlink" title="4.2.2. 提供上下文与对话历史 (AssistantMessage)"></a><strong>4.2.2. 提供上下文与对话历史 (<code>AssistantMessage</code>)</strong></h5><p>这是实现<strong>多轮对话</strong>的核心。为了让AI“记住”之前的对话，我们需要把历史聊天记录一起发送给它。这些历史记录就包含了之前的 <code>UserMessage</code> 和 <code>AssistantMessage</code>（AI的回答）。</p><p><strong>场景示例：</strong></p><ol><li><strong>用户</strong>：“2022年世界杯谁赢了？”</li><li><strong>AI</strong>：“阿根廷队赢得了2022年世界杯。”</li><li><strong>用户</strong>：“他们的队长是谁？” &lt;– <em>如果只发送这个问题，AI无法理解“他们”是谁</em></li></ol><p>要让AI正确回答，我们必须构建一个包含历史记录的 <code>Prompt</code>：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Message&gt; conversationHistory = List.of(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">UserMessage</span>(<span class="string">"2022年世界杯谁赢了？"</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(<span class="string">"阿根廷队赢得了2022年世界杯。"</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">UserMessage</span>(<span class="string">"他们的队长是谁？"</span>) <span class="comment">// 当前问题</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="type">Prompt</span> <span class="variable">promptWithHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(conversationHistory);</span><br><span class="line"><span class="comment">// 发送这个携带了完整上下文的 Prompt，AI 才能知道 "他们" 指的是阿根廷队</span></span><br><span class="line"><span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(promptWithHistory); </span><br><span class="line"><span class="comment">// AI 会回答 "利昂内尔·梅西是他们的队长。"</span></span><br></pre></td></tr></tbody></table></figure><p><code>ChatMemory</code> 的工作原理，本质上就是在后台自动帮我们组装这个包含历史记录的 <code>List&lt;Message&gt;</code>，并创建 <code>Prompt</code> 对象。</p><h5 id="4-2-3-请求级选项覆盖-PromptOptions"><a href="#4-2-3-请求级选项覆盖-PromptOptions" class="headerlink" title="4.2.3 请求级选项覆盖 (PromptOptions)"></a><strong>4.2.3 请求级选项覆盖 (<code>PromptOptions</code>)</strong></h5><p>有时，我们可能希望某一次特定的API调用使用不同的模型或参数（比如更高的 <code>temperature</code> 来增加创意），而不想修改全局配置。<code>Prompt</code> 类允许我们在创建时附加一个 <code>PromptOptions</code> 对象。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设全局配置的模型是 deepseek-chat, temperature 是 0.7</span></span><br><span class="line"><span class="comment">// 但这次我想要更有创意的回答</span></span><br><span class="line"></span><br><span class="line"><span class="type">OpenAiChatOptions</span> <span class="variable">customOptions</span> <span class="operator">=</span> OpenAiChatOptions.builder()</span><br><span class="line">        .withModel(<span class="string">"gpt-4o"</span>) <span class="comment">// 本次调用临时切换到 gpt-4o</span></span><br><span class="line">        .withTemperature(<span class="number">0.95f</span>) <span class="comment">// 大幅提高温度</span></span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="type">Prompt</span> <span class="variable">creativePrompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(<span class="string">"写一首关于机器人在雨中哭泣的诗。"</span>, customOptions);</span><br><span class="line">chatClient.call(creativePrompt);</span><br></pre></td></tr></tbody></table></figure><h4 id="4-3-Message-与角色"><a href="#4-3-Message-与角色" class="headerlink" title="4.3 Message 与角色"></a>4.3 <code>Message</code> 与角色</h4><p><code>Message</code> 是构成 <code>Prompt</code> 的基本单位。Spring AI 定义了四种核心的 <code>Message</code> 类型，它们分别对应了与模型对话中不同的角色。理解并善用它们，是实现高级、可控的人工智能交互``的关键。</p><p>下表详细说明了每种消息类型的作用和典型应用场景：</p><table><thead><tr><th><strong>消息类型 (Message Type)</strong></th><th><strong>核心作用</strong></th><th><strong>典型应用场景与示例</strong></th></tr></thead><tbody><tr><td><strong><code>SystemMessage</code></strong>&lt;br&gt;(系统消息)</td><td>用于设定 AI 的<strong>角色、行为准则、个性、目标</strong>和任何高级指令。它就像是给 AI 的“出厂设置”或“后台指令”，通常在对话开始时发送，并对整个对话过程持续生效，是<strong>优先级最高</strong>的指令。</td><td>为 AI 赋予人格或限定其能力范围</td></tr><tr><td><strong><code>UserMessage</code></strong>&lt;br&gt;(用户消息)</td><td>代表<strong>最终用户的输入</strong>。它就是用户的提问、指令或对话内容。在一次请求中，这通常是消息列表的最后一条。</td><td>用户向 AI 发起的每一次具体的提问</td></tr><tr><td><strong><code>AssistantMessage</code></strong>&lt;br&gt;(助手消息)</td><td>代表 <strong>AI 自己之前</strong>的回复。它是构建多轮对话历史、让 AI <strong>“记住”上下文</strong>的关键部分。</td><td>在实现对话记忆（Chat Memory）功能时，将历史记录中的每一条 AI 回复封装起来，重新传回给模型</td></tr><tr><td><strong><code>FunctionMessage</code></strong>&lt;br&gt;(函数消息)</td><td>用于<strong>函数/工具调用（Function/Tool Calling）场景。当 AI 决定调用一个外部工具后，应用需要将该工具的执行结果</strong>通过 <code>FunctionMessage</code> 返回给 AI，以便它能根据结果生成最终的自然语言回答。</td><td>AI 需要获取实时信息或执行操作时</td></tr></tbody></table><hr><h4 id="4-4-PromptTemplate：让-Prompt-动起来"><a href="#4-4-PromptTemplate：让-Prompt-动起来" class="headerlink" title="4.4 PromptTemplate：让 Prompt 动起来"></a>4.4 <code>PromptTemplate</code>：让 Prompt 动起来</h4><p>在实际应用中，我们的 Prompt 很少是完全静态的。通常需要根据用户的输入、查询的数据库结果或其他动态信息来构建。手动拼接字符串不仅繁琐、易错，而且难以维护。<code>PromptTemplate</code> 正是为此而生。</p><p><code>PromptTemplate</code> 允许你定义一个包含占位符（变量）的模板字符串，然后用一个 <code>Map</code> 来填充这些变量，最终渲染出一个完整的 <code>Prompt</code> 对象。</p><h5 id="4-4-1-简单示例：个性化问候"><a href="#4-4-1-简单示例：个性化问候" class="headerlink" title="4.4.1 简单示例：个性化问候"></a>4.4.1 简单示例：个性化问候</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件路径: src/main/java/com/example/hellospringai/service/ChatService.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.hellospringai.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatService</span><span class="params">(ChatClient chatClient)</span> {</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 【新方法】使用 PromptTemplate 实现动态翻译功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetLanguage 要翻译的目标语言 (e.g., "英文", "日文", "法文")</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text 要翻译的原文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 翻译后的文本内容流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">getDynamicTranslatedStream</span><span class="params">(String targetLanguage, String text)</span> {</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. 定义包含 {targetLanguage} 占位符的系统指令模板</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">systemPromptTemplate</span> <span class="operator">=</span> <span class="string">"你是一个专业的、精通多种语言的翻译家。"</span> + </span><br><span class="line">                                      <span class="string">"请将用户接下来发送的所有内容都翻译成 {targetLanguage}。"</span> +</span><br><span class="line">                                      <span class="string">"不要添加任何与翻译结果无关的解释或寒暄。"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">                <span class="comment">// 2. 使用流式API的高级形式，直接传入模板和变量来构建 SystemMessage</span></span><br><span class="line">                .system(systemSpec -&gt; systemSpec</span><br><span class="line">                        .text(systemPromptTemplate) <span class="comment">// 设置模板字符串</span></span><br><span class="line">                        .param(<span class="string">"targetLanguage"</span>, targetLanguage) <span class="comment">// 绑定模板中的变量</span></span><br><span class="line">                )</span><br><span class="line">                .user(text) <span class="comment">// 用户输入原文</span></span><br><span class="line">                .stream()</span><br><span class="line">                .content();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="4-5-结构化输出：将-AI-响应映射为-POJO"><a href="#4-5-结构化输出：将-AI-响应映射为-POJO" class="headerlink" title="4.5 结构化输出：将 AI 响应映射为 POJO"></a>4.5 结构化输出：将 AI 响应映射为 POJO</h4><p>我们经常需要 AI 返回的不仅仅是一段自由文本，而是一个<strong>结构化的数据</strong>，比如 JSON。传统的做法是让 AI 生成 JSON 字符串，然后在 Java 代码中手动解析它。这种方式非常脆弱，因为 AI 可能返回一个格式不正确的 JSON，导致解析失败。</p><p><code>OutputConverter</code> 是 Spring AI 提供的利器，它能将模型的文本输出<strong>自动、安全地转换为指定的 Java 对象</strong>。</p><h5 id="4-5-1-BeanOutputConverter-简单提取Json文本数据"><a href="#4-5-1-BeanOutputConverter-简单提取Json文本数据" class="headerlink" title="4.5.1 BeanOutputConverter 简单提取Json文本数据"></a>4.5.1 <code>BeanOutputConverter</code> 简单提取Json文本数据</h5><p>假设我们希望 AI 从一段简历描述中，提取出候选人的姓名、工作年限和技能列表，并封装到一个 <code>Candidate</code> DTO (Data Transfer Object) 中。</p><p><strong>第一步：定义数据模型 (<code>Candidate.java</code>)</strong></p><p>在这之前我们讲解两个核心的知识点</p><p>1.<code>var</code> 是 Java 10 引入的一个重要特性，它被称为**局部变量类型推断 **。</p><p><strong>1. 传统方式（没有 <code>var</code>）</strong></p><p>在处理复杂的泛型类型时，代码会显得非常冗长和重复。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 左边写了一长串类型，右边又写了一遍</span></span><br><span class="line">BeanOutputConverter&lt;Candidate&gt; candidateBeanOutputConverter = <span class="keyword">new</span> <span class="title class_">BeanOutputConverter</span>&lt;&gt;(Candidate.class);</span><br></pre></td></tr></tbody></table></figure><p><strong>2. 使用 <code>var</code> 的现代方式</strong></p><p>编译器会帮我们自动推断类型，代码变得极其简洁。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">OutputConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanOutputConverter</span>&lt;&gt;(Candidate.class);</span><br></pre></td></tr></tbody></table></figure><p>2.使用 Java 17 的 <code>record</code> 关键字可以极大地简化代码</p><p>让我们通过一个 <code>Person</code> 类的例子，来直观地感受一下 <code>record</code> 带来的巨大便利。</p><p><strong>1. 在没有 <code>record</code> 之前 (传统方式)</strong></p><p>我们需要写下面这么多代码，才能创建一个功能完备、不可变的数据类：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TraditionalPerson.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TraditionalPerson</span> { <span class="comment">// final 保证不可继承</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name; <span class="comment">// private final 保证不可变</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TraditionalPerson</span><span class="params">(String name, <span class="type">int</span> age)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">TraditionalPerson</span> <span class="variable">that</span> <span class="operator">=</span> (TraditionalPerson) o;</span><br><span class="line">        <span class="keyword">return</span> age == that.age &amp;&amp; Objects.equals(name, that.name);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(name, age);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"TraditionalPerson["</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">']'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>2. 有了 <code>record</code> 之后 (现代方式)</strong></p><p>现在，使用 <code>record</code> 关键字，我们可以用<strong>一行代码</strong>实现与上面完全相同的功能：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> {}</span><br></pre></td></tr></tbody></table></figure><p>现在，我们在 <code>com.example.hellospringai</code> 包下创建一个新的 <code>dto</code> 包，并在其中定义我们的数据传输对象。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件路径: src/main/java/com/example/hellospringai/dto/Candidate.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.hellospringai.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">Candidate</span><span class="params">(</span></span><br><span class="line"><span class="params">        String name, // 候选者名称</span></span><br><span class="line"><span class="params">        <span class="type">int</span> yearsOfExperience, // 工作经验</span></span><br><span class="line"><span class="params">        List&lt;String&gt; skills // 技能</span></span><br><span class="line"><span class="params">)</span> {}</span><br></pre></td></tr></tbody></table></figure><p><strong>第二步：创建解析服务 (<code>ExtractionService.java</code>)</strong></p><p>接下来，在 <code>service</code> 包中创建一个新服务，该服务封装了调用 AI 进行信息提取的核心逻辑。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件路径: src/main/java/com/example/hellospringai/service/ExtractionService.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.hellospringai.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.hellospringai.dto.Candidate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.prompt.Prompt;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.prompt.Prompt;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.prompt.PromptTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.converter.BeanOutputConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtractionService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExtractionService</span><span class="params">(ChatClient chatClient)</span> {</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Candidate <span class="title function_">extractCandidateFrom</span><span class="params">(String resumeText)</span> {</span><br><span class="line">        <span class="comment">// 1. 创建一个 BeanOutputConverter 实例，传入目标 DTO 的 Class</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">OutputConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanOutputConverter</span>&lt;&gt;(Candidate.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 获取格式化指令。这会生成一段文本，指导 AI 如何格式化其 JSON 输出。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">formatInstructions</span> <span class="operator">=</span> OutputConverter.getFormat();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 将格式化指令整合到我们的 PromptTemplate 中</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">promptTemplateString</span> <span class="operator">=</span> <span class="string">"""</span></span><br><span class="line"><span class="string">                从下面的简历文本中提取信息。</span></span><br><span class="line"><span class="string">                {format}</span></span><br><span class="line"><span class="string">                简历文本:</span></span><br><span class="line"><span class="string">                {resume}</span></span><br><span class="line"><span class="string">                """</span>;</span><br><span class="line">        <span class="type">PromptTemplate</span> <span class="variable">promptTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(promptTemplateString);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 渲染 Prompt，传入简历文本和格式化指令</span></span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> promptTemplate.create(Map.of(</span><br><span class="line">                <span class="string">"resume"</span>, resumeText,</span><br><span class="line">                <span class="string">"format"</span>, formatInstructions</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 调用 ChatClient，并直接使用 OutputConverter 解析响应</span></span><br><span class="line">        <span class="comment">// .call().entity() 是一个便捷方法，它会调用AI并自动使用我们提供的解析器</span></span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt(prompt)</span><br><span class="line">                .call()</span><br><span class="line">                .entity(OutputConverter);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>代码优化点</strong>：<br>在最新版本的 Spring AI 中，我们可以使用更简洁的 <code>.call().entity(outputParser)</code> 链式调用，它等同于您笔记中的 <code>.call()</code> 后再手动 <code>.parse()</code>，但代码更具可读性。</p></blockquote><p><strong>第三步：创建 API 端点 (<code>ExtractionController.java</code>)</strong></p><p>为了能通过 HTTP 请求使用我们的解析服务，我们在 <code>controller</code> 包中创建一个新的控制器。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件路径: src/main/java/com/example/hellospringai/controller/ExtractionController.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.hellospringai.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.hellospringai.dto.Candidate;</span><br><span class="line"><span class="keyword">import</span> com.example.hellospringai.service.ExtractionService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/api/v1")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtractionController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExtractionService extractionService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExtractionController</span><span class="params">(ExtractionService extractionService)</span> {</span><br><span class="line">        <span class="built_in">this</span>.extractionService = extractionService;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping("/extract")</span></span><br><span class="line">    <span class="keyword">public</span> Candidate <span class="title function_">extractData</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">resumeText</span> <span class="operator">=</span> request.get(<span class="string">"resumeText"</span>);</span><br><span class="line">        <span class="keyword">return</span> extractionService.extractCandidateFrom(resumeText);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>第四步：运行与测试</strong></p><ol><li>启动您的 Spring Boot 应用。</li><li>使用 <code>curl</code> 或任何 API 测试工具，向 <code>/ai/extract</code> 端点发送一个 <code>POST</code> 请求。</li></ol><p><strong><code>curl</code> 命令示例：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:8080/ai/extract -H <span class="string">"Content-Type: application/json"</span> -d <span class="string">"{\"resumeText\": \"张三是一名资深软件工程师，拥有超过8年的Java开发经验。他精通Spring Boot, Microservices, 和 Docker技术。\"}"</span></span><br></pre></td></tr></tbody></table></figure><p><strong>预期 JSON 响应：</strong><br>您将会收到一个由 Spring Boot 自动序列化后的、结构清晰的 <code>Candidate</code> JSON 对象。</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"张三"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"yearsOfExperence"</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"skills"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">"Java"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"Spring Boot"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"Microservices"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"Docker"</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong><code>BeanOutputConverter</code> 的价值</strong>：它不仅仅是 JSON 解析器。它在 Prompt 和解析之间建立了一座桥梁，通过在 Prompt 中注入格式指令，极大地提高了模型输出结构化数据的<strong>可靠性和稳定性</strong>。这是构建生产级、可依赖的 AI 应用不可或缺的一环。</p></blockquote><p>除了 <code>BeanOutputConverter</code>，Spring AI 还提供了 <code>MapOutputConverter</code>（将输出解析为 <code>Map&lt;String, Object&gt;</code>）和 <code>ListOutputConverter</code>（将输出解析为 <code>List&lt;String&gt;</code>），以适应不同的场景需求</p><hr><h5 id="4-5-2-ListOutputParser-提取为字符串列表"><a href="#4-5-2-ListOutputParser-提取为字符串列表" class="headerlink" title="4.5.2 ListOutputParser: 提取为字符串列表"></a>4.5.2 <code>ListOutputParser</code>: 提取为字符串列表</h5><p>当您只需要从文本中提取一个简单的列表时（例如，所有的技能、所有的城市名），<code>ListOutputParser</code> 是最便捷的选择。</p><p><strong>第一步：在 <code>ExtractionService.java</code> 中添加新方法</strong></p><p>我们将添加一个 <code>extractSkillsToList</code> 方法，它只提取技能列表。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 ExtractionService.java 中添加此方法</span></span><br><span class="line"><span class="keyword">package</span> com.example.hellospringai.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.parser.ListOutputParser; <span class="comment">// 新增 import</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.support.DefaultConversionService; <span class="comment">// 新增 import</span></span><br><span class="line"><span class="comment">// ... 其他 import</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtractionService</span> {</span><br><span class="line">    <span class="comment">// ... 已有代码 ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">extractSkillsToList</span><span class="params">(String resumeText)</span> {</span><br><span class="line">        <span class="comment">// 1. ListOutputParser 需要一个 ConversionService，我们使用默认的即可</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">outputParser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListOutputParser</span>(<span class="keyword">new</span> <span class="title class_">DefaultConversionService</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 它的格式化指令非常简单，会告诉AI返回一个逗号分隔的列表</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">formatInstructions</span> <span class="operator">=</span> outputParser.getFormat();</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">promptTemplateString</span> <span class="operator">=</span> <span class="string">"""</span></span><br><span class="line"><span class="string">                从下面的文本中，只列出提到的所有技术技能。</span></span><br><span class="line"><span class="string">                {format}</span></span><br><span class="line"><span class="string">                文本: {resume}</span></span><br><span class="line"><span class="string">                """</span>;</span><br><span class="line">        <span class="type">PromptTemplate</span> <span class="variable">promptTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(promptTemplateString);</span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> promptTemplate.create(Map.of(</span><br><span class="line">                <span class="string">"resume"</span>, resumeText,</span><br><span class="line">                <span class="string">"format"</span>, formatInstructions</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt(prompt)</span><br><span class="line">                .call()</span><br><span class="line">                .entity(outputParser);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>第二步：在 <code>ExtractionController.java</code> 中添加新端点</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 ExtractionController.java 中添加此方法</span></span><br><span class="line"><span class="keyword">package</span> com.example.hellospringai.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List; <span class="comment">// 新增 import</span></span><br><span class="line"><span class="comment">// ... 其他 import</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/ai")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtractionController</span> {</span><br><span class="line">    <span class="comment">// ... 已有代码 ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping("/skills-list")</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">extractSkills</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">resumeText</span> <span class="operator">=</span> request.get(<span class="string">"resumeText"</span>);</span><br><span class="line">        <span class="keyword">return</span> extractionService.extractSkillsToList(resumeText);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>第三步：测试 <code>ListOutputParser</code></strong></p><p>使用 <code>postman</code> 测试新端点：</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cDovL2xvY2FsaG9zdDo4MDgwL2FpL3NraWxscy1saXN0">http://localhost:8080/ai/skills-list</a></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="string">"resumeText"</span>: <span class="string">"张三是一名资深软件工程师，拥有超过8年的Java开发经验。他精通Spring Boot, Microservices, 和 Docker技术。"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>预期 JSON 响应：</strong></p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="string">"Java"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">"Spring Boot"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">"Microservices"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">"Docker"</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></tbody></table></figure><hr><h5 id="4-5-3-MapOutputParser-提取为键值对-Map"><a href="#4-5-3-MapOutputParser-提取为键值对-Map" class="headerlink" title="4.5.3 MapOutputParser: 提取为键值对 Map"></a>4.5.3 <code>MapOutputParser</code>: 提取为键值对 Map</h5><p>当您需要提取一组不固定的键值对，或者不想为此专门创建一个Java类时，<code>MapOutputParser</code> 非常有用。</p><p><strong>第一步：在 <code>ExtractionService.java</code> 中添加新方法</strong></p><p>我们将添加一个 <code>extractFactsToMap</code> 方法，用于提取关于一个主题的几个关键事实。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 ExtractionService.java 中添加此方法</span></span><br><span class="line"><span class="keyword">package</span> com.example.hellospringai.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.parser.MapOutputParser; <span class="comment">// 新增 import</span></span><br><span class="line"><span class="comment">// ... 其他 import</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtractionService</span> {</span><br><span class="line">    <span class="comment">// ... 已有代码 ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">extractFactsToMap</span><span class="params">(String topic)</span> {</span><br><span class="line">        <span class="type">var</span> <span class="variable">outputParser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MapOutputConverter</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">formatInstructions</span> <span class="operator">=</span> outputParser.getFormat();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">promptTemplateString</span> <span class="operator">=</span> <span class="string">"""</span></span><br><span class="line"><span class="string">                请提供关于 "{topic}" 的三个有趣的事实，必须以中文回复</span></span><br><span class="line"><span class="string">                {format}</span></span><br><span class="line"><span class="string">                """</span>;</span><br><span class="line">        <span class="type">PromptTemplate</span> <span class="variable">promptTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(promptTemplateString);</span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> promptTemplate.create(Map.of(</span><br><span class="line">                <span class="string">"topic"</span>, topic,</span><br><span class="line">                <span class="string">"format"</span>, formatInstructions</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt(prompt)</span><br><span class="line">                .call()</span><br><span class="line">                .entity(outputParser);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>第二步：在 <code>ExtractionController.java</code> 中添加新端点</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 ExtractionController.java 中添加此方法</span></span><br><span class="line"><span class="keyword">package</span> com.example.hellospringai.controller;</span><br><span class="line"><span class="comment">// ... 其他 import</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/ai")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtractionController</span> {</span><br><span class="line">    <span class="comment">// ... 已有代码 ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping("/facts-map")</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">extractFacts</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">topic</span> <span class="operator">=</span> request.get(<span class="string">"topic"</span>);</span><br><span class="line">        <span class="keyword">return</span> extractionService.extractFactsToMap(topic);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>第三步：测试 <code>MapOutputParser</code></strong></p><p>使用 <code>post</code> 命令测试新端点：</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cDovL2xvY2FsaG9zdDo4MDgwL2FpL2ZhY3RzLW1hcA">http://localhost:8080/ai/facts-map</a></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{<span class="string">"topic"</span>: <span class="string">"程序员笑话"</span>}</span><br></pre></td></tr></tbody></table></figure><p><strong>预期 JSON 响应 (内容可能不同)：</strong></p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"1"</span><span class="punctuation">:</span> <span class="string">"程序员最喜欢的节日是'1024程序员节'，因为1024在计算机中是2的10次方，象征着程序员的世界。"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"2"</span><span class="punctuation">:</span> <span class="string">"有一个经典的笑话：为什么程序员总是分不清万圣节和圣诞节？因为Oct 31 == Dec 25（八进制31等于十进制25）。"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"3"</span><span class="punctuation">:</span> <span class="string">"程序员最讨厌的动物是Bug，因为它们总是在最不合适的时候出现，而且很难彻底清除。"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p>通过这三个解析器的实战，我们已经掌握了让AI以可预测、可靠的结构化格式返回数据的核心技巧，这是构建生产级AI应用不可或缺的一环。</p><p>掌握了本章的内容，你已经从一个只会简单提问的 AI 用户，成长为一名懂得如何通过精心设计的 Prompt 来指挥和驾驭 AI 的“工程师”。这是从“使用 AI”到“构建 AI 应用”的关键一步。</p></div></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Prorise</div><div class="post-copyright__author_desc">这聒噪的世界让沉默的人显得另类</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://prorise-cool.github.io/posts/25888.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl(&quot;https://prorise-cool.github.io/posts/25888.html&quot;)">4. 深入 Prompt 工程</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/bYMH/418X445/ef9a3f68-d36a-441a-95fe-8179b1a25992.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tc.z.wiki/autoupload/iXoPwUD80CPTvQUyITTBFOykMT9FcWW5SasRoXZEs3Wyl5f0KlZfm6UsKj-HyTuv/20250609/cYu3/347X390/zfb.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://prorise-cool.github.io/posts/25888.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=4. 深入 Prompt 工程&amp;url=https://prorise-cool.github.io/posts/25888.html&amp;pic=https://bu.dusays.com/2025/06/19/68535b23089d0.webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Prorise-cool.github.io" target="_blank">格物致知</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/"><span class="categoryes-punctuation"><i class="anzhiyufont anzhiyu-icon-inbox"></i></span>后端技术<span class="categoryesPageCount">15</span></a><a class="post-meta__box__categoryes" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/Java/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>Java<span class="categoryesPageCount">15</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1-AI%E7%AF%87/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>Java微服务-AI篇<span class="tagsPageCount">15</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer=""></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/21190.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" onerror="onerror=null,src=&quot;/img/404.jpg&quot;" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">3. 对话核心 API 深度解析</div></div></a></div><div class="next-post pull-right"><a href="/posts/51829.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" onerror="onerror=null,src=&quot;/img/404.jpg&quot;" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">5. Chat Models：与大语言模型对话</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/12027.html" title="2. 快速入门：构建你的第一个 AI 应用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-15</div><div class="title">2. 快速入门：构建你的第一个 AI 应用</div></div></a></div><div><a href="/posts/59558.html" title="1. 序章：迎接 Java AI 开发新纪元"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-15</div><div class="title">1. 序章：迎接 Java AI 开发新纪元</div></div></a></div><div><a href="/posts/21190.html" title="3. 对话核心 API 深度解析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-15</div><div class="title">3. 对话核心 API 深度解析</div></div></a></div><div><a href="/posts/17745.html" title="12. 生产环境考量与部署"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-16</div><div class="title">12. 生产环境考量与部署</div></div></a></div><div><a href="/posts/36675.html" title="13. 实战项目：构建一个完整的 AI 知识库应用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-16</div><div class="title">13. 实战项目：构建一个完整的 AI 知识库应用</div></div></a></div><div><a href="/posts/57498.html" title="10. 构建高级 RAG 应用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-16</div><div class="title">10. 构建高级 RAG 应用</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" rel="external nofollow noreferrer">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div><script>window.postData={title:"4. 深入 Prompt 工程",date:"2025-06-15 19:13:45",updated:"2025-06-21 21:53:35",tags:["Java微服务-AI篇"],categories:["后端技术","Java"],content:'\n## 4. 深入 Prompt 工程\n\n如果说 `ChatClient` 是连接你和 AI 的电话线，那么 **Prompt 就是你在这条电话线上说的话**。你说得是否清晰、准确、有技巧，直接决定了电话那头的 AI 能否理解你的意图并给出满意的答复。Prompt 工程（Prompt Engineering）就是一门研究如何与 AI 高效沟通的艺术与科学。在本章，我将带你从理论到实践，彻底掌握它。\n\n#### 4.1 Prompt 的重要性与基本原则\n\n在与大语言模型交互时，我们很容易犯一个错误：把模型想象成一个无所不知、能够完美揣测我们心思的人类。但实际上，它是一个基于海量数据训练出来的概率模型。你给它的输入（Prompt）越模糊，它输出的结果就越可能偏离你的预期。\n\n> **Prompt 是与 AI 沟通的 API**。就像调用一个软件 API 需要遵循其定义的参数和格式一样，与 AI 沟通也需要遵循一定的范式，才能获得稳定、可控的输出。\n\n以下是编写高效 Prompt 的几个基本原则：\n1.  **清晰具体**：避免使用模糊的词语。不要说“给我写点关于狗的东西”，而要说“为一位10岁的小学生，写一段150字左右的短文，介绍金毛寻回犬的性格特点和历史起源”。\n2.  **提供上下文**：如果你的问题需要背景知识，请在 Prompt 中明确提供。例如，在分析一段用户评论前，先告诉模型：“你是一个电商平台的客服主管，请分析以下用户评论的情感倾向”。\n3.  **设定角色**：这是最有效的技巧之一。让 AI 扮演一个角色，可以极大地约束它的行为和语言风格。例如，“你是一位资深的 Java 技术专家...”、“你是一位风趣幽默的脱口秀演员...”。\n4.  **施加约束**：明确告诉模型你**不**想要什么，或者输出必须遵循的格式。例如，“...不要使用任何技术术语”、“...请以 JSON 格式输出，包含 name 和 email 两个字段”、“...回答不要超过100个字”。\n5.  **提供示例**：如果需要模型遵循特定的输出格式或风格，最好的方法就是给它一两个例子。这比用语言描述格式要有效得多。\n\n#### 4.2 `Prompt` 类详解\n\n在 Spring AI 中，`org.springframework.ai.chat.prompt.Prompt` 类是所有与 `ChatClient` 交互的载体。它不仅仅是一个简单的字符串包装器，而是一个结构化的对象，用于封装发送给模型的完整指令集。\n\n它的构造函数主要有两种：\n1.  `Prompt(String contents)`: 这是最简单的形式，将一个字符串包装成一个 `UserMessage`。\n2.  `Prompt(List<Message> messages)`: 这是更通用和强大的形式，允许你传入一个由不同角色组成的 `Message` 列表，构建复杂的多轮对话或带有系统指令的请求。\n\n```java\n// 简单形式：等同于创建一个只包含单个 UserMessage 的 Prompt\nPrompt simplePrompt = new Prompt("你好，AI！");\n\n// 复杂形式：构建一个包含系统指令和用户提问的 Prompt\nList<Message> messages = new ArrayList<>();\nmessages.add(new SystemMessage("你是一个专业的翻译家，只将用户输入翻译成英文。"));\nmessages.add(new UserMessage("我爱编程。"));\nPrompt structuredPrompt = new Prompt(messages);\n```\n`Prompt` 对象还允许你附加 `PromptOptions`，用于在单次调用中覆盖全局的模型参数（如 `model`, `temperature` 等），这为动态调整 AI 行为提供了极大的灵活性。\n\n在我们之前的代码中是如下编写的，可以把 `chatClient.prompt()` 理解为**一次新的对话的“发起”或“启动信号”**。\n\n```java\n    /**\n     * 流式内容调用：返回纯文本内容的响应流\n     * @param message 用户的提问\n     * @return 一个包含文本内容片段的 Flux 流\n     */\n    public Flux<String> getStreamContent(String message) {\n        return chatClient.prompt()\n                .user(message)\n                .stream()\n                .content();\n    }\n```\n\n那么，既然有这么便捷的方式，为什么 Spring AI 还要设计一个看起来有些“繁琐”的 `Prompt` 类呢？\n\n**答案是：`.user(message)` 只是一个快捷方式。而 `Prompt` 类，才是与AI进行一切复杂、有深度、有上下文交互的“官方语言”和标准容器。**\n\n您可以把它们的关系想象成寄快递：\n\n* **`.user(message)`**：就像是寄一个最简单的**“信封”**。您只需把信（`message`）塞进去，写上地址，它就能寄出。非常快捷，但功能有限。\n* **`Prompt` 类**：这是一个可定制的、坚固的**“快递包裹”**。您不仅可以放入用户的信件，还可以放入各种“附件”和“特殊说明”，来指挥收件人（AI）如何处理这份包裹。\n\n `ChatService` 能那么简单，是因为它处理的是最基础的“信封”场景。但一旦需求变得复杂，`Prompt` 类的威力就体现出来了。\n\n以下是 `.user(message)` 这种简单形式**无法做到**，而必须使用 `Prompt` 类才能实现的核心功能：\n\n##### **4.2.1 角色扮演与指令设定 (`SystemMessage`)**\n\n我们经常需要AI扮演一个特定的角色或遵循特定的规则。这通过 `SystemMessage`（系统消息）来实现，而 `SystemMessage` 必须被包裹在 `Prompt` 对象中。\n\n**您的示例代码正是完美的说明：**\n\n```java\n    /**\n     * 流式内容调用：返回纯文本内容的响应流\n     * @param message 用户的提问\n     * @return 一个包含文本内容片段的 Flux 流\n     */\n    public Flux<String> getStreamContent(String message) {\n        return chatClient.prompt()\n                .system("你是一个擅长翻译的大语言模型,会吧用户说的中文都翻译为英文")\n                .user(message)\n                .stream()\n                .content();\n    }\n```\n`.user()` 快捷方式无法单独传递这种系统级的“人设”指令。\n\n##### **4.2.2. 提供上下文与对话历史 (`AssistantMessage`)**\n\n这是实现**多轮对话**的核心。为了让AI“记住”之前的对话，我们需要把历史聊天记录一起发送给它。这些历史记录就包含了之前的 `UserMessage` 和 `AssistantMessage`（AI的回答）。\n\n**场景示例：**\n1.  **用户**：“2022年世界杯谁赢了？”\n2.  **AI**：“阿根廷队赢得了2022年世界杯。”\n3.  **用户**：“他们的队长是谁？”  <-- *如果只发送这个问题，AI无法理解“他们”是谁*\n\n要让AI正确回答，我们必须构建一个包含历史记录的 `Prompt`：\n```java\nList<Message> conversationHistory = List.of(\n    new UserMessage("2022年世界杯谁赢了？"),\n    new AssistantMessage("阿根廷队赢得了2022年世界杯。"),\n    new UserMessage("他们的队长是谁？") // 当前问题\n);\n\nPrompt promptWithHistory = new Prompt(conversationHistory);\n// 发送这个携带了完整上下文的 Prompt，AI 才能知道 "他们" 指的是阿根廷队\nChatResponse response = chatClient.call(promptWithHistory); \n// AI 会回答 "利昂内尔·梅西是他们的队长。"\n```\n`ChatMemory` 的工作原理，本质上就是在后台自动帮我们组装这个包含历史记录的 `List<Message>`，并创建 `Prompt` 对象。\n\n##### **4.2.3 请求级选项覆盖 (`PromptOptions`)**\n\n有时，我们可能希望某一次特定的API调用使用不同的模型或参数（比如更高的 `temperature` 来增加创意），而不想修改全局配置。`Prompt` 类允许我们在创建时附加一个 `PromptOptions` 对象。\n\n```java\n// 假设全局配置的模型是 deepseek-chat, temperature 是 0.7\n// 但这次我想要更有创意的回答\n\nOpenAiChatOptions customOptions = OpenAiChatOptions.builder()\n        .withModel("gpt-4o") // 本次调用临时切换到 gpt-4o\n        .withTemperature(0.95f) // 大幅提高温度\n        .build();\n\nPrompt creativePrompt = new Prompt("写一首关于机器人在雨中哭泣的诗。", customOptions);\nchatClient.call(creativePrompt);\n```\n\n\n\n\n\n\n\n\n\n\n\n#### 4.3 `Message` 与角色\n\n`Message` 是构成 `Prompt` 的基本单位。Spring AI 定义了四种核心的 `Message` 类型，它们分别对应了与模型对话中不同的角色。理解并善用它们，是实现高级、可控的人工智能交互``的关键。\n\n下表详细说明了每种消息类型的作用和典型应用场景：\n\n| **消息类型 (Message Type)**             | **核心作用**                                                 | **典型应用场景与示例**                                       |\n| --------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| **`SystemMessage`**&lt;br>(系统消息)    | 用于设定 AI 的**角色、行为准则、个性、目标**和任何高级指令。它就像是给 AI 的“出厂设置”或“后台指令”，通常在对话开始时发送，并对整个对话过程持续生效，是**优先级最高**的指令。 | 为 AI 赋予人格或限定其能力范围                               |\n| **`UserMessage`**&lt;br>(用户消息)      | 代表**最终用户的输入**。它就是用户的提问、指令或对话内容。在一次请求中，这通常是消息列表的最后一条。 | 用户向 AI 发起的每一次具体的提问                             |\n| **`AssistantMessage`**&lt;br>(助手消息) | 代表 **AI 自己之前**的回复。它是构建多轮对话历史、让 AI **“记住”上下文**的关键部分。 | 在实现对话记忆（Chat Memory）功能时，将历史记录中的每一条 AI 回复封装起来，重新传回给模型 |\n| **`FunctionMessage`**&lt;br>(函数消息)  | 用于**函数/工具调用（Function/Tool Calling）场景。当 AI 决定调用一个外部工具后，应用需要将该工具的执行结果**通过 `FunctionMessage` 返回给 AI，以便它能根据结果生成最终的自然语言回答。 | AI 需要获取实时信息或执行操作时                              |\n\n------\n\n#### 4.4 `PromptTemplate`：让 Prompt 动起来\n\n在实际应用中，我们的 Prompt 很少是完全静态的。通常需要根据用户的输入、查询的数据库结果或其他动态信息来构建。手动拼接字符串不仅繁琐、易错，而且难以维护。`PromptTemplate` 正是为此而生。\n\n`PromptTemplate` 允许你定义一个包含占位符（变量）的模板字符串，然后用一个 `Map` 来填充这些变量，最终渲染出一个完整的 `Prompt` 对象。\n\n##### 4.4.1 简单示例：个性化问候\n\n```java\n// 文件路径: src/main/java/com/example/hellospringai/service/ChatService.java\npackage com.example.hellospringai.service;\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.stereotype.Service;\nimport reactor.core.publisher.Flux;\n\n@Service\npublic class ChatService {\n\n    private final ChatClient chatClient;\n\n    public ChatService(ChatClient chatClient) {\n        this.chatClient = chatClient;\n    }\n\n    /**\n     * 【新方法】使用 PromptTemplate 实现动态翻译功能\n     * @param targetLanguage 要翻译的目标语言 (e.g., "英文", "日文", "法文")\n     * @param text 要翻译的原文\n     * @return 翻译后的文本内容流\n     */\n    public Flux<String> getDynamicTranslatedStream(String targetLanguage, String text) {\n        \n        // 1. 定义包含 {targetLanguage} 占位符的系统指令模板\n        String systemPromptTemplate = "你是一个专业的、精通多种语言的翻译家。" + \n                                      "请将用户接下来发送的所有内容都翻译成 {targetLanguage}。" +\n                                      "不要添加任何与翻译结果无关的解释或寒暄。";\n\n        return chatClient.prompt()\n                // 2. 使用流式API的高级形式，直接传入模板和变量来构建 SystemMessage\n                .system(systemSpec -> systemSpec\n                        .text(systemPromptTemplate) // 设置模板字符串\n                        .param("targetLanguage", targetLanguage) // 绑定模板中的变量\n                )\n                .user(text) // 用户输入原文\n                .stream()\n                .content();\n    }\n}\n```\n\n#### 4.5 结构化输出：将 AI 响应映射为 POJO\n\n我们经常需要 AI 返回的不仅仅是一段自由文本，而是一个**结构化的数据**，比如 JSON。传统的做法是让 AI 生成 JSON 字符串，然后在 Java 代码中手动解析它。这种方式非常脆弱，因为 AI 可能返回一个格式不正确的 JSON，导致解析失败。\n\n`OutputConverter` 是 Spring AI 提供的利器，它能将模型的文本输出**自动、安全地转换为指定的 Java 对象**。\n\n##### 4.5.1 `BeanOutputConverter` 简单提取Json文本数据\n\n假设我们希望 AI 从一段简历描述中，提取出候选人的姓名、工作年限和技能列表，并封装到一个 `Candidate` DTO (Data Transfer Object) 中。\n\n**第一步：定义数据模型 (`Candidate.java`)**\n\n在这之前我们讲解两个核心的知识点\n\n1.`var` 是 Java 10 引入的一个重要特性，它被称为**局部变量类型推断 **。\n\n**1. 传统方式（没有 `var`）**\n\n在处理复杂的泛型类型时，代码会显得非常冗长和重复。\n\n```java\n// 左边写了一长串类型，右边又写了一遍\nBeanOutputConverter<Candidate> candidateBeanOutputConverter = new BeanOutputConverter<>(Candidate.class);\n```\n\n**2. 使用 `var` 的现代方式**\n\n编译器会帮我们自动推断类型，代码变得极其简洁。\n\n```java\nvar OutputConverter = new BeanOutputConverter<>(Candidate.class);\n```\n\n\n\n2.使用 Java 17 的 `record` 关键字可以极大地简化代码\n\n让我们通过一个 `Person` 类的例子，来直观地感受一下 `record` 带来的巨大便利。\n\n**1. 在没有 `record` 之前 (传统方式)**\n\n我们需要写下面这么多代码，才能创建一个功能完备、不可变的数据类：\n\n```java\n// TraditionalPerson.java\nimport java.util.Objects;\n\npublic final class TraditionalPerson { // final 保证不可继承\n\n    private final String name; // private final 保证不可变\n    private final int age;\n\n    public TraditionalPerson(String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (o == null || getClass() != o.getClass()) return false;\n        TraditionalPerson that = (TraditionalPerson) o;\n        return age == that.age && Objects.equals(name, that.name);\n    }\n\n    @Override\n    public int hashCode() {\n        return Objects.hash(name, age);\n    }\n\n    @Override\n    public String toString() {\n        return "TraditionalPerson[" +\n                "name=\'" + name + \'\\\'\' +\n                ", age=" + age +\n                \']\';\n    }\n}\n```\n\n **2. 有了 `record` 之后 (现代方式)**\n\n现在，使用 `record` 关键字，我们可以用**一行代码**实现与上面完全相同的功能：\n\n```java\n// Person.java\npublic record Person(String name, int age) {}\n```\n\n现在，我们在 `com.example.hellospringai` 包下创建一个新的 `dto` 包，并在其中定义我们的数据传输对象。\n\n```java\n// 文件路径: src/main/java/com/example/hellospringai/dto/Candidate.java\npackage com.example.hellospringai.dto;\n\nimport java.util.List;\n\npublic record Candidate(\n        String name, // 候选者名称\n        int yearsOfExperience, // 工作经验\n        List<String> skills // 技能\n) {}\n```\n\n**第二步：创建解析服务 (`ExtractionService.java`)**\n\n接下来，在 `service` 包中创建一个新服务，该服务封装了调用 AI 进行信息提取的核心逻辑。\n\n```java\n// 文件路径: src/main/java/com/example/hellospringai/service/ExtractionService.java\npackage com.example.hellospringai.service;\n\nimport com.example.hellospringai.dto.Candidate;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.prompt.Prompt;\nimport org.springframework.ai.chat.prompt.Prompt;\nimport org.springframework.ai.chat.prompt.PromptTemplate;\nimport org.springframework.ai.converter.BeanOutputConverter;\nimport org.springframework.stereotype.Service;\n\nimport java.util.Map;\n\n@Service\npublic class ExtractionService {\n\n    private final ChatClient chatClient;\n\n    public ExtractionService(ChatClient chatClient) {\n        this.chatClient = chatClient;\n    }\n\n    public Candidate extractCandidateFrom(String resumeText) {\n        // 1. 创建一个 BeanOutputConverter 实例，传入目标 DTO 的 Class\n        var OutputConverter = new BeanOutputConverter<>(Candidate.class);\n\n        // 2. 获取格式化指令。这会生成一段文本，指导 AI 如何格式化其 JSON 输出。\n        String formatInstructions = OutputConverter.getFormat();\n\n        // 3. 将格式化指令整合到我们的 PromptTemplate 中\n        String promptTemplateString = """\n                从下面的简历文本中提取信息。\n                {format}\n                简历文本:\n                {resume}\n                """;\n        PromptTemplate promptTemplate = new PromptTemplate(promptTemplateString);\n\n        // 4. 渲染 Prompt，传入简历文本和格式化指令\n        Prompt prompt = promptTemplate.create(Map.of(\n                "resume", resumeText,\n                "format", formatInstructions\n        ));\n\n        // 5. 调用 ChatClient，并直接使用 OutputConverter 解析响应\n        // .call().entity() 是一个便捷方法，它会调用AI并自动使用我们提供的解析器\n        return chatClient.prompt(prompt)\n                .call()\n                .entity(OutputConverter);\n    }\n}\n```\n\n> **代码优化点**：\n> 在最新版本的 Spring AI 中，我们可以使用更简洁的 `.call().entity(outputParser)` 链式调用，它等同于您笔记中的 `.call()` 后再手动 `.parse()`，但代码更具可读性。\n\n**第三步：创建 API 端点 (`ExtractionController.java`)**\n\n为了能通过 HTTP 请求使用我们的解析服务，我们在 `controller` 包中创建一个新的控制器。\n\n```java\n// 文件路径: src/main/java/com/example/hellospringai/controller/ExtractionController.java\npackage com.example.hellospringai.controller;\n\nimport com.example.hellospringai.dto.Candidate;\nimport com.example.hellospringai.service.ExtractionService;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.Map;\n\n@RestController\n@RequestMapping("/api/v1")\npublic class ExtractionController {\n\n    private final ExtractionService extractionService;\n\n    public ExtractionController(ExtractionService extractionService) {\n        this.extractionService = extractionService;\n    }\n\n    @PostMapping("/extract")\n    public Candidate extractData(@RequestBody Map<String, String> request) {\n        String resumeText = request.get("resumeText");\n        return extractionService.extractCandidateFrom(resumeText);\n    }\n}\n```\n\n**第四步：运行与测试**\n\n1.  启动您的 Spring Boot 应用。\n2.  使用 `curl` 或任何 API 测试工具，向 `/ai/extract` 端点发送一个 `POST` 请求。\n\n**`curl` 命令示例：**\n\n```bash\ncurl -X POST http://localhost:8080/ai/extract -H "Content-Type: application/json" -d "{\\"resumeText\\": \\"张三是一名资深软件工程师，拥有超过8年的Java开发经验。他精通Spring Boot, Microservices, 和 Docker技术。\\"}"\n```\n\n**预期 JSON 响应：**\n您将会收到一个由 Spring Boot 自动序列化后的、结构清晰的 `Candidate` JSON 对象。\n\n```json\n{\n  "name": "张三",\n  "yearsOfExperence": 8,\n  "skills": [\n    "Java",\n    "Spring Boot",\n    "Microservices",\n    "Docker"\n  ]\n}\n```\n\n> **`BeanOutputConverter` 的价值**：它不仅仅是 JSON 解析器。它在 Prompt 和解析之间建立了一座桥梁，通过在 Prompt 中注入格式指令，极大地提高了模型输出结构化数据的**可靠性和稳定性**。这是构建生产级、可依赖的 AI 应用不可或缺的一环。\n\n除了 `BeanOutputConverter`，Spring AI 还提供了 `MapOutputConverter`（将输出解析为 `Map<String, Object>`）和 `ListOutputConverter`（将输出解析为 `List<String>`），以适应不同的场景需求\n\n\n-----\n\n##### 4.5.2 `ListOutputParser`: 提取为字符串列表\n\n当您只需要从文本中提取一个简单的列表时（例如，所有的技能、所有的城市名），`ListOutputParser` 是最便捷的选择。\n\n**第一步：在 `ExtractionService.java` 中添加新方法**\n\n我们将添加一个 `extractSkillsToList` 方法，它只提取技能列表。\n\n```java\n// 在 ExtractionService.java 中添加此方法\npackage com.example.hellospringai.service;\n\nimport org.springframework.ai.parser.ListOutputParser; // 新增 import\nimport org.springframework.core.convert.support.DefaultConversionService; // 新增 import\n// ... 其他 import\n\n@Service\npublic class ExtractionService {\n    // ... 已有代码 ...\n\n    public List<String> extractSkillsToList(String resumeText) {\n        // 1. ListOutputParser 需要一个 ConversionService，我们使用默认的即可\n        var outputParser = new ListOutputParser(new DefaultConversionService());\n\n        // 2. 它的格式化指令非常简单，会告诉AI返回一个逗号分隔的列表\n        String formatInstructions = outputParser.getFormat();\n        \n        String promptTemplateString = """\n                从下面的文本中，只列出提到的所有技术技能。\n                {format}\n                文本: {resume}\n                """;\n        PromptTemplate promptTemplate = new PromptTemplate(promptTemplateString);\n        Prompt prompt = promptTemplate.create(Map.of(\n                "resume", resumeText,\n                "format", formatInstructions\n        ));\n\n        return chatClient.prompt(prompt)\n                .call()\n                .entity(outputParser);\n    }\n}\n```\n\n**第二步：在 `ExtractionController.java` 中添加新端点**\n\n```java\n// 在 ExtractionController.java 中添加此方法\npackage com.example.hellospringai.controller;\n\nimport java.util.List; // 新增 import\n// ... 其他 import\n\n@RestController\n@RequestMapping("/ai")\npublic class ExtractionController {\n    // ... 已有代码 ...\n\n    @PostMapping("/skills-list")\n    public List<String> extractSkills(@RequestBody Map<String, String> request) {\n        String resumeText = request.get("resumeText");\n        return extractionService.extractSkillsToList(resumeText);\n    }\n}\n```\n\n**第三步：测试 `ListOutputParser`**\n\n使用 `postman` 测试新端点：\n\nhttp://localhost:8080/ai/skills-list\n\n```bash\n{\n  "resumeText": "张三是一名资深软件工程师，拥有超过8年的Java开发经验。他精通Spring Boot, Microservices, 和 Docker技术。"\n}\n```\n\n**预期 JSON 响应：**\n\n```json\n[\n  "Java",\n  "Spring Boot",\n  "Microservices",\n  "Docker"\n]\n```\n\n-----\n\n##### 4.5.3 `MapOutputParser`: 提取为键值对 Map\n\n当您需要提取一组不固定的键值对，或者不想为此专门创建一个Java类时，`MapOutputParser` 非常有用。\n\n**第一步：在 `ExtractionService.java` 中添加新方法**\n\n我们将添加一个 `extractFactsToMap` 方法，用于提取关于一个主题的几个关键事实。\n\n```java\n// 在 ExtractionService.java 中添加此方法\npackage com.example.hellospringai.service;\n\nimport org.springframework.ai.parser.MapOutputParser; // 新增 import\n// ... 其他 import\n\n@Service\npublic class ExtractionService {\n    // ... 已有代码 ...\n\n    public Map<String, Object> extractFactsToMap(String topic) {\n        var outputParser = new MapOutputConverter();\n        String formatInstructions = outputParser.getFormat();\n\n        String promptTemplateString = """\n                请提供关于 "{topic}" 的三个有趣的事实，必须以中文回复\n                {format}\n                """;\n        PromptTemplate promptTemplate = new PromptTemplate(promptTemplateString);\n        Prompt prompt = promptTemplate.create(Map.of(\n                "topic", topic,\n                "format", formatInstructions\n        ));\n\n        return chatClient.prompt(prompt)\n                .call()\n                .entity(outputParser);\n    }\n}\n```\n\n**第二步：在 `ExtractionController.java` 中添加新端点**\n\n```java\n// 在 ExtractionController.java 中添加此方法\npackage com.example.hellospringai.controller;\n// ... 其他 import\n\n@RestController\n@RequestMapping("/ai")\npublic class ExtractionController {\n    // ... 已有代码 ...\n\n    @PostMapping("/facts-map")\n    public Map<String, Object> extractFacts(@RequestBody Map<String, String> request) {\n        String topic = request.get("topic");\n        return extractionService.extractFactsToMap(topic);\n    }\n}\n```\n\n**第三步：测试 `MapOutputParser`**\n\n使用 `post` 命令测试新端点：\n\nhttp://localhost:8080/ai/facts-map\n\n```bash\n{"topic": "程序员笑话"}\n```\n\n**预期 JSON 响应 (内容可能不同)：**\n\n```json\n{\n    "1": "程序员最喜欢的节日是\'1024程序员节\'，因为1024在计算机中是2的10次方，象征着程序员的世界。",\n    "2": "有一个经典的笑话：为什么程序员总是分不清万圣节和圣诞节？因为Oct 31 == Dec 25（八进制31等于十进制25）。",\n    "3": "程序员最讨厌的动物是Bug，因为它们总是在最不合适的时候出现，而且很难彻底清除。"\n}\n```\n\n通过这三个解析器的实战，我们已经掌握了让AI以可预测、可靠的结构化格式返回数据的核心技巧，这是构建生产级AI应用不可或缺的一环。\n\n\n\n掌握了本章的内容，你已经从一个只会简单提问的 AI 用户，成长为一名懂得如何通过精心设计的 Prompt 来指挥和驾驭 AI 的“工程师”。这是从“使用 AI”到“构建 AI 应用”的关键一步。'}</script></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f747174bc3.webp" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/user/status.png" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.4;color:rgba(255,255,255,.9);text-align:center">🚀 全栈开发者，专注于构建优雅高效的数字解决方案<br><span style="color:#fff;font-weight:700">前端 · 后端 · 架构 · 优化</span><br>📚 分享实战经验，一起探索技术边界</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Prorise</h1><div class="author-info__desc">这聒噪的世界让沉默的人显得另类</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/361040115?spm_id_from=333.1387.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background:url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center/100% no-repeat"></div><div class="back face" style="background:url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center/100% no-repeat"></div></div></div></div><div class="card-widget card-latest-comments"><div class="item-headline"><i class="fas fa-comments"></i><span>最新评论</span></div><div class="item-content"><a href="/messages/" class="headline-right" title="查看更多"><i class="fas fa-angle-right"></i></a><div class="aside-list" id="latest-comments"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B7%B1%E5%85%A5-Prompt-%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">4. 深入 Prompt 工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-Prompt-%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7%E4%B8%8E%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99"><span class="toc-number">1.0.1.</span> <span class="toc-text">4.1 Prompt 的重要性与基本原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-Prompt-%E7%B1%BB%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.0.2.</span> <span class="toc-text">4.2 Prompt 类详解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-1-%E8%A7%92%E8%89%B2%E6%89%AE%E6%BC%94%E4%B8%8E%E6%8C%87%E4%BB%A4%E8%AE%BE%E5%AE%9A-SystemMessage"><span class="toc-number">1.0.2.1.</span> <span class="toc-text">4.2.1 角色扮演与指令设定 (SystemMessage)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-2-%E6%8F%90%E4%BE%9B%E4%B8%8A%E4%B8%8B%E6%96%87%E4%B8%8E%E5%AF%B9%E8%AF%9D%E5%8E%86%E5%8F%B2-AssistantMessage"><span class="toc-number">1.0.2.2.</span> <span class="toc-text">4.2.2. 提供上下文与对话历史 (AssistantMessage)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-3-%E8%AF%B7%E6%B1%82%E7%BA%A7%E9%80%89%E9%A1%B9%E8%A6%86%E7%9B%96-PromptOptions"><span class="toc-number">1.0.2.3.</span> <span class="toc-text">4.2.3 请求级选项覆盖 (PromptOptions)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-Message-%E4%B8%8E%E8%A7%92%E8%89%B2"><span class="toc-number">1.0.3.</span> <span class="toc-text">4.3 Message 与角色</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-PromptTemplate%EF%BC%9A%E8%AE%A9-Prompt-%E5%8A%A8%E8%B5%B7%E6%9D%A5"><span class="toc-number">1.0.4.</span> <span class="toc-text">4.4 PromptTemplate：让 Prompt 动起来</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-1-%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B%EF%BC%9A%E4%B8%AA%E6%80%A7%E5%8C%96%E9%97%AE%E5%80%99"><span class="toc-number">1.0.4.1.</span> <span class="toc-text">4.4.1 简单示例：个性化问候</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA%EF%BC%9A%E5%B0%86-AI-%E5%93%8D%E5%BA%94%E6%98%A0%E5%B0%84%E4%B8%BA-POJO"><span class="toc-number">1.0.5.</span> <span class="toc-text">4.5 结构化输出：将 AI 响应映射为 POJO</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-1-BeanOutputConverter-%E7%AE%80%E5%8D%95%E6%8F%90%E5%8F%96Json%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE"><span class="toc-number">1.0.5.1.</span> <span class="toc-text">4.5.1 BeanOutputConverter 简单提取Json文本数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-2-ListOutputParser-%E6%8F%90%E5%8F%96%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%97%E8%A1%A8"><span class="toc-number">1.0.5.2.</span> <span class="toc-text">4.5.2 ListOutputParser: 提取为字符串列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-3-MapOutputParser-%E6%8F%90%E5%8F%96%E4%B8%BA%E9%94%AE%E5%80%BC%E5%AF%B9-Map"><span class="toc-number">1.0.5.3.</span> <span class="toc-text">4.5.3 MapOutputParser: 提取为键值对 Map</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/56706.html" title="附录"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="附录"></a><div class="content"><a class="title" href="/posts/56706.html" title="附录">附录</a><time datetime="2025-06-15T22:13:45.000Z" title="发表于 2025-06-16 06:13:45">2025-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/27374.html" title="14. 社区、生态与未来展望"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="14. 社区、生态与未来展望"></a><div class="content"><a class="title" href="/posts/27374.html" title="14. 社区、生态与未来展望">14. 社区、生态与未来展望</a><time datetime="2025-06-15T21:13:45.000Z" title="发表于 2025-06-16 05:13:45">2025-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/36675.html" title="13. 实战项目：构建一个完整的 AI 知识库应用"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="13. 实战项目：构建一个完整的 AI 知识库应用"></a><div class="content"><a class="title" href="/posts/36675.html" title="13. 实战项目：构建一个完整的 AI 知识库应用">13. 实战项目：构建一个完整的 AI 知识库应用</a><time datetime="2025-06-15T20:13:45.000Z" title="发表于 2025-06-16 04:13:45">2025-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/17745.html" title="12. 生产环境考量与部署"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="12. 生产环境考量与部署"></a><div class="content"><a class="title" href="/posts/17745.html" title="12. 生产环境考量与部署">12. 生产环境考量与部署</a><time datetime="2025-06-15T19:13:45.000Z" title="发表于 2025-06-16 03:13:45">2025-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/24414.html" title="11. ETL 框架：文档处理与数据摄取"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/19/68535b23089d0.webp" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" alt="11. ETL 框架：文档处理与数据摄取"></a><div class="content"><a class="title" href="/posts/24414.html" title="11. ETL 框架：文档处理与数据摄取">11. ETL 框架：文档处理与数据摄取</a><time datetime="2025-06-15T18:13:45.000Z" title="发表于 2025-06-16 02:13:45">2025-06-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:3381292732@qq.com" rel="external nofollow noreferrer" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://weibo.com/u/7484736298?tabtype=home" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/06/16/684f745b722d7.webp" size="50px"><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Prorise-cool" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://space.bilibili.com/361040115?spm_id_from=333.788.0.0" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="workboard"><div id="runtimeTextTip"></div></div><div class="footer_custom_text">这是我的个人博客，分享技术与生活点滴。</div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener external nofollow noreferrer" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.foreverblog.cn/">十年之约</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/docs/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" rel="external nofollow noreferrer" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="博客框架为Hexo7.0" title="博客框架为Hexo7.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo7.0"></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"></a><a class="github-badge" target="_blank" href="https://github.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站采用CC BY-NC-SA 4.0协议" title="本站采用CC BY-NC-SA 4.0协议"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用CC BY-NC-SA 4.0协议"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2025 By <a class="footer-bar-link" href="/about/" title="Prorise" target="_blank">Prorise</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗, 万物可爱, 人间值得, 未来可期.","愿你眼里的星星，永远亮晶晶。","愿我们每个人都能被世界温柔以待。"]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/typed.js/2.0.12/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Prorise-cool?tab=repositories" title="网站源码">网站源码</a><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/" title="湘ICP备23041-302号">湘ICP备23041-302号</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">2</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" rel="external nofollow noreferrer" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="后续项目..."><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="后续项目..."><span class="back-menu-item-text">后续项目...</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>个人</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fas fa-check-double faa-tada"></i><span> 代办清单</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/awesome-links/"><i class="fas fa-link faa-tada"></i><span> 实用网站</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>预览</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?server=netease&amp;id=3117791189"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fas fa-comments faa-tada"></i><span> 评论总览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 即刻短文</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1-AI%E7%AF%87/" style="font-size:.88rem">Java微服务-AI篇<sup>15</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><button id="to_comment" type="button" title="直达评论" onclick="FixedCommentBtn()"><i class="anzhiyufont anzhiyu-icon-comments"></i></button><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" rel="external nofollow noreferrer" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="download-md-btn" type="button" title="下载文章源文件"><i class="anzhiyufont anzhiyu-icon-download"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="3117791189" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=3117791189&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>//- 从这里开始的所有JS代码，都必须有缩进（例如2个空格）
// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("06/10/2025 00:00:00"); // 此处读取您配置中的建站时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  
  // --- 已将您的专属LOGO和个人信息集成到这里 ---
  const ascll = [
    `欢迎访问 Prorise 的数字空间!`,
    `代码构建世界，思想驱动未来`,
    // 这里的反引号和所有ASCII art行，都必须有正确的缩进
    `
     ____                      _             
    |  _ \\  _ __   ___   _ __  (_) ___   ___  
    | |_) || '__| / _ \\ | '__| | |/ __| / _ \\ 
    |  __/ | |   | (_) || |    | |\\__ \\|  __/ 
    |_|    |_|    \\___/ |_|    |_||___/ \\___| 
                                             
    `,
    "已稳定运行",
    dnum,
    "天",
    `©2025 By Prorise 1.0.0`,
  ];
  
  const ascll2 = [`SYS-INFO`, `前置摄像头拍照成功`, `您的帅气脸庞为：`, `😎`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c${ascll[2]} \n%c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF; font-family:monospace;",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );

  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，朋友.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Created by Prorise %c 你正在访问 Prorise 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 注意，你的所有操作已被记录.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script async="">(function () {
  var grt = new Date("06/10/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.prorise666.site/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.prorise666.site/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  let initFn = window.walineFn || null

  const initWaline = (Fn) => {
    const waline = Fn(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline.prorise666.site',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
      imageUploader: true,
    }, null))

    const destroyWaline = () => {
      waline.destroy()
    }

    anzhiyu.addGlobalFn('pjax', destroyWaline, 'destroyWaline')
  }

  const loadWaline = async () => {
    if (initFn) initWaline(initFn)
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.css')
      if (true) await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline-meta.css')
      const { init } = await import('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.js')
      initFn = init || Waline.init
      initWaline(initFn)
      window.walineFn = initFn
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.prorise666.site/',
        region: 'ap-shanghai',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async="" data-pjax="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail=""</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="/js/load-on-demand.js"></script><script src="/custom/js/markdown-download.js"></script><script defer="" id="fluttering_ribbon" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="//code.tidio.co//tk571vck0ua2wjoalfbp8wyrlsdaunmz.js" async=""></script><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    let isShow = false
    const close = () => {
      window.tidioChatApi.hide()
      isShow = false
      document.body.style.position = 'relative';
      document.documentElement.style.overflow = 'auto'
    }
    
    const open = () => {
      window.tidioChatApi.open()
      window.tidioChatApi.show()
      isShow = true
    }

    const onTidioChatApiReady = () => {
      window.tidioChatApi.hide()
      window.tidioChatApi.on("close", close)
    }
    if (window.tidioChatApi) {
      window.tidioChatApi.on("ready", onTidioChatApiReady)
    } else {
      document.addEventListener("tidioChat-ready", onTidioChatApiReady)
    }

    window.chatBtnFn = () => {
      if (!window.tidioChatApi) return
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        window.tidioChatApi && window.tidioChatApi.hide()
      },
      show: () => {
        window.tidioChatApi && window.tidioChatApi.show()
      }
    }
  }
})()</script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://npm.elemecdn.com/meting@2.0.1/dist/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '[object Object]', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div>
    <link rel="stylesheet" href="https://ai.tianli0.top/static/public/postChatUser_summary.min.css">
    <script>
        let tianliGPT_key = '';
        let tianliGPT_postSelector = '#post-container .post-content';
        let tianliGPT_Title = '✨ AI 文章摘要';
        let tianliGPT_postURL = '/^https?:\/\/[^\/]+\/[0-9]{4}\/[0-9]{2}\/[0-9]{2}\/';
        let tianliGPT_blacklist = '';
        let tianliGPT_wordLimit = '1000';
        let tianliGPT_typingAnimate = true;
        let tianliGPT_theme = 'default';
        var postChatConfig = {
          backgroundColor: "#4d648d",
          bottom: "76px",
          left: "16px",
          fill: "#FFFFFF",
          width: "50px",
          frameWidth: "380px",
          frameHeight: "600px",
          defaultInput: true,
          upLoadWeb: true,
          showInviteLink: true,
          userTitle: "💬 智能助手",
          userDesc: "我是 Prorise 博客的 AI 助手，有任何关于网站内容的问题都可以问我哦～",
          addButton: true,
          beginningText: "这篇文章介绍了",
          userIcon: "https://ai.tianli0.top/static/img/PostChat.webp",
          userMode: "magic",
          defaultChatQuestions: ["你好","你是谁"],
          defaultSearchQuestions: ["视频压缩","设计"]
        };
    </script>
    <script data-postchat_key="" src="https://ai.tianli0.top/static/public/tianli_gpt.min.js"></script>
  </body></html>